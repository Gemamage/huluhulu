# AWS S3 配置完整指南 📸

本專案已為您準備了完整的 AWS S3 照片上傳解決方案。請按照以下步驟進行設定：

## 📁 相關檔案說明

| 檔案 | 用途 |
|------|------|
| `AWS_S3_SETUP_GUIDE.md` | 詳細的 AWS S3 設定步驟指南 |
| `AWS_S3_CHECKLIST.md` | 設定檢查清單，確保不遺漏任何步驟 |
| `backend/.env.example` | 環境變數範例檔案 |
| `backend/scripts/setup-env.js` | 互動式環境變數設定助手 |
| `backend/scripts/test-s3-connection.js` | S3 連線測試腳本 |

## 🚀 快速開始

### 方法一：使用互動式設定助手（推薦）

```bash
# 進入後端目錄
cd backend

# 執行環境設定助手
npm run setup:env

# 測試 S3 連線
npm run test:s3

# 重新啟動後端服務器
npm run dev
```

### 方法二：手動設定

```bash
# 1. 複製環境變數範例檔案
cp backend/.env.example backend/.env

# 2. 編輯 .env 檔案，填入您的 AWS 憑證
# 參考 AWS_S3_SETUP_GUIDE.md 獲取憑證

# 3. 測試 S3 連線
cd backend
npm run test:s3

# 4. 重新啟動後端服務器
npm run dev
```

## 📋 設定步驟概覽

1. **📖 閱讀設定指南**
   - 開啟 `AWS_S3_SETUP_GUIDE.md`
   - 按照步驟創建 AWS 帳號和 S3 儲存桶

2. **🔐 獲取 AWS 憑證**
   - 創建 IAM 使用者
   - 生成存取金鑰
   - 記錄憑證資訊

3. **⚙️ 配置環境變數**
   - 使用 `npm run setup:env` 或手動編輯 `.env`
   - 填入 AWS 憑證和儲存桶資訊

4. **🧪 測試配置**
   - 執行 `npm run test:s3`
   - 確保所有測試通過

5. **🎉 開始使用**
   - 重新啟動服務器
   - 測試照片上傳功能

## 🛠️ 可用命令

```bash
# 環境設定
npm run setup:env          # 互動式環境變數設定

# 測試命令
npm run test:s3            # 測試 S3 連線和權限

# 開發命令
npm run dev                # 啟動後端開發服務器
```

## 📊 S3 測試腳本功能

`npm run test:s3` 會執行以下測試：

- ✅ 檢查 AWS 憑證設定
- ✅ 驗證存取權限
- ✅ 檢查目標儲存桶是否存在
- ✅ 測試儲存桶權限
- ✅ 測試檔案上傳功能
- ✅ 測試檔案刪除功能

## 💰 費用說明

### AWS 免費方案（12個月）
- 5GB S3 標準儲存
- 20,000 GET 請求/月
- 2,000 PUT 請求/月
- 100GB 資料傳輸/月

### 預估月費用（超出免費額度）
- 儲存：約 $0.023/GB
- 請求：GET $0.0004/1000次，PUT $0.005/1000次
- 對於小型專案，通常每月費用 < $1 USD

## 🔒 安全最佳實踐

1. **環境變數安全**
   ```bash
   # 確保 .env 在 .gitignore 中
   echo ".env" >> .gitignore
   ```

2. **定期輪換金鑰**
   - 建議每 90 天更換 AWS 存取金鑰
   - 使用 AWS IAM 監控金鑰使用情況

3. **最小權限原則**
   - IAM 使用者僅給予必要的 S3 權限
   - 定期檢查和清理不必要的權限

## ❗ 常見問題解決

### 上傳失敗
```bash
# 檢查 S3 連線
npm run test:s3

# 檢查後端日誌
npm run dev
# 查看終端輸出的錯誤訊息
```

### 圖片無法顯示
- 檢查儲存桶政策是否允許公開讀取
- 確認圖片 URL 格式正確
- 檢查 CORS 設定

### 權限錯誤
- 確認 IAM 使用者有 S3 權限
- 檢查存取金鑰是否正確
- 驗證儲存桶名稱和區域設定

## 📞 技術支援

如果遇到問題：

1. **檢查設定**
   - 使用 `AWS_S3_CHECKLIST.md` 逐項檢查
   - 執行 `npm run test:s3` 診斷問題

2. **查看文件**
   - `AWS_S3_SETUP_GUIDE.md` - 詳細設定步驟
   - AWS 官方文件

3. **檢查日誌**
   - 後端服務器日誌
   - 瀏覽器開發者工具

---

## 🎯 下一步

設定完成後，您可以：

1. **測試功能**
   - 前往寵物登記頁面
   - 嘗試上傳照片
   - 檢查 S3 儲存桶中的檔案

2. **優化設定**
   - 設定生命週期政策自動清理舊檔案
   - 啟用 CloudFront CDN 加速圖片載入
   - 設定圖片壓縮和縮放

3. **監控使用**
   - 設定 AWS 帳單警報
   - 監控 S3 使用量和費用
   - 定期檢查安全設定

**祝您使用愉快！** 🚀