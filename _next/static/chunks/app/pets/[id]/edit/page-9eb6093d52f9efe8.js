(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8859],{2894:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},3067:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},4035:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},7810:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},6142:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},1541:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},7972:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2549:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(2898).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7678:function(e,t,s){Promise.resolve().then(s.bind(s,7317))},7317:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return k}});var a=s(7437),n=s(2265),r=s(4033),i=s(1396),l=s.n(i),o=s(575),c=s(5671),d=s(7625),u=s(6862),m=s(6210),h=s(7578),p=s(2782),x=s(5005),f=s(5453),g=s(7810),v=s(4035),j=s(6142),b=s(7972),y=s(2894),N=s(6782),w=s(4563);function I(e){var t,s,r,i,l,d,u;let{initialData:m,onSubmit:h,isLoading:I=!1,isSubmitting:S=!1,mode:k,submitButtonText:C}=e,[Z,_]=(0,n.useState)({name:(null==m?void 0:m.name)||"",type:(null==m?void 0:m.type)||"dog",...(null==m?void 0:m.breed)!==void 0&&{breed:m.breed},gender:(null==m?void 0:m.gender)||"unknown",...(null==m?void 0:m.age)!==void 0&&{age:m.age},...(null==m?void 0:m.color)!==void 0&&{color:m.color},...(null==m?void 0:m.size)!==void 0&&{size:m.size},status:(null==m?void 0:m.status)||"lost",...(null==m?void 0:m.description)!==void 0&&{description:m.description},lastSeenLocation:{address:(null==m?void 0:null===(t=m.lastSeenLocation)||void 0===t?void 0:t.address)||"",...(null==m?void 0:null===(s=m.lastSeenLocation)||void 0===s?void 0:s.latitude)!==void 0&&{latitude:m.lastSeenLocation.latitude},...(null==m?void 0:null===(r=m.lastSeenLocation)||void 0===r?void 0:r.longitude)!==void 0&&{longitude:m.lastSeenLocation.longitude}},lastSeenDate:(null==m?void 0:m.lastSeenDate)||new Date().toISOString().split("T")[0],contactInfo:{name:(null==m?void 0:null===(i=m.contactInfo)||void 0===i?void 0:i.name)||"",phone:(null==m?void 0:null===(l=m.contactInfo)||void 0===l?void 0:l.phone)||"",...(null==m?void 0:null===(d=m.contactInfo)||void 0===d?void 0:d.email)&&{email:m.contactInfo.email},preferredContact:(null==m?void 0:null===(u=m.contactInfo)||void 0===u?void 0:u.preferredContact)||"phone"},...(null==m?void 0:m.images)!==void 0&&{images:m.images},...(null==m?void 0:m.reward)!==void 0&&{reward:m.reward},isUrgent:(null==m?void 0:m.isUrgent)||!1,...(null==m?void 0:m.microchipId)!==void 0&&{microchipId:m.microchipId},...(null==m?void 0:m.vaccinated)!==void 0&&{vaccinated:m.vaccinated},...(null==m?void 0:m.medicalConditions)!==void 0&&{medicalConditions:m.medicalConditions},...(null==m?void 0:m.specialMarks)!==void 0&&{specialMarks:m.specialMarks},...(null==m?void 0:m.personality)!==void 0&&{personality:m.personality}}),[z,L]=(0,n.useState)({}),D=()=>{let e=(0,N.wm)(Z);return e.isValid?(L({}),!0):(L((0,N._s)(e.errors)),!1)},M=(e,t)=>{_(s=>{let a=e.split(".");return 1===a.length?{...s,[e]:t}:2===a.length?{...s,[a[0]]:{...s[a[0]],[a[1]]:t}}:s}),z[e]&&L(t=>{let s={...t};return delete s[e],s})},F=async e=>{if(e.preventDefault(),D())try{await h(Z)}catch(e){console.error("表單提交失敗:",e)}};return(0,a.jsxs)(c.Zb,{className:"w-full max-w-4xl mx-auto",children:[(0,a.jsxs)(c.Ol,{children:[(0,a.jsxs)(c.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.Z,{className:"h-5 w-5"}),"create"===k?"新增寵物協尋案例":"編輯寵物資訊"]}),(0,a.jsx)(c.SZ,{children:"請填寫詳細的寵物資訊，幫助我們更好地協助您找到寵物"})]}),(0,a.jsx)(c.aY,{children:(0,a.jsxs)("form",{onSubmit:F,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"基本資訊"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"name",children:"寵物名稱 *"}),(0,a.jsx)(p.I,{id:"name",value:Z.name,onChange:e=>M("name",e.target.value),placeholder:"請輸入寵物名稱",className:z.name?"border-red-500":""}),z.name&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"type",children:"寵物類型 *"}),(0,a.jsxs)("select",{id:"type",value:Z.type,onChange:e=>M("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"dog",children:"狗"}),(0,a.jsx)("option",{value:"cat",children:"貓"}),(0,a.jsx)("option",{value:"bird",children:"鳥"}),(0,a.jsx)("option",{value:"rabbit",children:"兔子"}),(0,a.jsx)("option",{value:"hamster",children:"倉鼠"}),(0,a.jsx)("option",{value:"fish",children:"魚"}),(0,a.jsx)("option",{value:"reptile",children:"爬蟲類"}),(0,a.jsx)("option",{value:"other",children:"其他"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"breed",children:"品種"}),(0,a.jsx)(p.I,{id:"breed",value:Z.breed,onChange:e=>M("breed",e.target.value),placeholder:"請輸入品種",className:z.breed?"border-red-500":""}),z.breed&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.breed})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"gender",children:"性別"}),(0,a.jsxs)("select",{id:"gender",value:Z.gender,onChange:e=>M("gender",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"male",children:"公"}),(0,a.jsx)("option",{value:"female",children:"母"}),(0,a.jsx)("option",{value:"unknown",children:"不明"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"age",children:"年齡"}),(0,a.jsx)(p.I,{id:"age",type:"number",value:Z.age||"",onChange:e=>M("age",e.target.value?parseInt(e.target.value):void 0),placeholder:"請輸入年齡",min:"0",max:"30",className:z.age?"border-red-500":""}),z.age&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.age})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"color",children:"顏色"}),(0,a.jsx)(p.I,{id:"color",value:Z.color,onChange:e=>M("color",e.target.value),placeholder:"請輸入顏色",className:z.color?"border-red-500":""}),z.color&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.color})]})]})]}),(0,a.jsx)(f.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"狀態資訊"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"status",children:"狀態 *"}),(0,a.jsxs)("select",{id:"status",value:Z.status,onChange:e=>M("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"lost",children:"走失"}),(0,a.jsx)("option",{value:"found",children:"找到"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"size",children:"體型"}),(0,a.jsxs)("select",{id:"size",value:Z.size,onChange:e=>M("size",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"small",children:"小型"}),(0,a.jsx)("option",{value:"medium",children:"中型"}),(0,a.jsx)("option",{value:"large",children:"大型"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"description",children:"描述"}),(0,a.jsx)("textarea",{id:"description",value:Z.description,onChange:e=>M("description",e.target.value),placeholder:"請詳細描述寵物的特徵、習性等",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(z.description?"border-red-500":"")}),z.description&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.description})]})]}),(0,a.jsx)(f.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(v.Z,{className:"h-5 w-5"}),"寵物照片"]}),(0,a.jsx)(w.U,{images:Z.images||[],onImagesChange:e=>M("images",e),maxImages:5,maxFileSize:5})]}),(0,a.jsx)(f.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(j.Z,{className:"h-5 w-5"}),"位置資訊"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"lastSeenAddress",children:"最後出現地點 *"}),(0,a.jsx)(p.I,{id:"lastSeenAddress",value:Z.lastSeenLocation.address,onChange:e=>M("lastSeenLocation.address",e.target.value),placeholder:"請輸入詳細地址",className:z["lastSeenLocation.address"]?"border-red-500":""}),z["lastSeenLocation.address"]&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z["lastSeenLocation.address"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"lastSeenDate",children:"最後出現日期 *"}),(0,a.jsx)(p.I,{id:"lastSeenDate",type:"date",value:Z.lastSeenDate?Z.lastSeenDate.split("T")[0]:"",onChange:e=>M("lastSeenDate",e.target.value+"T00:00:00.000Z"),className:"w-full"})]})]}),(0,a.jsx)(f.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5"}),"聯絡資訊"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"contactName",children:"聯絡人姓名 *"}),(0,a.jsx)(p.I,{id:"contactName",value:Z.contactInfo.name,onChange:e=>M("contactInfo.name",e.target.value),placeholder:"請輸入聯絡人姓名",className:z["contactInfo.name"]?"border-red-500":""}),z["contactInfo.name"]&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z["contactInfo.name"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"contactPhone",children:"電話號碼 *"}),(0,a.jsx)(p.I,{id:"contactPhone",value:Z.contactInfo.phone,onChange:e=>M("contactInfo.phone",e.target.value),placeholder:"請輸入電話號碼",className:z["contactInfo.phone"]?"border-red-500":""}),z["contactInfo.phone"]&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z["contactInfo.phone"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"contactEmail",children:"電子郵件"}),(0,a.jsx)(p.I,{id:"contactEmail",type:"email",value:Z.contactInfo.email,onChange:e=>M("contactInfo.email",e.target.value),placeholder:"請輸入電子郵件",className:z["contactInfo.email"]?"border-red-500":""}),z["contactInfo.email"]&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z["contactInfo.email"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"preferredContact",children:"偏好聯絡方式"}),(0,a.jsxs)("select",{id:"preferredContact",value:Z.contactInfo.preferredContact,onChange:e=>M("contactInfo.preferredContact",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"phone",children:"電話"}),(0,a.jsx)("option",{value:"email",children:"電子郵件"})]})]})]})]}),(0,a.jsx)(f.Z,{}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"其他資訊"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"reward",children:"獎勵金額"}),(0,a.jsx)(p.I,{id:"reward",type:"number",value:Z.reward||"",onChange:e=>M("reward",e.target.value?parseInt(e.target.value):void 0),placeholder:"請輸入獎勵金額",min:"0",className:z.reward?"border-red-500":""}),z.reward&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.reward})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"microchipId",children:"晶片 ID"}),(0,a.jsx)(p.I,{id:"microchipId",value:Z.microchipId,onChange:e=>M("microchipId",e.target.value),placeholder:"請輸入晶片 ID",className:z.microchipId?"border-red-500":""}),z.microchipId&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.microchipId})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"isUrgent",checked:Z.isUrgent,onChange:e=>M("isUrgent",e.target.checked),className:"rounded"}),(0,a.jsxs)(x._,{htmlFor:"isUrgent",className:"flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 text-primary"}),"緊急案例"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"vaccinated",checked:Z.vaccinated||!1,onChange:e=>M("vaccinated",e.target.checked),className:"rounded"}),(0,a.jsx)(x._,{htmlFor:"vaccinated",children:"已接種疫苗"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"medicalConditions",children:"醫療狀況"}),(0,a.jsx)("textarea",{id:"medicalConditions",value:Z.medicalConditions,onChange:e=>M("medicalConditions",e.target.value),placeholder:"請描述寵物的醫療狀況或特殊需求",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(z.medicalConditions?"border-red-500":"")}),z.medicalConditions&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.medicalConditions})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"specialMarks",children:"特殊標記"}),(0,a.jsx)("textarea",{id:"specialMarks",value:Z.specialMarks,onChange:e=>M("specialMarks",e.target.value),placeholder:"請描述寵物的特殊標記或特徵",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(z.specialMarks?"border-red-500":"")}),z.specialMarks&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.specialMarks})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x._,{htmlFor:"personality",children:"個性描述"}),(0,a.jsx)("textarea",{id:"personality",value:Z.personality,onChange:e=>M("personality",e.target.value),placeholder:"請描述寵物的個性和習性",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(z.personality?"border-red-500":"")}),z.personality&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:z.personality})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4 pt-6",children:[(0,a.jsx)(o.z,{type:"button",variant:"outline",disabled:I||S,children:"取消"}),(0,a.jsx)(o.z,{type:"submit",disabled:I||S,children:I||S?"處理中...":C||("create"===k?"新增寵物":"更新資訊")})]})]})})]})}var S=s(3067);function k(e){var t,s;let{petId:i}=e,p=(0,r.useRouter)(),{user:x,isAuthenticated:f}=(0,m.a)(),{toast:v}=(0,u.pm)(),[j,b]=(0,n.useState)(null),[y,N]=(0,n.useState)(!0),[w,k]=(0,n.useState)(!1),C=new h.Y;(0,n.useEffect)(()=>{f&&i&&Z()},[f,i]);let Z=async()=>{try{N(!0);let e=await C.getPetById(i);if(("object"==typeof e.owner?e.owner._id:e.owner)!==(null==x?void 0:x.id)){v({title:"權限不足",description:"您只能編輯自己發布的協尋案例",variant:"destructive"}),p.push("/pets/my");return}b(e)}catch(e){console.error("獲取寵物資訊失敗:",e),v({title:"錯誤",description:"無法載入寵物資訊，請稍後再試",variant:"destructive"}),p.push("/pets/my")}finally{N(!1)}},_=async e=>{if(j)try{k(!0);let t={name:e.name,status:e.status,description:e.description,lastSeenLocation:e.lastSeenLocation.latitude&&e.lastSeenLocation.longitude?{address:e.lastSeenLocation.address,coordinates:[e.lastSeenLocation.longitude,e.lastSeenLocation.latitude]}:{address:e.lastSeenLocation.address,coordinates:[0,0]},contactInfo:{phone:e.contactInfo.phone,email:e.contactInfo.email,preferredContact:e.contactInfo.preferredContact}};e.breed&&(t.breed=e.breed),e.age&&(t.age=e.age),e.gender&&(t.gender=e.gender),e.size&&(t.size=e.size),e.color&&(t.color=e.color),await C.updatePet(j._id,t),v({title:"成功",description:"協尋案例已更新"}),p.push("/pets/".concat(j._id))}catch(e){console.error("更新寵物資訊失敗:",e),v({title:"錯誤",description:"更新失敗，請稍後再試",variant:"destructive"})}finally{k(!1)}};if(!f)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(g.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"請先登入"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6",children:"您需要登入才能編輯協尋案例"}),(0,a.jsx)(o.z,{asChild:!0,children:(0,a.jsx)(l(),{href:"/auth/login",children:"前往登入"})})]})});if(y)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-8",children:[(0,a.jsx)(d.O,{className:"h-10 w-10"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.O,{className:"h-8 w-48"}),(0,a.jsx)(d.O,{className:"h-4 w-64"})]})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{children:(0,a.jsx)(d.O,{className:"h-6 w-32"})}),(0,a.jsx)(c.aY,{className:"space-y-6",children:Array.from({length:8}).map((e,t)=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.O,{className:"h-4 w-24"}),(0,a.jsx)(d.O,{className:"h-10 w-full"})]},t))})]})]})});if(!j)return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(g.Z,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"找不到協尋案例"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6",children:"您要編輯的協尋案例不存在或已被刪除"}),(0,a.jsx)(o.z,{asChild:!0,children:(0,a.jsx)(l(),{href:"/pets/my",children:"返回我的協尋"})})]})});let z={name:j.name,type:j.type,...j.breed&&{breed:j.breed},gender:j.gender,...j.age&&{age:j.age},...j.size&&{size:j.size},...j.color&&{color:j.color},status:j.status,...j.description&&{description:j.description},lastSeenLocation:{address:"string"==typeof j.lastSeenLocation?j.lastSeenLocation:(null===(t=j.lastSeenLocation)||void 0===t?void 0:t.address)||"",..."object"==typeof j.lastSeenLocation&&(null===(s=j.lastSeenLocation)||void 0===s?void 0:s.coordinates)&&{latitude:j.lastSeenLocation.coordinates[1],longitude:j.lastSeenLocation.coordinates[0]}},lastSeenDate:j.lastSeenDate?new Date(j.lastSeenDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],contactInfo:{name:j.contactName||"",phone:j.contactPhone||"",...j.contactEmail&&{email:j.contactEmail},preferredContact:"phone"},images:[],isUrgent:!1,isVaccinated:!1};return(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-8",children:[(0,a.jsx)(o.z,{variant:"outline",size:"icon",asChild:!0,children:(0,a.jsx)(l(),{href:"/pets/".concat(j._id),children:(0,a.jsx)(S.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"編輯協尋案例"}),(0,a.jsxs)("p",{className:"text-muted-foreground mt-2",children:["更新 ",j.name," 的協尋資訊"]})]})]}),(0,a.jsxs)(c.Zb,{children:[(0,a.jsx)(c.Ol,{children:(0,a.jsx)(c.ll,{children:"協尋資訊"})}),(0,a.jsx)(c.aY,{children:(0,a.jsx)(I,{initialData:z,onSubmit:_,isSubmitting:w,submitButtonText:"更新協尋案例",mode:"edit"})})]}),(0,a.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCA1 編輯提示"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[(0,a.jsx)("li",{children:"• 請確保聯絡資訊是最新的，以便好心人能夠聯繫到您"}),(0,a.jsx)("li",{children:"• 如果寵物已找到，請記得更新狀態為「找到」"}),(0,a.jsx)("li",{children:"• 詳細的描述和清晰的照片有助於提高找到寵物的機會"}),(0,a.jsx)("li",{children:"• 更新後的資訊會立即生效，其他用戶將看到最新內容"})]})]})]})})}},4563:function(e,t,s){"use strict";s.d(t,{U:function(){return d}});var a=s(7437),n=s(2265),r=s(575),i=s(5671),l=s(1541),o=s(2549),c=s(6862);function d(e){let{images:t,onImagesChange:s,maxImages:d=5,maxFileSize:u=5,acceptedTypes:m=["image/jpeg","image/png","image/webp"]}=e,[h,p]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!1),g=(0,n.useRef)(null),v=async e=>{let t=new FormData;t.append("image",e),t.append("type","pet");let s=localStorage.getItem("auth_token"),a={};s&&(a.Authorization="Bearer ".concat(s));let n=await fetch("".concat("http://localhost:3001/api","/api/upload/single"),{method:"POST",headers:a,body:t});if(!n.ok)throw Error("圖片上傳失敗");return(await n.json()).data.url},j=async e=>{if(!e)return;let a=Array.from(e);if(t.length+a.length>d){(0,c.Am)({title:"檔案數量超過限制",description:"最多只能上傳 ".concat(d," 張圖片"),variant:"destructive"});return}f(!0);try{let e=[];for(let t of a){if(!m.includes(t.type)){(0,c.Am)({title:"檔案類型不支援",description:"請上傳 ".concat(m.join(", ")," 格式的圖片"),variant:"destructive"});continue}if(t.size>1048576*u){(0,c.Am)({title:"檔案過大",description:"檔案大小不能超過 ".concat(u,"MB"),variant:"destructive"});continue}try{let s=await v(t);e.push(s)}catch(e){console.error("單個檔案上傳失敗:",e),(0,c.Am)({title:"檔案上傳失敗",description:"".concat(t.name," 上傳失敗"),variant:"destructive"})}}e.length>0&&(s([...t,...e]),(0,c.Am)({title:"圖片上傳成功",description:"已成功上傳 ".concat(e.length," 張圖片")}))}catch(e){console.error("圖片上傳失敗:",e),(0,c.Am)({title:"上傳失敗",description:"圖片上傳過程中發生錯誤，請重試",variant:"destructive"})}finally{f(!1)}},b=e=>{s(t.filter((t,s)=>s!==e))};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(i.Zb,{className:"border-2 border-dashed transition-colors cursor-pointer ".concat(h?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onClick:()=>{var e;null===(e=g.current)||void 0===e||e.click()},onDragOver:e=>{e.preventDefault(),p(!0)},onDragLeave:e=>{e.preventDefault(),p(!1)},onDrop:e=>{e.preventDefault(),p(!1),j(e.dataTransfer.files)},children:(0,a.jsx)(i.aY,{className:"flex flex-col items-center justify-center py-12 px-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,a.jsx)("div",{className:"p-4 bg-gray-100 rounded-full",children:(0,a.jsx)(l.Z,{className:"h-8 w-8 text-gray-600"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-lg font-medium text-gray-900",children:"拖曳照片到此處，或點擊上傳"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["支援 JPG、PNG、WebP 格式，單檔最大 ",u,"MB"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["最多可上傳 ",d," 張照片"]})]}),(0,a.jsx)(r.z,{type:"button",variant:"outline",disabled:x,onClick:e=>e.stopPropagation(),children:x?"上傳中...":"選擇檔案"})]})})}),(0,a.jsx)("input",{ref:g,type:"file",multiple:!0,accept:m.join(","),onChange:e=>j(e.target.files),className:"hidden"}),t.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-gray-900",children:["已選擇的照片 (",t.length,"/",d,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map((e,t)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"aspect-square bg-gray-100 rounded-lg overflow-hidden",children:(0,a.jsx)("img",{src:e,alt:"預覽圖片 ".concat(t+1),className:"w-full h-full object-cover"})}),(0,a.jsx)("button",{type:"button",onClick:()=>b(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600",children:(0,a.jsx)(o.Z,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded",children:t+1})]},t))})]})]})}},2782:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var a=s(7437),n=s(2265),r=s(2169);let i=n.forwardRef((e,t)=>{let{className:s,type:n,...i}=e;return(0,a.jsx)("input",{type:n,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})});i.displayName="Input"},5005:function(e,t,s){"use strict";s.d(t,{_:function(){return c}});var a=s(7437),n=s(2265),r=s(6743),i=s(6061),l=s(2169);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.f,{ref:t,className:(0,l.cn)(o(),s),...n})});c.displayName=r.f.displayName},5453:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437),n=s(2265),r=s(6823),i=s(2169);let l=n.forwardRef((e,t)=>{let{className:s,orientation:n="horizontal",decorative:l=!0,...o}=e;return(0,a.jsx)(r.f,{ref:t,decorative:l,orientation:n,className:(0,i.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",s),...o})});l.displayName=r.f.displayName},7625:function(e,t,s){"use strict";s.d(t,{O:function(){return r}});var a=s(7437),n=s(2169);function r(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",t),...s})}},6782:function(e,t,s){"use strict";s.d(t,{$s:function(){return d},Y_:function(){return m},_s:function(){return o},iu:function(){return c},oM:function(){return l},wm:function(){return u}});let a=e=>!!e&&/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase()),n=e=>{if(e.length<8)return!1;let t=/[A-Z]/.test(e),s=/[a-z]/.test(e),a=/[0-9]/.test(e),n=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e);return t&&s&&a&&n},r=e=>{if(!e||!/^[0-9\+\-\(\)\s]+$/.test(e))return!1;let t=e.replace(/\D/g,"");return t.length>=8&&t.length<15},i=e=>null!=e&&("string"!=typeof e||e.trim().length>0),l=e=>{let t=[];return i(e.name)?e.name.trim().length<2&&t.push({field:"name",message:"姓名至少需要2個字符"}):t.push({field:"name",message:"請輸入姓名"}),i(e.email)?a(e.email)||t.push({field:"email",message:"請輸入有效的電子郵件格式"}):t.push({field:"email",message:"請輸入電子郵件"}),i(e.password)?e.password.length<8&&t.push({field:"password",message:"密碼至少需要8個字符"}):t.push({field:"password",message:"請輸入密碼"}),e.phone&&e.phone.trim()&&!r(e.phone)&&t.push({field:"phone",message:"請輸入有效的手機號碼"}),{isValid:0===t.length,errors:t}},o=e=>{let t={};return e.forEach(e=>{t[e.field]=e.message}),t},c=e=>{let t=[];return i(e.email)?a(e.email)||t.push({field:"email",message:"請輸入有效的電子郵件格式"}):t.push({field:"email",message:"電子郵件為必填項目"}),i(e.password)||t.push({field:"password",message:"密碼為必填項目"}),{isValid:0===t.length,errors:t}},d=e=>{let t=[];return i(e.password)?n(e.password)||t.push({field:"password",message:"密碼至少需要8個字符，包含大小寫字母、數字和特殊字符"}):t.push({field:"password",message:"密碼為必填項目"}),i(e.confirmPassword)||t.push({field:"confirmPassword",message:"確認密碼為必填項目"}),{isValid:0===t.length,errors:t}},u=e=>{let t=[];return i(e.name)||t.push({field:"name",message:"寵物名稱為必填項目"}),i(e.type)||t.push({field:"type",message:"寵物類型為必填項目"}),i(e.gender)||t.push({field:"gender",message:"寵物性別為必填項目"}),i(e.size)||t.push({field:"size",message:"寵物體型為必填項目"}),i(e.status)||t.push({field:"status",message:"寵物狀態為必填項目"}),void 0!==e.age&&("number"!=typeof e.age||e.age<0)&&t.push({field:"age",message:"寵物年齡必須為正數"}),e.lastSeenLocation?i(e.lastSeenLocation.address)||t.push({field:"lastSeenLocation.address",message:"最後出現地點為必填項目"}):t.push({field:"lastSeenLocation",message:"最後出現地點為必填項目"}),e.contactInfo?(e.contactInfo.email&&!a(e.contactInfo.email)&&t.push({field:"contactInfo.email",message:"請輸入有效的電子郵件地址"}),e.contactInfo.phone&&!r(e.contactInfo.phone)&&t.push({field:"contactInfo.phone",message:"請輸入有效的電話號碼"}),e.contactInfo.phone||e.contactInfo.email||t.push({field:"contactInfo",message:"至少需要提供一種聯絡方式"})):t.push({field:"contactInfo",message:"聯絡資訊為必填項目"}),{isValid:0===t.length,errors:t}},m={email:{test:e=>a(e),message:"請輸入有效的電子郵件格式"},password:{test:e=>n(e),message:"密碼至少需要8個字符，包含大小寫字母、數字和特殊字符"},phone:{test:e=>r(e),message:"請輸入有效的電話號碼"},name:{test:e=>e&&e.trim().length>=2,message:"姓名至少需要2個字符"}}},4033:function(e,t,s){e.exports=s(5313)},6743:function(e,t,s){"use strict";s.d(t,{f:function(){return l}});var a=s(2265),n=s(9381),r=s(7437),i=a.forwardRef((e,t)=>(0,r.jsx)(n.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},9381:function(e,t,s){"use strict";s.d(t,{WV:function(){return l},jH:function(){return o}});var a=s(2265),n=s(4887),r=s(7256),i=s(7437),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let s=(0,r.Z8)(`Primitive.${t}`),n=a.forwardRef((e,a)=>{let{asChild:n,...r}=e,l=n?s:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(l,{...r,ref:a})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function o(e,t){e&&n.flushSync(()=>e.dispatchEvent(t))}},6823:function(e,t,s){"use strict";s.d(t,{f:function(){return c}});var a=s(2265),n=s(9381),r=s(7437),i="horizontal",l=["horizontal","vertical"],o=a.forwardRef((e,t)=>{let{decorative:s,orientation:a=i,...o}=e,c=l.includes(a)?a:i;return(0,r.jsx)(n.WV.div,{"data-orientation":c,...s?{role:"none"}:{"aria-orientation":"vertical"===c?c:void 0,role:"separator"},...o,ref:t})});o.displayName="Separator";var c=o},3771:function(e,t,s){"use strict";s.d(t,{o:function(){return n}});class a extends Error{}function n(e,t){let s;if("string"!=typeof e)throw new a("Invalid token specified: must be a string");t||(t={});let n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new a(`Invalid token specified: missing part #${n+1}`);try{s=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var s;return s=t,decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(e){return atob(t)}}(r)}catch(e){throw new a(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(s)}catch(e){throw new a(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}a.prototype.name="InvalidTokenError"}},function(e){e.O(0,[9061,6448,4046,7371,2971,4938,1744],function(){return e(e.s=7678)}),_N_E=e.O()}]);