(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9959],{1981:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6264:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2369:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,s(2898).Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]])},5321:function(e,t,s){Promise.resolve().then(s.bind(s,2797))},6993:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return l}});let l=s(817)._(s(2265)).default.createContext(null)},2797:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return _}});var l=s(7437),r=s(2265),a=s(4033),n=s(6210),i=s(5671),c=s(575),d=s(3277),o=s(5453),u=s(9069),x=s(1827),m=s(2369),h=s(1981),f=s(5790),g=s(6264),v=s(7226),j=s(7539),p=s(6691),y=s.n(p),N=s(7810),b=s(6142),w=s(211),S=s(9764),k=s(8203),Z=s(7578),C=s(6862),O=e=>{var t;let{pet:s,onClick:a,currentUserId:n}=e,[o,u]=(0,r.useState)(!1),[x,m]=(0,r.useState)(s.favoriteCount||0),[h,f]=(0,r.useState)(!1),{toast:g}=(0,C.pm)();(0,r.useEffect)(()=>{n&&s.favoritedBy&&u(s.favoritedBy.includes(n))},[n,s.favoritedBy]);let v=async e=>{if(e.stopPropagation(),!n){g({title:"請先登入",description:"您需要登入才能收藏寵物",variant:"destructive"});return}if(!h)try{f(!0),o?(await Z.e.unfavoritePet(s._id),u(!1),m(e=>Math.max(0,e-1)),g({title:"取消收藏",description:"已取消收藏此寵物"})):(await Z.e.favoritePet(s._id),u(!0),m(e=>e+1),g({title:"收藏成功",description:"已將此寵物加入收藏"}))}catch(e){console.error("收藏操作失敗:",e),g({title:"操作失敗",description:"收藏操作失敗，請稍後再試",variant:"destructive"})}finally{f(!1)}};return(0,l.jsxs)(i.Zb,{className:"cursor-pointer hover:shadow-lg transition-shadow duration-200",onClick:()=>{a&&a(s)},role:"article",children:[(0,l.jsx)(i.Ol,{className:"p-0",children:(0,l.jsxs)("div",{className:"relative w-full aspect-[3/4]",children:[s.images&&s.images.length>0?(0,l.jsx)(y(),{src:s.images[0]||"/placeholder-pet.jpg",alt:s.name,fill:!0,className:"object-cover rounded-t-lg"}):(0,l.jsx)("div",{className:"h-full w-full bg-gray-200 rounded-t-lg flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-gray-500",children:"無圖片"})}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 flex flex-col gap-2",children:[(0,l.jsx)(d.C,{variant:(e=>{switch(e){case"lost":return"destructive";case"found":default:return"default";case"adopted":return"secondary"}})(s.status),children:(e=>{switch(e){case"lost":return"走失";case"found":return"已找到";case"adopted":return"已領養";default:return e}})(s.status)}),n&&(0,l.jsx)(c.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 rounded-full bg-white/80 hover:bg-white/90 ".concat(o?"text-red-500":"text-gray-500"),onClick:v,disabled:h,"data-testid":"favorite-button",children:(0,l.jsx)(N.Z,{className:"h-4 w-4 ".concat(o?"fill-current":"")})})]})]})}),(0,l.jsx)(i.aY,{className:"p-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:s.name}),(0,l.jsx)("div",{className:"flex items-center space-x-1","data-testid":"pet-gender",children:(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"male"===s.gender?"♂":"female"===s.gender?"♀":"?"})})]}),s.breed&&(0,l.jsx)("p",{className:"text-sm text-gray-600",children:s.breed}),s.age&&(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:[s.age,"歲"]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:(e=>{switch(e){case"small":return"小型";case"medium":return"中型";case"large":return"大型";default:return e}})(s.size)}),(0,l.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-600",children:[(0,l.jsx)(b.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:s.lastSeenLocation?"string"==typeof s.lastSeenLocation?s.lastSeenLocation:(null===(t=s.lastSeenLocation)||void 0===t?void 0:t.address)||"未知地點":"未知地點"})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center pt-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)(w.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:s.viewCount})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)(S.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:s.shareCount})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)(N.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:x})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[(0,l.jsx)(k.Z,{className:"h-3 w-3"}),(0,l.jsx)("span",{children:new Date(s.createdAt).toLocaleDateString("zh-TW")})]})]})]})})]})};function _(){let{user:e}=(0,n.a)(),t=(0,a.useRouter)(),s=(0,a.useSearchParams)(),[p,y]=(0,r.useState)({query:(null==s?void 0:s.get("q"))||"",filters:{...(null==s?void 0:s.get("type"))&&{type:null==s?void 0:s.get("type")},...(null==s?void 0:s.get("status"))&&{status:null==s?void 0:s.get("status")},...(null==s?void 0:s.get("breed"))&&{breed:null==s?void 0:s.get("breed")},...(null==s?void 0:s.get("location"))&&{location:null==s?void 0:s.get("location")}},results:[],total:0,page:1,loading:!1,error:null,suggestions:[],analytics:null,health:null,isMockService:!1});(0,r.useEffect)(()=>{N(),b()},[]),(0,r.useEffect)(()=>{(p.query||Object.values(p.filters).some(e=>e))&&w()},[p.query,p.filters]);let N=async()=>{try{let e=await Z.e.getSearchAnalytics("7d");y(t=>({...t,analytics:e}))}catch(e){y(e=>({...e,analytics:null}))}},b=async()=>{try{let e=await Z.e.checkSearchHealth();y(t=>({...t,health:e.data.elasticsearch,isMockService:!1}))}catch(e){y(e=>({...e,health:null,isMockService:!0}))}},w=async()=>{y(e=>({...e,loading:!0,error:null}));try{let e={...p.filters,page:p.page,limit:12},t=await Z.e.advancedSearch(p.query,e);y(e=>({...e,results:t.items,total:t.total,loading:!1,isMockService:"mock"in t&&!!t.mock}));let s=new URLSearchParams;p.query&&s.set("q",p.query),Object.entries(p.filters).forEach(e=>{let[t,l]=e;l&&s.set(t,String(l))});let l="/advanced-search".concat(s.toString()?"?".concat(s.toString()):"");window.history.replaceState({},"",l)}catch(e){y(t=>({...t,loading:!1,error:e instanceof Error?e.message:"搜尋失敗，請稍後再試"}))}},S=async e=>{if(y(t=>({...t,query:e})),e.length>=2)try{let t=await Z.e.getSearchSuggestions(e);y(e=>({...e,suggestions:t}))}catch(e){y(e=>({...e,suggestions:[]}))}else y(e=>({...e,suggestions:[]}))},k=()=>{y(e=>({...e,query:"",filters:{},results:[],total:0,page:1,error:null,suggestions:[]})),t.push("/advanced-search")};return(0,l.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,l.jsx)(x.Z,{className:"h-6 w-6 text-blue-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"進階搜尋"}),(0,l.jsxs)("p",{className:"text-gray-600 mt-1",children:["使用 ",p.isMockService?"模擬":"Elasticsearch"," ","搜尋引擎，提供更精確的寵物協尋結果"]})]})]}),p.health&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,l.jsx)(d.C,{variant:"green"===p.health.status?"default":"destructive",className:"flex items-center gap-1",children:"green"===p.health.status?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.Z,{className:"h-3 w-3"}),p.isMockService?"模擬服務":"Elasticsearch"," 運行中"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.Z,{className:"h-3 w-3"}),"搜尋服務離線"]})}),p.analytics&&(0,l.jsxs)(d.C,{variant:"outline",className:"flex items-center gap-1",children:[(0,l.jsx)(f.Z,{className:"h-3 w-3"}),"今日搜尋: ",p.analytics.totalSearches]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,l.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,l.jsxs)(i.Zb,{children:[(0,l.jsxs)(i.Ol,{children:[(0,l.jsx)(i.ll,{className:"text-lg",children:"關鍵字搜尋"}),(0,l.jsx)(i.SZ,{children:"輸入寵物名稱、品種、特徵或地點"})]}),(0,l.jsx)(i.aY,{children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(j.X,{value:p.query,onChange:S,onSearch:w,suggestions:p.suggestions,placeholder:"例：黃金獵犬、台北市、走失的貓咪..."}),(0,l.jsx)(c.z,{onClick:w,className:"w-full",disabled:p.loading,children:p.loading?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"搜尋中..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"搜尋"]})})]})})]}),(0,l.jsx)(v.Z,{filters:p.filters,onFiltersChange:e=>{y(t=>({...t,filters:e}))},onSearch:w,onReset:k})]}),(0,l.jsxs)("div",{className:"lg:col-span-3",children:[p.error&&(0,l.jsxs)(u.bZ,{className:"mb-6",variant:"destructive",children:[(0,l.jsx)(h.Z,{className:"h-4 w-4"}),(0,l.jsx)(u.X,{children:p.error})]}),(p.results.length>0||p.loading)&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("h2",{className:"text-xl font-semibold",children:["搜尋結果 ",!p.loading&&"(".concat(p.total," 筆)")]}),Object.values(p.filters).filter(e=>void 0!==e&&""!==e).length>0&&(0,l.jsxs)(d.C,{variant:"secondary",children:[Object.values(p.filters).filter(e=>void 0!==e&&""!==e).length," 個篩選條件"]})]}),p.results.length>0&&(0,l.jsx)(c.z,{variant:"outline",size:"sm",onClick:k,children:"清除所有條件"})]}),(0,l.jsx)(o.Z,{})]}),p.loading&&(0,l.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(g.Z,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),(0,l.jsx)("p",{className:"text-gray-600",children:"正在搜尋寵物資訊..."})]})}),!p.loading&&p.results.length>0&&(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:p.results.map(t=>(0,l.jsx)(O,{pet:t,...(null==e?void 0:e.id)&&{currentUserId:e.id}},t._id))}),!p.loading&&0===p.results.length&&(p.query||Object.values(p.filters).filter(e=>void 0!==e&&""!==e).length>0)&&(0,l.jsx)("div",{className:"text-center py-12",children:(0,l.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,l.jsx)(x.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"找不到符合條件的寵物"}),(0,l.jsx)("p",{className:"text-gray-600 mb-6",children:"請嘗試調整搜尋關鍵字或篩選條件"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"建議："}),(0,l.jsxs)("ul",{className:"text-sm text-gray-500 space-y-1",children:[(0,l.jsx)("li",{children:"• 使用更通用的關鍵字"}),(0,l.jsx)("li",{children:"• 減少篩選條件"}),(0,l.jsx)("li",{children:"• 檢查拼字是否正確"}),(0,l.jsx)("li",{children:"• 嘗試搜尋相關的品種或地區"})]})]})]})}),!p.loading&&0===p.results.length&&!p.query&&0===Object.values(p.filters).filter(e=>void 0!==e&&""!==e).length&&(0,l.jsx)("div",{className:"text-center py-12",children:(0,l.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,l.jsx)(x.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"開始您的進階搜尋"}),(0,l.jsx)("p",{className:"text-gray-600",children:"輸入關鍵字或設定篩選條件來尋找走失的寵物"})]})})]})]})]})}},9069:function(e,t,s){"use strict";s.d(t,{X:function(){return d},bZ:function(){return c}});var l=s(7437),r=s(2265),a=s(6061),n=s(2169);let i=(0,a.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",warning:"border-yellow-500/50 text-yellow-600 dark:border-yellow-500 [&>svg]:text-yellow-600",success:"border-green-500/50 text-green-600 dark:border-green-500 [&>svg]:text-green-600",info:"border-blue-500/50 text-blue-600 dark:border-blue-500 [&>svg]:text-blue-600"}},defaultVariants:{variant:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:r,...a}=e;return(0,l.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(i({variant:r}),s),...a})});c.displayName="Alert",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",s),...r})}).displayName="AlertTitle";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,l.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",s),...r})});d.displayName="AlertDescription"},2210:function(e,t,s){"use strict";s.d(t,{F:function(){return a},e:function(){return n}});var l=s(2265);function r(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function a(...e){return t=>{let s=!1,l=e.map(e=>{let l=r(e,t);return s||"function"!=typeof l||(s=!0),l});if(s)return()=>{for(let t=0;t<l.length;t++){let s=l[t];"function"==typeof s?s():r(e[t],null)}}}}function n(...e){return l.useCallback(a(...e),e)}},7256:function(e,t,s){"use strict";s.d(t,{Z8:function(){return n},g7:function(){return i},sA:function(){return d}});var l=s(2265),r=s(2210),a=s(7437);function n(e){let t=function(e){let t=l.forwardRef((e,t)=>{let{children:s,...a}=e;if(l.isValidElement(s)){let e,n;let i=(e=Object.getOwnPropertyDescriptor(s.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?s.ref:(e=Object.getOwnPropertyDescriptor(s,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?s.props.ref:s.props.ref||s.ref,c=function(e,t){let s={...t};for(let l in t){let r=e[l],a=t[l];/^on[A-Z]/.test(l)?r&&a?s[l]=(...e)=>{let t=a(...e);return r(...e),t}:r&&(s[l]=r):"style"===l?s[l]={...r,...a}:"className"===l&&(s[l]=[r,a].filter(Boolean).join(" "))}return{...e,...s}}(a,s.props);return s.type!==l.Fragment&&(c.ref=t?(0,r.F)(t,i):i),l.cloneElement(s,c)}return l.Children.count(s)>1?l.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),s=l.forwardRef((e,s)=>{let{children:r,...n}=e,i=l.Children.toArray(r),c=i.find(o);if(c){let e=c.props.children,r=i.map(t=>t!==c?t:l.Children.count(e)>1?l.Children.only(null):l.isValidElement(e)?e.props.children:null);return(0,a.jsx)(t,{...n,ref:s,children:l.isValidElement(e)?l.cloneElement(e,void 0,r):null})}return(0,a.jsx)(t,{...n,ref:s,children:r})});return s.displayName=`${e}.Slot`,s}var i=n("Slot"),c=Symbol("radix.slottable");function d(e){let t=({children:e})=>(0,a.jsx)(a.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=c,t}function o(e){return l.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===c}},6061:function(e,t,s){"use strict";s.d(t,{j:function(){return n}});var l=s(7042);let r=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=l.W,n=(e,t)=>s=>{var l;if((null==t?void 0:t.variants)==null)return a(e,null==s?void 0:s.class,null==s?void 0:s.className);let{variants:n,defaultVariants:i}=t,c=Object.keys(n).map(e=>{let t=null==s?void 0:s[e],l=null==i?void 0:i[e];if(null===t)return null;let a=r(t)||r(l);return n[e][a]}),d=s&&Object.entries(s).reduce((e,t)=>{let[s,l]=t;return void 0===l||(e[s]=l),e},{});return a(e,c,null==t?void 0:null===(l=t.compoundVariants)||void 0===l?void 0:l.reduce((e,t)=>{let{class:s,className:l,...r}=t;return Object.entries(r).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...i,...d}[t]):({...i,...d})[t]===s})?[...e,s,l]:e},[]),null==s?void 0:s.class,null==s?void 0:s.className)}}},function(e){e.O(0,[9061,9044,4597,5746,9705,6652,4046,7371,5701,2971,4938,1744],function(){return e(e.s=5321)}),_N_E=e.O()}]);