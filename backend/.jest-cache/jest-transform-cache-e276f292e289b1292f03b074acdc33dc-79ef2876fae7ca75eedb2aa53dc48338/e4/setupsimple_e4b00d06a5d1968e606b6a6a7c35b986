8b511919d2af4dd4cbe831bd3a2c0e3d
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// 模擬外部服務
jest.mock('../src/services/emailService', () => ({
    EmailService: {
        sendVerificationEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendWelcomeEmail: jest.fn().mockResolvedValue(true),
        sendNotificationEmail: jest.fn().mockResolvedValue(true)
    }
}));
jest.mock('../src/services/cloudinaryService', () => ({
    CloudinaryService: {
        uploadFile: jest.fn().mockResolvedValue({
            public_id: 'test-image-id',
            secure_url: 'https://test.cloudinary.com/test-image.jpg',
            width: 800,
            height: 600
        }),
        deleteFile: jest.fn().mockResolvedValue(true),
        generateOptimizedUrl: jest.fn().mockReturnValue('https://test.cloudinary.com/optimized-image.jpg')
    }
}));
jest.mock('../src/services/aiService', () => ({
    analyzeImage: jest.fn().mockResolvedValue({
        breed: 'Golden Retriever',
        confidence: 0.95,
        features: {
            color: 'golden',
            size: 'large',
            age: 'adult'
        }
    }),
    findSimilarPets: jest.fn().mockResolvedValue([]),
    generateSearchSuggestions: jest.fn().mockResolvedValue(['golden retriever', 'labrador'])
}));
const mongodb_memory_server_1 = require("mongodb-memory-server");
const mongoose_1 = __importDefault(require("mongoose"));
let mongod;
// 全局設置 - 在所有測試之前運行
beforeAll(async () => {
    try {
        // 如果已經連接，先斷開
        if (mongoose_1.default.connection.readyState !== 0) {
            await mongoose_1.default.disconnect();
        }
        // 創建內存數據庫
        mongod = await mongodb_memory_server_1.MongoMemoryServer.create({
            instance: {
                dbSize: 1, // 1MB
            },
            binary: {
                version: '5.0.0',
                skipMD5: true,
            }
        });
        const uri = mongod.getUri();
        // 連接到數據庫
        await mongoose_1.default.connect(uri);
        console.log('✅ 測試數據庫已連接');
    }
    catch (error) {
        console.error('❌ 測試數據庫連接失敗:', error);
        throw error;
    }
}, 60000);
// 每個測試後清理數據
afterEach(async () => {
    if (mongoose_1.default.connection.readyState === 1) {
        try {
            const collections = mongoose_1.default.connection.collections;
            for (const key in collections) {
                await collections[key].deleteMany({});
            }
        }
        catch (error) {
            console.warn('清理數據時出現警告:', error.message);
        }
    }
});
// 測試結束後清理
afterAll(async () => {
    try {
        if (mongoose_1.default.connection.readyState !== 0) {
            await mongoose_1.default.connection.close();
        }
        if (mongod) {
            await mongod.stop();
        }
        console.log('✅ 測試數據庫已關閉');
    }
    catch (error) {
        console.warn('關閉數據庫時出現警告:', error.message);
    }
}, 30000);
// 設置測試環境變數
process.env.NODE_ENV = 'test';
process.env.JWT_SECRET = 'test-jwt-secret-key-with-minimum-32-characters-length';
process.env.CLOUDINARY_CLOUD_NAME = 'test-cloud';
process.env.CLOUDINARY_API_KEY = 'test-api-key';
process.env.CLOUDINARY_API_SECRET = 'test-api-secret';
process.env.EMAIL_HOST = 'smtp.test.com';
process.env.EMAIL_PORT = '587';
process.env.EMAIL_USER = 'test@example.com';
process.env.EMAIL_PASS = 'test-password';
process.env.EMAIL_FROM_NAME = '測試網站';
process.env.EMAIL_FROM_EMAIL = 'test@example.com';
process.env.CLIENT_URL = 'http://localhost:3000';
process.env.SESSION_SECRET = 'test-session-secret-key-with-minimum-32-characters';
process.env.GOOGLE_CLIENT_ID = 'test-google-client-id';
process.env.GOOGLE_CLIENT_SECRET = 'test-google-client-secret';
// 全局錯誤處理
process.on('unhandledRejection', (reason) => {
    console.warn('測試中出現未處理的 Promise 拒絕:', reason);
});
process.on('uncaughtException', (error) => {
    console.warn('測試中出現未捕獲的異常:', error.message);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXR1cC1zaW1wbGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFrRkEsU0FBUztBQUNULElBQUksQ0FBQyxJQUFJLENBQUMsOEJBQThCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMvQyxZQUFZLEVBQUU7UUFDWixxQkFBcUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDO1FBQ3hELHNCQUFzQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7UUFDekQsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztRQUNuRCxxQkFBcUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDO0tBQ3pEO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDcEQsaUJBQWlCLEVBQUU7UUFDakIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztZQUN0QyxTQUFTLEVBQUUsZUFBZTtZQUMxQixVQUFVLEVBQUUsNENBQTRDO1lBQ3hELEtBQUssRUFBRSxHQUFHO1lBQ1YsTUFBTSxFQUFFLEdBQUc7U0FDWixDQUFDO1FBQ0YsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7UUFDN0Msb0JBQW9CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxpREFBaUQsQ0FBQztLQUNuRztDQUNGLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQywyQkFBMkIsRUFB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QUU7SUFDMUMsT0FBTyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxFQUFFLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtJQUN4QyxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDOUMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXR1cC1zaW1wbGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29NZW1vcnlTZXJ2ZXIgfSBmcm9tICdtb25nb2RiLW1lbW9yeS1zZXJ2ZXInO1xuaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcblxubGV0IG1vbmdvZDogTW9uZ29NZW1vcnlTZXJ2ZXI7XG5cbi8vIOWFqOWxgOioree9riAtIOWcqOaJgOaciea4rOippuS5i+WJjemBi+ihjFxuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyDlpoLmnpzlt7LntpPpgKPmjqXvvIzlhYjmlrfplotcbiAgICBpZiAobW9uZ29vc2UuY29ubmVjdGlvbi5yZWFkeVN0YXRlICE9PSAwKSB7XG4gICAgICBhd2FpdCBtb25nb29zZS5kaXNjb25uZWN0KCk7XG4gICAgfVxuICAgIFxuICAgIC8vIOWJteW7uuWFp+WtmOaVuOaTmuW6q1xuICAgIG1vbmdvZCA9IGF3YWl0IE1vbmdvTWVtb3J5U2VydmVyLmNyZWF0ZSh7XG4gICAgICBpbnN0YW5jZToge1xuICAgICAgICBkYlNpemU6IDEsIC8vIDFNQlxuICAgICAgfSxcbiAgICAgIGJpbmFyeToge1xuICAgICAgICB2ZXJzaW9uOiAnNS4wLjAnLFxuICAgICAgICBza2lwTUQ1OiB0cnVlLFxuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IHVyaSA9IG1vbmdvZC5nZXRVcmkoKTtcbiAgICBcbiAgICAvLyDpgKPmjqXliLDmlbjmk5rluqtcbiAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0KHVyaSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ+KchSDmuKzoqabmlbjmk5rluqvlt7LpgKPmjqUnKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwg5ris6Kmm5pW45pOa5bqr6YCj5o6l5aSx5pWXOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufSwgNjAwMDApO1xuXG4vLyDmr4/lgIvmuKzoqablvozmuIXnkIbmlbjmk5pcbmFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gIGlmIChtb25nb29zZS5jb25uZWN0aW9uLnJlYWR5U3RhdGUgPT09IDEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29sbGVjdGlvbnMgPSBtb25nb29zZS5jb25uZWN0aW9uLmNvbGxlY3Rpb25zO1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gY29sbGVjdGlvbnMpIHtcbiAgICAgICAgYXdhaXQgY29sbGVjdGlvbnNba2V5XS5kZWxldGVNYW55KHt9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCfmuIXnkIbmlbjmk5rmmYLlh7rnj77orablkYo6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICB9XG59KTtcblxuLy8g5ris6Kmm57WQ5p2f5b6M5riF55CGXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XG4gIHRyeSB7XG4gICAgaWYgKG1vbmdvb3NlLmNvbm5lY3Rpb24ucmVhZHlTdGF0ZSAhPT0gMCkge1xuICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdGlvbi5jbG9zZSgpO1xuICAgIH1cbiAgICBpZiAobW9uZ29kKSB7XG4gICAgICBhd2FpdCBtb25nb2Quc3RvcCgpO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZygn4pyFIOa4rOippuaVuOaTmuW6q+W3sumXnOmWiScpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2Fybign6Zec6ZaJ5pW45pOa5bqr5pmC5Ye654++6K2m5ZGKOicsIGVycm9yLm1lc3NhZ2UpO1xuICB9XG59LCAzMDAwMCk7XG5cbi8vIOioree9rua4rOippueSsOWig+iuiuaVuFxucHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG5wcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtand0LXNlY3JldC1rZXktd2l0aC1taW5pbXVtLTMyLWNoYXJhY3RlcnMtbGVuZ3RoJztcbnByb2Nlc3MuZW52LkNMT1VESU5BUllfQ0xPVURfTkFNRSA9ICd0ZXN0LWNsb3VkJztcbnByb2Nlc3MuZW52LkNMT1VESU5BUllfQVBJX0tFWSA9ICd0ZXN0LWFwaS1rZXknO1xucHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9BUElfU0VDUkVUID0gJ3Rlc3QtYXBpLXNlY3JldCc7XG5wcm9jZXNzLmVudi5FTUFJTF9IT1NUID0gJ3NtdHAudGVzdC5jb20nO1xucHJvY2Vzcy5lbnYuRU1BSUxfUE9SVCA9ICc1ODcnO1xucHJvY2Vzcy5lbnYuRU1BSUxfVVNFUiA9ICd0ZXN0QGV4YW1wbGUuY29tJztcbnByb2Nlc3MuZW52LkVNQUlMX1BBU1MgPSAndGVzdC1wYXNzd29yZCc7XG5wcm9jZXNzLmVudi5FTUFJTF9GUk9NX05BTUUgPSAn5ris6Kmm57ay56uZJztcbnByb2Nlc3MuZW52LkVNQUlMX0ZST01fRU1BSUwgPSAndGVzdEBleGFtcGxlLmNvbSc7XG5wcm9jZXNzLmVudi5DTElFTlRfVVJMID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMCc7XG5wcm9jZXNzLmVudi5TRVNTSU9OX1NFQ1JFVCA9ICd0ZXN0LXNlc3Npb24tc2VjcmV0LWtleS13aXRoLW1pbmltdW0tMzItY2hhcmFjdGVycyc7XG5wcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEID0gJ3Rlc3QtZ29vZ2xlLWNsaWVudC1pZCc7XG5wcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX1NFQ1JFVCA9ICd0ZXN0LWdvb2dsZS1jbGllbnQtc2VjcmV0JztcblxuLy8g5qih5pOs5aSW6YOo5pyN5YuZXG5qZXN0Lm1vY2soJy4uL3NyYy9zZXJ2aWNlcy9lbWFpbFNlcnZpY2UnLCAoKSA9PiAoe1xuICBFbWFpbFNlcnZpY2U6IHtcbiAgICBzZW5kVmVyaWZpY2F0aW9uRW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZFdlbGNvbWVFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmROb3RpZmljYXRpb25FbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpXG4gIH1cbn0pKTtcblxuamVzdC5tb2NrKCcuLi9zcmMvc2VydmljZXMvY2xvdWRpbmFyeVNlcnZpY2UnLCAoKSA9PiAoe1xuICBDbG91ZGluYXJ5U2VydmljZToge1xuICAgIHVwbG9hZEZpbGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBwdWJsaWNfaWQ6ICd0ZXN0LWltYWdlLWlkJyxcbiAgICAgIHNlY3VyZV91cmw6ICdodHRwczovL3Rlc3QuY2xvdWRpbmFyeS5jb20vdGVzdC1pbWFnZS5qcGcnLFxuICAgICAgd2lkdGg6IDgwMCxcbiAgICAgIGhlaWdodDogNjAwXG4gICAgfSksXG4gICAgZGVsZXRlRmlsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIGdlbmVyYXRlT3B0aW1pemVkVXJsOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCdodHRwczovL3Rlc3QuY2xvdWRpbmFyeS5jb20vb3B0aW1pemVkLWltYWdlLmpwZycpXG4gIH1cbn0pKTtcblxuamVzdC5tb2NrKCcuLi9zcmMvc2VydmljZXMvYWlTZXJ2aWNlJywgKCkgPT4gKHtcbiAgYW5hbHl6ZUltYWdlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgIGJyZWVkOiAnR29sZGVuIFJldHJpZXZlcicsXG4gICAgY29uZmlkZW5jZTogMC45NSxcbiAgICBmZWF0dXJlczoge1xuICAgICAgY29sb3I6ICdnb2xkZW4nLFxuICAgICAgc2l6ZTogJ2xhcmdlJyxcbiAgICAgIGFnZTogJ2FkdWx0J1xuICAgIH1cbiAgfSksXG4gIGZpbmRTaW1pbGFyUGV0czogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKSxcbiAgZ2VuZXJhdGVTZWFyY2hTdWdnZXN0aW9uczogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFsnZ29sZGVuIHJldHJpZXZlcicsICdsYWJyYWRvciddKVxufSkpO1xuXG4vLyDlhajlsYDpjK/oqqTomZXnkIZcbnByb2Nlc3Mub24oJ3VuaGFuZGxlZFJlamVjdGlvbicsIChyZWFzb24pID0+IHtcbiAgY29uc29sZS53YXJuKCfmuKzoqabkuK3lh7rnj77mnKromZXnkIbnmoQgUHJvbWlzZSDmi5LntZU6JywgcmVhc29uKTtcbn0pO1xuXG5wcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcnJvcikgPT4ge1xuICBjb25zb2xlLndhcm4oJ+a4rOippuS4reWHuuePvuacquaNleeNsueahOeVsOW4uDonLCBlcnJvci5tZXNzYWdlKTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==