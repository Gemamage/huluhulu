a63004ef7d85d14abb45f38e5cd35a64
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// petService 單元測試 - 簡化版本，不依賴數據庫
const globals_1 = require("@jest/globals");
// 模擬外部依賴
globals_1.jest.mock('../../src/models/Pet');
globals_1.jest.mock('../../src/models/User');
globals_1.jest.mock('../../src/services/cloudinaryService');
globals_1.jest.mock('../../src/services/aiService');
globals_1.jest.mock('../../src/utils/logger');
// 設置測試環境變數
process.env.NODE_ENV = 'test';
process.env.JWT_SECRET = 'test-jwt-secret-key-with-minimum-32-characters-length';
// 導入要測試的服務
const petService_1 = require("../../src/services/petService");
// 模擬的 Pet 模型
const mockPet = {
    _id: '507f1f77bcf86cd799439011',
    name: '小白',
    type: 'dog',
    breed: '拉布拉多',
    status: 'lost',
    owner: '507f1f77bcf86cd799439012',
    save: globals_1.jest.fn(),
    populate: globals_1.jest.fn().mockReturnThis(),
    createdAt: new Date(),
    updatedAt: new Date()
};
// 模擬的 User 模型
const mockUser = {
    _id: '507f1f77bcf86cd799439012',
    username: 'testuser',
    email: 'test@example.com'
};
// 模擬 Pet 模型的靜態方法
const Pet = {
    findById: globals_1.jest.fn(),
    findOne: globals_1.jest.fn(),
    findByIdAndUpdate: globals_1.jest.fn(),
    findByIdAndDelete: globals_1.jest.fn(),
    find: globals_1.jest.fn(),
    countDocuments: globals_1.jest.fn(),
    deleteMany: globals_1.jest.fn()
};
// 模擬 User 模型的靜態方法
const User = {
    findById: globals_1.jest.fn(),
    deleteMany: globals_1.jest.fn()
};
// 模擬 CloudinaryService
const CloudinaryService = {
    uploadImage: globals_1.jest.fn(),
    deleteImage: globals_1.jest.fn()
};
// 模擬 aiService
const aiService = {
    analyzeImage: globals_1.jest.fn()
};
// 設置模擬
require('../../src/models/Pet').Pet = Pet;
require('../../src/models/User').User = User;
require('../../src/services/cloudinaryService').CloudinaryService = CloudinaryService;
require('../../src/services/aiService').aiService = aiService;
(0, globals_1.describe)('PetService 測試', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        // 設置預設的模擬回應
        User.findById.mockResolvedValue(mockUser);
        Pet.findById.mockResolvedValue({
            ...mockPet,
            populate: globals_1.jest.fn().mockResolvedValue(mockPet)
        });
        mockPet.save.mockResolvedValue(mockPet);
        mockPet.populate.mockResolvedValue(mockPet);
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.restoreAllMocks();
    });
    (0, globals_1.describe)('createPet', () => {
        const petData = {
            name: '小花',
            type: 'cat',
            breed: '波斯貓',
            status: 'lost',
            description: '走失的小貓',
            location: {
                address: '台北市信義區',
                city: '台北市',
                coordinates: [121.5654, 25.0330]
            },
            contact: {
                phone: '0912345678',
                email: 'owner@example.com'
            }
        };
        (0, globals_1.it)('應該成功創建寵物', async () => {
            // 模擬 Pet 構造函數
            const mockPetConstructor = globals_1.jest.fn().mockImplementation(() => ({
                ...mockPet,
                ...petData,
                save: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...petData }),
                populate: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...petData })
            }));
            Pet.prototype = mockPetConstructor.prototype;
            global.Pet = mockPetConstructor;
            const result = await petService_1.PetService.createPet('507f1f77bcf86cd799439012', petData);
            (0, globals_1.expect)(User.findById).toHaveBeenCalledWith('507f1f77bcf86cd799439012');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result.name).toBe(petData.name);
        });
        (0, globals_1.it)('應該在擁有者不存在時拋出錯誤', async () => {
            User.findById.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.createPet('507f1f77bcf86cd799439999', petData))
                .rejects.toThrow('擁有者不存在');
        });
        (0, globals_1.it)('應該處理圖片上傳', async () => {
            const petDataWithImages = {
                ...petData,
                images: ['image1.jpg', 'image2.jpg']
            };
            CloudinaryService.uploadImage.mockResolvedValue({
                secure_url: 'https://cloudinary.com/test.jpg',
                public_id: 'test_id',
                width: 800,
                height: 600
            });
            const mockPetConstructor = globals_1.jest.fn().mockImplementation(() => ({
                ...mockPet,
                save: globals_1.jest.fn().mockResolvedValue(mockPet),
                populate: globals_1.jest.fn().mockResolvedValue(mockPet)
            }));
            global.Pet = mockPetConstructor;
            await petService_1.PetService.createPet('507f1f77bcf86cd799439012', petDataWithImages);
            (0, globals_1.expect)(CloudinaryService.uploadImage).toHaveBeenCalledTimes(2);
        });
    });
    (0, globals_1.describe)('getPetById', () => {
        (0, globals_1.it)('應該成功根據ID獲取寵物', async () => {
            const result = await petService_1.PetService.getPetById('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(Pet.findById).toHaveBeenCalledWith('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result?._id).toBe('507f1f77bcf86cd799439011');
        });
        (0, globals_1.it)('應該在ID無效時拋出錯誤', async () => {
            await (0, globals_1.expect)(petService_1.PetService.getPetById('invalid-id'))
                .rejects.toThrow('無效的寵物 ID');
        });
        (0, globals_1.it)('應該返回null當寵物不存在', async () => {
            Pet.findById.mockReturnValue({
                populate: globals_1.jest.fn().mockReturnValue({
                    exec: globals_1.jest.fn().mockResolvedValue(null)
                })
            });
            const result = await petService_1.PetService.getPetById('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)('updatePet', () => {
        const updateData = {
            name: '更新的小白',
            description: '更新的描述'
        };
        (0, globals_1.it)('應該成功更新寵物', async () => {
            Pet.findOne.mockResolvedValue(mockPet);
            Pet.findByIdAndUpdate.mockReturnValue({
                populate: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...updateData })
            });
            const result = await petService_1.PetService.updatePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012', updateData);
            (0, globals_1.expect)(Pet.findOne).toHaveBeenCalledWith({ _id: '507f1f77bcf86cd799439011', owner: '507f1f77bcf86cd799439012' });
            (0, globals_1.expect)(Pet.findByIdAndUpdate).toHaveBeenCalled();
            (0, globals_1.expect)(result?.name).toBe(updateData.name);
        });
        (0, globals_1.it)('應該在寵物不存在時拋出錯誤', async () => {
            Pet.findOne.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.updatePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012', updateData))
                .rejects.toThrow('寵物不存在或您沒有權限修改');
        });
    });
    (0, globals_1.describe)('deletePet', () => {
        (0, globals_1.it)('應該成功刪除寵物', async () => {
            Pet.findOne.mockResolvedValue({
                ...mockPet,
                images: [{ publicId: 'test_id', url: 'test.jpg' }]
            });
            Pet.findByIdAndDelete.mockResolvedValue(mockPet);
            CloudinaryService.deleteImage.mockResolvedValue(true);
            const result = await petService_1.PetService.deletePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012');
            (0, globals_1.expect)(Pet.findOne).toHaveBeenCalledWith({ _id: '507f1f77bcf86cd799439011', owner: '507f1f77bcf86cd799439012' });
            (0, globals_1.expect)(Pet.findByIdAndDelete).toHaveBeenCalledWith('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(CloudinaryService.deleteImage).toHaveBeenCalledWith('test_id');
            (0, globals_1.expect)(result).toBe(true);
        });
        (0, globals_1.it)('應該在寵物不存在時拋出錯誤', async () => {
            Pet.findOne.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.deletePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012'))
                .rejects.toThrow('寵物不存在或您沒有權限刪除');
        });
    });
    (0, globals_1.describe)('getAllPets', () => {
        (0, globals_1.it)('應該成功獲取所有寵物', async () => {
            const mockPets = [mockPet, { ...mockPet, _id: '507f1f77bcf86cd799439013', name: '小黑' }];
            Pet.find.mockReturnValue({
                populate: globals_1.jest.fn().mockReturnValue({
                    sort: globals_1.jest.fn().mockReturnValue({
                        skip: globals_1.jest.fn().mockReturnValue({
                            limit: globals_1.jest.fn().mockReturnValue({
                                exec: globals_1.jest.fn().mockResolvedValue(mockPets)
                            })
                        })
                    })
                })
            });
            Pet.countDocuments.mockResolvedValue(2);
            const result = await petService_1.PetService.getAllPets(1, 10);
            (0, globals_1.expect)(result.pets).toHaveLength(2);
            (0, globals_1.expect)(result.total).toBe(2);
            (0, globals_1.expect)(result.page).toBe(1);
            (0, globals_1.expect)(result.totalPages).toBe(1);
        });
    });
    (0, globals_1.describe)('incrementViewCount', () => {
        (0, globals_1.it)('應該成功增加瀏覽次數', async () => {
            Pet.findByIdAndUpdate.mockResolvedValue(mockPet);
            await petService_1.PetService.incrementViewCount('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(Pet.findByIdAndUpdate).toHaveBeenCalledWith('507f1f77bcf86cd799439011', { $inc: { viewCount: 1 } }, { new: true });
        });
    });
    (0, globals_1.describe)('incrementShareCount', () => {
        (0, globals_1.it)('應該成功增加分享次數', async () => {
            Pet.findByIdAndUpdate.mockResolvedValue(mockPet);
            await petService_1.PetService.incrementShareCount('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(Pet.findByIdAndUpdate).toHaveBeenCalledWith('507f1f77bcf86cd799439011', { $inc: { shareCount: 1 } }, { new: true });
        });
    });
});
console.log('✅ petService 測試檔案已載入');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXJ2aWNlc1xccGV0U2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsZ0NBQWdDO0FBQ2hDLDJDQUFrRjtBQU1sRixTQUFTO0FBQ1QsY0FBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2xDLGNBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNuQyxjQUFJLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFDbEQsY0FBSSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQzFDLGNBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQVRwQyxXQUFXO0FBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO0FBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLHVEQUF1RCxDQUFDO0FBU2pGLFdBQVc7QUFDWCw4REFBeUY7QUFFekYsYUFBYTtBQUNiLE1BQU0sT0FBTyxHQUFHO0lBQ2QsR0FBRyxFQUFFLDBCQUEwQjtJQUMvQixJQUFJLEVBQUUsSUFBSTtJQUNWLElBQUksRUFBRSxLQUFLO0lBQ1gsS0FBSyxFQUFFLE1BQU07SUFDYixNQUFNLEVBQUUsTUFBTTtJQUNkLEtBQUssRUFBRSwwQkFBMEI7SUFDakMsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixRQUFRLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGNBQWMsRUFBRTtJQUNwQyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7SUFDckIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO0NBQ3RCLENBQUM7QUFFRixjQUFjO0FBQ2QsTUFBTSxRQUFRLEdBQUc7SUFDZixHQUFHLEVBQUUsMEJBQTBCO0lBQy9CLFFBQVEsRUFBRSxVQUFVO0lBQ3BC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SUFBSSxFQUFFLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQzNCLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxDQUNkLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXJ2aWNlc1xccGV0U2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBldFNlcnZpY2Ug5Zau5YWD5ris6KmmIC0g57Ch5YyW54mI5pys77yM5LiN5L6d6LO05pW45pOa5bqrXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgamVzdCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5cbi8vIOioree9rua4rOippueSsOWig+iuiuaVuFxucHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG5wcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtand0LXNlY3JldC1rZXktd2l0aC1taW5pbXVtLTMyLWNoYXJhY3RlcnMtbGVuZ3RoJztcblxuLy8g5qih5pOs5aSW6YOo5L6d6LO0XG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9tb2RlbHMvUGV0Jyk7XG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9tb2RlbHMvVXNlcicpO1xuamVzdC5tb2NrKCcuLi8uLi9zcmMvc2VydmljZXMvY2xvdWRpbmFyeVNlcnZpY2UnKTtcbmplc3QubW9jaygnLi4vLi4vc3JjL3NlcnZpY2VzL2FpU2VydmljZScpO1xuamVzdC5tb2NrKCcuLi8uLi9zcmMvdXRpbHMvbG9nZ2VyJyk7XG5cbi8vIOWwjuWFpeimgea4rOippueahOacjeWLmVxuaW1wb3J0IHsgUGV0U2VydmljZSwgQ3JlYXRlUGV0RGF0YSwgVXBkYXRlUGV0RGF0YSB9IGZyb20gJy4uLy4uL3NyYy9zZXJ2aWNlcy9wZXRTZXJ2aWNlJztcblxuLy8g5qih5pOs55qEIFBldCDmqKHlnotcbmNvbnN0IG1vY2tQZXQgPSB7XG4gIF9pZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScsXG4gIG5hbWU6ICflsI/nmb0nLFxuICB0eXBlOiAnZG9nJyxcbiAgYnJlZWQ6ICfmi4nluIPmi4nlpJonLFxuICBzdGF0dXM6ICdsb3N0JyxcbiAgb3duZXI6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTInLFxuICBzYXZlOiBqZXN0LmZuKCksXG4gIHBvcHVsYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbn07XG5cbi8vIOaooeaTrOeahCBVc2VyIOaooeWei1xuY29uc3QgbW9ja1VzZXIgPSB7XG4gIF9pZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicsXG4gIHVzZXJuYW1lOiAndGVzdHVzZXInLFxuICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nXG59O1xuXG4vLyDmqKHmk6wgUGV0IOaooeWei+eahOmdnOaFi+aWueazlVxuY29uc3QgUGV0ID0ge1xuICBmaW5kQnlJZDogamVzdC5mbigpLFxuICBmaW5kT25lOiBqZXN0LmZuKCksXG4gIGZpbmRCeUlkQW5kVXBkYXRlOiBqZXN0LmZuKCksXG4gIGZpbmRCeUlkQW5kRGVsZXRlOiBqZXN0LmZuKCksXG4gIGZpbmQ6IGplc3QuZm4oKSxcbiAgY291bnREb2N1bWVudHM6IGplc3QuZm4oKSxcbiAgZGVsZXRlTWFueTogamVzdC5mbigpXG59O1xuXG4vLyDmqKHmk6wgVXNlciDmqKHlnovnmoTpnZzmhYvmlrnms5VcbmNvbnN0IFVzZXIgPSB7XG4gIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gIGRlbGV0ZU1hbnk6IGplc3QuZm4oKVxufTtcblxuLy8g5qih5pOsIENsb3VkaW5hcnlTZXJ2aWNlXG5jb25zdCBDbG91ZGluYXJ5U2VydmljZSA9IHtcbiAgdXBsb2FkSW1hZ2U6IGplc3QuZm4oKSxcbiAgZGVsZXRlSW1hZ2U6IGplc3QuZm4oKVxufTtcblxuLy8g5qih5pOsIGFpU2VydmljZVxuY29uc3QgYWlTZXJ2aWNlID0ge1xuICBhbmFseXplSW1hZ2U6IGplc3QuZm4oKVxufTtcblxuLy8g6Kit572u5qih5pOsXG5yZXF1aXJlKCcuLi8uLi9zcmMvbW9kZWxzL1BldCcpLlBldCA9IFBldDtcbnJlcXVpcmUoJy4uLy4uL3NyYy9tb2RlbHMvVXNlcicpLlVzZXIgPSBVc2VyO1xucmVxdWlyZSgnLi4vLi4vc3JjL3NlcnZpY2VzL2Nsb3VkaW5hcnlTZXJ2aWNlJykuQ2xvdWRpbmFyeVNlcnZpY2UgPSBDbG91ZGluYXJ5U2VydmljZTtcbnJlcXVpcmUoJy4uLy4uL3NyYy9zZXJ2aWNlcy9haVNlcnZpY2UnKS5haVNlcnZpY2UgPSBhaVNlcnZpY2U7XG5cbmRlc2NyaWJlKCdQZXRTZXJ2aWNlIOa4rOippicsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgXG4gICAgLy8g6Kit572u6aCQ6Kit55qE5qih5pOs5Zue5oeJXG4gICAgVXNlci5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgUGV0LmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIC4uLm1vY2tQZXQsXG4gICAgICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpXG4gICAgfSk7XG4gICAgbW9ja1BldC5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICAgIG1vY2tQZXQucG9wdWxhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BldCk7XG4gIH0pO1xuICBcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc3RvcmVBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlUGV0JywgKCkgPT4ge1xuICAgIGNvbnN0IHBldERhdGE6IENyZWF0ZVBldERhdGEgPSB7XG4gICAgICBuYW1lOiAn5bCP6IqxJyxcbiAgICAgIHR5cGU6ICdjYXQnLFxuICAgICAgYnJlZWQ6ICfms6Lmlq/ospMnLFxuICAgICAgc3RhdHVzOiAnbG9zdCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ+i1sOWkseeahOWwj+iykycsXG4gICAgICBsb2NhdGlvbjoge1xuICAgICAgICBhZGRyZXNzOiAn5Y+w5YyX5biC5L+h576p5Y2AJyxcbiAgICAgICAgY2l0eTogJ+WPsOWMl+W4gicsXG4gICAgICAgIGNvb3JkaW5hdGVzOiBbMTIxLjU2NTQsIDI1LjAzMzBdXG4gICAgICB9LFxuICAgICAgY29udGFjdDoge1xuICAgICAgICBwaG9uZTogJzA5MTIzNDU2NzgnLFxuICAgICAgICBlbWFpbDogJ293bmVyQGV4YW1wbGUuY29tJ1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpdCgn5oeJ6Kmy5oiQ5Yqf5Ym15bu65a+154mpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8g5qih5pOsIFBldCDmp4vpgKDlh73mlbhcbiAgICAgIGNvbnN0IG1vY2tQZXRDb25zdHJ1Y3RvciA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgICAgLi4ubW9ja1BldCxcbiAgICAgICAgLi4ucGV0RGF0YSxcbiAgICAgICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja1BldCwgLi4ucGV0RGF0YSB9KSxcbiAgICAgICAgcG9wdWxhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLm1vY2tQZXQsIC4uLnBldERhdGEgfSlcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgUGV0LnByb3RvdHlwZSA9IG1vY2tQZXRDb25zdHJ1Y3Rvci5wcm90b3R5cGU7XG4gICAgICBnbG9iYWwuUGV0ID0gbW9ja1BldENvbnN0cnVjdG9yO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQZXRTZXJ2aWNlLmNyZWF0ZVBldCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJywgcGV0RGF0YSk7XG4gICAgICAgXG4gICAgICAgZXhwZWN0KFVzZXIuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Lm5hbWUpLnRvQmUocGV0RGF0YS5uYW1lKTtcbiAgICB9KTtcblxuICAgIGl0KCfmh4noqbLlnKjmk4HmnInogIXkuI3lrZjlnKjmmYLmi4vlh7rpjK/oqqQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBVc2VyLmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoUGV0U2VydmljZS5jcmVhdGVQZXQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTk5OScsIHBldERhdGEpKVxuICAgICAgICAgLnJlamVjdHMudG9UaHJvdygn5pOB5pyJ6ICF5LiN5a2Y5ZyoJyk7XG4gICAgfSk7XG5cbiAgICBpdCgn5oeJ6Kmy6JmV55CG5ZyW54mH5LiK5YKzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0RGF0YVdpdGhJbWFnZXMgPSB7XG4gICAgICAgIC4uLnBldERhdGEsXG4gICAgICAgIGltYWdlczogWydpbWFnZTEuanBnJywgJ2ltYWdlMi5qcGcnXVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgQ2xvdWRpbmFyeVNlcnZpY2UudXBsb2FkSW1hZ2UubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBzZWN1cmVfdXJsOiAnaHR0cHM6Ly9jbG91ZGluYXJ5LmNvbS90ZXN0LmpwZycsXG4gICAgICAgIHB1YmxpY19pZDogJ3Rlc3RfaWQnLFxuICAgICAgICB3aWR0aDogODAwLFxuICAgICAgICBoZWlnaHQ6IDYwMFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tQZXRDb25zdHJ1Y3RvciA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgICAgLi4ubW9ja1BldCxcbiAgICAgICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpLFxuICAgICAgICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIGdsb2JhbC5QZXQgPSBtb2NrUGV0Q29uc3RydWN0b3I7XG4gICAgICBcbiAgICAgIGF3YWl0IFBldFNlcnZpY2UuY3JlYXRlUGV0KCc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTInLCBwZXREYXRhV2l0aEltYWdlcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChDbG91ZGluYXJ5U2VydmljZS51cGxvYWRJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UGV0QnlJZCcsICgpID0+IHtcbiAgICBpdCgn5oeJ6Kmy5oiQ5Yqf5qC55pOaSUTnjbLlj5blr7XniaknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQZXRTZXJ2aWNlLmdldFBldEJ5SWQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpO1xuICAgICAgIFxuICAgICAgIGV4cGVjdChQZXQuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnKTtcbiAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgIGV4cGVjdChyZXN1bHQ/Ll9pZCkudG9CZSgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG4gICAgfSk7XG5cbiAgICBpdCgn5oeJ6Kmy5ZyoSUTnhKHmlYjmmYLmi4vlh7rpjK/oqqQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBleHBlY3QoUGV0U2VydmljZS5nZXRQZXRCeUlkKCdpbnZhbGlkLWlkJykpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ+eEoeaViOeahOWvteeJqSBJRCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+aHieipsui/lOWbnm51bGznlbblr7XniankuI3lrZjlnKgnLCBhc3luYyAoKSA9PiB7XG4gICAgICBQZXQuZmluZEJ5SWQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgcG9wdWxhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgIGV4ZWM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKVxuICAgICAgICB9KVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuZ2V0UGV0QnlJZCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGVQZXQnLCAoKSA9PiB7XG4gICAgY29uc3QgdXBkYXRlRGF0YTogVXBkYXRlUGV0RGF0YSA9IHtcbiAgICAgIG5hbWU6ICfmm7TmlrDnmoTlsI/nmb0nLFxuICAgICAgZGVzY3JpcHRpb246ICfmm7TmlrDnmoTmj4/ov7AnXG4gICAgfTtcblxuICAgIGl0KCfmh4noqbLmiJDlip/mm7TmlrDlr7XniaknLCBhc3luYyAoKSA9PiB7XG4gICAgICBQZXQuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0KTtcbiAgICAgIFBldC5maW5kQnlJZEFuZFVwZGF0ZS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja1BldCwgLi4udXBkYXRlRGF0YSB9KVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UudXBkYXRlUGV0KCc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLCAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJywgdXBkYXRlRGF0YSk7XG4gICAgICAgXG4gICAgICAgZXhwZWN0KFBldC5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IF9pZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScsIG93bmVyOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJyB9KTtcbiAgICAgIGV4cGVjdChQZXQuZmluZEJ5SWRBbmRVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQ/Lm5hbWUpLnRvQmUodXBkYXRlRGF0YS5uYW1lKTtcbiAgICB9KTtcblxuICAgIGl0KCfmh4noqbLlnKjlr7XniankuI3lrZjlnKjmmYLmi4vlh7rpjK/oqqQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBQZXQuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KFBldFNlcnZpY2UudXBkYXRlUGV0KCc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLCAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJywgdXBkYXRlRGF0YSkpXG4gICAgICAgICAucmVqZWN0cy50b1Rocm93KCflr7XniankuI3lrZjlnKjmiJbmgqjmspLmnInmrIrpmZDkv67mlLknKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGV0ZVBldCcsICgpID0+IHtcbiAgICBpdCgn5oeJ6Kmy5oiQ5Yqf5Yiq6Zmk5a+154mpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrUGV0LFxuICAgICAgICBpbWFnZXM6IFt7IHB1YmxpY0lkOiAndGVzdF9pZCcsIHVybDogJ3Rlc3QuanBnJyB9XVxuICAgICAgfSk7XG4gICAgICBQZXQuZmluZEJ5SWRBbmREZWxldGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BldCk7XG4gICAgICBDbG91ZGluYXJ5U2VydmljZS5kZWxldGVJbWFnZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUGV0U2VydmljZS5kZWxldGVQZXQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScsICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTInKTtcbiAgICAgICBcbiAgICAgICBleHBlY3QoUGV0LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywgb3duZXI6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTInIH0pO1xuICAgICAgIGV4cGVjdChQZXQuZmluZEJ5SWRBbmREZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnKTtcbiAgICAgIGV4cGVjdChDbG91ZGluYXJ5U2VydmljZS5kZWxldGVJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3RfaWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5oeJ6Kmy5Zyo5a+154mp5LiN5a2Y5Zyo5pmC5ouL5Ye66Yyv6KqkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChQZXRTZXJ2aWNlLmRlbGV0ZVBldCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywgJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicpKVxuICAgICAgICAgLnJlamVjdHMudG9UaHJvdygn5a+154mp5LiN5a2Y5Zyo5oiW5oKo5rKS5pyJ5qyK6ZmQ5Yiq6ZmkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBbGxQZXRzJywgKCkgPT4ge1xuICAgIGl0KCfmh4noqbLmiJDlip/njbLlj5bmiYDmnInlr7XniaknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUGV0cyA9IFttb2NrUGV0LCB7IC4uLm1vY2tQZXQsIF9pZDogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMycsIG5hbWU6ICflsI/pu5EnIH1dO1xuICAgICAgXG4gICAgICBQZXQuZmluZC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc29ydDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICBza2lwOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICAgbGltaXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgICAgIGV4ZWM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0cylcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBQZXQuY291bnREb2N1bWVudHMubW9ja1Jlc29sdmVkVmFsdWUoMik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuZ2V0QWxsUGV0cygxLCAxMCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQucGV0cykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGFnZSkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxQYWdlcykudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2luY3JlbWVudFZpZXdDb3VudCcsICgpID0+IHtcbiAgICBpdCgn5oeJ6Kmy5oiQ5Yqf5aKe5Yqg54CP6Ka95qyh5pW4JywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRCeUlkQW5kVXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICAgICAgXG4gICAgICBhd2FpdCBQZXRTZXJ2aWNlLmluY3JlbWVudFZpZXdDb3VudCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG4gICAgICAgXG4gICAgICAgZXhwZWN0KFBldC5maW5kQnlJZEFuZFVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyxcbiAgICAgICAgeyAkaW5jOiB7IHZpZXdDb3VudDogMSB9IH0sXG4gICAgICAgIHsgbmV3OiB0cnVlIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbmNyZW1lbnRTaGFyZUNvdW50JywgKCkgPT4ge1xuICAgIGl0KCfmh4noqbLmiJDlip/lop7liqDliIbkuqvmrKHmlbgnLCBhc3luYyAoKSA9PiB7XG4gICAgICBQZXQuZmluZEJ5SWRBbmRVcGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BldCk7XG4gICAgICBcbiAgICAgIGF3YWl0IFBldFNlcnZpY2UuaW5jcmVtZW50U2hhcmVDb3VudCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG4gICAgICAgXG4gICAgICAgZXhwZWN0KFBldC5maW5kQnlJZEFuZFVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyxcbiAgICAgICAgeyAkaW5jOiB7IHNoYXJlQ291bnQ6IDEgfSB9LFxuICAgICAgICB7IG5ldzogdHJ1ZSB9XG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5jb25zb2xlLmxvZygn4pyFIHBldFNlcnZpY2Ug5ris6Kmm5qqU5qGI5bey6LyJ5YWlJyk7Il0sInZlcnNpb24iOjN9