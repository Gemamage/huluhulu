{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\models\\Pet.ts","mappings":"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","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\models\\Pet.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\n// 聯絡資訊介面\nexport interface IContactInfo {\n  name: string;\n  phone: string;\n  email: string;\n}\n\n// AI 分析結果介面\nexport interface IAIAnalysis {\n  confidence: number;\n  labels: string[];\n  detectedBreed?: string;\n  colors: string[];\n  features: string[];\n}\n\n// 圖像特徵介面\nexport interface IImageFeatures {\n  imageUrl: string;\n  features: number[]; // 特徵向量\n  analysis?: IAIAnalysis;\n  processedAt: Date;\n}\n\n// 寵物介面定義\nexport interface IPet extends Document {\n  _id: mongoose.Types.ObjectId;\n  name: string;\n  type: 'dog' | 'cat' | 'bird' | 'rabbit' | 'other';\n  breed?: string | null;\n  gender: 'male' | 'female' | 'unknown';\n  age?: number | null;\n  color?: string | null;\n  size: 'small' | 'medium' | 'large';\n  status: 'lost' | 'found' | 'reunited';\n  description: string;\n  lastSeenLocation: string;\n  lastSeenDate: Date;\n  contactInfo: IContactInfo;\n  images: string[];\n  reward?: number | null;\n  isUrgent: boolean;\n  microchipId?: string | null;\n  vaccinations?: string[] | null;\n  medicalConditions?: string[] | null;\n  specialMarks?: string | null;\n  personality?: string[] | null;\n  viewCount: number;\n  shareCount: number;\n  userId: mongoose.Types.ObjectId;\n  // AI 相關字段\n  aiFeatures?: IImageFeatures[];\n  aiBreedPrediction?: string;\n  aiConfidence?: number;\n  aiTags?: string[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n// 聯絡資訊 Schema\nconst contactInfoSchema = new Schema<IContactInfo>({\n  name: {\n    type: String,\n    required: [true, '聯絡人姓名為必填項目'],\n    trim: true,\n    maxlength: [50, '聯絡人姓名長度不能超過 50 個字符'],\n  },\n  phone: {\n    type: String,\n    required: [true, '聯絡電話為必填項目'],\n    trim: true,\n    match: [/^[+]?[0-9\\s\\-()]+$/, '請提供有效的電話號碼'],\n  },\n  email: {\n    type: String,\n    required: [true, '聯絡電子郵件為必填項目'],\n    lowercase: true,\n    trim: true,\n    match: [/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/, '請提供有效的電子郵件地址'],\n  },\n}, { _id: false });\n\n// AI 分析結果 Schema\nconst aiAnalysisSchema = new Schema<IAIAnalysis>({\n  confidence: {\n    type: Number,\n    required: true,\n    min: 0,\n    max: 1,\n  },\n  labels: {\n    type: [String],\n    default: [],\n  },\n  detectedBreed: {\n    type: String,\n    trim: true,\n  },\n  colors: {\n    type: [String],\n    default: [],\n  },\n  features: {\n    type: [String],\n    default: [],\n  },\n}, { _id: false });\n\n// 圖像特徵 Schema\nconst imageFeaturesSchema = new Schema<IImageFeatures>({\n  imageUrl: {\n    type: String,\n    required: true,\n  },\n  features: {\n    type: [Number],\n    required: true,\n  },\n  analysis: {\n    type: aiAnalysisSchema,\n  },\n  processedAt: {\n    type: Date,\n    default: Date.now,\n  },\n}, { _id: false });\n\n// 寵物 Schema\nconst petSchema = new Schema<IPet>({\n  name: {\n    type: String,\n    required: [true, '寵物名稱為必填項目'],\n    trim: true,\n    maxlength: [50, '寵物名稱長度不能超過 50 個字符'],\n  },\n  type: {\n    type: String,\n    required: [true, '寵物類型為必填項目'],\n    enum: {\n      values: ['dog', 'cat', 'bird', 'rabbit', 'other'],\n      message: '寵物類型必須是: dog, cat, bird, rabbit, other 其中之一',\n    },\n  },\n  breed: {\n    type: String,\n    trim: true,\n    maxlength: [50, '品種名稱長度不能超過 50 個字符'],\n  },\n  gender: {\n    type: String,\n    required: [true, '寵物性別為必填項目'],\n    enum: {\n      values: ['male', 'female', 'unknown'],\n      message: '寵物性別必須是: male, female, unknown 其中之一',\n    },\n  },\n  age: {\n    type: Number,\n    min: [0, '年齡不能為負數'],\n    max: [50, '年齡不能超過 50 歲'],\n  },\n  color: {\n    type: String,\n    trim: true,\n    maxlength: [100, '顏色描述長度不能超過 100 個字符'],\n  },\n  size: {\n    type: String,\n    required: [true, '寵物體型為必填項目'],\n    enum: {\n      values: ['small', 'medium', 'large'],\n      message: '寵物體型必須是: small, medium, large 其中之一',\n    },\n  },\n  status: {\n    type: String,\n    required: [true, '狀態為必填項目'],\n    enum: {\n      values: ['lost', 'found', 'reunited'],\n      message: '狀態必須是: lost, found, reunited 其中之一',\n    },\n  },\n  description: {\n    type: String,\n    required: [true, '描述為必填項目'],\n    trim: true,\n    maxlength: [1000, '描述長度不能超過 1000 個字符'],\n  },\n  lastSeenLocation: {\n    type: String,\n    required: [true, '最後出現地點為必填項目'],\n    trim: true,\n    maxlength: [200, '地點描述長度不能超過 200 個字符'],\n  },\n  lastSeenDate: {\n    type: Date,\n    required: [true, '最後出現日期為必填項目'],\n  },\n  contactInfo: {\n    type: contactInfoSchema,\n    required: [true, '聯絡資訊為必填項目'],\n  },\n  images: {\n    type: [String],\n    default: [],\n    validate: {\n      validator: function(images: string[]) {\n        return images.length <= 10;\n      },\n      message: '圖片數量不能超過 10 張',\n    },\n  },\n  reward: {\n    type: Number,\n    min: [0, '獎金不能為負數'],\n    max: [1000000, '獎金不能超過 1,000,000'],\n    default: 0,\n  },\n  isUrgent: {\n    type: Boolean,\n    default: false,\n  },\n  microchipId: {\n    type: String,\n    trim: true,\n    maxlength: [50, '晶片編號長度不能超過 50 個字符'],\n  },\n  vaccinations: {\n    type: [String],\n    default: [],\n  },\n  medicalConditions: {\n    type: [String],\n    default: [],\n  },\n  specialMarks: {\n    type: String,\n    trim: true,\n    maxlength: [500, '特殊標記描述長度不能超過 500 個字符'],\n  },\n  personality: {\n    type: [String],\n    default: [],\n  },\n  viewCount: {\n    type: Number,\n    default: 0,\n    min: [0, '瀏覽次數不能為負數'],\n  },\n  shareCount: {\n    type: Number,\n    default: 0,\n    min: [0, '分享次數不能為負數'],\n  },\n  userId: {\n    type: Schema.Types.ObjectId,\n    ref: 'User',\n    required: [true, '用戶 ID 為必填項目'],\n  },\n  // AI 相關字段\n  aiFeatures: {\n    type: [imageFeaturesSchema],\n    default: [],\n  },\n  aiBreedPrediction: {\n    type: String,\n    trim: true,\n    maxlength: [100, 'AI 品種預測長度不能超過 100 個字符'],\n  },\n  aiConfidence: {\n    type: Number,\n    min: [0, 'AI 信心度不能為負數'],\n    max: [1, 'AI 信心度不能超過 1'],\n  },\n  aiTags: {\n    type: [String],\n    default: [],\n    validate: {\n      validator: function(tags: string[]) {\n        return tags.length <= 20;\n      },\n      message: 'AI 標籤數量不能超過 20 個',\n    },\n  },\n}, {\n  timestamps: true,\n  toJSON: {\n    transform: function(doc, ret) {\n      ret.id = ret._id;\n      delete (ret as any)._id;\n      delete (ret as any).__v;\n      return ret;\n    },\n  },\n});\n\n// 建立索引\npetSchema.index({ status: 1 });\npetSchema.index({ type: 1 });\npetSchema.index({ lastSeenLocation: 'text', description: 'text', name: 'text' });\npetSchema.index({ createdAt: -1 });\npetSchema.index({ userId: 1 });\npetSchema.index({ isUrgent: -1, createdAt: -1 });\n\n// 匯出寵物模型\nexport const Pet = mongoose.model<IPet>('Pet', petSchema);"],"version":3}