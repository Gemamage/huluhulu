9810b48c214769c5d29b448a82782066
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.responseMiddleware = exports.ResponseUtil = void 0;
const errors_1 = require("./errors");
/**
 * 響應工具類
 */
class ResponseUtil {
    /**
     * 發送成功響應
     */
    static success(res, data, message, statusCode = 200, meta) {
        const response = {
            success: true,
            timestamp: new Date().toISOString(),
        };
        if (message) {
            response.message = message;
        }
        if (data !== undefined) {
            response.data = data;
        }
        if (meta) {
            response.meta = meta;
        }
        res.status(statusCode).json(response);
    }
    /**
     * 發送創建成功響應
     */
    static created(res, data, message = "創建成功") {
        ResponseUtil.success(res, data, message, 201);
    }
    /**
     * 發送更新成功響應
     */
    static updated(res, data, message = "更新成功") {
        ResponseUtil.success(res, data, message, 200);
    }
    /**
     * 發送刪除成功響應
     */
    static deleted(res, message = "刪除成功") {
        ResponseUtil.success(res, undefined, message, 200);
    }
    /**
     * 發送分頁響應
     */
    static paginated(res, data, pagination, message) {
        const totalPages = Math.ceil(pagination.total / pagination.limit);
        const meta = {
            page: pagination.page,
            limit: pagination.limit,
            total: pagination.total,
            totalPages,
            hasNext: pagination.page < totalPages,
            hasPrev: pagination.page > 1,
        };
        ResponseUtil.success(res, data, message, 200, meta);
    }
    /**
     * 發送錯誤響應
     */
    static error(res, error, path, method) {
        const response = {
            success: false,
            error: {
                message: error.message,
                code: error.errorCode,
                statusCode: error.statusCode,
                timestamp: error.timestamp,
            },
        };
        if (error.details && error.details.length > 0) {
            response.error.details = error.details;
        }
        if (path) {
            response.error.path = path;
        }
        if (method) {
            response.error.method = method;
        }
        res.status(error.statusCode).json(response);
    }
    /**
     * 發送驗證錯誤響應
     */
    static validationError(res, errors, message = "輸入資料驗證失敗") {
        const appError = new errors_1.AppError(message, 400, errors_1.ErrorCode.VALIDATION_ERROR, errors);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送未授權響應
     */
    static unauthorized(res, message = "認證失敗") {
        const appError = new errors_1.AppError(message, 401, errors_1.ErrorCode.AUTHENTICATION_FAILED);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送禁止訪問響應
     */
    static forbidden(res, message = "權限不足") {
        const appError = new errors_1.AppError(message, 403, errors_1.ErrorCode.INSUFFICIENT_PERMISSIONS);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送未找到響應
     */
    static notFound(res, resource = "資源", identifier) {
        const message = identifier
            ? `${resource} (${identifier}) 未找到`
            : `${resource} 未找到`;
        const appError = new errors_1.AppError(message, 404, errors_1.ErrorCode.RESOURCE_NOT_FOUND, [
            { resource, identifier },
        ]);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送衝突響應
     */
    static conflict(res, resource, field, value) {
        const message = `${resource} 的 ${field} 已存在`;
        const appError = new errors_1.AppError(message, 409, errors_1.ErrorCode.RESOURCE_CONFLICT, [
            { resource, field, value, constraint: "unique" },
        ]);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送速率限制響應
     */
    static rateLimited(res, message = "請求過於頻繁，請稍後再試") {
        const appError = new errors_1.AppError(message, 429, errors_1.ErrorCode.RATE_LIMIT_EXCEEDED);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送內部伺服器錯誤響應
     */
    static internalError(res, message = "內部伺服器錯誤") {
        const appError = new errors_1.AppError(message, 500, errors_1.ErrorCode.INTERNAL_SERVER_ERROR, undefined, false);
        ResponseUtil.error(res, appError);
    }
}
exports.ResponseUtil = ResponseUtil;
/**
 * 響應中間件 - 為 Response 對象添加便捷方法
 */
const responseMiddleware = (req, res, next) => {
    // 添加便捷方法到 Response 對象
    res.success = function (data, message, statusCode, meta) {
        return ResponseUtil.success(this, data, message, statusCode, meta);
    };
    res.created = function (data, message) {
        return ResponseUtil.created(this, data, message);
    };
    res.updated = function (data, message) {
        return ResponseUtil.updated(this, data, message);
    };
    res.deleted = function (message) {
        return ResponseUtil.deleted(this, message);
    };
    res.paginated = function (data, pagination, message) {
        return ResponseUtil.paginated(this, data, pagination, message);
    };
    res.validationError = function (errors, message) {
        return ResponseUtil.validationError(this, errors, message);
    };
    res.unauthorized = function (message) {
        return ResponseUtil.unauthorized(this, message);
    };
    res.forbidden = function (message) {
        return ResponseUtil.forbidden(this, message);
    };
    res.notFound = function (resource, identifier) {
        return ResponseUtil.notFound(this, resource, identifier);
    };
    res.conflict = function (resource, field, value) {
        return ResponseUtil.conflict(this, resource, field, value);
    };
    res.rateLimited = function (message) {
        return ResponseUtil.rateLimited(this, message);
    };
    res.internalError = function (message) {
        return ResponseUtil.internalError(this, message);
    };
    next();
};
exports.responseMiddleware = responseMiddleware;
exports.default = ResponseUtil;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxyZXNwb25zZS50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSxxQ0FBK0M7QUFnRC9DOztHQUVHO0FBQ0gsTUFBYSxZQUFZO0lBQ3ZCOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FDWixHQUFhLEVBQ2IsSUFBUSxFQUNSLE9BQWdCLEVBQ2hCLGFBQXFCLEdBQUcsRUFDeEIsSUFBOEI7UUFFOUIsTUFBTSxRQUFRLEdBQXVCO1lBQ25DLE9BQU8sRUFBRSxJQUFJO1lBQ2IsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1NBQ3BDLENBQUM7UUFFRixJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ1osUUFBUSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDN0IsQ0FBQztRQUVELElBQUksSUFBSSxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQ3ZCLFFBQVEsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLENBQUM7UUFFRCxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ1QsUUFBUSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDdkIsQ0FBQztRQUVELEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxPQUFPLENBQ1osR0FBYSxFQUNiLElBQVEsRUFDUixVQUFrQixNQUFNO1FBRXhCLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FDWixHQUFhLEVBQ2IsSUFBUSxFQUNSLFVBQWtCLE1BQU07UUFFeEIsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVB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O0lBRUYsR0FBRyxDQUFDLFdBQVcsR0FBRyxVQUFVLE9BQWdCO1FBQzFDLE9BQU8sWUFBWSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDakQsQ0FBQyxDQUFDO0lBRUYsR0FBRyxDQUFDLGFBQWEsR0FBRyxVQUFVLE9BQWdCO1FBQzVDLE9BQU8sWUFBWSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDbkQsQ0FBQyxDQUFDO0lBRUYsSUFBSSxFQUFFLENBQUM7QUFDVCxDQUFDLENBQUM7QUFuRVcsUUFBQSxrQkFBa0Isc0JBbUU3QjtBQWtDRixrQkFBZSxZQUFZLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxyZXNwb25zZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXNwb25zZSB9IGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBBcHBFcnJvciwgRXJyb3JDb2RlIH0gZnJvbSBcIi4vZXJyb3JzXCI7XG5cbi8qKlxuICog5oiQ5Yqf6Z+/5oeJ5LuL6Z2iXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU3VjY2Vzc1Jlc3BvbnNlPFQgPSBhbnk+IHtcbiAgc3VjY2VzczogdHJ1ZTtcbiAgbWVzc2FnZT86IHN0cmluZztcbiAgZGF0YT86IFQ7XG4gIG1ldGE/OiB7XG4gICAgcGFnZT86IG51bWJlcjtcbiAgICBsaW1pdD86IG51bWJlcjtcbiAgICB0b3RhbD86IG51bWJlcjtcbiAgICB0b3RhbFBhZ2VzPzogbnVtYmVyO1xuICAgIGhhc05leHQ/OiBib29sZWFuO1xuICAgIGhhc1ByZXY/OiBib29sZWFuO1xuICB9O1xuICB0aW1lc3RhbXA6IHN0cmluZztcbn1cblxuLyoqXG4gKiDpjK/oqqTpn7/mh4nku4vpnaJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFcnJvclJlc3BvbnNlIHtcbiAgc3VjY2VzczogZmFsc2U7XG4gIGVycm9yOiB7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGNvZGU6IEVycm9yQ29kZTtcbiAgICBzdGF0dXNDb2RlOiBudW1iZXI7XG4gICAgZGV0YWlscz86IGFueVtdO1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gICAgbWV0aG9kPzogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICB9O1xufVxuXG4vKipcbiAqIOWIhumggeizh+ioiuS7i+mdolxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhZ2luYXRpb25NZXRhIHtcbiAgcGFnZTogbnVtYmVyO1xuICBsaW1pdDogbnVtYmVyO1xuICB0b3RhbDogbnVtYmVyO1xuICB0b3RhbFBhZ2VzOiBudW1iZXI7XG4gIGhhc05leHQ6IGJvb2xlYW47XG4gIGhhc1ByZXY6IGJvb2xlYW47XG59XG5cbi8qKlxuICog6Z+/5oeJ5bel5YW36aGeXG4gKi9cbmV4cG9ydCBjbGFzcyBSZXNwb25zZVV0aWwge1xuICAvKipcbiAgICog55m86YCB5oiQ5Yqf6Z+/5oeJXG4gICAqL1xuICBzdGF0aWMgc3VjY2VzczxUPihcbiAgICByZXM6IFJlc3BvbnNlLFxuICAgIGRhdGE/OiBULFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgc3RhdHVzQ29kZTogbnVtYmVyID0gMjAwLFxuICAgIG1ldGE/OiBQYXJ0aWFsPFBhZ2luYXRpb25NZXRhPixcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgcmVzcG9uc2U6IFN1Y2Nlc3NSZXNwb25zZTxUPiA9IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuXG4gICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgIHJlc3BvbnNlLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgIH1cblxuICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJlc3BvbnNlLmRhdGEgPSBkYXRhO1xuICAgIH1cblxuICAgIGlmIChtZXRhKSB7XG4gICAgICByZXNwb25zZS5tZXRhID0gbWV0YTtcbiAgICB9XG5cbiAgICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24ocmVzcG9uc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgeWJteW7uuaIkOWKn+mfv+aHiVxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZWQ8VD4oXG4gICAgcmVzOiBSZXNwb25zZSxcbiAgICBkYXRhPzogVCxcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSBcIuWJteW7uuaIkOWKn1wiLFxuICApOiB2b2lkIHtcbiAgICBSZXNwb25zZVV0aWwuc3VjY2VzcyhyZXMsIGRhdGEsIG1lc3NhZ2UsIDIwMSk7XG4gIH1cblxuICAvKipcbiAgICog55m86YCB5pu05paw5oiQ5Yqf6Z+/5oeJXG4gICAqL1xuICBzdGF0aWMgdXBkYXRlZDxUPihcbiAgICByZXM6IFJlc3BvbnNlLFxuICAgIGRhdGE/OiBULFxuICAgIG1lc3NhZ2U6IHN0cmluZyA9IFwi5pu05paw5oiQ5YqfXCIsXG4gICk6IHZvaWQge1xuICAgIFJlc3BvbnNlVXRpbC5zdWNjZXNzKHJlcywgZGF0YSwgbWVzc2FnZSwgMjAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHliKrpmaTmiJDlip/pn7/mh4lcbiAgICovXG4gIHN0YXRpYyBkZWxldGVkKHJlczogUmVzcG9uc2UsIG1lc3NhZ2U6IHN0cmluZyA9IFwi5Yiq6Zmk5oiQ5YqfXCIpOiB2b2lkIHtcbiAgICBSZXNwb25zZVV0aWwuc3VjY2VzcyhyZXMsIHVuZGVmaW5lZCwgbWVzc2FnZSwgMjAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHliIbpoIHpn7/mh4lcbiAgICovXG4gIHN0YXRpYyBwYWdpbmF0ZWQ8VD4oXG4gICAgcmVzOiBSZXNwb25zZSxcbiAgICBkYXRhOiBUW10sXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgcGFnZTogbnVtYmVyO1xuICAgICAgbGltaXQ6IG51bWJlcjtcbiAgICAgIHRvdGFsOiBudW1iZXI7XG4gICAgfSxcbiAgICBtZXNzYWdlPzogc3RyaW5nLFxuICApOiB2b2lkIHtcbiAgICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKHBhZ2luYXRpb24udG90YWwgLyBwYWdpbmF0aW9uLmxpbWl0KTtcbiAgICBjb25zdCBtZXRhOiBQYWdpbmF0aW9uTWV0YSA9IHtcbiAgICAgIHBhZ2U6IHBhZ2luYXRpb24ucGFnZSxcbiAgICAgIGxpbWl0OiBwYWdpbmF0aW9uLmxpbWl0LFxuICAgICAgdG90YWw6IHBhZ2luYXRpb24udG90YWwsXG4gICAgICB0b3RhbFBhZ2VzLFxuICAgICAgaGFzTmV4dDogcGFnaW5hdGlvbi5wYWdlIDwgdG90YWxQYWdlcyxcbiAgICAgIGhhc1ByZXY6IHBhZ2luYXRpb24ucGFnZSA+IDEsXG4gICAgfTtcblxuICAgIFJlc3BvbnNlVXRpbC5zdWNjZXNzKHJlcywgZGF0YSwgbWVzc2FnZSwgMjAwLCBtZXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHpjK/oqqTpn7/mh4lcbiAgICovXG4gIHN0YXRpYyBlcnJvcihcbiAgICByZXM6IFJlc3BvbnNlLFxuICAgIGVycm9yOiBBcHBFcnJvcixcbiAgICBwYXRoPzogc3RyaW5nLFxuICAgIG1ldGhvZD86IHN0cmluZyxcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgcmVzcG9uc2U6IEVycm9yUmVzcG9uc2UgPSB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIGNvZGU6IGVycm9yLmVycm9yQ29kZSxcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzQ29kZSxcbiAgICAgICAgdGltZXN0YW1wOiBlcnJvci50aW1lc3RhbXAsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBpZiAoZXJyb3IuZGV0YWlscyAmJiBlcnJvci5kZXRhaWxzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlc3BvbnNlLmVycm9yLmRldGFpbHMgPSBlcnJvci5kZXRhaWxzO1xuICAgIH1cblxuICAgIGlmIChwYXRoKSB7XG4gICAgICByZXNwb25zZS5lcnJvci5wYXRoID0gcGF0aDtcbiAgICB9XG5cbiAgICBpZiAobWV0aG9kKSB7XG4gICAgICByZXNwb25zZS5lcnJvci5tZXRob2QgPSBtZXRob2Q7XG4gICAgfVxuXG4gICAgcmVzLnN0YXR1cyhlcnJvci5zdGF0dXNDb2RlKS5qc29uKHJlc3BvbnNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHpqZforYnpjK/oqqTpn7/mh4lcbiAgICovXG4gIHN0YXRpYyB2YWxpZGF0aW9uRXJyb3IoXG4gICAgcmVzOiBSZXNwb25zZSxcbiAgICBlcnJvcnM6IEFycmF5PHsgZmllbGQ6IHN0cmluZzsgbWVzc2FnZTogc3RyaW5nOyB2YWx1ZT86IGFueSB9PixcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSBcIui8uOWFpeizh+aWmempl+itieWkseaVl1wiLFxuICApOiB2b2lkIHtcbiAgICBjb25zdCBhcHBFcnJvciA9IG5ldyBBcHBFcnJvcihcbiAgICAgIG1lc3NhZ2UsXG4gICAgICA0MDAsXG4gICAgICBFcnJvckNvZGUuVkFMSURBVElPTl9FUlJPUixcbiAgICAgIGVycm9ycyxcbiAgICApO1xuICAgIFJlc3BvbnNlVXRpbC5lcnJvcihyZXMsIGFwcEVycm9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHmnKrmjojmrIrpn7/mh4lcbiAgICovXG4gIHN0YXRpYyB1bmF1dGhvcml6ZWQocmVzOiBSZXNwb25zZSwgbWVzc2FnZTogc3RyaW5nID0gXCLoqo3orYnlpLHmlZdcIik6IHZvaWQge1xuICAgIGNvbnN0IGFwcEVycm9yID0gbmV3IEFwcEVycm9yKFxuICAgICAgbWVzc2FnZSxcbiAgICAgIDQwMSxcbiAgICAgIEVycm9yQ29kZS5BVVRIRU5USUNBVElPTl9GQUlMRUQsXG4gICAgKTtcbiAgICBSZXNwb25zZVV0aWwuZXJyb3IocmVzLCBhcHBFcnJvcik7XG4gIH1cblxuICAvKipcbiAgICog55m86YCB56aB5q2i6Kiq5ZWP6Z+/5oeJXG4gICAqL1xuICBzdGF0aWMgZm9yYmlkZGVuKHJlczogUmVzcG9uc2UsIG1lc3NhZ2U6IHN0cmluZyA9IFwi5qyK6ZmQ5LiN6LazXCIpOiB2b2lkIHtcbiAgICBjb25zdCBhcHBFcnJvciA9IG5ldyBBcHBFcnJvcihcbiAgICAgIG1lc3NhZ2UsXG4gICAgICA0MDMsXG4gICAgICBFcnJvckNvZGUuSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TLFxuICAgICk7XG4gICAgUmVzcG9uc2VVdGlsLmVycm9yKHJlcywgYXBwRXJyb3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgeacquaJvuWIsOmfv+aHiVxuICAgKi9cbiAgc3RhdGljIG5vdEZvdW5kKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgcmVzb3VyY2U6IHN0cmluZyA9IFwi6LOH5rqQXCIsXG4gICAgaWRlbnRpZmllcj86IHN0cmluZyB8IG51bWJlcixcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGlkZW50aWZpZXJcbiAgICAgID8gYCR7cmVzb3VyY2V9ICgke2lkZW50aWZpZXJ9KSDmnKrmib7liLBgXG4gICAgICA6IGAke3Jlc291cmNlfSDmnKrmib7liLBgO1xuXG4gICAgY29uc3QgYXBwRXJyb3IgPSBuZXcgQXBwRXJyb3IobWVzc2FnZSwgNDA0LCBFcnJvckNvZGUuUkVTT1VSQ0VfTk9UX0ZPVU5ELCBbXG4gICAgICB7IHJlc291cmNlLCBpZGVudGlmaWVyIH0sXG4gICAgXSk7XG4gICAgUmVzcG9uc2VVdGlsLmVycm9yKHJlcywgYXBwRXJyb3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgeihneeqgemfv+aHiVxuICAgKi9cbiAgc3RhdGljIGNvbmZsaWN0KFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgcmVzb3VyY2U6IHN0cmluZyxcbiAgICBmaWVsZDogc3RyaW5nLFxuICAgIHZhbHVlOiBhbnksXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBgJHtyZXNvdXJjZX0g55qEICR7ZmllbGR9IOW3suWtmOWcqGA7XG4gICAgY29uc3QgYXBwRXJyb3IgPSBuZXcgQXBwRXJyb3IobWVzc2FnZSwgNDA5LCBFcnJvckNvZGUuUkVTT1VSQ0VfQ09ORkxJQ1QsIFtcbiAgICAgIHsgcmVzb3VyY2UsIGZpZWxkLCB2YWx1ZSwgY29uc3RyYWludDogXCJ1bmlxdWVcIiB9LFxuICAgIF0pO1xuICAgIFJlc3BvbnNlVXRpbC5lcnJvcihyZXMsIGFwcEVycm9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHpgJ/njofpmZDliLbpn7/mh4lcbiAgICovXG4gIHN0YXRpYyByYXRlTGltaXRlZChcbiAgICByZXM6IFJlc3BvbnNlLFxuICAgIG1lc3NhZ2U6IHN0cmluZyA9IFwi6KuL5rGC6YGO5pa86aC757mB77yM6KuL56iN5b6M5YaN6KmmXCIsXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IGFwcEVycm9yID0gbmV3IEFwcEVycm9yKG1lc3NhZ2UsIDQyOSwgRXJyb3JDb2RlLlJBVEVfTElNSVRfRVhDRUVERUQpO1xuICAgIFJlc3BvbnNlVXRpbC5lcnJvcihyZXMsIGFwcEVycm9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHlhafpg6jkvLrmnI3lmajpjK/oqqTpn7/mh4lcbiAgICovXG4gIHN0YXRpYyBpbnRlcm5hbEVycm9yKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgbWVzc2FnZTogc3RyaW5nID0gXCLlhafpg6jkvLrmnI3lmajpjK/oqqRcIixcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYXBwRXJyb3IgPSBuZXcgQXBwRXJyb3IoXG4gICAgICBtZXNzYWdlLFxuICAgICAgNTAwLFxuICAgICAgRXJyb3JDb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgIHVuZGVmaW5lZCxcbiAgICAgIGZhbHNlLFxuICAgICk7XG4gICAgUmVzcG9uc2VVdGlsLmVycm9yKHJlcywgYXBwRXJyb3IpO1xuICB9XG59XG5cbi8qKlxuICog6Z+/5oeJ5Lit6ZaT5Lu2IC0g54K6IFJlc3BvbnNlIOWwjeixoea3u+WKoOS+v+aNt+aWueazlVxuICovXG5leHBvcnQgY29uc3QgcmVzcG9uc2VNaWRkbGV3YXJlID0gKFxuICByZXE6IGFueSxcbiAgcmVzOiBSZXNwb25zZSxcbiAgbmV4dDogYW55LFxuKTogdm9pZCA9PiB7XG4gIC8vIOa3u+WKoOS+v+aNt+aWueazleWIsCBSZXNwb25zZSDlsI3osaFcbiAgcmVzLnN1Y2Nlc3MgPSBmdW5jdGlvbiA8VD4oXG4gICAgZGF0YT86IFQsXG4gICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICBzdGF0dXNDb2RlPzogbnVtYmVyLFxuICAgIG1ldGE/OiBQYXJ0aWFsPFBhZ2luYXRpb25NZXRhPixcbiAgKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC5zdWNjZXNzKHRoaXMsIGRhdGEsIG1lc3NhZ2UsIHN0YXR1c0NvZGUsIG1ldGEpO1xuICB9O1xuXG4gIHJlcy5jcmVhdGVkID0gZnVuY3Rpb24gPFQ+KGRhdGE/OiBULCBtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC5jcmVhdGVkKHRoaXMsIGRhdGEsIG1lc3NhZ2UpO1xuICB9O1xuXG4gIHJlcy51cGRhdGVkID0gZnVuY3Rpb24gPFQ+KGRhdGE/OiBULCBtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC51cGRhdGVkKHRoaXMsIGRhdGEsIG1lc3NhZ2UpO1xuICB9O1xuXG4gIHJlcy5kZWxldGVkID0gZnVuY3Rpb24gKG1lc3NhZ2U/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLmRlbGV0ZWQodGhpcywgbWVzc2FnZSk7XG4gIH07XG5cbiAgcmVzLnBhZ2luYXRlZCA9IGZ1bmN0aW9uIDxUPihcbiAgICBkYXRhOiBUW10sXG4gICAgcGFnaW5hdGlvbjogeyBwYWdlOiBudW1iZXI7IGxpbWl0OiBudW1iZXI7IHRvdGFsOiBudW1iZXIgfSxcbiAgICBtZXNzYWdlPzogc3RyaW5nLFxuICApIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLnBhZ2luYXRlZCh0aGlzLCBkYXRhLCBwYWdpbmF0aW9uLCBtZXNzYWdlKTtcbiAgfTtcblxuICByZXMudmFsaWRhdGlvbkVycm9yID0gZnVuY3Rpb24gKFxuICAgIGVycm9yczogQXJyYXk8eyBmaWVsZDogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmc7IHZhbHVlPzogYW55IH0+LFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiBSZXNwb25zZVV0aWwudmFsaWRhdGlvbkVycm9yKHRoaXMsIGVycm9ycywgbWVzc2FnZSk7XG4gIH07XG5cbiAgcmVzLnVuYXV0aG9yaXplZCA9IGZ1bmN0aW9uIChtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC51bmF1dGhvcml6ZWQodGhpcywgbWVzc2FnZSk7XG4gIH07XG5cbiAgcmVzLmZvcmJpZGRlbiA9IGZ1bmN0aW9uIChtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC5mb3JiaWRkZW4odGhpcywgbWVzc2FnZSk7XG4gIH07XG5cbiAgcmVzLm5vdEZvdW5kID0gZnVuY3Rpb24gKHJlc291cmNlPzogc3RyaW5nLCBpZGVudGlmaWVyPzogc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC5ub3RGb3VuZCh0aGlzLCByZXNvdXJjZSwgaWRlbnRpZmllcik7XG4gIH07XG5cbiAgcmVzLmNvbmZsaWN0ID0gZnVuY3Rpb24gKHJlc291cmNlOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLmNvbmZsaWN0KHRoaXMsIHJlc291cmNlLCBmaWVsZCwgdmFsdWUpO1xuICB9O1xuXG4gIHJlcy5yYXRlTGltaXRlZCA9IGZ1bmN0aW9uIChtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC5yYXRlTGltaXRlZCh0aGlzLCBtZXNzYWdlKTtcbiAgfTtcblxuICByZXMuaW50ZXJuYWxFcnJvciA9IGZ1bmN0aW9uIChtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC5pbnRlcm5hbEVycm9yKHRoaXMsIG1lc3NhZ2UpO1xuICB9O1xuXG4gIG5leHQoKTtcbn07XG5cbi8vIOaTtOWxlSBFeHByZXNzIFJlc3BvbnNlIOS7i+mdolxuZGVjbGFyZSBnbG9iYWwge1xuICBuYW1lc3BhY2UgRXhwcmVzcyB7XG4gICAgaW50ZXJmYWNlIFJlc3BvbnNlIHtcbiAgICAgIHN1Y2Nlc3M8VD4oXG4gICAgICAgIGRhdGE/OiBULFxuICAgICAgICBtZXNzYWdlPzogc3RyaW5nLFxuICAgICAgICBzdGF0dXNDb2RlPzogbnVtYmVyLFxuICAgICAgICBtZXRhPzogUGFydGlhbDxQYWdpbmF0aW9uTWV0YT4sXG4gICAgICApOiB2b2lkO1xuICAgICAgY3JlYXRlZDxUPihkYXRhPzogVCwgbWVzc2FnZT86IHN0cmluZyk6IHZvaWQ7XG4gICAgICB1cGRhdGVkPFQ+KGRhdGE/OiBULCBtZXNzYWdlPzogc3RyaW5nKTogdm9pZDtcbiAgICAgIGRlbGV0ZWQobWVzc2FnZT86IHN0cmluZyk6IHZvaWQ7XG4gICAgICBwYWdpbmF0ZWQ8VD4oXG4gICAgICAgIGRhdGE6IFRbXSxcbiAgICAgICAgcGFnaW5hdGlvbjogeyBwYWdlOiBudW1iZXI7IGxpbWl0OiBudW1iZXI7IHRvdGFsOiBudW1iZXIgfSxcbiAgICAgICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICAgICk6IHZvaWQ7XG4gICAgICB2YWxpZGF0aW9uRXJyb3IoXG4gICAgICAgIGVycm9yczogQXJyYXk8eyBmaWVsZDogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmc7IHZhbHVlPzogYW55IH0+LFxuICAgICAgICBtZXNzYWdlPzogc3RyaW5nLFxuICAgICAgKTogdm9pZDtcbiAgICAgIHVuYXV0aG9yaXplZChtZXNzYWdlPzogc3RyaW5nKTogdm9pZDtcbiAgICAgIGZvcmJpZGRlbihtZXNzYWdlPzogc3RyaW5nKTogdm9pZDtcbiAgICAgIG5vdEZvdW5kKHJlc291cmNlPzogc3RyaW5nLCBpZGVudGlmaWVyPzogc3RyaW5nIHwgbnVtYmVyKTogdm9pZDtcbiAgICAgIGNvbmZsaWN0KHJlc291cmNlOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB2b2lkO1xuICAgICAgcmF0ZUxpbWl0ZWQobWVzc2FnZT86IHN0cmluZyk6IHZvaWQ7XG4gICAgICBpbnRlcm5hbEVycm9yKG1lc3NhZ2U/OiBzdHJpbmcpOiB2b2lkO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSZXNwb25zZVV0aWw7XG4iXSwidmVyc2lvbiI6M30=