dae4d2c7c53e06592ae642b66a89b4ab
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.petRoutes = void 0;
const express_1 = require("express");
const error_handler_1 = require("../middleware/error-handler");
const errors_1 = require("../utils/errors");
const logger_1 = require("../utils/logger");
const validation_1 = require("../utils/validation");
const Pet_1 = require("../models/Pet");
const SearchHistory_1 = require("../models/SearchHistory");
const auth_1 = require("../middleware/auth");
const rbac_1 = require("../middleware/rbac");
const mongoose_1 = __importDefault(require("mongoose"));
const router = (0, express_1.Router)();
exports.petRoutes = router;
/**
 * @route   GET /api/pets
 * @desc    取得寵物列表
 * @access  Public
 */
router.get('/', (0, validation_1.validateQuery)(validation_1.petSearchSchema), (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { page = 1, limit = 12, status, type, breed, location, search, sortBy = 'createdAt', sortOrder = 'desc', radius = 10 } = req.validatedQuery;
    logger_1.logger.info('獲取寵物列表請求', {
        page, limit, status, type, breed, location, search, sortBy, sortOrder
    });
    // 建立查詢條件
    const query = {};
    // 狀態篩選
    if (status) {
        query.status = status;
    }
    // 寵物類型篩選
    if (type) {
        query.type = type;
    }
    // 品種篩選
    if (breed) {
        query.breed = new RegExp(breed, 'i');
    }
    // 文字搜尋（名稱、描述、地點）
    if (search) {
        query.$or = [
            { name: new RegExp(search, 'i') },
            { description: new RegExp(search, 'i') },
            { lastSeenLocation: new RegExp(search, 'i') },
            { 'contactInfo.name': new RegExp(search, 'i') }
        ];
    }
    // 地點篩選
    if (location) {
        query.lastSeenLocation = new RegExp(location, 'i');
    }
    // 計算分頁
    const skip = (page - 1) * limit;
    // 排序設定
    const sortOptions = {};
    sortOptions[sortBy] = sortOrder === 'desc' ? -1 : 1;
    // 如果按緊急程度排序，優先顯示緊急案件
    if (sortBy === 'createdAt') {
        sortOptions.isUrgent = -1;
    }
    // 執行查詢
    const [pets, totalItems] = await Promise.all([
        Pet_1.Pet.find(query)
            .sort(sortOptions)
            .skip(skip)
            .limit(limit)
            .populate('userId', 'name email')
            .lean(),
        Pet_1.Pet.countDocuments(query)
    ]);
    // 記錄搜尋歷史（如果有搜尋條件且用戶已登入）
    if ((search || location || type || status || breed) && req.user?.id) {
        const searchQuery = search || location || '';
        const filters = {
            type,
            status,
            location,
            breed,
            radius
        };
        // 異步記錄搜尋歷史，不影響主要回應
        SearchHistory_1.SearchHistory.recordSearch(req.user.id, searchQuery, filters, totalItems)
            .catch(error => {
            logger_1.logger.error('記錄搜尋歷史失敗:', error);
        });
    }
    // 計算分頁資訊
    const totalPages = Math.ceil(totalItems / limit);
    res.json({
        success: true,
        data: {
            pets,
            pagination: {
                currentPage: page,
                totalPages,
                totalItems,
                itemsPerPage: limit,
                hasNextPage: page < totalPages,
                hasPrevPage: page > 1
            },
            filters: {
                status: ['lost', 'found', 'reunited'],
                type: ['dog', 'cat', 'bird', 'rabbit', 'other'],
                size: ['small', 'medium', 'large'],
                gender: ['male', 'female', 'unknown'],
            },
        },
    });
}));
/**
 * @route   GET /api/pets/my
 * @desc    獲取用戶自己的寵物協尋案例
 * @access  Private
 */
router.get('/my', auth_1.authenticate, rbac_1.requireActiveAccount, (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { page = 1, limit = 12, status } = req.query;
    const userId = req.user.id;
    logger_1.logger.info('獲取用戶寵物列表請求', { userId });
    // 建立查詢條件
    const query = { userId: new mongoose_1.default.Types.ObjectId(userId) };
    // 狀態篩選
    if (status) {
        query.status = status;
    }
    // 計算分頁
    const skip = (Number(page) - 1) * Number(limit);
    // 執行查詢
    const [pets, totalItems] = await Promise.all([
        Pet_1.Pet.find(query)
            .sort({ isUrgent: -1, createdAt: -1 })
            .skip(skip)
            .limit(Number(limit))
            .lean(),
        Pet_1.Pet.countDocuments(query)
    ]);
    // 計算分頁資訊
    const totalPages = Math.ceil(totalItems / Number(limit));
    res.json({
        success: true,
        data: {
            pets,
            pagination: {
                currentPage: Number(page),
                totalPages,
                totalItems,
                itemsPerPage: Number(limit),
                hasNextPage: Number(page) < totalPages,
                hasPrevPage: Number(page) > 1
            },
        },
    });
}));
/**
 * @route   GET /api/pets/:id
 * @desc    獲取特定寵物資訊
 * @access  Public
 */
router.get('/:id', (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { id } = req.params;
    if (!id || !mongoose_1.default.Types.ObjectId.isValid(id)) {
        throw new errors_1.ValidationError('請提供有效的寵物 ID');
    }
    logger_1.logger.info('獲取寵物詳細資訊請求', { petId: id });
    // 查找寵物並增加瀏覽次數
    const pet = await Pet_1.Pet.findByIdAndUpdate(id, { $inc: { viewCount: 1 } }, { new: true }).populate('userId', 'name email').lean();
    if (!pet) {
        throw new errors_1.NotFoundError('找不到指定的寵物資訊');
    }
    res.json({
        success: true,
        data: {
            pet,
        },
    });
}));
/**
 * @route   POST /api/pets
 * @desc    新增寵物協尋案例
 * @access  Private
 */
router.post('/', auth_1.authenticate, rbac_1.requireActiveAccount, (0, validation_1.validateRequest)(validation_1.petSchema), (0, error_handler_1.asyncHandler)(async (req, res) => {
    const validatedData = req.validatedData;
    const userId = req.user.id;
    logger_1.logger.info('新增寵物協尋案例請求', {
        userId,
        name: validatedData.name,
        type: validatedData.type,
        status: validatedData.status,
        lastSeenLocation: validatedData.lastSeenLocation
    });
    // 建立寵物資料
    const petData = {
        ...validatedData,
        userId: new mongoose_1.default.Types.ObjectId(userId),
        viewCount: 0,
        shareCount: 0,
    };
    // 儲存到資料庫
    const pet = new Pet_1.Pet(petData);
    await pet.save();
    // 填充用戶資訊
    await pet.populate('userId', 'name email');
    res.status(201).json({
        success: true,
        message: '寵物協尋案例新增成功',
        data: {
            pet: pet.toJSON(),
        },
    });
}));
/**
 * @route   PUT /api/pets/:id
 * @desc    更新寵物資訊
 * @access  Private
 */
router.put('/:id', auth_1.authenticate, rbac_1.requireActiveAccount, (0, validation_1.validateRequest)(validation_1.petUpdateSchema), (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { id } = req.params;
    const updateData = req.validatedData;
    const userId = req.user.id;
    if (!id || !mongoose_1.default.Types.ObjectId.isValid(id)) {
        throw new errors_1.ValidationError('請提供有效的寵物 ID');
    }
    logger_1.logger.info('更新寵物資訊請求', { petId: id, userId, updateData });
    // 查找寵物並檢查權限
    const pet = await Pet_1.Pet.findById(id);
    if (!pet) {
        throw new errors_1.NotFoundError('找不到指定的寵物資訊');
    }
    // 檢查是否為寵物擁有者或管理員
    if (pet.userId.toString() !== userId && !(0, rbac_1.hasPermission)(req.user, rbac_1.Permission.PET_WRITE)) {
        throw new errors_1.ForbiddenError('您沒有權限修改此寵物資訊');
    }
    // 更新寵物資訊
    const updatedPet = await Pet_1.Pet.findByIdAndUpdate(id, { $set: updateData }, { new: true, runValidators: true }).populate('userId', 'name email');
    res.json({
        success: true,
        message: '寵物資訊更新成功',
        data: {
            pet: updatedPet,
        },
    });
}));
/**
 * @route   DELETE /api/pets/:id
 * @desc    刪除寵物協尋案例
 * @access  Private
 */
router.delete('/:id', auth_1.authenticate, rbac_1.requireActiveAccount, (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { id } = req.params;
    const userId = req.user.id;
    if (!id || !mongoose_1.default.Types.ObjectId.isValid(id)) {
        throw new errors_1.ValidationError('請提供有效的寵物 ID');
    }
    logger_1.logger.info('刪除寵物協尋案例請求', { petId: id, userId });
    // 查找寵物並檢查權限
    const pet = await Pet_1.Pet.findById(id);
    if (!pet) {
        throw new errors_1.NotFoundError('找不到指定的寵物資訊');
    }
    // 檢查是否為寵物擁有者或管理員
    if (pet.userId.toString() !== userId && !(0, rbac_1.hasPermission)(req.user, rbac_1.Permission.PET_DELETE)) {
        throw new errors_1.ForbiddenError('您沒有權限刪除此寵物資訊');
    }
    // 執行刪除（硬刪除）
    await Pet_1.Pet.findByIdAndDelete(id);
    res.json({
        success: true,
        message: '寵物協尋案例已刪除',
    });
}));
/**
 * @route   POST /api/pets/:id/images
 * @desc    上傳寵物圖片
 * @access  Private
 */
router.post('/:id/images', (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { id } = req.params;
    if (!id) {
        throw new errors_1.ValidationError('請提供寵物 ID');
    }
    // TODO: 實作圖片上傳邏輯
    // - 權限檢查
    // - 檔案驗證
    // - 圖片處理（壓縮、縮放）
    // - 上傳到雲端儲存
    logger_1.logger.info('上傳寵物圖片請求', { petId: id });
    res.json({
        success: true,
        message: '圖片上傳成功',
        data: {
            imageUrls: [
                'https://example.com/images/pet-new-1.jpg',
                'https://example.com/images/pet-new-2.jpg',
            ],
        },
    });
}));
/**
 * @route   POST /api/pets/:id/share
 * @desc    分享寵物協尋案例
 * @access  Public
 */
router.post('/:id/share', (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { id } = req.params;
    const { platform } = req.body;
    if (!id || !mongoose_1.default.Types.ObjectId.isValid(id)) {
        throw new errors_1.ValidationError('請提供有效的寵物 ID');
    }
    logger_1.logger.info('分享寵物協尋案例請求', { petId: id, platform });
    // 查找寵物並增加分享次數
    const pet = await Pet_1.Pet.findByIdAndUpdate(id, { $inc: { shareCount: 1 } }, { new: true });
    if (!pet) {
        throw new errors_1.NotFoundError('找不到指定的寵物資訊');
    }
    // 生成分享連結
    const baseUrl = process.env.FRONTEND_URL || 'http://localhost:3000';
    const shareUrl = `${baseUrl}/pets/${id}`;
    res.json({
        success: true,
        message: '分享連結生成成功',
        data: {
            shareUrl,
            shareCount: pet.shareCount,
            platform,
        },
    });
}));
/**
 * @route   GET /api/pets/user/:userId
 * @desc    獲取指定用戶的寵物協尋案例
 * @access  Public
 */
router.get('/user/:userId', (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { userId } = req.params;
    const { page = 1, limit = 12, status } = req.query;
    if (!userId || !mongoose_1.default.Types.ObjectId.isValid(userId)) {
        throw new errors_1.ValidationError('請提供有效的用戶 ID');
    }
    logger_1.logger.info('獲取用戶寵物列表請求', { userId });
    // 建立查詢條件
    const query = { userId: new mongoose_1.default.Types.ObjectId(userId) };
    // 狀態篩選
    if (status) {
        query.status = status;
    }
    // 計算分頁
    const skip = (Number(page) - 1) * Number(limit);
    // 執行查詢
    const [pets, totalItems] = await Promise.all([
        Pet_1.Pet.find(query)
            .sort({ isUrgent: -1, createdAt: -1 })
            .skip(skip)
            .limit(Number(limit))
            .populate('userId', 'name email')
            .lean(),
        Pet_1.Pet.countDocuments(query)
    ]);
    // 計算分頁資訊
    const totalPages = Math.ceil(totalItems / Number(limit));
    res.json({
        success: true,
        data: {
            pets,
            pagination: {
                currentPage: Number(page),
                totalPages,
                totalItems,
                itemsPerPage: Number(limit),
                hasNextPage: Number(page) < totalPages,
                hasPrevPage: Number(page) > 1
            },
        },
    });
}));
/**
 * @route   GET /api/pets/search/similar
 * @desc    搜尋相似寵物
 * @access  Public
 */
router.get('/search/similar', (0, error_handler_1.asyncHandler)(async (req, res) => {
    const { type, breed, color, location, excludeId } = req.query;
    logger_1.logger.info('搜尋相似寵物請求', { type, breed, color, location, excludeId });
    // 建立查詢條件
    const query = {};
    // 排除指定的寵物
    if (excludeId && mongoose_1.default.Types.ObjectId.isValid(excludeId)) {
        query._id = { $ne: new mongoose_1.default.Types.ObjectId(excludeId) };
    }
    // 寵物類型匹配（必須條件）
    if (type) {
        query.type = type;
    }
    // 品種匹配（可選）
    if (breed) {
        query.breed = new RegExp(breed, 'i');
    }
    // 顏色匹配（可選）
    if (color) {
        query.color = new RegExp(color, 'i');
    }
    // 地點相近匹配（可選）
    if (location) {
        query.lastSeenLocation = new RegExp(location, 'i');
    }
    // 執行查詢，限制結果數量
    const similarPets = await Pet_1.Pet.find(query)
        .sort({ createdAt: -1 })
        .limit(6)
        .populate('userId', 'name')
        .lean();
    res.json({
        success: true,
        data: {
            similarPets,
        },
    });
}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xccGV0cy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxxQ0FBaUM7QUFDakMsK0RBQTJEO0FBQzNELDRDQUFpRjtBQUNqRiw0Q0FBeUM7QUFDekMsb0RBQWtIO0FBQ2xILHVDQUEwQztBQUMxQywyREFBd0Q7QUFDeEQsNkNBQWtEO0FBQ2xELDZDQUF3RztBQUN4Ryx3REFBZ0M7QUFFaEMsTUFBTSxNQUFNLEdBQUcsSUFBQSxnQkFBTSxHQUFFLENBQUM7QUE2ZkwsMkJBQVM7QUEzZjVCOzs7O0dBSUc7QUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFBLDBCQUFhLEVBQUMsNEJBQWUsQ0FBQyxFQUFFLElBQUEsNEJBQVksRUFBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQzlFLE1BQU0sRUFDSixJQUFJLEdBQUcsQ0FBQyxFQUNSLEtBQUssR0FBRyxFQUFFLEVBQ1YsTUFBTSxFQUNOLElBQUksRUFDSixLQUFLLEVBQ0wsUUFBUSxFQUNSLE1BQU0sRUFDTixNQUFNLEdBQUcsV0FBVyxFQUNwQixTQUFTLEdBQUcsTUFBTSxFQUNsQixNQUFNLEdBQUcsRUFBRSxFQUNaLEdBQUcsR0FBRyxDQUFDLGNBQWMsQ0FBQztJQUV2QixlQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtRQUN0QixJQUFJLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVM7S0FDdEUsQ0FBQyxDQUFDO0lBRUgsU0FBUztJQUNULE1BQU0sS0FBSyxHQUFRLEVBQUUsQ0FBQztJQUV0QixPQUFPO0lBQ1AsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUNYLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3hCLENBQUM7SUFFRCxT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QUUsSUFBSTtRQUNiLElBQUksRUFBRTtZQUNKLFdBQVc7U0FDWjtLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xccGV0cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IGFzeW5jSGFuZGxlciB9IGZyb20gJy4uL21pZGRsZXdhcmUvZXJyb3ItaGFuZGxlcic7XG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3IsIE5vdEZvdW5kRXJyb3IsIEZvcmJpZGRlbkVycm9yIH0gZnJvbSAnLi4vdXRpbHMvZXJyb3JzJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyB2YWxpZGF0ZVJlcXVlc3QsIHZhbGlkYXRlUXVlcnksIHBldFNjaGVtYSwgcGV0VXBkYXRlU2NoZW1hLCBwZXRTZWFyY2hTY2hlbWEgfSBmcm9tICcuLi91dGlscy92YWxpZGF0aW9uJztcbmltcG9ydCB7IFBldCwgSVBldCB9IGZyb20gJy4uL21vZGVscy9QZXQnO1xuaW1wb3J0IHsgU2VhcmNoSGlzdG9yeSB9IGZyb20gJy4uL21vZGVscy9TZWFyY2hIaXN0b3J5JztcbmltcG9ydCB7IGF1dGhlbnRpY2F0ZSB9IGZyb20gJy4uL21pZGRsZXdhcmUvYXV0aCc7XG5pbXBvcnQgeyByZXF1aXJlUGVybWlzc2lvbiwgUGVybWlzc2lvbiwgcmVxdWlyZUFjdGl2ZUFjY291bnQsIGhhc1Blcm1pc3Npb24gfSBmcm9tICcuLi9taWRkbGV3YXJlL3JiYWMnO1xuaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcblxuY29uc3Qgcm91dGVyID0gUm91dGVyKCk7XG5cbi8qKlxuICogQHJvdXRlICAgR0VUIC9hcGkvcGV0c1xuICogQGRlc2MgICAg5Y+W5b6X5a+154mp5YiX6KGoXG4gKiBAYWNjZXNzICBQdWJsaWNcbiAqL1xucm91dGVyLmdldCgnLycsIHZhbGlkYXRlUXVlcnkocGV0U2VhcmNoU2NoZW1hKSwgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCB7XG4gICAgcGFnZSA9IDEsXG4gICAgbGltaXQgPSAxMixcbiAgICBzdGF0dXMsXG4gICAgdHlwZSxcbiAgICBicmVlZCxcbiAgICBsb2NhdGlvbixcbiAgICBzZWFyY2gsXG4gICAgc29ydEJ5ID0gJ2NyZWF0ZWRBdCcsXG4gICAgc29ydE9yZGVyID0gJ2Rlc2MnLFxuICAgIHJhZGl1cyA9IDEwXG4gIH0gPSByZXEudmFsaWRhdGVkUXVlcnk7XG5cbiAgbG9nZ2VyLmluZm8oJ+eNsuWPluWvteeJqeWIl+ihqOiri+axgicsIHtcbiAgICBwYWdlLCBsaW1pdCwgc3RhdHVzLCB0eXBlLCBicmVlZCwgbG9jYXRpb24sIHNlYXJjaCwgc29ydEJ5LCBzb3J0T3JkZXJcbiAgfSk7XG5cbiAgLy8g5bu656uL5p+l6Kmi5qKd5Lu2XG4gIGNvbnN0IHF1ZXJ5OiBhbnkgPSB7fTtcbiAgXG4gIC8vIOeLgOaFi+evqemBuFxuICBpZiAoc3RhdHVzKSB7XG4gICAgcXVlcnkuc3RhdHVzID0gc3RhdHVzO1xuICB9XG4gIFxuICAvLyDlr7XnianpoZ7lnovnr6npgbhcbiAgaWYgKHR5cGUpIHtcbiAgICBxdWVyeS50eXBlID0gdHlwZTtcbiAgfVxuICBcbiAgLy8g5ZOB56iu56+p6YG4XG4gIGlmIChicmVlZCkge1xuICAgIHF1ZXJ5LmJyZWVkID0gbmV3IFJlZ0V4cChicmVlZCwgJ2knKTtcbiAgfVxuICBcbiAgLy8g5paH5a2X5pCc5bCL77yI5ZCN56ix44CB5o+P6L+w44CB5Zyw6bue77yJXG4gIGlmIChzZWFyY2gpIHtcbiAgICBxdWVyeS4kb3IgPSBbXG4gICAgICB7IG5hbWU6IG5ldyBSZWdFeHAoc2VhcmNoLCAnaScpIH0sXG4gICAgICB7IGRlc2NyaXB0aW9uOiBuZXcgUmVnRXhwKHNlYXJjaCwgJ2knKSB9LFxuICAgICAgeyBsYXN0U2VlbkxvY2F0aW9uOiBuZXcgUmVnRXhwKHNlYXJjaCwgJ2knKSB9LFxuICAgICAgeyAnY29udGFjdEluZm8ubmFtZSc6IG5ldyBSZWdFeHAoc2VhcmNoLCAnaScpIH1cbiAgICBdO1xuICB9XG4gIFxuICAvLyDlnLDpu57nr6npgbhcbiAgaWYgKGxvY2F0aW9uKSB7XG4gICAgcXVlcnkubGFzdFNlZW5Mb2NhdGlvbiA9IG5ldyBSZWdFeHAobG9jYXRpb24sICdpJyk7XG4gIH1cblxuICAvLyDoqIjnrpfliIbpoIFcbiAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcbiAgXG4gIC8vIOaOkuW6j+ioreWumlxuICBjb25zdCBzb3J0T3B0aW9uczogYW55ID0ge307XG4gIHNvcnRPcHRpb25zW3NvcnRCeV0gPSBzb3J0T3JkZXIgPT09ICdkZXNjJyA/IC0xIDogMTtcbiAgXG4gIC8vIOWmguaenOaMiee3iuaApeeoi+W6puaOkuW6j++8jOWEquWFiOmhr+ekuue3iuaApeahiOS7tlxuICBpZiAoc29ydEJ5ID09PSAnY3JlYXRlZEF0Jykge1xuICAgIHNvcnRPcHRpb25zLmlzVXJnZW50ID0gLTE7XG4gIH1cblxuICAvLyDln7fooYzmn6XoqaJcbiAgY29uc3QgW3BldHMsIHRvdGFsSXRlbXNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIFBldC5maW5kKHF1ZXJ5KVxuICAgICAgLnNvcnQoc29ydE9wdGlvbnMpXG4gICAgICAuc2tpcChza2lwKVxuICAgICAgLmxpbWl0KGxpbWl0KVxuICAgICAgLnBvcHVsYXRlKCd1c2VySWQnLCAnbmFtZSBlbWFpbCcpXG4gICAgICAubGVhbigpLFxuICAgIFBldC5jb3VudERvY3VtZW50cyhxdWVyeSlcbiAgXSk7XG5cbiAgLy8g6KiY6YyE5pCc5bCL5q235Y+y77yI5aaC5p6c5pyJ5pCc5bCL5qKd5Lu25LiU55So5oi25bey55m75YWl77yJXG4gIGlmICgoc2VhcmNoIHx8IGxvY2F0aW9uIHx8IHR5cGUgfHwgc3RhdHVzIHx8IGJyZWVkKSAmJiByZXEudXNlcj8uaWQpIHtcbiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHNlYXJjaCB8fCBsb2NhdGlvbiB8fCAnJztcbiAgICBjb25zdCBmaWx0ZXJzID0ge1xuICAgICAgdHlwZSxcbiAgICAgIHN0YXR1cyxcbiAgICAgIGxvY2F0aW9uLFxuICAgICAgYnJlZWQsXG4gICAgICByYWRpdXNcbiAgICB9O1xuICAgIFxuICAgIC8vIOeVsOatpeiomOmMhOaQnOWwi+att+WPsu+8jOS4jeW9semfv+S4u+imgeWbnuaHiVxuICAgIFNlYXJjaEhpc3RvcnkucmVjb3JkU2VhcmNoKHJlcS51c2VyLmlkLCBzZWFyY2hRdWVyeSwgZmlsdGVycywgdG90YWxJdGVtcylcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGxvZ2dlci5lcnJvcign6KiY6YyE5pCc5bCL5q235Y+y5aSx5pWXOicsIGVycm9yKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLy8g6KiI566X5YiG6aCB6LOH6KiKXG4gIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWxJdGVtcyAvIGxpbWl0KTtcblxuICByZXMuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBkYXRhOiB7XG4gICAgICBwZXRzLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBjdXJyZW50UGFnZTogcGFnZSxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgICAgdG90YWxJdGVtcyxcbiAgICAgICAgaXRlbXNQZXJQYWdlOiBsaW1pdCxcbiAgICAgICAgaGFzTmV4dFBhZ2U6IHBhZ2UgPCB0b3RhbFBhZ2VzLFxuICAgICAgICBoYXNQcmV2UGFnZTogcGFnZSA+IDFcbiAgICAgIH0sXG4gICAgICBmaWx0ZXJzOiB7XG4gICAgICAgIHN0YXR1czogWydsb3N0JywgJ2ZvdW5kJywgJ3JldW5pdGVkJ10sXG4gICAgICAgIHR5cGU6IFsnZG9nJywgJ2NhdCcsICdiaXJkJywgJ3JhYmJpdCcsICdvdGhlciddLFxuICAgICAgICBzaXplOiBbJ3NtYWxsJywgJ21lZGl1bScsICdsYXJnZSddLFxuICAgICAgICBnZW5kZXI6IFsnbWFsZScsICdmZW1hbGUnLCAndW5rbm93biddLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn0pKTtcblxuLyoqXG4gKiBAcm91dGUgICBHRVQgL2FwaS9wZXRzL215XG4gKiBAZGVzYyAgICDnjbLlj5bnlKjmiLboh6rlt7HnmoTlr7XnianljZTlsIvmoYjkvotcbiAqIEBhY2Nlc3MgIFByaXZhdGVcbiAqL1xucm91dGVyLmdldCgnL215JywgYXV0aGVudGljYXRlLCByZXF1aXJlQWN0aXZlQWNjb3VudCwgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCB7IHBhZ2UgPSAxLCBsaW1pdCA9IDEyLCBzdGF0dXMgfSA9IHJlcS5xdWVyeTtcbiAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLmlkO1xuXG4gIGxvZ2dlci5pbmZvKCfnjbLlj5bnlKjmiLblr7XnianliJfooajoq4vmsYInLCB7IHVzZXJJZCB9KTtcblxuICAvLyDlu7rnq4vmn6XoqaLmop3ku7ZcbiAgY29uc3QgcXVlcnk6IGFueSA9IHsgdXNlcklkOiBuZXcgbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQodXNlcklkKSB9O1xuICBcbiAgLy8g54uA5oWL56+p6YG4XG4gIGlmIChzdGF0dXMpIHtcbiAgICBxdWVyeS5zdGF0dXMgPSBzdGF0dXM7XG4gIH1cblxuICAvLyDoqIjnrpfliIbpoIFcbiAgY29uc3Qgc2tpcCA9IChOdW1iZXIocGFnZSkgLSAxKSAqIE51bWJlcihsaW1pdCk7XG4gIFxuICAvLyDln7fooYzmn6XoqaJcbiAgY29uc3QgW3BldHMsIHRvdGFsSXRlbXNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIFBldC5maW5kKHF1ZXJ5KVxuICAgICAgLnNvcnQoeyBpc1VyZ2VudDogLTEsIGNyZWF0ZWRBdDogLTEgfSlcbiAgICAgIC5za2lwKHNraXApXG4gICAgICAubGltaXQoTnVtYmVyKGxpbWl0KSlcbiAgICAgIC5sZWFuKCksXG4gICAgUGV0LmNvdW50RG9jdW1lbnRzKHF1ZXJ5KVxuICBdKTtcblxuICAvLyDoqIjnrpfliIbpoIHos4foqIpcbiAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbEl0ZW1zIC8gTnVtYmVyKGxpbWl0KSk7XG5cbiAgcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgZGF0YToge1xuICAgICAgcGV0cyxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgY3VycmVudFBhZ2U6IE51bWJlcihwYWdlKSxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgICAgdG90YWxJdGVtcyxcbiAgICAgICAgaXRlbXNQZXJQYWdlOiBOdW1iZXIobGltaXQpLFxuICAgICAgICBoYXNOZXh0UGFnZTogTnVtYmVyKHBhZ2UpIDwgdG90YWxQYWdlcyxcbiAgICAgICAgaGFzUHJldlBhZ2U6IE51bWJlcihwYWdlKSA+IDFcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG59KSk7XG5cbi8qKlxuICogQHJvdXRlICAgR0VUIC9hcGkvcGV0cy86aWRcbiAqIEBkZXNjICAgIOeNsuWPlueJueWumuWvteeJqeizh+ioilxuICogQGFjY2VzcyAgUHVibGljXG4gKi9cbnJvdXRlci5nZXQoJy86aWQnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgaWYgKCFpZCB8fCAhbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQuaXNWYWxpZChpZCkpIHtcbiAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCfoq4vmj5DkvpvmnInmlYjnmoTlr7XniakgSUQnKTtcbiAgfVxuXG4gIGxvZ2dlci5pbmZvKCfnjbLlj5blr7XnianoqbPntLDos4foqIroq4vmsYInLCB7IHBldElkOiBpZCB9KTtcblxuICAvLyDmn6Xmib7lr7XniankuKblop7liqDngI/opr3mrKHmlbhcbiAgY29uc3QgcGV0ID0gYXdhaXQgUGV0LmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgIGlkLFxuICAgIHsgJGluYzogeyB2aWV3Q291bnQ6IDEgfSB9LFxuICAgIHsgbmV3OiB0cnVlIH1cbiAgKS5wb3B1bGF0ZSgndXNlcklkJywgJ25hbWUgZW1haWwnKS5sZWFuKCk7XG5cbiAgaWYgKCFwZXQpIHtcbiAgICB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcign5om+5LiN5Yiw5oyH5a6a55qE5a+154mp6LOH6KiKJyk7XG4gIH1cblxuICByZXMuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBkYXRhOiB7XG4gICAgICBwZXQsXG4gICAgfSxcbiAgfSk7XG59KSk7XG5cbi8qKlxuICogQHJvdXRlICAgUE9TVCAvYXBpL3BldHNcbiAqIEBkZXNjICAgIOaWsOWinuWvteeJqeWNlOWwi+ahiOS+i1xuICogQGFjY2VzcyAgUHJpdmF0ZVxuICovXG5yb3V0ZXIucG9zdCgnLycsIGF1dGhlbnRpY2F0ZSwgcmVxdWlyZUFjdGl2ZUFjY291bnQsIHZhbGlkYXRlUmVxdWVzdChwZXRTY2hlbWEpLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHZhbGlkYXRlZERhdGEgPSByZXEudmFsaWRhdGVkRGF0YTtcbiAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLmlkO1xuXG4gIGxvZ2dlci5pbmZvKCfmlrDlop7lr7XnianljZTlsIvmoYjkvovoq4vmsYInLCB7IFxuICAgIHVzZXJJZCxcbiAgICBuYW1lOiB2YWxpZGF0ZWREYXRhLm5hbWUsIFxuICAgIHR5cGU6IHZhbGlkYXRlZERhdGEudHlwZSwgXG4gICAgc3RhdHVzOiB2YWxpZGF0ZWREYXRhLnN0YXR1cywgXG4gICAgbGFzdFNlZW5Mb2NhdGlvbjogdmFsaWRhdGVkRGF0YS5sYXN0U2VlbkxvY2F0aW9uIFxuICB9KTtcblxuICAvLyDlu7rnq4vlr7Xnianos4fmlplcbiAgY29uc3QgcGV0RGF0YSA9IHtcbiAgICAuLi52YWxpZGF0ZWREYXRhLFxuICAgIHVzZXJJZDogbmV3IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkKHVzZXJJZCksXG4gICAgdmlld0NvdW50OiAwLFxuICAgIHNoYXJlQ291bnQ6IDAsXG4gIH07XG5cbiAgLy8g5YSy5a2Y5Yiw6LOH5paZ5bqrXG4gIGNvbnN0IHBldCA9IG5ldyBQZXQocGV0RGF0YSk7XG4gIGF3YWl0IHBldC5zYXZlKCk7XG5cbiAgLy8g5aGr5YWF55So5oi26LOH6KiKXG4gIGF3YWl0IHBldC5wb3B1bGF0ZSgndXNlcklkJywgJ25hbWUgZW1haWwnKTtcblxuICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBtZXNzYWdlOiAn5a+154mp5Y2U5bCL5qGI5L6L5paw5aKe5oiQ5YqfJyxcbiAgICBkYXRhOiB7XG4gICAgICBwZXQ6IHBldC50b0pTT04oKSxcbiAgICB9LFxuICB9KTtcbn0pKTtcblxuLyoqXG4gKiBAcm91dGUgICBQVVQgL2FwaS9wZXRzLzppZFxuICogQGRlc2MgICAg5pu05paw5a+154mp6LOH6KiKXG4gKiBAYWNjZXNzICBQcml2YXRlXG4gKi9cbnJvdXRlci5wdXQoJy86aWQnLCBhdXRoZW50aWNhdGUsIHJlcXVpcmVBY3RpdmVBY2NvdW50LCB2YWxpZGF0ZVJlcXVlc3QocGV0VXBkYXRlU2NoZW1hKSwgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICBjb25zdCB1cGRhdGVEYXRhID0gcmVxLnZhbGlkYXRlZERhdGE7XG4gIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyIS5pZDtcblxuICBpZiAoIWlkIHx8ICFtb25nb29zZS5UeXBlcy5PYmplY3RJZC5pc1ZhbGlkKGlkKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ+iri+aPkOS+m+acieaViOeahOWvteeJqSBJRCcpO1xuICB9XG5cbiAgbG9nZ2VyLmluZm8oJ+abtOaWsOWvteeJqeizh+ioiuiri+axgicsIHsgcGV0SWQ6IGlkLCB1c2VySWQsIHVwZGF0ZURhdGEgfSk7XG5cbiAgLy8g5p+l5om+5a+154mp5Lim5qqi5p+l5qyK6ZmQXG4gIGNvbnN0IHBldCA9IGF3YWl0IFBldC5maW5kQnlJZChpZCk7XG4gIGlmICghcGV0KSB7XG4gICAgdGhyb3cgbmV3IE5vdEZvdW5kRXJyb3IoJ+aJvuS4jeWIsOaMh+WumueahOWvteeJqeizh+ioiicpO1xuICB9XG5cbiAgLy8g5qqi5p+l5piv5ZCm54K65a+154mp5pOB5pyJ6ICF5oiW566h55CG5ZOhXG4gIGlmIChwZXQudXNlcklkLnRvU3RyaW5nKCkgIT09IHVzZXJJZCAmJiAhaGFzUGVybWlzc2lvbihyZXEudXNlciEsIFBlcm1pc3Npb24uUEVUX1dSSVRFKSkge1xuICAgIHRocm93IG5ldyBGb3JiaWRkZW5FcnJvcign5oKo5rKS5pyJ5qyK6ZmQ5L+u5pS55q2k5a+154mp6LOH6KiKJyk7XG4gIH1cblxuICAvLyDmm7TmlrDlr7Xnianos4foqIpcbiAgY29uc3QgdXBkYXRlZFBldCA9IGF3YWl0IFBldC5maW5kQnlJZEFuZFVwZGF0ZShcbiAgICBpZCxcbiAgICB7ICRzZXQ6IHVwZGF0ZURhdGEgfSxcbiAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XG4gICkucG9wdWxhdGUoJ3VzZXJJZCcsICduYW1lIGVtYWlsJyk7XG5cbiAgcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZTogJ+WvteeJqeizh+ioiuabtOaWsOaIkOWKnycsXG4gICAgZGF0YToge1xuICAgICAgcGV0OiB1cGRhdGVkUGV0LFxuICAgIH0sXG4gIH0pO1xufSkpO1xuXG4vKipcbiAqIEByb3V0ZSAgIERFTEVURSAvYXBpL3BldHMvOmlkXG4gKiBAZGVzYyAgICDliKrpmaTlr7XnianljZTlsIvmoYjkvotcbiAqIEBhY2Nlc3MgIFByaXZhdGVcbiAqL1xucm91dGVyLmRlbGV0ZSgnLzppZCcsIGF1dGhlbnRpY2F0ZSwgcmVxdWlyZUFjdGl2ZUFjY291bnQsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcbiAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIhLmlkO1xuXG4gIGlmICghaWQgfHwgIW1vbmdvb3NlLlR5cGVzLk9iamVjdElkLmlzVmFsaWQoaWQpKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcign6KuL5o+Q5L6b5pyJ5pWI55qE5a+154mpIElEJyk7XG4gIH1cblxuICBsb2dnZXIuaW5mbygn5Yiq6Zmk5a+154mp5Y2U5bCL5qGI5L6L6KuL5rGCJywgeyBwZXRJZDogaWQsIHVzZXJJZCB9KTtcblxuICAvLyDmn6Xmib7lr7XniankuKbmqqLmn6XmrIrpmZBcbiAgY29uc3QgcGV0ID0gYXdhaXQgUGV0LmZpbmRCeUlkKGlkKTtcbiAgaWYgKCFwZXQpIHtcbiAgICB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcign5om+5LiN5Yiw5oyH5a6a55qE5a+154mp6LOH6KiKJyk7XG4gIH1cblxuICAvLyDmqqLmn6XmmK/lkKbngrrlr7Xnianmk4HmnInogIXmiJbnrqHnkIblk6FcbiAgaWYgKHBldC51c2VySWQudG9TdHJpbmcoKSAhPT0gdXNlcklkICYmICFoYXNQZXJtaXNzaW9uKHJlcS51c2VyISwgUGVybWlzc2lvbi5QRVRfREVMRVRFKSkge1xuICAgIHRocm93IG5ldyBGb3JiaWRkZW5FcnJvcign5oKo5rKS5pyJ5qyK6ZmQ5Yiq6Zmk5q2k5a+154mp6LOH6KiKJyk7XG4gIH1cblxuICAvLyDln7fooYzliKrpmaTvvIjnoazliKrpmaTvvIlcbiAgYXdhaXQgUGV0LmZpbmRCeUlkQW5kRGVsZXRlKGlkKTtcblxuICByZXMuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBtZXNzYWdlOiAn5a+154mp5Y2U5bCL5qGI5L6L5bey5Yiq6ZmkJyxcbiAgfSk7XG59KSk7XG5cbi8qKlxuICogQHJvdXRlICAgUE9TVCAvYXBpL3BldHMvOmlkL2ltYWdlc1xuICogQGRlc2MgICAg5LiK5YKz5a+154mp5ZyW54mHXG4gKiBAYWNjZXNzICBQcml2YXRlXG4gKi9cbnJvdXRlci5wb3N0KCcvOmlkL2ltYWdlcycsIGFzeW5jSGFuZGxlcihhc3luYyAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICBpZiAoIWlkKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcign6KuL5o+Q5L6b5a+154mpIElEJyk7XG4gIH1cblxuICAvLyBUT0RPOiDlr6bkvZzlnJbniYfkuIrlgrPpgo/ovK9cbiAgLy8gLSDmrIrpmZDmqqLmn6VcbiAgLy8gLSDmqpTmoYjpqZforYlcbiAgLy8gLSDlnJbniYfomZXnkIbvvIjlo5PnuK7jgIHnuK7mlL7vvIlcbiAgLy8gLSDkuIrlgrPliLDpm7Lnq6/lhLLlrZhcblxuICBsb2dnZXIuaW5mbygn5LiK5YKz5a+154mp5ZyW54mH6KuL5rGCJywgeyBwZXRJZDogaWQgfSk7XG5cbiAgcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZTogJ+WclueJh+S4iuWCs+aIkOWKnycsXG4gICAgZGF0YToge1xuICAgICAgaW1hZ2VVcmxzOiBbXG4gICAgICAgICdodHRwczovL2V4YW1wbGUuY29tL2ltYWdlcy9wZXQtbmV3LTEuanBnJyxcbiAgICAgICAgJ2h0dHBzOi8vZXhhbXBsZS5jb20vaW1hZ2VzL3BldC1uZXctMi5qcGcnLFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcbn0pKTtcblxuLyoqXG4gKiBAcm91dGUgICBQT1NUIC9hcGkvcGV0cy86aWQvc2hhcmVcbiAqIEBkZXNjICAgIOWIhuS6q+WvteeJqeWNlOWwi+ahiOS+i1xuICogQGFjY2VzcyAgUHVibGljXG4gKi9cbnJvdXRlci5wb3N0KCcvOmlkL3NoYXJlJywgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICBjb25zdCB7IHBsYXRmb3JtIH0gPSByZXEuYm9keTtcblxuICBpZiAoIWlkIHx8ICFtb25nb29zZS5UeXBlcy5PYmplY3RJZC5pc1ZhbGlkKGlkKSkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ+iri+aPkOS+m+acieaViOeahOWvteeJqSBJRCcpO1xuICB9XG5cbiAgbG9nZ2VyLmluZm8oJ+WIhuS6q+WvteeJqeWNlOWwi+ahiOS+i+iri+axgicsIHsgcGV0SWQ6IGlkLCBwbGF0Zm9ybSB9KTtcblxuICAvLyDmn6Xmib7lr7XniankuKblop7liqDliIbkuqvmrKHmlbhcbiAgY29uc3QgcGV0ID0gYXdhaXQgUGV0LmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgIGlkLFxuICAgIHsgJGluYzogeyBzaGFyZUNvdW50OiAxIH0gfSxcbiAgICB7IG5ldzogdHJ1ZSB9XG4gICk7XG5cbiAgaWYgKCFwZXQpIHtcbiAgICB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcign5om+5LiN5Yiw5oyH5a6a55qE5a+154mp6LOH6KiKJyk7XG4gIH1cblxuICAvLyDnlJ/miJDliIbkuqvpgKPntZBcbiAgY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52LkZST05URU5EX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJztcbiAgY29uc3Qgc2hhcmVVcmwgPSBgJHtiYXNlVXJsfS9wZXRzLyR7aWR9YDtcblxuICByZXMuanNvbih7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBtZXNzYWdlOiAn5YiG5Lqr6YCj57WQ55Sf5oiQ5oiQ5YqfJyxcbiAgICBkYXRhOiB7XG4gICAgICBzaGFyZVVybCxcbiAgICAgIHNoYXJlQ291bnQ6IHBldC5zaGFyZUNvdW50LFxuICAgICAgcGxhdGZvcm0sXG4gICAgfSxcbiAgfSk7XG59KSk7XG5cbi8qKlxuICogQHJvdXRlICAgR0VUIC9hcGkvcGV0cy91c2VyLzp1c2VySWRcbiAqIEBkZXNjICAgIOeNsuWPluaMh+WumueUqOaItueahOWvteeJqeWNlOWwi+ahiOS+i1xuICogQGFjY2VzcyAgUHVibGljXG4gKi9cbnJvdXRlci5nZXQoJy91c2VyLzp1c2VySWQnLCBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHsgdXNlcklkIH0gPSByZXEucGFyYW1zO1xuICBjb25zdCB7IHBhZ2UgPSAxLCBsaW1pdCA9IDEyLCBzdGF0dXMgfSA9IHJlcS5xdWVyeTtcblxuICBpZiAoIXVzZXJJZCB8fCAhbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQuaXNWYWxpZCh1c2VySWQpKSB7XG4gICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcign6KuL5o+Q5L6b5pyJ5pWI55qE55So5oi2IElEJyk7XG4gIH1cblxuICBsb2dnZXIuaW5mbygn542y5Y+W55So5oi25a+154mp5YiX6KGo6KuL5rGCJywgeyB1c2VySWQgfSk7XG5cbiAgLy8g5bu656uL5p+l6Kmi5qKd5Lu2XG4gIGNvbnN0IHF1ZXJ5OiBhbnkgPSB7IHVzZXJJZDogbmV3IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkKHVzZXJJZCkgfTtcbiAgXG4gIC8vIOeLgOaFi+evqemBuFxuICBpZiAoc3RhdHVzKSB7XG4gICAgcXVlcnkuc3RhdHVzID0gc3RhdHVzO1xuICB9XG5cbiAgLy8g6KiI566X5YiG6aCBXG4gIGNvbnN0IHNraXAgPSAoTnVtYmVyKHBhZ2UpIC0gMSkgKiBOdW1iZXIobGltaXQpO1xuICBcbiAgLy8g5Z+36KGM5p+l6KmiXG4gIGNvbnN0IFtwZXRzLCB0b3RhbEl0ZW1zXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBQZXQuZmluZChxdWVyeSlcbiAgICAgIC5zb3J0KHsgaXNVcmdlbnQ6IC0xLCBjcmVhdGVkQXQ6IC0xIH0pXG4gICAgICAuc2tpcChza2lwKVxuICAgICAgLmxpbWl0KE51bWJlcihsaW1pdCkpXG4gICAgICAucG9wdWxhdGUoJ3VzZXJJZCcsICduYW1lIGVtYWlsJylcbiAgICAgIC5sZWFuKCksXG4gICAgUGV0LmNvdW50RG9jdW1lbnRzKHF1ZXJ5KVxuICBdKTtcblxuICAvLyDoqIjnrpfliIbpoIHos4foqIpcbiAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbEl0ZW1zIC8gTnVtYmVyKGxpbWl0KSk7XG5cbiAgcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgZGF0YToge1xuICAgICAgcGV0cyxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgY3VycmVudFBhZ2U6IE51bWJlcihwYWdlKSxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgICAgdG90YWxJdGVtcyxcbiAgICAgICAgaXRlbXNQZXJQYWdlOiBOdW1iZXIobGltaXQpLFxuICAgICAgICBoYXNOZXh0UGFnZTogTnVtYmVyKHBhZ2UpIDwgdG90YWxQYWdlcyxcbiAgICAgICAgaGFzUHJldlBhZ2U6IE51bWJlcihwYWdlKSA+IDFcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG59KSk7XG5cbi8qKlxuICogQHJvdXRlICAgR0VUIC9hcGkvcGV0cy9zZWFyY2gvc2ltaWxhclxuICogQGRlc2MgICAg5pCc5bCL55u45Ly85a+154mpXG4gKiBAYWNjZXNzICBQdWJsaWNcbiAqL1xucm91dGVyLmdldCgnL3NlYXJjaC9zaW1pbGFyJywgYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCB7IHR5cGUsIGJyZWVkLCBjb2xvciwgbG9jYXRpb24sIGV4Y2x1ZGVJZCB9ID0gcmVxLnF1ZXJ5O1xuXG4gIGxvZ2dlci5pbmZvKCfmkJzlsIvnm7jkvLzlr7Xnianoq4vmsYInLCB7IHR5cGUsIGJyZWVkLCBjb2xvciwgbG9jYXRpb24sIGV4Y2x1ZGVJZCB9KTtcblxuICAvLyDlu7rnq4vmn6XoqaLmop3ku7ZcbiAgY29uc3QgcXVlcnk6IGFueSA9IHt9O1xuICBcbiAgLy8g5o6S6Zmk5oyH5a6a55qE5a+154mpXG4gIGlmIChleGNsdWRlSWQgJiYgbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQuaXNWYWxpZChleGNsdWRlSWQgYXMgc3RyaW5nKSkge1xuICAgIHF1ZXJ5Ll9pZCA9IHsgJG5lOiBuZXcgbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQoZXhjbHVkZUlkIGFzIHN0cmluZykgfTtcbiAgfVxuICBcbiAgLy8g5a+154mp6aGe5Z6L5Yy56YWN77yI5b+F6aCI5qKd5Lu277yJXG4gIGlmICh0eXBlKSB7XG4gICAgcXVlcnkudHlwZSA9IHR5cGU7XG4gIH1cbiAgXG4gIC8vIOWTgeeoruWMuemFje+8iOWPr+mBuO+8iVxuICBpZiAoYnJlZWQpIHtcbiAgICBxdWVyeS5icmVlZCA9IG5ldyBSZWdFeHAoYnJlZWQgYXMgc3RyaW5nLCAnaScpO1xuICB9XG4gIFxuICAvLyDpoY/oibLljLnphY3vvIjlj6/pgbjvvIlcbiAgaWYgKGNvbG9yKSB7XG4gICAgcXVlcnkuY29sb3IgPSBuZXcgUmVnRXhwKGNvbG9yIGFzIHN0cmluZywgJ2knKTtcbiAgfVxuICBcbiAgLy8g5Zyw6bue55u46L+R5Yy56YWN77yI5Y+v6YG477yJXG4gIGlmIChsb2NhdGlvbikge1xuICAgIHF1ZXJ5Lmxhc3RTZWVuTG9jYXRpb24gPSBuZXcgUmVnRXhwKGxvY2F0aW9uIGFzIHN0cmluZywgJ2knKTtcbiAgfVxuXG4gIC8vIOWft+ihjOafpeipou+8jOmZkOWItue1kOaenOaVuOmHj1xuICBjb25zdCBzaW1pbGFyUGV0cyA9IGF3YWl0IFBldC5maW5kKHF1ZXJ5KVxuICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxuICAgIC5saW1pdCg2KVxuICAgIC5wb3B1bGF0ZSgndXNlcklkJywgJ25hbWUnKVxuICAgIC5sZWFuKCk7XG5cbiAgcmVzLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgZGF0YToge1xuICAgICAgc2ltaWxhclBldHMsXG4gICAgfSxcbiAgfSk7XG59KSk7XG5cbmV4cG9ydCB7IHJvdXRlciBhcyBwZXRSb3V0ZXMgfTsiXSwidmVyc2lvbiI6M30=