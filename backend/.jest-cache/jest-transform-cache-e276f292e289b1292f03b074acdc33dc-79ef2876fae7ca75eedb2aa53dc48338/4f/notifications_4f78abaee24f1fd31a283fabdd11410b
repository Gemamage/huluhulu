edafdab57640ac681ecc48d56c379489
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const express_validator_1 = require("express-validator");
const notificationService_1 = require("../services/notificationService");
const NotificationPreference_1 = require("../models/NotificationPreference");
const Notification_1 = require("../models/Notification");
const auth_1 = require("../middleware/auth");
const logger_1 = require("../utils/logger");
const router = (0, express_1.Router)();
/**
 * 驗證錯誤處理中介軟體
 */
const handleValidationErrors = (req, res, next) => {
    const errors = (0, express_validator_1.validationResult)(req);
    if (!errors.isEmpty()) {
        return res.status(400).json({
            success: false,
            message: '請求參數驗證失敗',
            errors: errors.array(),
        });
    }
    next();
    return;
};
/**
 * @route POST /api/notifications/send
 * @desc 發送單一通知
 * @access Private
 */
router.post('/send', auth_1.authenticate, [
    (0, express_validator_1.body)('userId').isMongoId().withMessage('用戶 ID 格式不正確'),
    (0, express_validator_1.body)('type').isIn(Object.values(Notification_1.NotificationType)).withMessage('通知類型不正確'),
    (0, express_validator_1.body)('title').trim().isLength({ min: 1, max: 100 }).withMessage('標題長度必須在 1-100 字元之間'),
    (0, express_validator_1.body)('message').trim().isLength({ min: 1, max: 500 }).withMessage('訊息長度必須在 1-500 字元之間'),
    (0, express_validator_1.body)('priority').optional().isIn(Object.values(Notification_1.NotificationPriority)).withMessage('優先級不正確'),
    (0, express_validator_1.body)('actionUrl').optional().isURL().withMessage('動作連結格式不正確'),
    (0, express_validator_1.body)('imageUrl').optional().isURL().withMessage('圖片連結格式不正確'),
    (0, express_validator_1.body)('channels.push').optional().isBoolean().withMessage('推播通知設定必須為布林值'),
    (0, express_validator_1.body)('channels.email').optional().isBoolean().withMessage('Email 通知設定必須為布林值'),
    (0, express_validator_1.body)('channels.inApp').optional().isBoolean().withMessage('站內通知設定必須為布林值'),
    (0, express_validator_1.body)('scheduledAt').optional().isISO8601().withMessage('排程時間格式不正確'),
    (0, express_validator_1.body)('expiresAt').optional().isISO8601().withMessage('過期時間格式不正確'),
], handleValidationErrors, async (req, res) => {
    try {
        const options = {
            userId: req.body.userId,
            type: req.body.type,
            title: req.body.title,
            message: req.body.message,
            priority: req.body.priority,
            data: req.body.data,
            actionUrl: req.body.actionUrl,
            imageUrl: req.body.imageUrl,
            channels: req.body.channels,
            scheduledAt: req.body.scheduledAt ? new Date(req.body.scheduledAt) : undefined,
            expiresAt: req.body.expiresAt ? new Date(req.body.expiresAt) : undefined,
        };
        const result = await notificationService_1.NotificationService.sendNotification(options);
        res.json({
            success: result.success,
            message: result.success ? '通知發送成功' : '通知發送失敗',
            data: {
                notificationId: result.notificationId,
                channels: result.channels,
            },
        });
    }
    catch (error) {
        logger_1.logger.error('發送通知 API 錯誤', { error, body: req.body });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route POST /api/notifications/batch
 * @desc 批次發送通知
 * @access Private
 */
router.post('/batch', auth_1.authenticate, [
    (0, express_validator_1.body)('userIds').isArray({ min: 1 }).withMessage('用戶 ID 列表不能為空'),
    (0, express_validator_1.body)('userIds.*').isMongoId().withMessage('用戶 ID 格式不正確'),
    (0, express_validator_1.body)('type').isIn(Object.values(Notification_1.NotificationType)).withMessage('通知類型不正確'),
    (0, express_validator_1.body)('title').trim().isLength({ min: 1, max: 100 }).withMessage('標題長度必須在 1-100 字元之間'),
    (0, express_validator_1.body)('message').trim().isLength({ min: 1, max: 500 }).withMessage('訊息長度必須在 1-500 字元之間'),
    (0, express_validator_1.body)('priority').optional().isIn(Object.values(Notification_1.NotificationPriority)).withMessage('優先級不正確'),
], handleValidationErrors, async (req, res) => {
    try {
        const options = {
            userIds: req.body.userIds,
            type: req.body.type,
            title: req.body.title,
            message: req.body.message,
            priority: req.body.priority,
            data: req.body.data,
            actionUrl: req.body.actionUrl,
            imageUrl: req.body.imageUrl,
            channels: req.body.channels,
            scheduledAt: req.body.scheduledAt ? new Date(req.body.scheduledAt) : undefined,
            expiresAt: req.body.expiresAt ? new Date(req.body.expiresAt) : undefined,
        };
        const result = await notificationService_1.NotificationService.sendBatchNotification(options);
        res.json({
            success: true,
            message: '批次通知發送完成',
            data: result,
        });
    }
    catch (error) {
        logger_1.logger.error('批次發送通知 API 錯誤', { error, body: req.body });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route GET /api/notifications
 * @desc 取得用戶通知列表
 * @access Private
 */
router.get('/', auth_1.authenticate, [
    (0, express_validator_1.query)('page').optional().isInt({ min: 1 }).withMessage('頁碼必須為正整數'),
    (0, express_validator_1.query)('limit').optional().isInt({ min: 1, max: 50 }).withMessage('每頁數量必須在 1-50 之間'),
], handleValidationErrors, async (req, res) => {
    try {
        const userId = req.user.userId;
        const page = parseInt(req.query.page) || 1;
        const limit = parseInt(req.query.limit) || 20;
        const result = await notificationService_1.NotificationService.getUserNotifications(userId, page, limit);
        res.json({
            success: true,
            message: '取得通知列表成功',
            data: {
                notifications: result.notifications,
                pagination: {
                    page,
                    limit,
                    total: result.total,
                    hasMore: result.hasMore,
                },
            },
        });
    }
    catch (error) {
        logger_1.logger.error('取得通知列表 API 錯誤', { error, userId: req.user?.userId });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route PUT /api/notifications/:id/read
 * @desc 標記通知為已讀
 * @access Private
 */
router.put('/:id/read', auth_1.authenticate, [
    (0, express_validator_1.param)('id').isMongoId().withMessage('通知 ID 格式不正確'),
], handleValidationErrors, async (req, res) => {
    try {
        const notificationId = req.params.id;
        const userId = req.user?.userId;
        if (!userId) {
            return res.status(401).json({
                success: false,
                message: '用戶未認證',
            });
        }
        const success = await notificationService_1.NotificationService.markAsRead(notificationId, userId);
        if (success) {
            return res.json({
                success: true,
                message: '通知已標記為已讀',
            });
        }
        else {
            return res.status(404).json({
                success: false,
                message: '找不到指定的通知',
            });
        }
    }
    catch (error) {
        logger_1.logger.error('標記通知已讀 API 錯誤', { error, notificationId: req.params.id });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route GET /api/notifications/unread-count
 * @desc 取得未讀通知數量
 * @access Private
 */
router.get('/unread-count', auth_1.authenticate, async (req, res) => {
    try {
        const userId = req.user.userId;
        const count = await notificationService_1.NotificationService.getUnreadCount(userId);
        res.json({
            success: true,
            message: '取得未讀通知數量成功',
            data: { count },
        });
    }
    catch (error) {
        logger_1.logger.error('取得未讀通知數量 API 錯誤', { error, userId: req.user?.userId });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route GET /api/notifications/preferences
 * @desc 取得用戶通知偏好設定
 * @access Private
 */
router.get('/preferences', auth_1.authenticate, async (req, res) => {
    try {
        const userId = req.user.userId;
        const preferences = await NotificationPreference_1.NotificationPreference.findByUserId(userId);
        if (!preferences) {
            return res.status(404).json({
                success: false,
                message: '找不到通知偏好設定',
            });
        }
        res.json({
            success: true,
            message: '取得通知偏好設定成功',
            data: preferences,
        });
        return;
    }
    catch (error) {
        logger_1.logger.error('取得通知偏好設定 API 錯誤', { error, userId: req.user?.userId });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route PUT /api/notifications/preferences
 * @desc 更新用戶通知偏好設定
 * @access Private
 */
router.put('/preferences', auth_1.authenticate, [
    (0, express_validator_1.body)('pushNotifications').optional().isObject().withMessage('推播通知設定必須為物件'),
    (0, express_validator_1.body)('emailNotifications').optional().isObject().withMessage('Email 通知設定必須為物件'),
    (0, express_validator_1.body)('inAppNotifications').optional().isObject().withMessage('站內通知設定必須為物件'),
    (0, express_validator_1.body)('globalSettings.pushEnabled').optional().isBoolean().withMessage('推播開關必須為布林值'),
    (0, express_validator_1.body)('globalSettings.emailEnabled').optional().isBoolean().withMessage('Email 開關必須為布林值'),
    (0, express_validator_1.body)('globalSettings.quietHours.enabled').optional().isBoolean().withMessage('勿擾時段開關必須為布林值'),
    (0, express_validator_1.body)('globalSettings.quietHours.start').optional().matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/).withMessage('勿擾開始時間格式不正確'),
    (0, express_validator_1.body)('globalSettings.quietHours.end').optional().matches(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/).withMessage('勿擾結束時間格式不正確'),
    (0, express_validator_1.body)('globalSettings.frequency').optional().isIn(['immediate', 'hourly', 'daily']).withMessage('通知頻率設定不正確'),
], handleValidationErrors, async (req, res) => {
    try {
        const userId = req.user.userId;
        const updateData = req.body;
        const preferences = await NotificationPreference_1.NotificationPreference.findByUserId(userId);
        if (!preferences) {
            return res.status(404).json({
                success: false,
                message: '找不到通知偏好設定',
            });
        }
        // 更新偏好設定
        if (updateData.preferences) {
            Object.assign(preferences.preferences, updateData.preferences);
            preferences.markModified('preferences');
        }
        // 更新全域設定
        if (updateData.globalSettings) {
            Object.assign(preferences.globalSettings, updateData.globalSettings);
            preferences.markModified('globalSettings');
        }
        const updatedPreferences = await preferences.save();
        res.json({
            success: true,
            message: '通知偏好設定更新成功',
            data: updatedPreferences,
        });
        return;
    }
    catch (error) {
        logger_1.logger.error('更新通知偏好設定 API 錯誤', { error, userId: req.user?.userId });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route POST /api/notifications/device-token
 * @desc 新增裝置 Token
 * @access Private
 */
router.post('/device-token', auth_1.authenticate, [
    (0, express_validator_1.body)('token').trim().isLength({ min: 1 }).withMessage('裝置 Token 不能為空'),
    (0, express_validator_1.body)('platform').optional().isIn(['ios', 'android', 'web']).withMessage('平台類型不正確'),
], handleValidationErrors, async (req, res) => {
    try {
        const userId = req.user.userId;
        const { token, platform } = req.body;
        const preferences = await NotificationPreference_1.NotificationPreference.findByUserId(userId);
        if (!preferences) {
            return res.status(404).json({
                success: false,
                message: '找不到通知偏好設定',
            });
        }
        await preferences.addDeviceToken(token, platform);
        res.json({
            success: true,
            message: '裝置 Token 新增成功',
        });
        return;
    }
    catch (error) {
        logger_1.logger.error('新增裝置 Token API 錯誤', { error, userId: req.user?.userId });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route DELETE /api/notifications/device-token
 * @desc 移除裝置 Token
 * @access Private
 */
router.delete('/device-token', auth_1.authenticate, [
    (0, express_validator_1.body)('token').trim().isLength({ min: 1 }).withMessage('裝置 Token 不能為空'),
], handleValidationErrors, async (req, res) => {
    try {
        const userId = req.user.userId;
        const { token } = req.body;
        const preferences = await NotificationPreference_1.NotificationPreference.findByUserId(userId);
        if (!preferences) {
            return res.status(404).json({
                success: false,
                message: '找不到通知偏好設定',
            });
        }
        await preferences.removeDeviceTokens([token]);
        res.json({
            success: true,
            message: '裝置 Token 移除成功',
        });
        return;
    }
    catch (error) {
        logger_1.logger.error('移除裝置 Token API 錯誤', { error, userId: req.user?.userId });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route GET /api/notifications/stats
 * @desc 取得通知統計資訊
 * @access Private
 */
router.get('/stats', auth_1.authenticate, async (req, res) => {
    try {
        const userId = req.user.userId;
        const stats = await notificationService_1.NotificationService.getNotificationStats(userId);
        res.json({
            success: true,
            message: '取得通知統計成功',
            data: stats,
        });
        return;
    }
    catch (error) {
        logger_1.logger.error('取得通知統計 API 錯誤', { error, userId: req.user?.userId });
        res.status(500).json({
            success: false,
            message: '伺服器內部錯誤',
        });
        return;
    }
});
/**
 * @route POST /api/notifications/test
 * @desc 發送測試通知（僅開發環境）
 * @access Private
 */
if (process.env.NODE_ENV === 'development') {
    router.post('/test', auth_1.authenticate, [
        (0, express_validator_1.body)('type').optional().isIn(Object.values(Notification_1.NotificationType)).withMessage('通知類型不正確'),
        (0, express_validator_1.body)('priority').optional().isIn(Object.values(Notification_1.NotificationPriority)).withMessage('優先級不正確'),
    ], handleValidationErrors, async (req, res) => {
        try {
            const userId = req.user.userId;
            const { type = Notification_1.NotificationType.SYSTEM_UPDATE, priority = Notification_1.NotificationPriority.NORMAL } = req.body;
            const options = {
                userId,
                type,
                title: '測試通知',
                message: '這是一個測試通知，用於驗證通知系統是否正常運作。',
                priority,
                data: {
                    test: true,
                    timestamp: new Date().toISOString(),
                },
            };
            const result = await notificationService_1.NotificationService.sendNotification(options);
            res.json({
                success: result.success,
                message: '測試通知發送完成',
                data: {
                    notificationId: result.notificationId,
                    channels: result.channels,
                },
            });
            return;
        }
        catch (error) {
            logger_1.logger.error('發送測試通知 API 錯誤', { error, userId: req.user?.userId });
            res.status(500).json({
                success: false,
                message: '伺服器內部錯誤',
            });
            return;
        }
    });
}
exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcbm90aWZpY2F0aW9ucy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHFDQUFvRDtBQUNwRCx5REFBeUU7QUFDekUseUVBQXFIO0FBQ3JILDZFQUEwRTtBQUMxRSx5REFBZ0Y7QUFDaEYsNkNBQWtEO0FBQ2xELDRDQUF5QztBQUd6QyxNQUFNLE1BQU0sR0FBRyxJQUFBLGdCQUFNLEdBQUUsQ0FBQztBQUV4Qjs7R0FFRztBQUNILE1BQU0sc0JBQXNCLEdBQUcsQ0FBQyxHQUFZLEVBQUUsR0FBYSxFQUFFLElBQVMsRUFBRSxFQUFFO0lBQ3hFLE1BQU0sTUFBTSxHQUFHLElBQUEsb0NBQWdCLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDO1FBQ3RCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDMUIsT0FBTyxFQUFFLEtBQUs7WUFDZCxPQUFPLEVBQUUsVUFBVTtZQUNuQixNQUFNLEVBQUUsTUFBTSxDQUFDLEtBQUssRUFBRTtTQUN2QixDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0QsSUFBSSxFQUFFLENBQUM7SUFDUCxPQUFPO0FBQ1QsQ0FBQyxDQUFDO0FBRUY7Ozs7R0FJRztBQUNILE1BQU0sQ0FBQyxJQUFJLENBQ1QsT0FBTyxFQUNQLG1CQUFZLEVBQ1o7SUFDRSxJQUFBLHdCQUFJLEVBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQztJQUNyRCxJQUFBLHdCQUFJLEVBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsK0JBQWdCLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUM7SUFDekUsSUFBQSx3QkFBSSxFQUFDLE9BQU8s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QUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSx5Q0FBbUIsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVuRSxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTztnQkFDdkIsT0FBTyxFQUFFLFVBQVU7Z0JBQ25CLElBQUksRUFBRTtvQkFDSixjQUFjLEVBQUUsTUFBTSxDQUFDLGNBQWM7b0JBQ3JDLFFBQVEsRUFBRSxNQUFNLENBQUMsUUFBUTtpQkFDMUI7YUFDRixDQUFDLENBQUM7WUFDSCxPQUFPO1FBQ1QsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixlQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUcsR0FBVyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzVFLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsU0FBUzthQUNuQixDQUFDLENBQUM7WUFDSCxPQUFPO1FBQ1QsQ0FBQztJQUNILENBQUMsQ0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELGtCQUFlLE1BQU0sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXFVzZXJcXERlc2t0b3BcXHRyYWVwcm9qZWN0XFx0ZXN0MlxccGV0LWZpbmRlci1hcHBcXGJhY2tlbmRcXHNyY1xccm91dGVzXFxub3RpZmljYXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IGJvZHksIHBhcmFtLCBxdWVyeSwgdmFsaWRhdGlvblJlc3VsdCB9IGZyb20gJ2V4cHJlc3MtdmFsaWRhdG9yJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UsIE5vdGlmaWNhdGlvbk9wdGlvbnMsIEJhdGNoTm90aWZpY2F0aW9uT3B0aW9ucyB9IGZyb20gJy4uL3NlcnZpY2VzL25vdGlmaWNhdGlvblNlcnZpY2UnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uUHJlZmVyZW5jZSB9IGZyb20gJy4uL21vZGVscy9Ob3RpZmljYXRpb25QcmVmZXJlbmNlJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblR5cGUsIE5vdGlmaWNhdGlvblByaW9yaXR5IH0gZnJvbSAnLi4vbW9kZWxzL05vdGlmaWNhdGlvbic7XG5pbXBvcnQgeyBhdXRoZW50aWNhdGUgfSBmcm9tICcuLi9taWRkbGV3YXJlL2F1dGgnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2VyJztcbmltcG9ydCB7IFR5cGVzIH0gZnJvbSAnbW9uZ29vc2UnO1xuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKTtcblxuLyoqXG4gKiDpqZforYnpjK/oqqTomZXnkIbkuK3ku4vou5/pq5RcbiAqL1xuY29uc3QgaGFuZGxlVmFsaWRhdGlvbkVycm9ycyA9IChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IGFueSkgPT4ge1xuICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XG4gIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6ICfoq4vmsYLlj4PmlbjpqZforYnlpLHmlZcnLFxuICAgICAgZXJyb3JzOiBlcnJvcnMuYXJyYXkoKSxcbiAgICB9KTtcbiAgfVxuICBuZXh0KCk7XG4gIHJldHVybjtcbn07XG5cbi8qKlxuICogQHJvdXRlIFBPU1QgL2FwaS9ub3RpZmljYXRpb25zL3NlbmRcbiAqIEBkZXNjIOeZvOmAgeWWruS4gOmAmuefpVxuICogQGFjY2VzcyBQcml2YXRlXG4gKi9cbnJvdXRlci5wb3N0KFxuICAnL3NlbmQnLFxuICBhdXRoZW50aWNhdGUsXG4gIFtcbiAgICBib2R5KCd1c2VySWQnKS5pc01vbmdvSWQoKS53aXRoTWVzc2FnZSgn55So5oi2IElEIOagvOW8j+S4jeato+eiuicpLFxuICAgIGJvZHkoJ3R5cGUnKS5pc0luKE9iamVjdC52YWx1ZXMoTm90aWZpY2F0aW9uVHlwZSkpLndpdGhNZXNzYWdlKCfpgJrnn6XpoZ7lnovkuI3mraPnoronKSxcbiAgICBib2R5KCd0aXRsZScpLnRyaW0oKS5pc0xlbmd0aCh7IG1pbjogMSwgbWF4OiAxMDAgfSkud2l0aE1lc3NhZ2UoJ+aomemhjOmVt+W6puW/hemgiOWcqCAxLTEwMCDlrZflhYPkuYvplpMnKSxcbiAgICBib2R5KCdtZXNzYWdlJykudHJpbSgpLmlzTGVuZ3RoKHsgbWluOiAxLCBtYXg6IDUwMCB9KS53aXRoTWVzc2FnZSgn6KiK5oGv6ZW35bqm5b+F6aCI5ZyoIDEtNTAwIOWtl+WFg+S5i+mWkycpLFxuICAgIGJvZHkoJ3ByaW9yaXR5Jykub3B0aW9uYWwoKS5pc0luKE9iamVjdC52YWx1ZXMoTm90aWZpY2F0aW9uUHJpb3JpdHkpKS53aXRoTWVzc2FnZSgn5YSq5YWI57Sa5LiN5q2j56K6JyksXG4gICAgYm9keSgnYWN0aW9uVXJsJykub3B0aW9uYWwoKS5pc1VSTCgpLndpdGhNZXNzYWdlKCfli5XkvZzpgKPntZDmoLzlvI/kuI3mraPnoronKSxcbiAgICBib2R5KCdpbWFnZVVybCcpLm9wdGlvbmFsKCkuaXNVUkwoKS53aXRoTWVzc2FnZSgn5ZyW54mH6YCj57WQ5qC85byP5LiN5q2j56K6JyksXG4gICAgYm9keSgnY2hhbm5lbHMucHVzaCcpLm9wdGlvbmFsKCkuaXNCb29sZWFuKCkud2l0aE1lc3NhZ2UoJ+aOqOaSremAmuefpeioreWumuW/hemgiOeCuuW4g+ael+WAvCcpLFxuICAgIGJvZHkoJ2NoYW5uZWxzLmVtYWlsJykub3B0aW9uYWwoKS5pc0Jvb2xlYW4oKS53aXRoTWVzc2FnZSgnRW1haWwg6YCa55+l6Kit5a6a5b+F6aCI54K65biD5p6X5YC8JyksXG4gICAgYm9keSgnY2hhbm5lbHMuaW5BcHAnKS5vcHRpb25hbCgpLmlzQm9vbGVhbigpLndpdGhNZXNzYWdlKCfnq5nlhafpgJrnn6XoqK3lrprlv4XpoIjngrrluIPmnpflgLwnKSxcbiAgICBib2R5KCdzY2hlZHVsZWRBdCcpLm9wdGlvbmFsKCkuaXNJU084NjAxKCkud2l0aE1lc3NhZ2UoJ+aOkueoi+aZgumWk+agvOW8j+S4jeato+eiuicpLFxuICAgIGJvZHkoJ2V4cGlyZXNBdCcpLm9wdGlvbmFsKCkuaXNJU084NjAxKCkud2l0aE1lc3NhZ2UoJ+mBjuacn+aZgumWk+agvOW8j+S4jeato+eiuicpLFxuICBdLFxuICBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9wdGlvbnM6IE5vdGlmaWNhdGlvbk9wdGlvbnMgPSB7XG4gICAgICAgIHVzZXJJZDogcmVxLmJvZHkudXNlcklkLFxuICAgICAgICB0eXBlOiByZXEuYm9keS50eXBlLFxuICAgICAgICB0aXRsZTogcmVxLmJvZHkudGl0bGUsXG4gICAgICAgIG1lc3NhZ2U6IHJlcS5ib2R5Lm1lc3NhZ2UsXG4gICAgICAgIHByaW9yaXR5OiByZXEuYm9keS5wcmlvcml0eSxcbiAgICAgICAgZGF0YTogcmVxLmJvZHkuZGF0YSxcbiAgICAgICAgYWN0aW9uVXJsOiByZXEuYm9keS5hY3Rpb25VcmwsXG4gICAgICAgIGltYWdlVXJsOiByZXEuYm9keS5pbWFnZVVybCxcbiAgICAgICAgY2hhbm5lbHM6IHJlcS5ib2R5LmNoYW5uZWxzLFxuICAgICAgICBzY2hlZHVsZWRBdDogcmVxLmJvZHkuc2NoZWR1bGVkQXQgPyBuZXcgRGF0ZShyZXEuYm9keS5zY2hlZHVsZWRBdCkgOiB1bmRlZmluZWQsXG4gICAgICAgIGV4cGlyZXNBdDogcmVxLmJvZHkuZXhwaXJlc0F0ID8gbmV3IERhdGUocmVxLmJvZHkuZXhwaXJlc0F0KSA6IHVuZGVmaW5lZCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE5vdGlmaWNhdGlvblNlcnZpY2Uuc2VuZE5vdGlmaWNhdGlvbihvcHRpb25zKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiByZXN1bHQuc3VjY2VzcyxcbiAgICAgICAgbWVzc2FnZTogcmVzdWx0LnN1Y2Nlc3MgPyAn6YCa55+l55m86YCB5oiQ5YqfJyA6ICfpgJrnn6XnmbzpgIHlpLHmlZcnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbm90aWZpY2F0aW9uSWQ6IHJlc3VsdC5ub3RpZmljYXRpb25JZCxcbiAgICAgICAgICBjaGFubmVsczogcmVzdWx0LmNoYW5uZWxzLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcign55m86YCB6YCa55+lIEFQSSDpjK/oqqQnLCB7IGVycm9yLCBib2R5OiByZXEuYm9keSB9KTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICfkvLrmnI3lmajlhafpg6jpjK/oqqQnLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4pO1xuXG4vKipcbiAqIEByb3V0ZSBQT1NUIC9hcGkvbm90aWZpY2F0aW9ucy9iYXRjaFxuICogQGRlc2Mg5om55qyh55m86YCB6YCa55+lXG4gKiBAYWNjZXNzIFByaXZhdGVcbiAqL1xucm91dGVyLnBvc3QoXG4gICcvYmF0Y2gnLFxuICBhdXRoZW50aWNhdGUsXG4gIFtcbiAgICBib2R5KCd1c2VySWRzJykuaXNBcnJheSh7IG1pbjogMSB9KS53aXRoTWVzc2FnZSgn55So5oi2IElEIOWIl+ihqOS4jeiDveeCuuepuicpLFxuICAgIGJvZHkoJ3VzZXJJZHMuKicpLmlzTW9uZ29JZCgpLndpdGhNZXNzYWdlKCfnlKjmiLYgSUQg5qC85byP5LiN5q2j56K6JyksXG4gICAgYm9keSgndHlwZScpLmlzSW4oT2JqZWN0LnZhbHVlcyhOb3RpZmljYXRpb25UeXBlKSkud2l0aE1lc3NhZ2UoJ+mAmuefpemhnuWei+S4jeato+eiuicpLFxuICAgIGJvZHkoJ3RpdGxlJykudHJpbSgpLmlzTGVuZ3RoKHsgbWluOiAxLCBtYXg6IDEwMCB9KS53aXRoTWVzc2FnZSgn5qiZ6aGM6ZW35bqm5b+F6aCI5ZyoIDEtMTAwIOWtl+WFg+S5i+mWkycpLFxuICAgIGJvZHkoJ21lc3NhZ2UnKS50cmltKCkuaXNMZW5ndGgoeyBtaW46IDEsIG1heDogNTAwIH0pLndpdGhNZXNzYWdlKCfoqIrmga/plbfluqblv4XpoIjlnKggMS01MDAg5a2X5YWD5LmL6ZaTJyksXG4gICAgYm9keSgncHJpb3JpdHknKS5vcHRpb25hbCgpLmlzSW4oT2JqZWN0LnZhbHVlcyhOb3RpZmljYXRpb25Qcmlvcml0eSkpLndpdGhNZXNzYWdlKCflhKrlhYjntJrkuI3mraPnoronKSxcbiAgXSxcbiAgaGFuZGxlVmFsaWRhdGlvbkVycm9ycyxcbiAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvcHRpb25zOiBCYXRjaE5vdGlmaWNhdGlvbk9wdGlvbnMgPSB7XG4gICAgICAgIHVzZXJJZHM6IHJlcS5ib2R5LnVzZXJJZHMsXG4gICAgICAgIHR5cGU6IHJlcS5ib2R5LnR5cGUsXG4gICAgICAgIHRpdGxlOiByZXEuYm9keS50aXRsZSxcbiAgICAgICAgbWVzc2FnZTogcmVxLmJvZHkubWVzc2FnZSxcbiAgICAgICAgcHJpb3JpdHk6IHJlcS5ib2R5LnByaW9yaXR5LFxuICAgICAgICBkYXRhOiByZXEuYm9keS5kYXRhLFxuICAgICAgICBhY3Rpb25Vcmw6IHJlcS5ib2R5LmFjdGlvblVybCxcbiAgICAgICAgaW1hZ2VVcmw6IHJlcS5ib2R5LmltYWdlVXJsLFxuICAgICAgICBjaGFubmVsczogcmVxLmJvZHkuY2hhbm5lbHMsXG4gICAgICAgIHNjaGVkdWxlZEF0OiByZXEuYm9keS5zY2hlZHVsZWRBdCA/IG5ldyBEYXRlKHJlcS5ib2R5LnNjaGVkdWxlZEF0KSA6IHVuZGVmaW5lZCxcbiAgICAgICAgZXhwaXJlc0F0OiByZXEuYm9keS5leHBpcmVzQXQgPyBuZXcgRGF0ZShyZXEuYm9keS5leHBpcmVzQXQpIDogdW5kZWZpbmVkLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgTm90aWZpY2F0aW9uU2VydmljZS5zZW5kQmF0Y2hOb3RpZmljYXRpb24ob3B0aW9ucyk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ+aJueasoemAmuefpeeZvOmAgeWujOaIkCcsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ+aJueasoeeZvOmAgemAmuefpSBBUEkg6Yyv6KqkJywgeyBlcnJvciwgYm9keTogcmVxLmJvZHkgfSk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAn5Ly65pyN5Zmo5YWn6YOo6Yyv6KqkJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuKTtcblxuLyoqXG4gKiBAcm91dGUgR0VUIC9hcGkvbm90aWZpY2F0aW9uc1xuICogQGRlc2Mg5Y+W5b6X55So5oi26YCa55+l5YiX6KGoXG4gKiBAYWNjZXNzIFByaXZhdGVcbiAqL1xucm91dGVyLmdldChcbiAgJy8nLFxuICBhdXRoZW50aWNhdGUsXG4gIFtcbiAgICBxdWVyeSgncGFnZScpLm9wdGlvbmFsKCkuaXNJbnQoeyBtaW46IDEgfSkud2l0aE1lc3NhZ2UoJ+mggeeivOW/hemgiOeCuuato+aVtOaVuCcpLFxuICAgIHF1ZXJ5KCdsaW1pdCcpLm9wdGlvbmFsKCkuaXNJbnQoeyBtaW46IDEsIG1heDogNTAgfSkud2l0aE1lc3NhZ2UoJ+avj+mggeaVuOmHj+W/hemgiOWcqCAxLTUwIOS5i+mWkycpLFxuICBdLFxuICBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IChyZXEgYXMgYW55KS51c2VyLnVzZXJJZDtcbiAgICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEucXVlcnkucGFnZSBhcyBzdHJpbmcpIHx8IDE7XG4gICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCBhcyBzdHJpbmcpIHx8IDIwO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmdldFVzZXJOb3RpZmljYXRpb25zKHVzZXJJZCwgcGFnZSwgbGltaXQpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICflj5blvpfpgJrnn6XliJfooajmiJDlip8nLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbm90aWZpY2F0aW9uczogcmVzdWx0Lm5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgICAgdG90YWw6IHJlc3VsdC50b3RhbCxcbiAgICAgICAgICAgIGhhc01vcmU6IHJlc3VsdC5oYXNNb3JlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCflj5blvpfpgJrnn6XliJfooaggQVBJIOmMr+iqpCcsIHsgZXJyb3IsIHVzZXJJZDogKHJlcSBhcyBhbnkpLnVzZXI/LnVzZXJJZCB9KTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICfkvLrmnI3lmajlhafpg6jpjK/oqqQnLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4pO1xuXG4vKipcbiAqIEByb3V0ZSBQVVQgL2FwaS9ub3RpZmljYXRpb25zLzppZC9yZWFkXG4gKiBAZGVzYyDmqJnoqJjpgJrnn6Xngrrlt7LoroBcbiAqIEBhY2Nlc3MgUHJpdmF0ZVxuICovXG5yb3V0ZXIucHV0KFxuICAnLzppZC9yZWFkJyxcbiAgYXV0aGVudGljYXRlLFxuICBbXG4gICAgcGFyYW0oJ2lkJykuaXNNb25nb0lkKCkud2l0aE1lc3NhZ2UoJ+mAmuefpSBJRCDmoLzlvI/kuI3mraPnoronKSxcbiAgXSxcbiAgaGFuZGxlVmFsaWRhdGlvbkVycm9ycyxcbiAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBub3RpZmljYXRpb25JZCA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgICBjb25zdCB1c2VySWQgPSAocmVxIGFzIGFueSkudXNlcj8udXNlcklkO1xuXG4gICAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICfnlKjmiLbmnKroqo3orYknLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IE5vdGlmaWNhdGlvblNlcnZpY2UubWFya0FzUmVhZChub3RpZmljYXRpb25JZCBhcyBzdHJpbmcsIHVzZXJJZCBhcyBzdHJpbmcpO1xuXG4gICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogJ+mAmuefpeW3suaomeiomOeCuuW3suiugCcsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAn5om+5LiN5Yiw5oyH5a6a55qE6YCa55+lJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcign5qiZ6KiY6YCa55+l5bey6K6AIEFQSSDpjK/oqqQnLCB7IGVycm9yLCBub3RpZmljYXRpb25JZDogcmVxLnBhcmFtcy5pZCB9KTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICfkvLrmnI3lmajlhafpg6jpjK/oqqQnLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4pO1xuXG4vKipcbiAqIEByb3V0ZSBHRVQgL2FwaS9ub3RpZmljYXRpb25zL3VucmVhZC1jb3VudFxuICogQGRlc2Mg5Y+W5b6X5pyq6K6A6YCa55+l5pW46YePXG4gKiBAYWNjZXNzIFByaXZhdGVcbiAqL1xucm91dGVyLmdldChcbiAgJy91bnJlYWQtY291bnQnLFxuICBhdXRoZW50aWNhdGUsXG4gIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlcklkID0gKHJlcSBhcyBhbnkpLnVzZXIudXNlcklkO1xuICAgICAgY29uc3QgY291bnQgPSBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmdldFVucmVhZENvdW50KHVzZXJJZCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ+WPluW+l+acquiugOmAmuefpeaVuOmHj+aIkOWKnycsXG4gICAgICAgIGRhdGE6IHsgY291bnQgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ+WPluW+l+acquiugOmAmuefpeaVuOmHjyBBUEkg6Yyv6KqkJywgeyBlcnJvciwgdXNlcklkOiAocmVxIGFzIGFueSkudXNlcj8udXNlcklkIH0pO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ+S8uuacjeWZqOWFp+mDqOmMr+iqpCcsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbik7XG5cbi8qKlxuICogQHJvdXRlIEdFVCAvYXBpL25vdGlmaWNhdGlvbnMvcHJlZmVyZW5jZXNcbiAqIEBkZXNjIOWPluW+l+eUqOaItumAmuefpeWBj+WlveioreWumlxuICogQGFjY2VzcyBQcml2YXRlXG4gKi9cbnJvdXRlci5nZXQoXG4gICcvcHJlZmVyZW5jZXMnLFxuICBhdXRoZW50aWNhdGUsXG4gIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlcklkID0gKHJlcSBhcyBhbnkpLnVzZXIudXNlcklkO1xuICAgICAgY29uc3QgcHJlZmVyZW5jZXMgPSBhd2FpdCBOb3RpZmljYXRpb25QcmVmZXJlbmNlLmZpbmRCeVVzZXJJZCh1c2VySWQpO1xuXG4gICAgICBpZiAoIXByZWZlcmVuY2VzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ+aJvuS4jeWIsOmAmuefpeWBj+WlveioreWumicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICflj5blvpfpgJrnn6XlgY/lpb3oqK3lrprmiJDlip8nLFxuICAgICAgICBkYXRhOiBwcmVmZXJlbmNlcyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ+WPluW+l+mAmuefpeWBj+WlveioreWumiBBUEkg6Yyv6KqkJywgeyBlcnJvciwgdXNlcklkOiAocmVxIGFzIGFueSkudXNlcj8udXNlcklkIH0pO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ+S8uuacjeWZqOWFp+mDqOmMr+iqpCcsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbik7XG5cbi8qKlxuICogQHJvdXRlIFBVVCAvYXBpL25vdGlmaWNhdGlvbnMvcHJlZmVyZW5jZXNcbiAqIEBkZXNjIOabtOaWsOeUqOaItumAmuefpeWBj+WlveioreWumlxuICogQGFjY2VzcyBQcml2YXRlXG4gKi9cbnJvdXRlci5wdXQoXG4gICcvcHJlZmVyZW5jZXMnLFxuICBhdXRoZW50aWNhdGUsXG4gIFtcbiAgICBib2R5KCdwdXNoTm90aWZpY2F0aW9ucycpLm9wdGlvbmFsKCkuaXNPYmplY3QoKS53aXRoTWVzc2FnZSgn5o6o5pKt6YCa55+l6Kit5a6a5b+F6aCI54K654mp5Lu2JyksXG4gICAgYm9keSgnZW1haWxOb3RpZmljYXRpb25zJykub3B0aW9uYWwoKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdFbWFpbCDpgJrnn6XoqK3lrprlv4XpoIjngrrnianku7YnKSxcbiAgICBib2R5KCdpbkFwcE5vdGlmaWNhdGlvbnMnKS5vcHRpb25hbCgpLmlzT2JqZWN0KCkud2l0aE1lc3NhZ2UoJ+ermeWFp+mAmuefpeioreWumuW/hemgiOeCuueJqeS7ticpLFxuICAgIGJvZHkoJ2dsb2JhbFNldHRpbmdzLnB1c2hFbmFibGVkJykub3B0aW9uYWwoKS5pc0Jvb2xlYW4oKS53aXRoTWVzc2FnZSgn5o6o5pKt6ZaL6Zec5b+F6aCI54K65biD5p6X5YC8JyksXG4gICAgYm9keSgnZ2xvYmFsU2V0dGluZ3MuZW1haWxFbmFibGVkJykub3B0aW9uYWwoKS5pc0Jvb2xlYW4oKS53aXRoTWVzc2FnZSgnRW1haWwg6ZaL6Zec5b+F6aCI54K65biD5p6X5YC8JyksXG4gICAgYm9keSgnZ2xvYmFsU2V0dGluZ3MucXVpZXRIb3Vycy5lbmFibGVkJykub3B0aW9uYWwoKS5pc0Jvb2xlYW4oKS53aXRoTWVzc2FnZSgn5Yu/5pO+5pmC5q616ZaL6Zec5b+F6aCI54K65biD5p6X5YC8JyksXG4gICAgYm9keSgnZ2xvYmFsU2V0dGluZ3MucXVpZXRIb3Vycy5zdGFydCcpLm9wdGlvbmFsKCkubWF0Y2hlcygvXihbMDFdP1swLTldfDJbMC0zXSk6WzAtNV1bMC05XSQvKS53aXRoTWVzc2FnZSgn5Yu/5pO+6ZaL5aeL5pmC6ZaT5qC85byP5LiN5q2j56K6JyksXG4gICAgYm9keSgnZ2xvYmFsU2V0dGluZ3MucXVpZXRIb3Vycy5lbmQnKS5vcHRpb25hbCgpLm1hdGNoZXMoL14oWzAxXT9bMC05XXwyWzAtM10pOlswLTVdWzAtOV0kLykud2l0aE1lc3NhZ2UoJ+WLv+aTvue1kOadn+aZgumWk+agvOW8j+S4jeato+eiuicpLFxuICAgIGJvZHkoJ2dsb2JhbFNldHRpbmdzLmZyZXF1ZW5jeScpLm9wdGlvbmFsKCkuaXNJbihbJ2ltbWVkaWF0ZScsICdob3VybHknLCAnZGFpbHknXSkud2l0aE1lc3NhZ2UoJ+mAmuefpemgu+eOh+ioreWumuS4jeato+eiuicpLFxuICBdLFxuICBoYW5kbGVWYWxpZGF0aW9uRXJyb3JzLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IChyZXEgYXMgYW55KS51c2VyLnVzZXJJZDtcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSByZXEuYm9keTtcblxuICAgICAgY29uc3QgcHJlZmVyZW5jZXMgPSBhd2FpdCBOb3RpZmljYXRpb25QcmVmZXJlbmNlLmZpbmRCeVVzZXJJZCh1c2VySWQpO1xuICAgICAgaWYgKCFwcmVmZXJlbmNlcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICfmib7kuI3liLDpgJrnn6XlgY/lpb3oqK3lrponLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8g5pu05paw5YGP5aW96Kit5a6aXG4gICAgICBpZiAodXBkYXRlRGF0YS5wcmVmZXJlbmNlcykge1xuICAgICAgICBPYmplY3QuYXNzaWduKHByZWZlcmVuY2VzLnByZWZlcmVuY2VzLCB1cGRhdGVEYXRhLnByZWZlcmVuY2VzKTtcbiAgICAgICAgcHJlZmVyZW5jZXMubWFya01vZGlmaWVkKCdwcmVmZXJlbmNlcycpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDmm7TmlrDlhajln5/oqK3lrppcbiAgICAgIGlmICh1cGRhdGVEYXRhLmdsb2JhbFNldHRpbmdzKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24ocHJlZmVyZW5jZXMuZ2xvYmFsU2V0dGluZ3MsIHVwZGF0ZURhdGEuZ2xvYmFsU2V0dGluZ3MpO1xuICAgICAgICBwcmVmZXJlbmNlcy5tYXJrTW9kaWZpZWQoJ2dsb2JhbFNldHRpbmdzJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWRQcmVmZXJlbmNlcyA9IGF3YWl0IHByZWZlcmVuY2VzLnNhdmUoKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAn6YCa55+l5YGP5aW96Kit5a6a5pu05paw5oiQ5YqfJyxcbiAgICAgICAgZGF0YTogdXBkYXRlZFByZWZlcmVuY2VzLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcign5pu05paw6YCa55+l5YGP5aW96Kit5a6aIEFQSSDpjK/oqqQnLCB7IGVycm9yLCB1c2VySWQ6IChyZXEgYXMgYW55KS51c2VyPy51c2VySWQgfSk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAn5Ly65pyN5Zmo5YWn6YOo6Yyv6KqkJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuKTtcblxuLyoqXG4gKiBAcm91dGUgUE9TVCAvYXBpL25vdGlmaWNhdGlvbnMvZGV2aWNlLXRva2VuXG4gKiBAZGVzYyDmlrDlop7oo53nva4gVG9rZW5cbiAqIEBhY2Nlc3MgUHJpdmF0ZVxuICovXG5yb3V0ZXIucG9zdChcbiAgJy9kZXZpY2UtdG9rZW4nLFxuICBhdXRoZW50aWNhdGUsXG4gIFtcbiAgICBib2R5KCd0b2tlbicpLnRyaW0oKS5pc0xlbmd0aCh7IG1pbjogMSB9KS53aXRoTWVzc2FnZSgn6KOd572uIFRva2VuIOS4jeiDveeCuuepuicpLFxuICAgIGJvZHkoJ3BsYXRmb3JtJykub3B0aW9uYWwoKS5pc0luKFsnaW9zJywgJ2FuZHJvaWQnLCAnd2ViJ10pLndpdGhNZXNzYWdlKCflubPlj7DpoZ7lnovkuI3mraPnoronKSxcbiAgXSxcbiAgaGFuZGxlVmFsaWRhdGlvbkVycm9ycyxcbiAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VySWQgPSAocmVxIGFzIGFueSkudXNlci51c2VySWQ7XG4gICAgICBjb25zdCB7IHRva2VuLCBwbGF0Zm9ybSB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGNvbnN0IHByZWZlcmVuY2VzID0gYXdhaXQgTm90aWZpY2F0aW9uUHJlZmVyZW5jZS5maW5kQnlVc2VySWQodXNlcklkKTtcbiAgICAgIGlmICghcHJlZmVyZW5jZXMpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAn5om+5LiN5Yiw6YCa55+l5YGP5aW96Kit5a6aJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IHByZWZlcmVuY2VzLmFkZERldmljZVRva2VuKHRva2VuLCBwbGF0Zm9ybSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ+ijnee9riBUb2tlbiDmlrDlop7miJDlip8nLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcign5paw5aKe6KOd572uIFRva2VuIEFQSSDpjK/oqqQnLCB7IGVycm9yLCB1c2VySWQ6IChyZXEgYXMgYW55KS51c2VyPy51c2VySWQgfSk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAn5Ly65pyN5Zmo5YWn6YOo6Yyv6KqkJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuKTtcblxuLyoqXG4gKiBAcm91dGUgREVMRVRFIC9hcGkvbm90aWZpY2F0aW9ucy9kZXZpY2UtdG9rZW5cbiAqIEBkZXNjIOenu+mZpOijnee9riBUb2tlblxuICogQGFjY2VzcyBQcml2YXRlXG4gKi9cbnJvdXRlci5kZWxldGUoXG4gICcvZGV2aWNlLXRva2VuJyxcbiAgYXV0aGVudGljYXRlLFxuICBbXG4gICAgYm9keSgndG9rZW4nKS50cmltKCkuaXNMZW5ndGgoeyBtaW46IDEgfSkud2l0aE1lc3NhZ2UoJ+ijnee9riBUb2tlbiDkuI3og73ngrrnqbonKSxcbiAgXSxcbiAgaGFuZGxlVmFsaWRhdGlvbkVycm9ycyxcbiAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VySWQgPSAocmVxIGFzIGFueSkudXNlci51c2VySWQ7XG4gICAgICBjb25zdCB7IHRva2VuIH0gPSByZXEuYm9keTtcblxuICAgICAgY29uc3QgcHJlZmVyZW5jZXMgPSBhd2FpdCBOb3RpZmljYXRpb25QcmVmZXJlbmNlLmZpbmRCeVVzZXJJZCh1c2VySWQpO1xuICAgICAgaWYgKCFwcmVmZXJlbmNlcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICfmib7kuI3liLDpgJrnn6XlgY/lpb3oqK3lrponLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgcHJlZmVyZW5jZXMucmVtb3ZlRGV2aWNlVG9rZW5zKFt0b2tlbl0pO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICfoo53nva4gVG9rZW4g56e76Zmk5oiQ5YqfJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ+enu+mZpOijnee9riBUb2tlbiBBUEkg6Yyv6KqkJywgeyBlcnJvciwgdXNlcklkOiAocmVxIGFzIGFueSkudXNlcj8udXNlcklkIH0pO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ+S8uuacjeWZqOWFp+mDqOmMr+iqpCcsXG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbik7XG5cbi8qKlxuICogQHJvdXRlIEdFVCAvYXBpL25vdGlmaWNhdGlvbnMvc3RhdHNcbiAqIEBkZXNjIOWPluW+l+mAmuefpee1seioiOizh+ioilxuICogQGFjY2VzcyBQcml2YXRlXG4gKi9cbnJvdXRlci5nZXQoXG4gICcvc3RhdHMnLFxuICBhdXRoZW50aWNhdGUsXG4gIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlcklkID0gKHJlcSBhcyBhbnkpLnVzZXIudXNlcklkO1xuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLmdldE5vdGlmaWNhdGlvblN0YXRzKHVzZXJJZCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ+WPluW+l+mAmuefpee1seioiOaIkOWKnycsXG4gICAgICAgIGRhdGE6IHN0YXRzLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcign5Y+W5b6X6YCa55+l57Wx6KiIIEFQSSDpjK/oqqQnLCB7IGVycm9yLCB1c2VySWQ6IChyZXEgYXMgYW55KS51c2VyPy51c2VySWQgfSk7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAn5Ly65pyN5Zmo5YWn6YOo6Yyv6KqkJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuKTtcblxuLyoqXG4gKiBAcm91dGUgUE9TVCAvYXBpL25vdGlmaWNhdGlvbnMvdGVzdFxuICogQGRlc2Mg55m86YCB5ris6Kmm6YCa55+l77yI5YOF6ZaL55m855Kw5aKD77yJXG4gKiBAYWNjZXNzIFByaXZhdGVcbiAqL1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gIHJvdXRlci5wb3N0KFxuICAgICcvdGVzdCcsXG4gICAgYXV0aGVudGljYXRlLFxuICAgIFtcbiAgICAgIGJvZHkoJ3R5cGUnKS5vcHRpb25hbCgpLmlzSW4oT2JqZWN0LnZhbHVlcyhOb3RpZmljYXRpb25UeXBlKSkud2l0aE1lc3NhZ2UoJ+mAmuefpemhnuWei+S4jeato+eiuicpLFxuICAgICAgYm9keSgncHJpb3JpdHknKS5vcHRpb25hbCgpLmlzSW4oT2JqZWN0LnZhbHVlcyhOb3RpZmljYXRpb25Qcmlvcml0eSkpLndpdGhNZXNzYWdlKCflhKrlhYjntJrkuI3mraPnoronKSxcbiAgICBdLFxuICAgIGhhbmRsZVZhbGlkYXRpb25FcnJvcnMsXG4gICAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlcklkID0gKHJlcSBhcyBhbnkpLnVzZXIudXNlcklkO1xuICAgICAgICBjb25zdCB7IHR5cGUgPSBOb3RpZmljYXRpb25UeXBlLlNZU1RFTV9VUERBVEUsIHByaW9yaXR5ID0gTm90aWZpY2F0aW9uUHJpb3JpdHkuTk9STUFMIH0gPSByZXEuYm9keTtcblxuICAgICAgICBjb25zdCBvcHRpb25zOiBOb3RpZmljYXRpb25PcHRpb25zID0ge1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICB0eXBlLFxuICAgICAgICAgIHRpdGxlOiAn5ris6Kmm6YCa55+lJyxcbiAgICAgICAgICBtZXNzYWdlOiAn6YCZ5piv5LiA5YCL5ris6Kmm6YCa55+l77yM55So5pa86amX6K2J6YCa55+l57O757Wx5piv5ZCm5q2j5bi46YGL5L2c44CCJyxcbiAgICAgICAgICBwcmlvcml0eSxcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB0ZXN0OiB0cnVlLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBOb3RpZmljYXRpb25TZXJ2aWNlLnNlbmROb3RpZmljYXRpb24ob3B0aW9ucyk7XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IHJlc3VsdC5zdWNjZXNzLFxuICAgICAgICAgIG1lc3NhZ2U6ICfmuKzoqabpgJrnn6XnmbzpgIHlrozmiJAnLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbklkOiByZXN1bHQubm90aWZpY2F0aW9uSWQsXG4gICAgICAgICAgICBjaGFubmVsczogcmVzdWx0LmNoYW5uZWxzLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ+eZvOmAgea4rOippumAmuefpSBBUEkg6Yyv6KqkJywgeyBlcnJvciwgdXNlcklkOiAocmVxIGFzIGFueSkudXNlcj8udXNlcklkIH0pO1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ+S8uuacjeWZqOWFp+mDqOmMr+iqpCcsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7Il0sInZlcnNpb24iOjN9