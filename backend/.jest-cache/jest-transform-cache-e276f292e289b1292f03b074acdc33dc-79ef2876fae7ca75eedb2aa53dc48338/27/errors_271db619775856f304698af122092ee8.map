{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\utils\\errors.ts","mappings":"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","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\utils\\errors.ts"],"sourcesContent":["/**\n * 錯誤代碼枚舉\n */\nexport enum ErrorCode {\n  // 通用錯誤\n  INTERNAL_SERVER_ERROR = \"INTERNAL_SERVER_ERROR\",\n  SERVICE_UNAVAILABLE = \"SERVICE_UNAVAILABLE\",\n\n  // 驗證錯誤\n  VALIDATION_ERROR = \"VALIDATION_ERROR\",\n  INVALID_INPUT = \"INVALID_INPUT\",\n  MISSING_REQUIRED_FIELD = \"MISSING_REQUIRED_FIELD\",\n\n  // 認證錯誤\n  AUTHENTICATION_FAILED = \"AUTHENTICATION_FAILED\",\n  INVALID_TOKEN = \"INVALID_TOKEN\",\n  TOKEN_EXPIRED = \"TOKEN_EXPIRED\",\n  INVALID_CREDENTIALS = \"INVALID_CREDENTIALS\",\n\n  // 授權錯誤\n  INSUFFICIENT_PERMISSIONS = \"INSUFFICIENT_PERMISSIONS\",\n  ACCESS_DENIED = \"ACCESS_DENIED\",\n\n  // 資源錯誤\n  RESOURCE_NOT_FOUND = \"RESOURCE_NOT_FOUND\",\n  RESOURCE_ALREADY_EXISTS = \"RESOURCE_ALREADY_EXISTS\",\n  RESOURCE_CONFLICT = \"RESOURCE_CONFLICT\",\n\n  // 業務邏輯錯誤\n  BUSINESS_RULE_VIOLATION = \"BUSINESS_RULE_VIOLATION\",\n  OPERATION_NOT_ALLOWED = \"OPERATION_NOT_ALLOWED\",\n\n  // 外部服務錯誤\n  EXTERNAL_SERVICE_ERROR = \"EXTERNAL_SERVICE_ERROR\",\n  DATABASE_ERROR = \"DATABASE_ERROR\",\n\n  // 速率限制\n  RATE_LIMIT_EXCEEDED = \"RATE_LIMIT_EXCEEDED\",\n}\n\n/**\n * 錯誤詳情介面\n */\nexport interface ErrorDetails {\n  field?: string;\n  value?: any;\n  constraint?: string;\n  code?: string;\n  [key: string]: any;\n}\n\n/**\n * 自定義錯誤類別\n */\nexport class AppError extends Error {\n  public readonly statusCode: number;\n  public readonly isOperational: boolean;\n  public readonly errorCode: ErrorCode;\n  public readonly details?: ErrorDetails[];\n  public readonly timestamp: string;\n\n  constructor(\n    message: string,\n    statusCode: number = 500,\n    errorCode: ErrorCode = ErrorCode.INTERNAL_SERVER_ERROR,\n    details?: ErrorDetails[],\n    isOperational: boolean = true,\n  ) {\n    super(message);\n\n    this.statusCode = statusCode;\n    this.errorCode = errorCode;\n    this.details = details;\n    this.isOperational = isOperational;\n    this.timestamp = new Date().toISOString();\n\n    // 確保錯誤堆疊追蹤正確\n    Error.captureStackTrace(this, this.constructor);\n  }\n\n  /**\n   * 轉換為 JSON 格式\n   */\n  toJSON() {\n    return {\n      message: this.message,\n      statusCode: this.statusCode,\n      errorCode: this.errorCode,\n      details: this.details,\n      timestamp: this.timestamp,\n      isOperational: this.isOperational,\n    };\n  }\n}\n\n/**\n * 驗證錯誤\n */\nexport class ValidationError extends AppError {\n  constructor(message: string = \"輸入資料驗證失敗\", details?: ErrorDetails[]) {\n    super(message, 400, ErrorCode.VALIDATION_ERROR, details);\n  }\n}\n\n/**\n * 認證錯誤\n */\nexport class AuthenticationError extends AppError {\n  constructor(\n    message: string = \"認證失敗\",\n    errorCode: ErrorCode = ErrorCode.AUTHENTICATION_FAILED,\n  ) {\n    super(message, 401, errorCode);\n  }\n}\n\n/**\n * 授權錯誤\n */\nexport class AuthorizationError extends AppError {\n  constructor(\n    message: string = \"權限不足\",\n    errorCode: ErrorCode = ErrorCode.INSUFFICIENT_PERMISSIONS,\n  ) {\n    super(message, 403, errorCode);\n  }\n}\n\n/**\n * 禁止訪問錯誤（AuthorizationError 的別名）\n */\nexport class ForbiddenError extends AuthorizationError {\n  constructor(message: string = \"禁止訪問\") {\n    super(message, ErrorCode.ACCESS_DENIED);\n  }\n}\n\n/**\n * 資源未找到錯誤\n */\nexport class NotFoundError extends AppError {\n  constructor(message: string = \"資源未找到\", details?: ErrorDetails[]) {\n    super(message, 404, ErrorCode.RESOURCE_NOT_FOUND, details);\n  }\n}\n\n/**\n * 衝突錯誤\n */\nexport class ConflictError extends AppError {\n  constructor(message: string = \"資源衝突\", details?: ErrorDetails[]) {\n    super(message, 409, ErrorCode.RESOURCE_CONFLICT, details);\n  }\n}\n\n/**\n * 速率限制錯誤\n */\nexport class RateLimitError extends AppError {\n  constructor(message: string = \"請求過於頻繁\", details?: ErrorDetails[]) {\n    super(message, 429, ErrorCode.RATE_LIMIT_EXCEEDED, details);\n  }\n}\n\n/**\n * 內部伺服器錯誤\n */\nexport class InternalServerError extends AppError {\n  constructor(message: string = \"內部伺服器錯誤\", details?: ErrorDetails[]) {\n    super(message, 500, ErrorCode.INTERNAL_SERVER_ERROR, details, false);\n  }\n}\n\n/**\n * 服務不可用錯誤\n */\nexport class ServiceUnavailableError extends AppError {\n  constructor(message: string = \"服務暫時不可用\", details?: ErrorDetails[]) {\n    super(message, 503, ErrorCode.SERVICE_UNAVAILABLE, details, false);\n  }\n}\n\n/**\n * 業務邏輯錯誤\n */\nexport class BusinessRuleError extends AppError {\n  constructor(message: string, details?: ErrorDetails[]) {\n    super(message, 400, ErrorCode.BUSINESS_RULE_VIOLATION, details);\n  }\n}\n\n/**\n * 外部服務錯誤\n */\nexport class ExternalServiceError extends AppError {\n  constructor(message: string = \"外部服務錯誤\", details?: ErrorDetails[]) {\n    super(message, 502, ErrorCode.EXTERNAL_SERVICE_ERROR, details, false);\n  }\n}\n\n/**\n * 資料庫錯誤\n */\nexport class DatabaseError extends AppError {\n  constructor(message: string = \"資料庫操作失敗\", details?: ErrorDetails[]) {\n    super(message, 500, ErrorCode.DATABASE_ERROR, details, false);\n  }\n}\n\n/**\n * 錯誤工廠函數\n */\nexport class ErrorFactory {\n  /**\n   * 創建驗證錯誤\n   */\n  static createValidationError(\n    message: string = \"輸入資料驗證失敗\",\n    field?: string,\n    value?: any,\n    constraint?: string,\n  ): ValidationError {\n    const details: ErrorDetails[] = [];\n    if (field) {\n      details.push({ field, value, constraint });\n    }\n    return new ValidationError(message, details);\n  }\n\n  /**\n   * 創建認證錯誤\n   */\n  static createAuthenticationError(\n    type:\n      | \"invalid_credentials\"\n      | \"invalid_token\"\n      | \"token_expired\" = \"invalid_credentials\",\n  ): AuthenticationError {\n    const messages = {\n      invalid_credentials: \"用戶名或密碼錯誤\",\n      invalid_token: \"無效的認證令牌\",\n      token_expired: \"認證令牌已過期\",\n    };\n\n    const errorCodes = {\n      invalid_credentials: ErrorCode.INVALID_CREDENTIALS,\n      invalid_token: ErrorCode.INVALID_TOKEN,\n      token_expired: ErrorCode.TOKEN_EXPIRED,\n    };\n\n    return new AuthenticationError(messages[type], errorCodes[type]);\n  }\n\n  /**\n   * 創建資源未找到錯誤\n   */\n  static createNotFoundError(\n    resource: string,\n    identifier?: string | number,\n  ): NotFoundError {\n    const message = identifier\n      ? `${resource} (${identifier}) 未找到`\n      : `${resource} 未找到`;\n\n    const details: ErrorDetails[] = [\n      {\n        resource,\n        identifier,\n      },\n    ];\n\n    return new NotFoundError(message, details);\n  }\n\n  /**\n   * 創建衝突錯誤\n   */\n  static createConflictError(\n    resource: string,\n    field: string,\n    value: any,\n  ): ConflictError {\n    const message = `${resource} 的 ${field} 已存在`;\n    const details: ErrorDetails[] = [\n      {\n        resource,\n        field,\n        value,\n        constraint: \"unique\",\n      },\n    ];\n\n    return new ConflictError(message, details);\n  }\n\n  /**\n   * 創建速率限制錯誤\n   */\n  static createRateLimitError(\n    message: string = \"請求過於頻繁，請稍後再試\",\n    details?: ErrorDetails[],\n  ): RateLimitError {\n    return new RateLimitError(message, details);\n  }\n\n  /**\n   * 從 Mongoose 錯誤創建 AppError\n   */\n  static fromMongooseError(error: any): AppError {\n    if (error.name === \"ValidationError\") {\n      const details: ErrorDetails[] = Object.values(error.errors).map(\n        (err: any) => ({\n          field: err.path,\n          value: err.value,\n          constraint: err.kind,\n          message: err.message,\n        }),\n      );\n      return new ValidationError(\"資料驗證失敗\", details);\n    }\n\n    if (error.name === \"MongoServerError\" && error.code === 11000) {\n      const field = Object.keys(error.keyValue || {})[0];\n      if (field) {\n        const value = error.keyValue[field];\n        return ErrorFactory.createConflictError(\"資源\", field, value);\n      }\n      return new ConflictError(\"資源衝突\");\n    }\n\n    if (error.name === \"CastError\") {\n      const details: ErrorDetails[] = [\n        {\n          field: error.path,\n          value: error.value,\n          constraint: \"type\",\n          message: \"無效的資料格式\",\n        },\n      ];\n      return new ValidationError(\"無效的資料格式\", details);\n    }\n\n    return new DatabaseError(error.message);\n  }\n\n  /**\n   * 從 Zod 錯誤創建 ValidationError\n   */\n  static fromZodError(error: any): ValidationError {\n    const details: ErrorDetails[] = error.errors.map((err: any) => ({\n      field: err.path.join(\".\"),\n      value: err.received,\n      constraint: err.code,\n      message: err.message,\n    }));\n    return new ValidationError(\"輸入資料驗證失敗\", details);\n  }\n}\n\n/**\n * 檢查錯誤是否為操作性錯誤\n */\nexport const isOperationalError = (error: Error): boolean => {\n  if (error instanceof AppError) {\n    return error.isOperational;\n  }\n  return false;\n};\n\n/**\n * 格式化錯誤響應\n */\nexport const formatErrorResponse = (\n  error: AppError,\n  includeStack: boolean = false,\n) => {\n  const response: any = {\n    success: false,\n    error: {\n      message: error.message,\n      code: error.errorCode,\n      statusCode: error.statusCode,\n      timestamp: error.timestamp,\n    },\n  };\n\n  if (error.details && error.details.length > 0) {\n    response.error.details = error.details;\n  }\n\n  if (includeStack && error.stack) {\n    response.error.stack = error.stack;\n  }\n\n  return response;\n};\n\n/**\n * 錯誤日誌格式化\n */\nexport const formatErrorForLogging = (\n  error: Error,\n  context?: Record<string, any>,\n) => {\n  const logData: any = {\n    message: error.message,\n    name: error.name,\n    stack: error.stack,\n  };\n\n  if (error instanceof AppError) {\n    logData.errorCode = error.errorCode;\n    logData.statusCode = error.statusCode;\n    logData.isOperational = error.isOperational;\n    logData.details = error.details;\n  }\n\n  if (context) {\n    logData.context = context;\n  }\n\n  return logData;\n};\n"],"version":3}