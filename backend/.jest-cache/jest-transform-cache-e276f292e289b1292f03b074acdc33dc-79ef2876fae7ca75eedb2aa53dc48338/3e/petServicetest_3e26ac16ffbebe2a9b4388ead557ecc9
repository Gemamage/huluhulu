c21a65b09e4e4e6c91049029445d0a96
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// petService 單元測試 - 簡化版本，不依賴數據庫
const globals_1 = require("@jest/globals");
// 模擬外部依賴
globals_1.jest.mock('../../src/models/Pet');
globals_1.jest.mock('../../src/models/User');
globals_1.jest.mock('../../src/services/cloudinaryService');
globals_1.jest.mock('../../src/services/aiService');
globals_1.jest.mock('../../src/utils/logger');
// 設置測試環境變數
process.env.NODE_ENV = 'test';
process.env.JWT_SECRET = 'test-jwt-secret-key-with-minimum-32-characters-length';
// 導入要測試的服務
const petService_1 = require("../../src/services/petService");
// 模擬的 Pet 模型
const mockPet = {
    _id: '507f1f77bcf86cd799439011',
    name: '小白',
    type: 'dog',
    breed: '拉布拉多',
    status: 'lost',
    owner: '507f1f77bcf86cd799439012',
    save: globals_1.jest.fn(),
    populate: globals_1.jest.fn().mockReturnThis(),
    createdAt: new Date(),
    updatedAt: new Date()
};
// 模擬的 User 模型
const mockUser = {
    _id: '507f1f77bcf86cd799439012',
    username: 'testuser',
    email: 'test@example.com'
};
// 創建模擬構造函數
const MockPet = globals_1.jest.fn().mockImplementation((data) => ({
    ...mockPet,
    ...data,
    save: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...data }),
    populate: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...data })
}));
// 添加靜態方法到模擬構造函數
MockPet.findById = globals_1.jest.fn().mockReturnValue({
    populate: globals_1.jest.fn().mockReturnValue({
        exec: globals_1.jest.fn().mockResolvedValue(mockPet)
    })
});
MockPet.findOne = globals_1.jest.fn();
MockPet.findByIdAndUpdate = globals_1.jest.fn();
MockPet.findByIdAndDelete = globals_1.jest.fn();
MockPet.find = globals_1.jest.fn();
MockPet.countDocuments = globals_1.jest.fn();
MockPet.deleteMany = globals_1.jest.fn();
// 模擬 User 模型的靜態方法
const MockUser = {
    findById: globals_1.jest.fn(),
    deleteMany: globals_1.jest.fn()
};
// 模擬 CloudinaryService
const MockCloudinaryService = {
    uploadImage: globals_1.jest.fn(),
    deleteImage: globals_1.jest.fn()
};
// 模擬 aiService
const MockAiService = {
    analyzeImage: globals_1.jest.fn()
};
// 設置模擬
globals_1.jest.doMock('../../src/models/Pet', () => ({ Pet: MockPet }));
globals_1.jest.doMock('../../src/models/User', () => ({ User: MockUser }));
globals_1.jest.doMock('../../src/services/cloudinaryService', () => ({ CloudinaryService: MockCloudinaryService }));
globals_1.jest.doMock('../../src/services/aiService', () => ({ aiService: MockAiService }));
(0, globals_1.describe)('PetService 測試', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        // 設置預設的模擬回應
        MockUser.findById.mockResolvedValue(mockUser);
        MockPet.findById.mockReturnValue({
            populate: globals_1.jest.fn().mockReturnValue({
                exec: globals_1.jest.fn().mockResolvedValue(mockPet)
            })
        });
        mockPet.save.mockResolvedValue(mockPet);
        mockPet.populate.mockResolvedValue(mockPet);
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.restoreAllMocks();
    });
    (0, globals_1.describe)('createPet', () => {
        const petData = {
            name: '小花',
            type: 'cat',
            breed: '波斯貓',
            status: 'lost',
            description: '走失的小貓',
            location: {
                address: '台北市信義區',
                city: '台北市',
                coordinates: [121.5654, 25.0330]
            },
            contact: {
                phone: '0912345678',
                email: 'owner@example.com'
            }
        };
        (0, globals_1.it)('應該成功創建寵物', async () => {
            const result = await petService_1.PetService.createPet('507f1f77bcf86cd799439012', petData);
            (0, globals_1.expect)(MockUser.findById).toHaveBeenCalledWith('507f1f77bcf86cd799439012');
            (0, globals_1.expect)(MockPet).toHaveBeenCalled();
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result.name).toBe(petData.name);
        });
        (0, globals_1.it)('應該在擁有者不存在時拋出錯誤', async () => {
            MockUser.findById.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.createPet('507f1f77bcf86cd799439999', petData))
                .rejects.toThrow('擁有者不存在');
        });
        (0, globals_1.it)('應該處理圖片上傳', async () => {
            const petDataWithImages = {
                ...petData,
                images: ['image1.jpg', 'image2.jpg']
            };
            MockCloudinaryService.uploadImage.mockResolvedValue({
                secure_url: 'https://cloudinary.com/test.jpg',
                public_id: 'test_id',
                width: 800,
                height: 600
            });
            await petService_1.PetService.createPet('507f1f77bcf86cd799439012', petDataWithImages);
            (0, globals_1.expect)(MockCloudinaryService.uploadImage).toHaveBeenCalledTimes(2);
        });
    });
    (0, globals_1.describe)('getPetById', () => {
        (0, globals_1.it)('應該成功根據ID獲取寵物', async () => {
            const result = await petService_1.PetService.getPetById('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(MockPet.findById).toHaveBeenCalledWith('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result?._id).toBe('507f1f77bcf86cd799439011');
        });
        (0, globals_1.it)('應該在ID無效時拋出錯誤', async () => {
            await (0, globals_1.expect)(petService_1.PetService.getPetById('invalid-id'))
                .rejects.toThrow('無效的寵物 ID');
        });
        (0, globals_1.it)('應該返回null當寵物不存在', async () => {
            MockPet.findById.mockReturnValue({
                populate: globals_1.jest.fn().mockReturnValue({
                    exec: globals_1.jest.fn().mockResolvedValue(null)
                })
            });
            const result = await petService_1.PetService.getPetById('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)('updatePet', () => {
        const updateData = {
            name: '更新的小白',
            description: '更新的描述'
        };
        (0, globals_1.it)('應該成功更新寵物', async () => {
            MockPet.findOne.mockResolvedValue(mockPet);
            MockPet.findByIdAndUpdate.mockReturnValue({
                populate: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...updateData })
            });
            const result = await petService_1.PetService.updatePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012', updateData);
            (0, globals_1.expect)(MockPet.findOne).toHaveBeenCalledWith({ _id: '507f1f77bcf86cd799439011', owner: '507f1f77bcf86cd799439012' });
            (0, globals_1.expect)(MockPet.findByIdAndUpdate).toHaveBeenCalled();
            (0, globals_1.expect)(result?.name).toBe(updateData.name);
        });
        (0, globals_1.it)('應該在寵物不存在時拋出錯誤', async () => {
            MockPet.findOne.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.updatePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012', updateData))
                .rejects.toThrow('寵物不存在或您沒有權限修改');
        });
    });
    (0, globals_1.describe)('deletePet', () => {
        (0, globals_1.it)('應該成功刪除寵物', async () => {
            MockPet.findOne.mockResolvedValue({
                ...mockPet,
                images: [{ publicId: 'test_id', url: 'test.jpg' }]
            });
            MockPet.findByIdAndDelete.mockResolvedValue(mockPet);
            MockCloudinaryService.deleteImage.mockResolvedValue(true);
            const result = await petService_1.PetService.deletePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012');
            (0, globals_1.expect)(MockPet.findOne).toHaveBeenCalledWith({ _id: '507f1f77bcf86cd799439011', owner: '507f1f77bcf86cd799439012' });
            (0, globals_1.expect)(MockPet.findByIdAndDelete).toHaveBeenCalledWith('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(MockCloudinaryService.deleteImage).toHaveBeenCalledWith('test_id');
            (0, globals_1.expect)(result).toBe(true);
        });
        (0, globals_1.it)('應該在寵物不存在時拋出錯誤', async () => {
            MockPet.findOne.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.deletePet('507f1f77bcf86cd799439011', '507f1f77bcf86cd799439012'))
                .rejects.toThrow('寵物不存在或您沒有權限刪除');
        });
    });
    (0, globals_1.describe)('getAllPets', () => {
        (0, globals_1.it)('應該成功獲取所有寵物', async () => {
            const mockPets = [mockPet, { ...mockPet, _id: '507f1f77bcf86cd799439013', name: '小黑' }];
            MockPet.find.mockReturnValue({
                populate: globals_1.jest.fn().mockReturnValue({
                    sort: globals_1.jest.fn().mockReturnValue({
                        skip: globals_1.jest.fn().mockReturnValue({
                            limit: globals_1.jest.fn().mockReturnValue({
                                exec: globals_1.jest.fn().mockResolvedValue(mockPets)
                            })
                        })
                    })
                })
            });
            MockPet.countDocuments.mockResolvedValue(2);
            const result = await petService_1.PetService.getAllPets(1, 10);
            (0, globals_1.expect)(result.pets).toHaveLength(2);
            (0, globals_1.expect)(result.total).toBe(2);
            (0, globals_1.expect)(result.page).toBe(1);
            (0, globals_1.expect)(result.totalPages).toBe(1);
        });
    });
    (0, globals_1.describe)('incrementViewCount', () => {
        (0, globals_1.it)('應該成功增加瀏覽次數', async () => {
            MockPet.findByIdAndUpdate.mockResolvedValue(mockPet);
            await petService_1.PetService.incrementViewCount('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(MockPet.findByIdAndUpdate).toHaveBeenCalledWith('507f1f77bcf86cd799439011', { $inc: { viewCount: 1 } }, { new: true });
        });
    });
    (0, globals_1.describe)('incrementShareCount', () => {
        (0, globals_1.it)('應該成功增加分享次數', async () => {
            MockPet.findByIdAndUpdate.mockResolvedValue(mockPet);
            await petService_1.PetService.incrementShareCount('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(MockPet.findByIdAndUpdate).toHaveBeenCalledWith('507f1f77bcf86cd799439011', { $inc: { shareCount: 1 } }, { new: true });
        });
    });
});
console.log('✅ petService 測試檔案已載入');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXJ2aWNlc1xccGV0U2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsZ0NBQWdDO0FBQ2hDLDJDQUFrRjtBQU1sRixTQUFTO0FBQ1QsY0FBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2xDLGNBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNuQyxjQUFJLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFDbEQsY0FBSSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQzFDLGNBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQVRwQyxXQUFXO0FBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO0FBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLHVEQUF1RCxDQUFDO0FBU2pGLFdBQVc7QUFDWCw4REFBeUY7QUFFekYsYUFBYTtBQUNiLE1BQU0sT0FBTyxHQUFHO0lBQ2QsR0FBRyxFQUFFLDBCQUEwQjtJQUMvQixJQUFJLEVBQUUsSUFBSTtJQUNWLElBQUksRUFBRSxLQUFLO0lBQ1gsS0FBSyxFQUFFLE1BQU07SUFDYixNQUFNLEVBQUUsTUFBTTtJQUNkLEtBQUssRUFBRSwwQkFBMEI7SUFDakMsSUFBSSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixRQUFRLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGNBQWMsRUFBRTtJQUNwQyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7SUFDckIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO0NBQ3RCLENBQUM7QUFFRixjQUFjO0FBQ2QsTUFBTSxRQUFRLEdBQUc7SUFDZixHQUFHLEVBQUUsMEJBQTBCO0lBQy9CLFFBQVEsRUFBRSxVQUFVO0lBQ3BC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QUFDLENBQUM7WUFFckQsTUFBTSx1QkFBVSxDQUFDLG1CQUFtQixDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFFaEUsSUFBQSxnQkFBTSxFQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLG9CQUFvQixDQUNwRCwwQkFBMEIsRUFDM0IsRUFBRSxJQUFJLEVBQUUsRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFDM0IsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQ2QsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ04sQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXFVzZXJcXERlc2t0b3BcXHRyYWVwcm9qZWN0XFx0ZXN0MlxccGV0LWZpbmRlci1hcHBcXGJhY2tlbmRcXHRlc3RcXHNlcnZpY2VzXFxwZXRTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGV0U2VydmljZSDllq7lhYPmuKzoqaYgLSDnsKHljJbniYjmnKzvvIzkuI3kvp3os7Tmlbjmk5rluqtcbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBqZXN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuLy8g6Kit572u5ris6Kmm55Kw5aKD6K6K5pW4XG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbnByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPSAndGVzdC1qd3Qtc2VjcmV0LWtleS13aXRoLW1pbmltdW0tMzItY2hhcmFjdGVycy1sZW5ndGgnO1xuXG4vLyDmqKHmk6zlpJbpg6jkvp3os7Rcbmplc3QubW9jaygnLi4vLi4vc3JjL21vZGVscy9QZXQnKTtcbmplc3QubW9jaygnLi4vLi4vc3JjL21vZGVscy9Vc2VyJyk7XG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9zZXJ2aWNlcy9jbG91ZGluYXJ5U2VydmljZScpO1xuamVzdC5tb2NrKCcuLi8uLi9zcmMvc2VydmljZXMvYWlTZXJ2aWNlJyk7XG5qZXN0Lm1vY2soJy4uLy4uL3NyYy91dGlscy9sb2dnZXInKTtcblxuLy8g5bCO5YWl6KaB5ris6Kmm55qE5pyN5YuZXG5pbXBvcnQgeyBQZXRTZXJ2aWNlLCBDcmVhdGVQZXREYXRhLCBVcGRhdGVQZXREYXRhIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL3BldFNlcnZpY2UnO1xuXG4vLyDmqKHmk6znmoQgUGV0IOaooeWei1xuY29uc3QgbW9ja1BldCA9IHtcbiAgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyxcbiAgbmFtZTogJ+Wwj+eZvScsXG4gIHR5cGU6ICdkb2cnLFxuICBicmVlZDogJ+aLieW4g+aLieWkmicsXG4gIHN0YXR1czogJ2xvc3QnLFxuICBvd25lcjogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicsXG4gIHNhdmU6IGplc3QuZm4oKSxcbiAgcG9wdWxhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxufTtcblxuLy8g5qih5pOs55qEIFVzZXIg5qih5Z6LXG5jb25zdCBtb2NrVXNlciA9IHtcbiAgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJyxcbiAgdXNlcm5hbWU6ICd0ZXN0dXNlcicsXG4gIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbSdcbn07XG5cbi8vIOWJteW7uuaooeaTrOani+mAoOWHveaVuFxuY29uc3QgTW9ja1BldCA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGRhdGEpID0+ICh7XG4gIC4uLm1vY2tQZXQsXG4gIC4uLmRhdGEsXG4gIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLm1vY2tQZXQsIC4uLmRhdGEgfSksXG4gIHBvcHVsYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyAuLi5tb2NrUGV0LCAuLi5kYXRhIH0pXG59KSk7XG5cbi8vIOa3u+WKoOmdnOaFi+aWueazleWIsOaooeaTrOani+mAoOWHveaVuFxuTW9ja1BldC5maW5kQnlJZCA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgZXhlYzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpXG4gIH0pXG59KTtcbk1vY2tQZXQuZmluZE9uZSA9IGplc3QuZm4oKTtcbk1vY2tQZXQuZmluZEJ5SWRBbmRVcGRhdGUgPSBqZXN0LmZuKCk7XG5Nb2NrUGV0LmZpbmRCeUlkQW5kRGVsZXRlID0gamVzdC5mbigpO1xuTW9ja1BldC5maW5kID0gamVzdC5mbigpO1xuTW9ja1BldC5jb3VudERvY3VtZW50cyA9IGplc3QuZm4oKTtcbk1vY2tQZXQuZGVsZXRlTWFueSA9IGplc3QuZm4oKTtcblxuLy8g5qih5pOsIFVzZXIg5qih5Z6L55qE6Z2c5oWL5pa55rOVXG5jb25zdCBNb2NrVXNlciA9IHtcbiAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgZGVsZXRlTWFueTogamVzdC5mbigpXG59O1xuXG4vLyDmqKHmk6wgQ2xvdWRpbmFyeVNlcnZpY2VcbmNvbnN0IE1vY2tDbG91ZGluYXJ5U2VydmljZSA9IHtcbiAgdXBsb2FkSW1hZ2U6IGplc3QuZm4oKSxcbiAgZGVsZXRlSW1hZ2U6IGplc3QuZm4oKVxufTtcblxuLy8g5qih5pOsIGFpU2VydmljZVxuY29uc3QgTW9ja0FpU2VydmljZSA9IHtcbiAgYW5hbHl6ZUltYWdlOiBqZXN0LmZuKClcbn07XG5cbi8vIOioree9ruaooeaTrFxuamVzdC5kb01vY2soJy4uLy4uL3NyYy9tb2RlbHMvUGV0JywgKCkgPT4gKHsgUGV0OiBNb2NrUGV0IH0pKTtcbmplc3QuZG9Nb2NrKCcuLi8uLi9zcmMvbW9kZWxzL1VzZXInLCAoKSA9PiAoeyBVc2VyOiBNb2NrVXNlciB9KSk7XG5qZXN0LmRvTW9jaygnLi4vLi4vc3JjL3NlcnZpY2VzL2Nsb3VkaW5hcnlTZXJ2aWNlJywgKCkgPT4gKHsgQ2xvdWRpbmFyeVNlcnZpY2U6IE1vY2tDbG91ZGluYXJ5U2VydmljZSB9KSk7XG5qZXN0LmRvTW9jaygnLi4vLi4vc3JjL3NlcnZpY2VzL2FpU2VydmljZScsICgpID0+ICh7IGFpU2VydmljZTogTW9ja0FpU2VydmljZSB9KSk7XG5cbmRlc2NyaWJlKCdQZXRTZXJ2aWNlIOa4rOippicsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgXG4gICAgLy8g6Kit572u6aCQ6Kit55qE5qih5pOs5Zue5oeJXG4gICAgTW9ja1VzZXIuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgIE1vY2tQZXQuZmluZEJ5SWQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIHBvcHVsYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgZXhlYzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpXG4gICAgICB9KVxuICAgIH0pO1xuICAgIG1vY2tQZXQuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0KTtcbiAgICBtb2NrUGV0LnBvcHVsYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICB9KTtcbiAgXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZVBldCcsICgpID0+IHtcbiAgICBjb25zdCBwZXREYXRhOiBDcmVhdGVQZXREYXRhID0ge1xuICAgICAgbmFtZTogJ+Wwj+iKsScsXG4gICAgICB0eXBlOiAnY2F0JyxcbiAgICAgIGJyZWVkOiAn5rOi5pav6LKTJyxcbiAgICAgIHN0YXR1czogJ2xvc3QnLFxuICAgICAgZGVzY3JpcHRpb246ICfotbDlpLHnmoTlsI/ospMnLFxuICAgICAgbG9jYXRpb246IHtcbiAgICAgICAgYWRkcmVzczogJ+WPsOWMl+W4guS/oee+qeWNgCcsXG4gICAgICAgIGNpdHk6ICflj7DljJfluIInLFxuICAgICAgICBjb29yZGluYXRlczogWzEyMS41NjU0LCAyNS4wMzMwXVxuICAgICAgfSxcbiAgICAgIGNvbnRhY3Q6IHtcbiAgICAgICAgcGhvbmU6ICcwOTEyMzQ1Njc4JyxcbiAgICAgICAgZW1haWw6ICdvd25lckBleGFtcGxlLmNvbSdcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaXQoJ+aHieipsuaIkOWKn+WJteW7uuWvteeJqScsIGFzeW5jICgpID0+IHtcbiAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQZXRTZXJ2aWNlLmNyZWF0ZVBldCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJywgcGV0RGF0YSk7XG4gICAgICAgXG4gICAgICAgZXhwZWN0KE1vY2tVc2VyLmZpbmRCeUlkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEyJyk7XG4gICAgICAgZXhwZWN0KE1vY2tQZXQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgIGV4cGVjdChyZXN1bHQubmFtZSkudG9CZShwZXREYXRhLm5hbWUpO1xuICAgICB9KTtcblxuICAgIGl0KCfmh4noqbLlnKjmk4HmnInogIXkuI3lrZjlnKjmmYLmi4vlh7rpjK/oqqQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgTW9ja1VzZXIuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICAgXG4gICAgICAgYXdhaXQgZXhwZWN0KFBldFNlcnZpY2UuY3JlYXRlUGV0KCc1MDdmMWY3N2JjZjg2Y2Q3OTk0Mzk5OTknLCBwZXREYXRhKSlcbiAgICAgICAgICAucmVqZWN0cy50b1Rocm93KCfmk4HmnInogIXkuI3lrZjlnKgnKTtcbiAgICAgfSk7XG5cbiAgICBpdCgn5oeJ6Kmy6JmV55CG5ZyW54mH5LiK5YKzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0RGF0YVdpdGhJbWFnZXMgPSB7XG4gICAgICAgIC4uLnBldERhdGEsXG4gICAgICAgIGltYWdlczogWydpbWFnZTEuanBnJywgJ2ltYWdlMi5qcGcnXVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgTW9ja0Nsb3VkaW5hcnlTZXJ2aWNlLnVwbG9hZEltYWdlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgIHNlY3VyZV91cmw6ICdodHRwczovL2Nsb3VkaW5hcnkuY29tL3Rlc3QuanBnJyxcbiAgICAgICAgIHB1YmxpY19pZDogJ3Rlc3RfaWQnLFxuICAgICAgICAgd2lkdGg6IDgwMCxcbiAgICAgICAgIGhlaWdodDogNjAwXG4gICAgICAgfSk7XG4gICAgICAgXG4gICAgICAgYXdhaXQgUGV0U2VydmljZS5jcmVhdGVQZXQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicsIHBldERhdGFXaXRoSW1hZ2VzKTtcbiAgICAgICBcbiAgICAgICBleHBlY3QoTW9ja0Nsb3VkaW5hcnlTZXJ2aWNlLnVwbG9hZEltYWdlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQZXRCeUlkJywgKCkgPT4ge1xuICAgIGl0KCfmh4noqbLmiJDlip/moLnmk5pJROeNsuWPluWvteeJqScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuZ2V0UGV0QnlJZCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoTW9ja1BldC5maW5kQnlJZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0Py5faWQpLnRvQmUoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+aHieipsuWcqElE54Sh5pWI5pmC5ouL5Ye66Yyv6KqkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KFBldFNlcnZpY2UuZ2V0UGV0QnlJZCgnaW52YWxpZC1pZCcpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCfnhKHmlYjnmoTlr7XniakgSUQnKTtcbiAgICB9KTtcblxuICAgIGl0KCfmh4noqbLov5Tlm55udWxs55W25a+154mp5LiN5a2Y5ZyoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgIE1vY2tQZXQuZmluZEJ5SWQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgIHBvcHVsYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgZXhlYzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpXG4gICAgICAgICB9KVxuICAgICAgIH0pO1xuICAgICAgIFxuICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuZ2V0UGV0QnlJZCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG4gICAgICAgXG4gICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGVQZXQnLCAoKSA9PiB7XG4gICAgY29uc3QgdXBkYXRlRGF0YTogVXBkYXRlUGV0RGF0YSA9IHtcbiAgICAgIG5hbWU6ICfmm7TmlrDnmoTlsI/nmb0nLFxuICAgICAgZGVzY3JpcHRpb246ICfmm7TmlrDnmoTmj4/ov7AnXG4gICAgfTtcblxuICAgIGl0KCfmh4noqbLmiJDlip/mm7TmlrDlr7XniaknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgTW9ja1BldC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICAgICAgIE1vY2tQZXQuZmluZEJ5SWRBbmRVcGRhdGUubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgIHBvcHVsYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyAuLi5tb2NrUGV0LCAuLi51cGRhdGVEYXRhIH0pXG4gICAgICAgfSk7XG4gICAgICAgXG4gICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUGV0U2VydmljZS51cGRhdGVQZXQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScsICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTInLCB1cGRhdGVEYXRhKTtcbiAgICAgICAgXG4gICAgICAgIGV4cGVjdChNb2NrUGV0LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywgb3duZXI6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTInIH0pO1xuICAgICAgIGV4cGVjdChNb2NrUGV0LmZpbmRCeUlkQW5kVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgZXhwZWN0KHJlc3VsdD8ubmFtZSkudG9CZSh1cGRhdGVEYXRhLm5hbWUpO1xuICAgICB9KTtcblxuICAgIGl0KCfmh4noqbLlnKjlr7XniankuI3lrZjlnKjmmYLmi4vlh7rpjK/oqqQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgTW9ja1BldC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgIFxuICAgICAgIGF3YWl0IGV4cGVjdChQZXRTZXJ2aWNlLnVwZGF0ZVBldCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywgJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicsIHVwZGF0ZURhdGEpKVxuICAgICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ+WvteeJqeS4jeWtmOWcqOaIluaCqOaykuacieasiumZkOS/ruaUuScpO1xuICAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGV0ZVBldCcsICgpID0+IHtcbiAgICBpdCgn5oeJ6Kmy5oiQ5Yqf5Yiq6Zmk5a+154mpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgIE1vY2tQZXQuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAuLi5tb2NrUGV0LFxuICAgICAgICAgaW1hZ2VzOiBbeyBwdWJsaWNJZDogJ3Rlc3RfaWQnLCB1cmw6ICd0ZXN0LmpwZycgfV1cbiAgICAgICB9KTtcbiAgICAgICBNb2NrUGV0LmZpbmRCeUlkQW5kRGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICAgICAgIE1vY2tDbG91ZGluYXJ5U2VydmljZS5kZWxldGVJbWFnZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgICBcbiAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQZXRTZXJ2aWNlLmRlbGV0ZVBldCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywgJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KE1vY2tQZXQuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBfaWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLCBvd25lcjogJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicgfSk7XG4gICAgICAgIGV4cGVjdChNb2NrUGV0LmZpbmRCeUlkQW5kRGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG4gICAgICAgZXhwZWN0KE1vY2tDbG91ZGluYXJ5U2VydmljZS5kZWxldGVJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3RfaWQnKTtcbiAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICB9KTtcblxuICAgIGl0KCfmh4noqbLlnKjlr7XniankuI3lrZjlnKjmmYLmi4vlh7rpjK/oqqQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgTW9ja1BldC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgIFxuICAgICAgIGF3YWl0IGV4cGVjdChQZXRTZXJ2aWNlLmRlbGV0ZVBldCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywgJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMicpKVxuICAgICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ+WvteeJqeS4jeWtmOWcqOaIluaCqOaykuacieasiumZkOWIqumZpCcpO1xuICAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEFsbFBldHMnLCAoKSA9PiB7XG4gICAgaXQoJ+aHieipsuaIkOWKn+eNsuWPluaJgOacieWvteeJqScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQZXRzID0gW21vY2tQZXQsIHsgLi4ubW9ja1BldCwgX2lkOiAnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDEzJywgbmFtZTogJ+Wwj+m7kScgfV07XG4gICAgICBcbiAgICAgIE1vY2tQZXQuZmluZC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgcG9wdWxhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICBzb3J0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICBza2lwOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICAgIGxpbWl0OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICAgICAgZXhlYzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXRzKVxuICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICB9KVxuICAgICAgICAgICB9KVxuICAgICAgICAgfSlcbiAgICAgICB9KTtcbiAgICAgICBcbiAgICAgICBNb2NrUGV0LmNvdW50RG9jdW1lbnRzLm1vY2tSZXNvbHZlZFZhbHVlKDIpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQZXRTZXJ2aWNlLmdldEFsbFBldHMoMSwgMTApO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnBldHMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWwpLnRvQmUoMik7XG4gICAgICBleHBlY3QocmVzdWx0LnBhZ2UpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsUGFnZXMpLnRvQmUoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbmNyZW1lbnRWaWV3Q291bnQnLCAoKSA9PiB7XG4gICAgaXQoJ+aHieipsuaIkOWKn+WinuWKoOeAj+imveasoeaVuCcsIGFzeW5jICgpID0+IHtcbiAgICAgICBNb2NrUGV0LmZpbmRCeUlkQW5kVXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICAgICAgICBcbiAgICAgICAgYXdhaXQgUGV0U2VydmljZS5pbmNyZW1lbnRWaWV3Q291bnQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KE1vY2tQZXQuZmluZEJ5SWRBbmRVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLFxuICAgICAgICAgeyAkaW5jOiB7IHZpZXdDb3VudDogMSB9IH0sXG4gICAgICAgICB7IG5ldzogdHJ1ZSB9XG4gICAgICAgKTtcbiAgICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbmNyZW1lbnRTaGFyZUNvdW50JywgKCkgPT4ge1xuICAgIGl0KCfmh4noqbLmiJDlip/lop7liqDliIbkuqvmrKHmlbgnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgTW9ja1BldC5maW5kQnlJZEFuZFVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0KTtcbiAgICAgICBcbiAgICAgICBhd2FpdCBQZXRTZXJ2aWNlLmluY3JlbWVudFNoYXJlQ291bnQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KE1vY2tQZXQuZmluZEJ5SWRBbmRVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLFxuICAgICAgICAgeyAkaW5jOiB7IHNoYXJlQ291bnQ6IDEgfSB9LFxuICAgICAgICAgeyBuZXc6IHRydWUgfVxuICAgICAgICk7XG4gICAgIH0pO1xuICB9KTtcbn0pO1xuXG5jb25zb2xlLmxvZygn4pyFIHBldFNlcnZpY2Ug5ris6Kmm5qqU5qGI5bey6LyJ5YWlJyk7Il0sInZlcnNpb24iOjN9