6a93cf07ed4f8ee60074a05d6be937c2
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.formatErrorForLogging = exports.formatErrorResponse = exports.isOperationalError = exports.ErrorFactory = exports.DatabaseError = exports.ExternalServiceError = exports.BusinessRuleError = exports.ServiceUnavailableError = exports.InternalServerError = exports.RateLimitError = exports.ConflictError = exports.NotFoundError = exports.ForbiddenError = exports.AuthorizationError = exports.AuthenticationError = exports.ValidationError = exports.AppError = exports.ErrorCode = void 0;
/**
 * 錯誤代碼枚舉
 */
var ErrorCode;
(function (ErrorCode) {
    // 通用錯誤
    ErrorCode["INTERNAL_SERVER_ERROR"] = "INTERNAL_SERVER_ERROR";
    ErrorCode["SERVICE_UNAVAILABLE"] = "SERVICE_UNAVAILABLE";
    // 驗證錯誤
    ErrorCode["VALIDATION_ERROR"] = "VALIDATION_ERROR";
    ErrorCode["INVALID_INPUT"] = "INVALID_INPUT";
    ErrorCode["MISSING_REQUIRED_FIELD"] = "MISSING_REQUIRED_FIELD";
    // 認證錯誤
    ErrorCode["AUTHENTICATION_FAILED"] = "AUTHENTICATION_FAILED";
    ErrorCode["INVALID_TOKEN"] = "INVALID_TOKEN";
    ErrorCode["TOKEN_EXPIRED"] = "TOKEN_EXPIRED";
    ErrorCode["INVALID_CREDENTIALS"] = "INVALID_CREDENTIALS";
    // 授權錯誤
    ErrorCode["INSUFFICIENT_PERMISSIONS"] = "INSUFFICIENT_PERMISSIONS";
    ErrorCode["ACCESS_DENIED"] = "ACCESS_DENIED";
    // 資源錯誤
    ErrorCode["RESOURCE_NOT_FOUND"] = "RESOURCE_NOT_FOUND";
    ErrorCode["RESOURCE_ALREADY_EXISTS"] = "RESOURCE_ALREADY_EXISTS";
    ErrorCode["RESOURCE_CONFLICT"] = "RESOURCE_CONFLICT";
    // 業務邏輯錯誤
    ErrorCode["BUSINESS_RULE_VIOLATION"] = "BUSINESS_RULE_VIOLATION";
    ErrorCode["OPERATION_NOT_ALLOWED"] = "OPERATION_NOT_ALLOWED";
    // 外部服務錯誤
    ErrorCode["EXTERNAL_SERVICE_ERROR"] = "EXTERNAL_SERVICE_ERROR";
    ErrorCode["DATABASE_ERROR"] = "DATABASE_ERROR";
    // 速率限制
    ErrorCode["RATE_LIMIT_EXCEEDED"] = "RATE_LIMIT_EXCEEDED";
})(ErrorCode || (exports.ErrorCode = ErrorCode = {}));
/**
 * 自定義錯誤類別
 */
class AppError extends Error {
    constructor(message, statusCode = 500, errorCode = ErrorCode.INTERNAL_SERVER_ERROR, details, isOperational = true) {
        super(message);
        this.statusCode = statusCode;
        this.errorCode = errorCode;
        this.details = details;
        this.isOperational = isOperational;
        this.timestamp = new Date().toISOString();
        // 確保錯誤堆疊追蹤正確
        Error.captureStackTrace(this, this.constructor);
    }
    /**
     * 轉換為 JSON 格式
     */
    toJSON() {
        return {
            message: this.message,
            statusCode: this.statusCode,
            errorCode: this.errorCode,
            details: this.details,
            timestamp: this.timestamp,
            isOperational: this.isOperational,
        };
    }
}
exports.AppError = AppError;
/**
 * 驗證錯誤
 */
class ValidationError extends AppError {
    constructor(message = '輸入資料驗證失敗', details) {
        super(message, 400, ErrorCode.VALIDATION_ERROR, details);
    }
}
exports.ValidationError = ValidationError;
/**
 * 認證錯誤
 */
class AuthenticationError extends AppError {
    constructor(message = '認證失敗', errorCode = ErrorCode.AUTHENTICATION_FAILED) {
        super(message, 401, errorCode);
    }
}
exports.AuthenticationError = AuthenticationError;
/**
 * 授權錯誤
 */
class AuthorizationError extends AppError {
    constructor(message = '權限不足', errorCode = ErrorCode.INSUFFICIENT_PERMISSIONS) {
        super(message, 403, errorCode);
    }
}
exports.AuthorizationError = AuthorizationError;
/**
 * 禁止訪問錯誤（AuthorizationError 的別名）
 */
class ForbiddenError extends AuthorizationError {
    constructor(message = '禁止訪問') {
        super(message, ErrorCode.ACCESS_DENIED);
    }
}
exports.ForbiddenError = ForbiddenError;
/**
 * 資源未找到錯誤
 */
class NotFoundError extends AppError {
    constructor(message = '資源未找到', details) {
        super(message, 404, ErrorCode.RESOURCE_NOT_FOUND, details);
    }
}
exports.NotFoundError = NotFoundError;
/**
 * 衝突錯誤
 */
class ConflictError extends AppError {
    constructor(message = '資源衝突', details) {
        super(message, 409, ErrorCode.RESOURCE_CONFLICT, details);
    }
}
exports.ConflictError = ConflictError;
/**
 * 速率限制錯誤
 */
class RateLimitError extends AppError {
    constructor(message = '請求過於頻繁', details) {
        super(message, 429, ErrorCode.RATE_LIMIT_EXCEEDED, details);
    }
}
exports.RateLimitError = RateLimitError;
/**
 * 內部伺服器錯誤
 */
class InternalServerError extends AppError {
    constructor(message = '內部伺服器錯誤', details) {
        super(message, 500, ErrorCode.INTERNAL_SERVER_ERROR, details, false);
    }
}
exports.InternalServerError = InternalServerError;
/**
 * 服務不可用錯誤
 */
class ServiceUnavailableError extends AppError {
    constructor(message = '服務暫時不可用', details) {
        super(message, 503, ErrorCode.SERVICE_UNAVAILABLE, details, false);
    }
}
exports.ServiceUnavailableError = ServiceUnavailableError;
/**
 * 業務邏輯錯誤
 */
class BusinessRuleError extends AppError {
    constructor(message, details) {
        super(message, 400, ErrorCode.BUSINESS_RULE_VIOLATION, details);
    }
}
exports.BusinessRuleError = BusinessRuleError;
/**
 * 外部服務錯誤
 */
class ExternalServiceError extends AppError {
    constructor(message = '外部服務錯誤', details) {
        super(message, 502, ErrorCode.EXTERNAL_SERVICE_ERROR, details, false);
    }
}
exports.ExternalServiceError = ExternalServiceError;
/**
 * 資料庫錯誤
 */
class DatabaseError extends AppError {
    constructor(message = '資料庫操作失敗', details) {
        super(message, 500, ErrorCode.DATABASE_ERROR, details, false);
    }
}
exports.DatabaseError = DatabaseError;
/**
 * 錯誤工廠函數
 */
class ErrorFactory {
    /**
     * 創建驗證錯誤
     */
    static createValidationError(message = '輸入資料驗證失敗', field, value, constraint) {
        const details = [];
        if (field) {
            details.push({ field, value, constraint });
        }
        return new ValidationError(message, details);
    }
    /**
     * 創建認證錯誤
     */
    static createAuthenticationError(type = 'invalid_credentials') {
        const messages = {
            invalid_credentials: '用戶名或密碼錯誤',
            invalid_token: '無效的認證令牌',
            token_expired: '認證令牌已過期',
        };
        const errorCodes = {
            invalid_credentials: ErrorCode.INVALID_CREDENTIALS,
            invalid_token: ErrorCode.INVALID_TOKEN,
            token_expired: ErrorCode.TOKEN_EXPIRED,
        };
        return new AuthenticationError(messages[type], errorCodes[type]);
    }
    /**
     * 創建資源未找到錯誤
     */
    static createNotFoundError(resource, identifier) {
        const message = identifier
            ? `${resource} (${identifier}) 未找到`
            : `${resource} 未找到`;
        const details = [{
                resource,
                identifier,
            }];
        return new NotFoundError(message, details);
    }
    /**
     * 創建衝突錯誤
     */
    static createConflictError(resource, field, value) {
        const message = `${resource} 的 ${field} 已存在`;
        const details = [{
                resource,
                field,
                value,
                constraint: 'unique',
            }];
        return new ConflictError(message, details);
    }
    /**
     * 創建速率限制錯誤
     */
    static createRateLimitError(message = '請求過於頻繁，請稍後再試', details) {
        return new RateLimitError(message, details);
    }
    /**
     * 從 Mongoose 錯誤創建 AppError
     */
    static fromMongooseError(error) {
        if (error.name === 'ValidationError') {
            const details = Object.values(error.errors).map((err) => ({
                field: err.path,
                value: err.value,
                constraint: err.kind,
                message: err.message,
            }));
            return new ValidationError('資料驗證失敗', details);
        }
        if (error.name === 'MongoServerError' && error.code === 11000) {
            const field = Object.keys(error.keyValue || {})[0];
            if (field) {
                const value = error.keyValue[field];
                return ErrorFactory.createConflictError('資源', field, value);
            }
            return new ConflictError('資源衝突');
        }
        if (error.name === 'CastError') {
            const details = [{
                    field: error.path,
                    value: error.value,
                    constraint: 'type',
                    message: '無效的資料格式',
                }];
            return new ValidationError('無效的資料格式', details);
        }
        return new DatabaseError(error.message);
    }
    /**
     * 從 Zod 錯誤創建 ValidationError
     */
    static fromZodError(error) {
        const details = error.errors.map((err) => ({
            field: err.path.join('.'),
            value: err.received,
            constraint: err.code,
            message: err.message,
        }));
        return new ValidationError('輸入資料驗證失敗', details);
    }
}
exports.ErrorFactory = ErrorFactory;
/**
 * 檢查錯誤是否為操作性錯誤
 */
const isOperationalError = (error) => {
    if (error instanceof AppError) {
        return error.isOperational;
    }
    return false;
};
exports.isOperationalError = isOperationalError;
/**
 * 格式化錯誤響應
 */
const formatErrorResponse = (error, includeStack = false) => {
    const response = {
        success: false,
        error: {
            message: error.message,
            code: error.errorCode,
            statusCode: error.statusCode,
            timestamp: error.timestamp,
        },
    };
    if (error.details && error.details.length > 0) {
        response.error.details = error.details;
    }
    if (includeStack && error.stack) {
        response.error.stack = error.stack;
    }
    return response;
};
exports.formatErrorResponse = formatErrorResponse;
/**
 * 錯誤日誌格式化
 */
const formatErrorForLogging = (error, context) => {
    const logData = {
        message: error.message,
        name: error.name,
        stack: error.stack,
    };
    if (error instanceof AppError) {
        logData.errorCode = error.errorCode;
        logData.statusCode = error.statusCode;
        logData.isOperational = error.isOperational;
        logData.details = error.details;
    }
    if (context) {
        logData.context = context;
    }
    return logData;
};
exports.formatErrorForLogging = formatErrorForLogging;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxlcnJvcnMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUE7O0dBRUc7QUFDSCxJQUFZLFNBbUNYO0FBbkNELFdBQVksU0FBUztJQUNuQixPQUFPO0lBQ1AsNERBQStDLENBQUE7SUFDL0Msd0RBQTJDLENBQUE7SUFFM0MsT0FBTztJQUNQLGtEQUFxQyxDQUFBO0lBQ3JDLDRDQUErQixDQUFBO0lBQy9CLDhEQUFpRCxDQUFBO0lBRWpELE9BQU87SUFDUCw0REFBK0MsQ0FBQTtJQUMvQyw0Q0FBK0IsQ0FBQTtJQUMvQiw0Q0FBK0IsQ0FBQTtJQUMvQix3REFBMkMsQ0FBQTtJQUUzQyxPQUFPO0lBQ1Asa0VBQXFELENBQUE7SUFDckQsNENBQStCLENBQUE7SUFFL0IsT0FBTztJQUNQLHNEQUF5QyxDQUFBO0lBQ3pDLGdFQUFtRCxDQUFBO0lBQ25ELG9EQUF1QyxDQUFBO0lBRXZDLFNBQVM7SUFDVCxnRUFBbUQsQ0FBQTtJQUNuRCw0REFBK0MsQ0FBQTtJQUUvQyxTQUFTO0lBQ1QsOERBQWlELENBQUE7SUFDakQsOENBQWlDLENBQUE7SUFFakMsT0FBTztJQUNQLHdEQUEyQyxDQUFBO0FBQzdDLENBQUMsRUFuQ1csU0FBUyx5QkFBVCxTQUFTLFFBbUNwQjtBQWFEOztHQUVHO0FBQ0gsTUFBYSxRQUFTLFNBQVEsS0FBSztJQU9qQyxZQUNFLE9BQWUsRUFDZixhQUFxQixHQUFHLEVBQ3hCLFlBQXVCLFNBQVMsQ0FBQyxxQkFBcUIsRUFDdEQsT0FBd0IsRUFDeEIsZ0JBQXlCLElBQUk7UUFFN0IsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRWYsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDM0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxD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Q0FBQztRQUM5QixPQUFPLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDcEMsT0FBTyxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQ3RDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQztRQUM1QyxPQUFPLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7SUFDbEMsQ0FBQztJQUVELElBQUksT0FBTyxFQUFFLENBQUM7UUFDWixPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUM1QixDQUFDO0lBRUQsT0FBTyxPQUFPLENBQUM7QUFDakIsQ0FBQyxDQUFDO0FBdEJXLFFBQUEscUJBQXFCLHlCQXNCaEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxlcnJvcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiDpjK/oqqTku6PnorzmnproiIlcbiAqL1xuZXhwb3J0IGVudW0gRXJyb3JDb2RlIHtcbiAgLy8g6YCa55So6Yyv6KqkXG4gIElOVEVSTkFMX1NFUlZFUl9FUlJPUiA9ICdJTlRFUk5BTF9TRVJWRVJfRVJST1InLFxuICBTRVJWSUNFX1VOQVZBSUxBQkxFID0gJ1NFUlZJQ0VfVU5BVkFJTEFCTEUnLFxuICBcbiAgLy8g6amX6K2J6Yyv6KqkXG4gIFZBTElEQVRJT05fRVJST1IgPSAnVkFMSURBVElPTl9FUlJPUicsXG4gIElOVkFMSURfSU5QVVQgPSAnSU5WQUxJRF9JTlBVVCcsXG4gIE1JU1NJTkdfUkVRVUlSRURfRklFTEQgPSAnTUlTU0lOR19SRVFVSVJFRF9GSUVMRCcsXG4gIFxuICAvLyDoqo3orYnpjK/oqqRcbiAgQVVUSEVOVElDQVRJT05fRkFJTEVEID0gJ0FVVEhFTlRJQ0FUSU9OX0ZBSUxFRCcsXG4gIElOVkFMSURfVE9LRU4gPSAnSU5WQUxJRF9UT0tFTicsXG4gIFRPS0VOX0VYUElSRUQgPSAnVE9LRU5fRVhQSVJFRCcsXG4gIElOVkFMSURfQ1JFREVOVElBTFMgPSAnSU5WQUxJRF9DUkVERU5USUFMUycsXG4gIFxuICAvLyDmjojmrIrpjK/oqqRcbiAgSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TID0gJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gIEFDQ0VTU19ERU5JRUQgPSAnQUNDRVNTX0RFTklFRCcsXG4gIFxuICAvLyDos4fmupDpjK/oqqRcbiAgUkVTT1VSQ0VfTk9UX0ZPVU5EID0gJ1JFU09VUkNFX05PVF9GT1VORCcsXG4gIFJFU09VUkNFX0FMUkVBRFlfRVhJU1RTID0gJ1JFU09VUkNFX0FMUkVBRFlfRVhJU1RTJyxcbiAgUkVTT1VSQ0VfQ09ORkxJQ1QgPSAnUkVTT1VSQ0VfQ09ORkxJQ1QnLFxuICBcbiAgLy8g5qWt5YuZ6YKP6Lyv6Yyv6KqkXG4gIEJVU0lORVNTX1JVTEVfVklPTEFUSU9OID0gJ0JVU0lORVNTX1JVTEVfVklPTEFUSU9OJyxcbiAgT1BFUkFUSU9OX05PVF9BTExPV0VEID0gJ09QRVJBVElPTl9OT1RfQUxMT1dFRCcsXG4gIFxuICAvLyDlpJbpg6jmnI3li5npjK/oqqRcbiAgRVhURVJOQUxfU0VSVklDRV9FUlJPUiA9ICdFWFRFUk5BTF9TRVJWSUNFX0VSUk9SJyxcbiAgREFUQUJBU0VfRVJST1IgPSAnREFUQUJBU0VfRVJST1InLFxuICBcbiAgLy8g6YCf546H6ZmQ5Yi2XG4gIFJBVEVfTElNSVRfRVhDRUVERUQgPSAnUkFURV9MSU1JVF9FWENFRURFRCcsXG59XG5cbi8qKlxuICog6Yyv6Kqk6Kmz5oOF5LuL6Z2iXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRXJyb3JEZXRhaWxzIHtcbiAgZmllbGQ/OiBzdHJpbmc7XG4gIHZhbHVlPzogYW55O1xuICBjb25zdHJhaW50Pzogc3RyaW5nO1xuICBjb2RlPzogc3RyaW5nO1xuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbi8qKlxuICog6Ieq5a6a576p6Yyv6Kqk6aGe5YilXG4gKi9cbmV4cG9ydCBjbGFzcyBBcHBFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgcHVibGljIHJlYWRvbmx5IHN0YXR1c0NvZGU6IG51bWJlcjtcbiAgcHVibGljIHJlYWRvbmx5IGlzT3BlcmF0aW9uYWw6IGJvb2xlYW47XG4gIHB1YmxpYyByZWFkb25seSBlcnJvckNvZGU6IEVycm9yQ29kZTtcbiAgcHVibGljIHJlYWRvbmx5IGRldGFpbHM/OiBFcnJvckRldGFpbHNbXTtcbiAgcHVibGljIHJlYWRvbmx5IHRpbWVzdGFtcDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBzdGF0dXNDb2RlOiBudW1iZXIgPSA1MDAsXG4gICAgZXJyb3JDb2RlOiBFcnJvckNvZGUgPSBFcnJvckNvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICAgIGRldGFpbHM/OiBFcnJvckRldGFpbHNbXSxcbiAgICBpc09wZXJhdGlvbmFsOiBib29sZWFuID0gdHJ1ZVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICBcbiAgICB0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xuICAgIHRoaXMuZXJyb3JDb2RlID0gZXJyb3JDb2RlO1xuICAgIHRoaXMuZGV0YWlscyA9IGRldGFpbHM7XG4gICAgdGhpcy5pc09wZXJhdGlvbmFsID0gaXNPcGVyYXRpb25hbDtcbiAgICB0aGlzLnRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBcbiAgICAvLyDnorrkv53pjK/oqqTloIbnlorov73ouaTmraPnorpcbiAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCB0aGlzLmNvbnN0cnVjdG9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDovYnmj5vngrogSlNPTiDmoLzlvI9cbiAgICovXG4gIHRvSlNPTigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlLFxuICAgICAgc3RhdHVzQ29kZTogdGhpcy5zdGF0dXNDb2RlLFxuICAgICAgZXJyb3JDb2RlOiB0aGlzLmVycm9yQ29kZSxcbiAgICAgIGRldGFpbHM6IHRoaXMuZGV0YWlscyxcbiAgICAgIHRpbWVzdGFtcDogdGhpcy50aW1lc3RhbXAsXG4gICAgICBpc09wZXJhdGlvbmFsOiB0aGlzLmlzT3BlcmF0aW9uYWwsXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIOmpl+itiemMr+iqpFxuICovXG5leHBvcnQgY2xhc3MgVmFsaWRhdGlvbkVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn6Ly45YWl6LOH5paZ6amX6K2J5aSx5pWXJyxcbiAgICBkZXRhaWxzPzogRXJyb3JEZXRhaWxzW11cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNDAwLCBFcnJvckNvZGUuVkFMSURBVElPTl9FUlJPUiwgZGV0YWlscyk7XG4gIH1cbn1cblxuLyoqXG4gKiDoqo3orYnpjK/oqqRcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dGhlbnRpY2F0aW9uRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyA9ICfoqo3orYnlpLHmlZcnLFxuICAgIGVycm9yQ29kZTogRXJyb3JDb2RlID0gRXJyb3JDb2RlLkFVVEhFTlRJQ0FUSU9OX0ZBSUxFRFxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlLCA0MDEsIGVycm9yQ29kZSk7XG4gIH1cbn1cblxuLyoqXG4gKiDmjojmrIrpjK/oqqRcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dGhvcml6YXRpb25FcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nID0gJ+asiumZkOS4jei2sycsXG4gICAgZXJyb3JDb2RlOiBFcnJvckNvZGUgPSBFcnJvckNvZGUuSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UsIDQwMywgZXJyb3JDb2RlKTtcbiAgfVxufVxuXG4vKipcbiAqIOemgeatouioquWVj+mMr+iqpO+8iEF1dGhvcml6YXRpb25FcnJvciDnmoTliKXlkI3vvIlcbiAqL1xuZXhwb3J0IGNsYXNzIEZvcmJpZGRlbkVycm9yIGV4dGVuZHMgQXV0aG9yaXphdGlvbkVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ+emgeatouioquWVjycpIHtcbiAgICBzdXBlcihtZXNzYWdlLCBFcnJvckNvZGUuQUNDRVNTX0RFTklFRCk7XG4gIH1cbn1cblxuLyoqXG4gKiDos4fmupDmnKrmib7liLDpjK/oqqRcbiAqL1xuZXhwb3J0IGNsYXNzIE5vdEZvdW5kRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1lc3NhZ2U6IHN0cmluZyA9ICfos4fmupDmnKrmib7liLAnLFxuICAgIGRldGFpbHM/OiBFcnJvckRldGFpbHNbXVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlLCA0MDQsIEVycm9yQ29kZS5SRVNPVVJDRV9OT1RfRk9VTkQsIGRldGFpbHMpO1xuICB9XG59XG5cbi8qKlxuICog6KGd56qB6Yyv6KqkXG4gKi9cbmV4cG9ydCBjbGFzcyBDb25mbGljdEVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn6LOH5rqQ6KGd56qBJyxcbiAgICBkZXRhaWxzPzogRXJyb3JEZXRhaWxzW11cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNDA5LCBFcnJvckNvZGUuUkVTT1VSQ0VfQ09ORkxJQ1QsIGRldGFpbHMpO1xuICB9XG59XG5cbi8qKlxuICog6YCf546H6ZmQ5Yi26Yyv6KqkXG4gKi9cbmV4cG9ydCBjbGFzcyBSYXRlTGltaXRFcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nID0gJ+iri+axgumBjuaWvOmgu+e5gScsXG4gICAgZGV0YWlscz86IEVycm9yRGV0YWlsc1tdXG4gICkge1xuICAgIHN1cGVyKG1lc3NhZ2UsIDQyOSwgRXJyb3JDb2RlLlJBVEVfTElNSVRfRVhDRUVERUQsIGRldGFpbHMpO1xuICB9XG59XG5cbi8qKlxuICog5YWn6YOo5Ly65pyN5Zmo6Yyv6KqkXG4gKi9cbmV4cG9ydCBjbGFzcyBJbnRlcm5hbFNlcnZlckVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn5YWn6YOo5Ly65pyN5Zmo6Yyv6KqkJyxcbiAgICBkZXRhaWxzPzogRXJyb3JEZXRhaWxzW11cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNTAwLCBFcnJvckNvZGUuSU5URVJOQUxfU0VSVkVSX0VSUk9SLCBkZXRhaWxzLCBmYWxzZSk7XG4gIH1cbn1cblxuLyoqXG4gKiDmnI3li5nkuI3lj6/nlKjpjK/oqqRcbiAqL1xuZXhwb3J0IGNsYXNzIFNlcnZpY2VVbmF2YWlsYWJsZUVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn5pyN5YuZ5pqr5pmC5LiN5Y+v55SoJyxcbiAgICBkZXRhaWxzPzogRXJyb3JEZXRhaWxzW11cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNTAzLCBFcnJvckNvZGUuU0VSVklDRV9VTkFWQUlMQUJMRSwgZGV0YWlscywgZmFsc2UpO1xuICB9XG59XG5cbi8qKlxuICog5qWt5YuZ6YKP6Lyv6Yyv6KqkXG4gKi9cbmV4cG9ydCBjbGFzcyBCdXNpbmVzc1J1bGVFcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIGRldGFpbHM/OiBFcnJvckRldGFpbHNbXVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlLCA0MDAsIEVycm9yQ29kZS5CVVNJTkVTU19SVUxFX1ZJT0xBVElPTiwgZGV0YWlscyk7XG4gIH1cbn1cblxuLyoqXG4gKiDlpJbpg6jmnI3li5npjK/oqqRcbiAqL1xuZXhwb3J0IGNsYXNzIEV4dGVybmFsU2VydmljZUVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn5aSW6YOo5pyN5YuZ6Yyv6KqkJyxcbiAgICBkZXRhaWxzPzogRXJyb3JEZXRhaWxzW11cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNTAyLCBFcnJvckNvZGUuRVhURVJOQUxfU0VSVklDRV9FUlJPUiwgZGV0YWlscywgZmFsc2UpO1xuICB9XG59XG5cbi8qKlxuICog6LOH5paZ5bqr6Yyv6KqkXG4gKi9cbmV4cG9ydCBjbGFzcyBEYXRhYmFzZUVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn6LOH5paZ5bqr5pON5L2c5aSx5pWXJyxcbiAgICBkZXRhaWxzPzogRXJyb3JEZXRhaWxzW11cbiAgKSB7XG4gICAgc3VwZXIobWVzc2FnZSwgNTAwLCBFcnJvckNvZGUuREFUQUJBU0VfRVJST1IsIGRldGFpbHMsIGZhbHNlKTtcbiAgfVxufVxuXG4vKipcbiAqIOmMr+iqpOW3peW7oOWHveaVuFxuICovXG5leHBvcnQgY2xhc3MgRXJyb3JGYWN0b3J5IHtcbiAgLyoqXG4gICAqIOWJteW7uumpl+itiemMr+iqpFxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZVZhbGlkYXRpb25FcnJvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn6Ly45YWl6LOH5paZ6amX6K2J5aSx5pWXJyxcbiAgICBmaWVsZD86IHN0cmluZyxcbiAgICB2YWx1ZT86IGFueSxcbiAgICBjb25zdHJhaW50Pzogc3RyaW5nXG4gICk6IFZhbGlkYXRpb25FcnJvciB7XG4gICAgY29uc3QgZGV0YWlsczogRXJyb3JEZXRhaWxzW10gPSBbXTtcbiAgICBpZiAoZmllbGQpIHtcbiAgICAgIGRldGFpbHMucHVzaCh7IGZpZWxkLCB2YWx1ZSwgY29uc3RyYWludCB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uRXJyb3IobWVzc2FnZSwgZGV0YWlscyk7XG4gIH1cblxuICAvKipcbiAgICog5Ym15bu66KqN6K2J6Yyv6KqkXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlQXV0aGVudGljYXRpb25FcnJvcihcbiAgICB0eXBlOiAnaW52YWxpZF9jcmVkZW50aWFscycgfCAnaW52YWxpZF90b2tlbicgfCAndG9rZW5fZXhwaXJlZCcgPSAnaW52YWxpZF9jcmVkZW50aWFscydcbiAgKTogQXV0aGVudGljYXRpb25FcnJvciB7XG4gICAgY29uc3QgbWVzc2FnZXMgPSB7XG4gICAgICBpbnZhbGlkX2NyZWRlbnRpYWxzOiAn55So5oi25ZCN5oiW5a+G56K86Yyv6KqkJyxcbiAgICAgIGludmFsaWRfdG9rZW46ICfnhKHmlYjnmoToqo3orYnku6TniYwnLFxuICAgICAgdG9rZW5fZXhwaXJlZDogJ+iqjeitieS7pOeJjOW3sumBjuacnycsXG4gICAgfTtcbiAgICBcbiAgICBjb25zdCBlcnJvckNvZGVzID0ge1xuICAgICAgaW52YWxpZF9jcmVkZW50aWFsczogRXJyb3JDb2RlLklOVkFMSURfQ1JFREVOVElBTFMsXG4gICAgICBpbnZhbGlkX3Rva2VuOiBFcnJvckNvZGUuSU5WQUxJRF9UT0tFTixcbiAgICAgIHRva2VuX2V4cGlyZWQ6IEVycm9yQ29kZS5UT0tFTl9FWFBJUkVELFxuICAgIH07XG5cbiAgICByZXR1cm4gbmV3IEF1dGhlbnRpY2F0aW9uRXJyb3IobWVzc2FnZXNbdHlwZV0sIGVycm9yQ29kZXNbdHlwZV0pO1xuICB9XG5cbiAgLyoqXG4gICAqIOWJteW7uuizh+a6kOacquaJvuWIsOmMr+iqpFxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZU5vdEZvdW5kRXJyb3IoXG4gICAgcmVzb3VyY2U6IHN0cmluZyxcbiAgICBpZGVudGlmaWVyPzogc3RyaW5nIHwgbnVtYmVyXG4gICk6IE5vdEZvdW5kRXJyb3Ige1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBpZGVudGlmaWVyIFxuICAgICAgPyBgJHtyZXNvdXJjZX0gKCR7aWRlbnRpZmllcn0pIOacquaJvuWIsGBcbiAgICAgIDogYCR7cmVzb3VyY2V9IOacquaJvuWIsGA7XG4gICAgXG4gICAgY29uc3QgZGV0YWlsczogRXJyb3JEZXRhaWxzW10gPSBbe1xuICAgICAgcmVzb3VyY2UsXG4gICAgICBpZGVudGlmaWVyLFxuICAgIH1dO1xuXG4gICAgcmV0dXJuIG5ldyBOb3RGb3VuZEVycm9yKG1lc3NhZ2UsIGRldGFpbHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIOWJteW7uuihneeqgemMr+iqpFxuICAgKi9cbiAgc3RhdGljIGNyZWF0ZUNvbmZsaWN0RXJyb3IoXG4gICAgcmVzb3VyY2U6IHN0cmluZyxcbiAgICBmaWVsZDogc3RyaW5nLFxuICAgIHZhbHVlOiBhbnlcbiAgKTogQ29uZmxpY3RFcnJvciB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGAke3Jlc291cmNlfSDnmoQgJHtmaWVsZH0g5bey5a2Y5ZyoYDtcbiAgICBjb25zdCBkZXRhaWxzOiBFcnJvckRldGFpbHNbXSA9IFt7XG4gICAgICByZXNvdXJjZSxcbiAgICAgIGZpZWxkLFxuICAgICAgdmFsdWUsXG4gICAgICBjb25zdHJhaW50OiAndW5pcXVlJyxcbiAgICB9XTtcblxuICAgIHJldHVybiBuZXcgQ29uZmxpY3RFcnJvcihtZXNzYWdlLCBkZXRhaWxzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlibXlu7rpgJ/njofpmZDliLbpjK/oqqRcbiAgICovXG4gIHN0YXRpYyBjcmVhdGVSYXRlTGltaXRFcnJvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn6KuL5rGC6YGO5pa86aC757mB77yM6KuL56iN5b6M5YaN6KmmJyxcbiAgICBkZXRhaWxzPzogRXJyb3JEZXRhaWxzW11cbiAgKTogUmF0ZUxpbWl0RXJyb3Ige1xuICAgIHJldHVybiBuZXcgUmF0ZUxpbWl0RXJyb3IobWVzc2FnZSwgZGV0YWlscyk7XG4gIH1cblxuICAvKipcbiAgICog5b6eIE1vbmdvb3NlIOmMr+iqpOWJteW7uiBBcHBFcnJvclxuICAgKi9cbiAgc3RhdGljIGZyb21Nb25nb29zZUVycm9yKGVycm9yOiBhbnkpOiBBcHBFcnJvciB7XG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdWYWxpZGF0aW9uRXJyb3InKSB7XG4gICAgICBjb25zdCBkZXRhaWxzOiBFcnJvckRldGFpbHNbXSA9IE9iamVjdC52YWx1ZXMoZXJyb3IuZXJyb3JzKS5tYXAoKGVycjogYW55KSA9PiAoe1xuICAgICAgICBmaWVsZDogZXJyLnBhdGgsXG4gICAgICAgIHZhbHVlOiBlcnIudmFsdWUsXG4gICAgICAgIGNvbnN0cmFpbnQ6IGVyci5raW5kLFxuICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZSxcbiAgICAgIH0pKTtcbiAgICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkVycm9yKCfos4fmlpnpqZforYnlpLHmlZcnLCBkZXRhaWxzKTtcbiAgICB9XG5cbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ01vbmdvU2VydmVyRXJyb3InICYmIGVycm9yLmNvZGUgPT09IDExMDAwKSB7XG4gICAgICBjb25zdCBmaWVsZCA9IE9iamVjdC5rZXlzKGVycm9yLmtleVZhbHVlIHx8IHt9KVswXTtcbiAgICAgIGlmIChmaWVsZCkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGVycm9yLmtleVZhbHVlW2ZpZWxkXTtcbiAgICAgICAgcmV0dXJuIEVycm9yRmFjdG9yeS5jcmVhdGVDb25mbGljdEVycm9yKCfos4fmupAnLCBmaWVsZCwgdmFsdWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBDb25mbGljdEVycm9yKCfos4fmupDooZ3nqoEnKTtcbiAgICB9XG5cbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0Nhc3RFcnJvcicpIHtcbiAgICAgIGNvbnN0IGRldGFpbHM6IEVycm9yRGV0YWlsc1tdID0gW3tcbiAgICAgICAgZmllbGQ6IGVycm9yLnBhdGgsXG4gICAgICAgIHZhbHVlOiBlcnJvci52YWx1ZSxcbiAgICAgICAgY29uc3RyYWludDogJ3R5cGUnLFxuICAgICAgICBtZXNzYWdlOiAn54Sh5pWI55qE6LOH5paZ5qC85byPJyxcbiAgICAgIH1dO1xuICAgICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uRXJyb3IoJ+eEoeaViOeahOizh+aWmeagvOW8jycsIGRldGFpbHMpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgRGF0YWJhc2VFcnJvcihlcnJvci5tZXNzYWdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlvp4gWm9kIOmMr+iqpOWJteW7uiBWYWxpZGF0aW9uRXJyb3JcbiAgICovXG4gIHN0YXRpYyBmcm9tWm9kRXJyb3IoZXJyb3I6IGFueSk6IFZhbGlkYXRpb25FcnJvciB7XG4gICAgY29uc3QgZGV0YWlsczogRXJyb3JEZXRhaWxzW10gPSBlcnJvci5lcnJvcnMubWFwKChlcnI6IGFueSkgPT4gKHtcbiAgICAgIGZpZWxkOiBlcnIucGF0aC5qb2luKCcuJyksXG4gICAgICB2YWx1ZTogZXJyLnJlY2VpdmVkLFxuICAgICAgY29uc3RyYWludDogZXJyLmNvZGUsXG4gICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZSxcbiAgICB9KSk7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uRXJyb3IoJ+i8uOWFpeizh+aWmempl+itieWkseaVlycsIGRldGFpbHMpO1xuICB9XG59XG5cbi8qKlxuICog5qqi5p+l6Yyv6Kqk5piv5ZCm54K65pON5L2c5oCn6Yyv6KqkXG4gKi9cbmV4cG9ydCBjb25zdCBpc09wZXJhdGlvbmFsRXJyb3IgPSAoZXJyb3I6IEVycm9yKTogYm9vbGVhbiA9PiB7XG4gIGlmIChlcnJvciBpbnN0YW5jZW9mIEFwcEVycm9yKSB7XG4gICAgcmV0dXJuIGVycm9yLmlzT3BlcmF0aW9uYWw7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuLyoqXG4gKiDmoLzlvI/ljJbpjK/oqqTpn7/mh4lcbiAqL1xuZXhwb3J0IGNvbnN0IGZvcm1hdEVycm9yUmVzcG9uc2UgPSAoXG4gIGVycm9yOiBBcHBFcnJvcixcbiAgaW5jbHVkZVN0YWNrOiBib29sZWFuID0gZmFsc2VcbikgPT4ge1xuICBjb25zdCByZXNwb25zZTogYW55ID0ge1xuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIGVycm9yOiB7XG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgY29kZTogZXJyb3IuZXJyb3JDb2RlLFxuICAgICAgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzQ29kZSxcbiAgICAgIHRpbWVzdGFtcDogZXJyb3IudGltZXN0YW1wLFxuICAgIH0sXG4gIH07XG5cbiAgaWYgKGVycm9yLmRldGFpbHMgJiYgZXJyb3IuZGV0YWlscy5sZW5ndGggPiAwKSB7XG4gICAgcmVzcG9uc2UuZXJyb3IuZGV0YWlscyA9IGVycm9yLmRldGFpbHM7XG4gIH1cblxuICBpZiAoaW5jbHVkZVN0YWNrICYmIGVycm9yLnN0YWNrKSB7XG4gICAgcmVzcG9uc2UuZXJyb3Iuc3RhY2sgPSBlcnJvci5zdGFjaztcbiAgfVxuXG4gIHJldHVybiByZXNwb25zZTtcbn07XG5cbi8qKlxuICog6Yyv6Kqk5pel6KqM5qC85byP5YyWXG4gKi9cbmV4cG9ydCBjb25zdCBmb3JtYXRFcnJvckZvckxvZ2dpbmcgPSAoXG4gIGVycm9yOiBFcnJvcixcbiAgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIGFueT5cbikgPT4ge1xuICBjb25zdCBsb2dEYXRhOiBhbnkgPSB7XG4gICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICBuYW1lOiBlcnJvci5uYW1lLFxuICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgfTtcblxuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBcHBFcnJvcikge1xuICAgIGxvZ0RhdGEuZXJyb3JDb2RlID0gZXJyb3IuZXJyb3JDb2RlO1xuICAgIGxvZ0RhdGEuc3RhdHVzQ29kZSA9IGVycm9yLnN0YXR1c0NvZGU7XG4gICAgbG9nRGF0YS5pc09wZXJhdGlvbmFsID0gZXJyb3IuaXNPcGVyYXRpb25hbDtcbiAgICBsb2dEYXRhLmRldGFpbHMgPSBlcnJvci5kZXRhaWxzO1xuICB9XG5cbiAgaWYgKGNvbnRleHQpIHtcbiAgICBsb2dEYXRhLmNvbnRleHQgPSBjb250ZXh0O1xuICB9XG5cbiAgcmV0dXJuIGxvZ0RhdGE7XG59OyJdLCJ2ZXJzaW9uIjozfQ==