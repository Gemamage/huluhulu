b0063578e1da2d361e902ef2bdc9a63a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// petService 單元測試 - 簡化版本，不依賴數據庫
const globals_1 = require("@jest/globals");
// 模擬外部依賴
globals_1.jest.mock('../../src/models/Pet');
globals_1.jest.mock('../../src/models/User');
globals_1.jest.mock('../../src/services/cloudinaryService');
globals_1.jest.mock('../../src/services/aiService');
globals_1.jest.mock('../../src/utils/logger');
// 設置測試環境變數
process.env.NODE_ENV = 'test';
process.env.JWT_SECRET = 'test-jwt-secret-key-with-minimum-32-characters-length';
// 導入要測試的服務
const petService_1 = require("../../src/services/petService");
// 模擬的 Pet 模型
const mockPet = {
    _id: 'pet123',
    name: '小白',
    type: 'dog',
    breed: '拉布拉多',
    status: 'lost',
    owner: 'user123',
    save: globals_1.jest.fn(),
    populate: globals_1.jest.fn().mockReturnThis(),
    createdAt: new Date(),
    updatedAt: new Date()
};
// 模擬的 User 模型
const mockUser = {
    _id: 'user123',
    username: 'testuser',
    email: 'test@example.com'
};
// 模擬 Pet 模型的靜態方法
const Pet = {
    findById: globals_1.jest.fn(),
    findOne: globals_1.jest.fn(),
    findByIdAndUpdate: globals_1.jest.fn(),
    findByIdAndDelete: globals_1.jest.fn(),
    find: globals_1.jest.fn(),
    countDocuments: globals_1.jest.fn(),
    deleteMany: globals_1.jest.fn()
};
// 模擬 User 模型的靜態方法
const User = {
    findById: globals_1.jest.fn(),
    deleteMany: globals_1.jest.fn()
};
// 模擬 CloudinaryService
const CloudinaryService = {
    uploadImage: globals_1.jest.fn(),
    deleteImage: globals_1.jest.fn()
};
// 模擬 aiService
const aiService = {
    analyzeImage: globals_1.jest.fn()
};
// 設置模擬
require('../../src/models/Pet').Pet = Pet;
require('../../src/models/User').User = User;
require('../../src/services/cloudinaryService').CloudinaryService = CloudinaryService;
require('../../src/services/aiService').aiService = aiService;
(0, globals_1.describe)('PetService 測試', () => {
    (0, globals_1.beforeEach)(() => {
        globals_1.jest.clearAllMocks();
        // 設置預設的模擬回應
        User.findById.mockResolvedValue(mockUser);
        Pet.findById.mockResolvedValue({
            ...mockPet,
            populate: globals_1.jest.fn().mockResolvedValue(mockPet)
        });
        mockPet.save.mockResolvedValue(mockPet);
        mockPet.populate.mockResolvedValue(mockPet);
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.restoreAllMocks();
    });
    (0, globals_1.describe)('createPet', () => {
        const petData = {
            name: '小花',
            type: 'cat',
            breed: '波斯貓',
            status: 'lost',
            description: '走失的小貓',
            location: {
                address: '台北市信義區',
                city: '台北市',
                coordinates: [121.5654, 25.0330]
            },
            contact: {
                phone: '0912345678',
                email: 'owner@example.com'
            }
        };
        (0, globals_1.it)('應該成功創建寵物', async () => {
            // 模擬 Pet 構造函數
            const mockPetConstructor = globals_1.jest.fn().mockImplementation(() => ({
                ...mockPet,
                ...petData,
                save: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...petData }),
                populate: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...petData })
            }));
            Pet.prototype = mockPetConstructor.prototype;
            global.Pet = mockPetConstructor;
            const result = await petService_1.PetService.createPet('user123', petData);
            (0, globals_1.expect)(User.findById).toHaveBeenCalledWith('user123');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result.name).toBe(petData.name);
        });
        (0, globals_1.it)('應該在擁有者不存在時拋出錯誤', async () => {
            User.findById.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.createPet('invalid-user', petData))
                .rejects.toThrow('擁有者不存在');
        });
        (0, globals_1.it)('應該處理圖片上傳', async () => {
            const petDataWithImages = {
                ...petData,
                images: ['image1.jpg', 'image2.jpg']
            };
            CloudinaryService.uploadImage.mockResolvedValue({
                secure_url: 'https://cloudinary.com/test.jpg',
                public_id: 'test_id',
                width: 800,
                height: 600
            });
            const mockPetConstructor = globals_1.jest.fn().mockImplementation(() => ({
                ...mockPet,
                save: globals_1.jest.fn().mockResolvedValue(mockPet),
                populate: globals_1.jest.fn().mockResolvedValue(mockPet)
            }));
            global.Pet = mockPetConstructor;
            await petService_1.PetService.createPet('user123', petDataWithImages);
            (0, globals_1.expect)(CloudinaryService.uploadImage).toHaveBeenCalledTimes(2);
        });
    });
    (0, globals_1.describe)('getPetById', () => {
        (0, globals_1.it)('應該成功根據ID獲取寵物', async () => {
            const result = await petService_1.PetService.getPetById('pet123');
            (0, globals_1.expect)(Pet.findById).toHaveBeenCalledWith('pet123');
            (0, globals_1.expect)(result).toBeDefined();
            (0, globals_1.expect)(result?._id).toBe('pet123');
        });
        (0, globals_1.it)('應該在ID無效時拋出錯誤', async () => {
            await (0, globals_1.expect)(petService_1.PetService.getPetById('invalid-id'))
                .rejects.toThrow('無效的寵物 ID');
        });
        (0, globals_1.it)('應該返回null當寵物不存在', async () => {
            Pet.findById.mockReturnValue({
                populate: globals_1.jest.fn().mockReturnValue({
                    exec: globals_1.jest.fn().mockResolvedValue(null)
                })
            });
            const result = await petService_1.PetService.getPetById('507f1f77bcf86cd799439011');
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)('updatePet', () => {
        const updateData = {
            name: '更新的小白',
            description: '更新的描述'
        };
        (0, globals_1.it)('應該成功更新寵物', async () => {
            Pet.findOne.mockResolvedValue(mockPet);
            Pet.findByIdAndUpdate.mockReturnValue({
                populate: globals_1.jest.fn().mockResolvedValue({ ...mockPet, ...updateData })
            });
            const result = await petService_1.PetService.updatePet('pet123', 'user123', updateData);
            (0, globals_1.expect)(Pet.findOne).toHaveBeenCalledWith({ _id: 'pet123', owner: 'user123' });
            (0, globals_1.expect)(Pet.findByIdAndUpdate).toHaveBeenCalled();
            (0, globals_1.expect)(result?.name).toBe(updateData.name);
        });
        (0, globals_1.it)('應該在寵物不存在時拋出錯誤', async () => {
            Pet.findOne.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.updatePet('pet123', 'user123', updateData))
                .rejects.toThrow('寵物不存在或您沒有權限修改');
        });
    });
    (0, globals_1.describe)('deletePet', () => {
        (0, globals_1.it)('應該成功刪除寵物', async () => {
            Pet.findOne.mockResolvedValue({
                ...mockPet,
                images: [{ publicId: 'test_id', url: 'test.jpg' }]
            });
            Pet.findByIdAndDelete.mockResolvedValue(mockPet);
            CloudinaryService.deleteImage.mockResolvedValue(true);
            const result = await petService_1.PetService.deletePet('pet123', 'user123');
            (0, globals_1.expect)(Pet.findOne).toHaveBeenCalledWith({ _id: 'pet123', owner: 'user123' });
            (0, globals_1.expect)(Pet.findByIdAndDelete).toHaveBeenCalledWith('pet123');
            (0, globals_1.expect)(CloudinaryService.deleteImage).toHaveBeenCalledWith('test_id');
            (0, globals_1.expect)(result).toBe(true);
        });
        (0, globals_1.it)('應該在寵物不存在時拋出錯誤', async () => {
            Pet.findOne.mockResolvedValue(null);
            await (0, globals_1.expect)(petService_1.PetService.deletePet('pet123', 'user123'))
                .rejects.toThrow('寵物不存在或您沒有權限刪除');
        });
    });
    (0, globals_1.describe)('getAllPets', () => {
        (0, globals_1.it)('應該成功獲取所有寵物', async () => {
            const mockPets = [mockPet, { ...mockPet, _id: 'pet456', name: '小黑' }];
            Pet.find.mockReturnValue({
                populate: globals_1.jest.fn().mockReturnValue({
                    sort: globals_1.jest.fn().mockReturnValue({
                        skip: globals_1.jest.fn().mockReturnValue({
                            limit: globals_1.jest.fn().mockReturnValue({
                                exec: globals_1.jest.fn().mockResolvedValue(mockPets)
                            })
                        })
                    })
                })
            });
            Pet.countDocuments.mockResolvedValue(2);
            const result = await petService_1.PetService.getAllPets(1, 10);
            (0, globals_1.expect)(result.pets).toHaveLength(2);
            (0, globals_1.expect)(result.total).toBe(2);
            (0, globals_1.expect)(result.page).toBe(1);
            (0, globals_1.expect)(result.totalPages).toBe(1);
        });
    });
    (0, globals_1.describe)('incrementViewCount', () => {
        (0, globals_1.it)('應該成功增加瀏覽次數', async () => {
            Pet.findByIdAndUpdate.mockResolvedValue(mockPet);
            await petService_1.PetService.incrementViewCount('pet123');
            (0, globals_1.expect)(Pet.findByIdAndUpdate).toHaveBeenCalledWith('pet123', { $inc: { viewCount: 1 } }, { new: true });
        });
    });
    (0, globals_1.describe)('incrementShareCount', () => {
        (0, globals_1.it)('應該成功增加分享次數', async () => {
            Pet.findByIdAndUpdate.mockResolvedValue(mockPet);
            await petService_1.PetService.incrementShareCount('pet123');
            (0, globals_1.expect)(Pet.findByIdAndUpdate).toHaveBeenCalledWith('pet123', { $inc: { shareCount: 1 } }, { new: true });
        });
    });
});
console.log('✅ petService 測試檔案已載入');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXJ2aWNlc1xccGV0U2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsZ0NBQWdDO0FBQ2hDLDJDQUFrRjtBQU1sRixTQUFTO0FBQ1QsY0FBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2xDLGNBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNuQyxjQUFJLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFDbEQsY0FBSSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQzFDLGNBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQVRwQyxXQUFXO0FBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDO0FBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLHVEQUF1RCxDQUFDO0FBU2pGLFdBQVc7QUFDWCw4REFBeUY7QUFFekYsYUFBYTtBQUNiLE1BQU0sT0FBTyxHQUFHO0lBQ2QsR0FBRyxFQUFFLFFBQVE7SUFDYixJQUFJLEVBQUUsSUFBSTtJQUNWLElBQUksRUFBRSxLQUFLO0lBQ1gsS0FBSyxFQUFFLE1BQU07SUFDYixNQUFNLEVBQUUsTUFBTTtJQUNkLEtBQUssRUFBRSxTQUFTO0lBQ2hCLElBQUksRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsUUFBUSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7SUFDcEMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO0lBQ3JCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTtDQUN0QixDQUFDO0FBRUYsY0FBYztBQUNkLE1BQU0sUUFBUSxHQUFHO0lBQ2YsR0FBRyxFQUFFLFNBQVM7SUFDZCxRQUFRLEVBQUUsVUFBVTtJQUNwQixLQUFLLEVB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LElBQUksRUFBRSxDQUNkLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXJ2aWNlc1xccGV0U2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBldFNlcnZpY2Ug5Zau5YWD5ris6KmmIC0g57Ch5YyW54mI5pys77yM5LiN5L6d6LO05pW45pOa5bqrXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgamVzdCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5cbi8vIOioree9rua4rOippueSsOWig+iuiuaVuFxucHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG5wcm9jZXNzLmVudi5KV1RfU0VDUkVUID0gJ3Rlc3Qtand0LXNlY3JldC1rZXktd2l0aC1taW5pbXVtLTMyLWNoYXJhY3RlcnMtbGVuZ3RoJztcblxuLy8g5qih5pOs5aSW6YOo5L6d6LO0XG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9tb2RlbHMvUGV0Jyk7XG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9tb2RlbHMvVXNlcicpO1xuamVzdC5tb2NrKCcuLi8uLi9zcmMvc2VydmljZXMvY2xvdWRpbmFyeVNlcnZpY2UnKTtcbmplc3QubW9jaygnLi4vLi4vc3JjL3NlcnZpY2VzL2FpU2VydmljZScpO1xuamVzdC5tb2NrKCcuLi8uLi9zcmMvdXRpbHMvbG9nZ2VyJyk7XG5cbi8vIOWwjuWFpeimgea4rOippueahOacjeWLmVxuaW1wb3J0IHsgUGV0U2VydmljZSwgQ3JlYXRlUGV0RGF0YSwgVXBkYXRlUGV0RGF0YSB9IGZyb20gJy4uLy4uL3NyYy9zZXJ2aWNlcy9wZXRTZXJ2aWNlJztcblxuLy8g5qih5pOs55qEIFBldCDmqKHlnotcbmNvbnN0IG1vY2tQZXQgPSB7XG4gIF9pZDogJ3BldDEyMycsXG4gIG5hbWU6ICflsI/nmb0nLFxuICB0eXBlOiAnZG9nJyxcbiAgYnJlZWQ6ICfmi4nluIPmi4nlpJonLFxuICBzdGF0dXM6ICdsb3N0JyxcbiAgb3duZXI6ICd1c2VyMTIzJyxcbiAgc2F2ZTogamVzdC5mbigpLFxuICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXG59O1xuXG4vLyDmqKHmk6znmoQgVXNlciDmqKHlnotcbmNvbnN0IG1vY2tVc2VyID0ge1xuICBfaWQ6ICd1c2VyMTIzJyxcbiAgdXNlcm5hbWU6ICd0ZXN0dXNlcicsXG4gIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbSdcbn07XG5cbi8vIOaooeaTrCBQZXQg5qih5Z6L55qE6Z2c5oWL5pa55rOVXG5jb25zdCBQZXQgPSB7XG4gIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgZmluZEJ5SWRBbmRVcGRhdGU6IGplc3QuZm4oKSxcbiAgZmluZEJ5SWRBbmREZWxldGU6IGplc3QuZm4oKSxcbiAgZmluZDogamVzdC5mbigpLFxuICBjb3VudERvY3VtZW50czogamVzdC5mbigpLFxuICBkZWxldGVNYW55OiBqZXN0LmZuKClcbn07XG5cbi8vIOaooeaTrCBVc2VyIOaooeWei+eahOmdnOaFi+aWueazlVxuY29uc3QgVXNlciA9IHtcbiAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgZGVsZXRlTWFueTogamVzdC5mbigpXG59O1xuXG4vLyDmqKHmk6wgQ2xvdWRpbmFyeVNlcnZpY2VcbmNvbnN0IENsb3VkaW5hcnlTZXJ2aWNlID0ge1xuICB1cGxvYWRJbWFnZTogamVzdC5mbigpLFxuICBkZWxldGVJbWFnZTogamVzdC5mbigpXG59O1xuXG4vLyDmqKHmk6wgYWlTZXJ2aWNlXG5jb25zdCBhaVNlcnZpY2UgPSB7XG4gIGFuYWx5emVJbWFnZTogamVzdC5mbigpXG59O1xuXG4vLyDoqK3nva7mqKHmk6xcbnJlcXVpcmUoJy4uLy4uL3NyYy9tb2RlbHMvUGV0JykuUGV0ID0gUGV0O1xucmVxdWlyZSgnLi4vLi4vc3JjL21vZGVscy9Vc2VyJykuVXNlciA9IFVzZXI7XG5yZXF1aXJlKCcuLi8uLi9zcmMvc2VydmljZXMvY2xvdWRpbmFyeVNlcnZpY2UnKS5DbG91ZGluYXJ5U2VydmljZSA9IENsb3VkaW5hcnlTZXJ2aWNlO1xucmVxdWlyZSgnLi4vLi4vc3JjL3NlcnZpY2VzL2FpU2VydmljZScpLmFpU2VydmljZSA9IGFpU2VydmljZTtcblxuZGVzY3JpYmUoJ1BldFNlcnZpY2Ug5ris6KmmJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyDoqK3nva7poJDoqK3nmoTmqKHmk6zlm57mh4lcbiAgICBVc2VyLmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICBQZXQuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgLi4ubW9ja1BldCxcbiAgICAgIHBvcHVsYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BldClcbiAgICB9KTtcbiAgICBtb2NrUGV0LnNhdmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BldCk7XG4gICAgbW9ja1BldC5wb3B1bGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0KTtcbiAgfSk7XG4gIFxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVQZXQnLCAoKSA9PiB7XG4gICAgY29uc3QgcGV0RGF0YTogQ3JlYXRlUGV0RGF0YSA9IHtcbiAgICAgIG5hbWU6ICflsI/oirEnLFxuICAgICAgdHlwZTogJ2NhdCcsXG4gICAgICBicmVlZDogJ+azouaWr+iykycsXG4gICAgICBzdGF0dXM6ICdsb3N0JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAn6LWw5aSx55qE5bCP6LKTJyxcbiAgICAgIGxvY2F0aW9uOiB7XG4gICAgICAgIGFkZHJlc3M6ICflj7DljJfluILkv6HnvqnljYAnLFxuICAgICAgICBjaXR5OiAn5Y+w5YyX5biCJyxcbiAgICAgICAgY29vcmRpbmF0ZXM6IFsxMjEuNTY1NCwgMjUuMDMzMF1cbiAgICAgIH0sXG4gICAgICBjb250YWN0OiB7XG4gICAgICAgIHBob25lOiAnMDkxMjM0NTY3OCcsXG4gICAgICAgIGVtYWlsOiAnb3duZXJAZXhhbXBsZS5jb20nXG4gICAgICB9XG4gICAgfTtcblxuICAgIGl0KCfmh4noqbLmiJDlip/libXlu7rlr7XniaknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyDmqKHmk6wgUGV0IOani+mAoOWHveaVuFxuICAgICAgY29uc3QgbW9ja1BldENvbnN0cnVjdG9yID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgICAuLi5tb2NrUGV0LFxuICAgICAgICAuLi5wZXREYXRhLFxuICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyAuLi5tb2NrUGV0LCAuLi5wZXREYXRhIH0pLFxuICAgICAgICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja1BldCwgLi4ucGV0RGF0YSB9KVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBQZXQucHJvdG90eXBlID0gbW9ja1BldENvbnN0cnVjdG9yLnByb3RvdHlwZTtcbiAgICAgIGdsb2JhbC5QZXQgPSBtb2NrUGV0Q29uc3RydWN0b3I7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuY3JlYXRlUGV0KCd1c2VyMTIzJywgcGV0RGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChVc2VyLmZpbmRCeUlkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlcjEyMycpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubmFtZSkudG9CZShwZXREYXRhLm5hbWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+aHieipsuWcqOaTgeacieiAheS4jeWtmOWcqOaZguaLi+WHuumMr+iqpCcsIGFzeW5jICgpID0+IHtcbiAgICAgIFVzZXIuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChQZXRTZXJ2aWNlLmNyZWF0ZVBldCgnaW52YWxpZC11c2VyJywgcGV0RGF0YSkpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ+aTgeacieiAheS4jeWtmOWcqCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+aHieipsuiZleeQhuWclueJh+S4iuWCsycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBldERhdGFXaXRoSW1hZ2VzID0ge1xuICAgICAgICAuLi5wZXREYXRhLFxuICAgICAgICBpbWFnZXM6IFsnaW1hZ2UxLmpwZycsICdpbWFnZTIuanBnJ11cbiAgICAgIH07XG4gICAgICBcbiAgICAgIENsb3VkaW5hcnlTZXJ2aWNlLnVwbG9hZEltYWdlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgc2VjdXJlX3VybDogJ2h0dHBzOi8vY2xvdWRpbmFyeS5jb20vdGVzdC5qcGcnLFxuICAgICAgICBwdWJsaWNfaWQ6ICd0ZXN0X2lkJyxcbiAgICAgICAgd2lkdGg6IDgwMCxcbiAgICAgICAgaGVpZ2h0OiA2MDBcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBtb2NrUGV0Q29uc3RydWN0b3IgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICAgIC4uLm1vY2tQZXQsXG4gICAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0KSxcbiAgICAgICAgcG9wdWxhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0KVxuICAgICAgfSkpO1xuICAgICAgXG4gICAgICBnbG9iYWwuUGV0ID0gbW9ja1BldENvbnN0cnVjdG9yO1xuICAgICAgXG4gICAgICBhd2FpdCBQZXRTZXJ2aWNlLmNyZWF0ZVBldCgndXNlcjEyMycsIHBldERhdGFXaXRoSW1hZ2VzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KENsb3VkaW5hcnlTZXJ2aWNlLnVwbG9hZEltYWdlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQZXRCeUlkJywgKCkgPT4ge1xuICAgIGl0KCfmh4noqbLmiJDlip/moLnmk5pJROeNsuWPluWvteeJqScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuZ2V0UGV0QnlJZCgncGV0MTIzJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChQZXQuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwZXQxMjMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Py5faWQpLnRvQmUoJ3BldDEyMycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+aHieipsuWcqElE54Sh5pWI5pmC5ouL5Ye66Yyv6KqkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZXhwZWN0KFBldFNlcnZpY2UuZ2V0UGV0QnlJZCgnaW52YWxpZC1pZCcpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCfnhKHmlYjnmoTlr7XniakgSUQnKTtcbiAgICB9KTtcblxuICAgIGl0KCfmh4noqbLov5Tlm55udWxs55W25a+154mp5LiN5a2Y5ZyoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRCeUlkLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHBvcHVsYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICBleGVjOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobnVsbClcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQZXRTZXJ2aWNlLmdldFBldEJ5SWQoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlUGV0JywgKCkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZURhdGE6IFVwZGF0ZVBldERhdGEgPSB7XG4gICAgICBuYW1lOiAn5pu05paw55qE5bCP55m9JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAn5pu05paw55qE5o+P6L+wJ1xuICAgIH07XG5cbiAgICBpdCgn5oeJ6Kmy5oiQ5Yqf5pu05paw5a+154mpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BldCk7XG4gICAgICBQZXQuZmluZEJ5SWRBbmRVcGRhdGUubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgcG9wdWxhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLm1vY2tQZXQsIC4uLnVwZGF0ZURhdGEgfSlcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQZXRTZXJ2aWNlLnVwZGF0ZVBldCgncGV0MTIzJywgJ3VzZXIxMjMnLCB1cGRhdGVEYXRhKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KFBldC5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IF9pZDogJ3BldDEyMycsIG93bmVyOiAndXNlcjEyMycgfSk7XG4gICAgICBleHBlY3QoUGV0LmZpbmRCeUlkQW5kVXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Py5uYW1lKS50b0JlKHVwZGF0ZURhdGEubmFtZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5oeJ6Kmy5Zyo5a+154mp5LiN5a2Y5Zyo5pmC5ouL5Ye66Yyv6KqkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChQZXRTZXJ2aWNlLnVwZGF0ZVBldCgncGV0MTIzJywgJ3VzZXIxMjMnLCB1cGRhdGVEYXRhKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygn5a+154mp5LiN5a2Y5Zyo5oiW5oKo5rKS5pyJ5qyK6ZmQ5L+u5pS5Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWxldGVQZXQnLCAoKSA9PiB7XG4gICAgaXQoJ+aHieipsuaIkOWKn+WIqumZpOWvteeJqScsIGFzeW5jICgpID0+IHtcbiAgICAgIFBldC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1BldCxcbiAgICAgICAgaW1hZ2VzOiBbeyBwdWJsaWNJZDogJ3Rlc3RfaWQnLCB1cmw6ICd0ZXN0LmpwZycgfV1cbiAgICAgIH0pO1xuICAgICAgUGV0LmZpbmRCeUlkQW5kRGVsZXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICAgICAgQ2xvdWRpbmFyeVNlcnZpY2UuZGVsZXRlSW1hZ2UubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuZGVsZXRlUGV0KCdwZXQxMjMnLCAndXNlcjEyMycpO1xuICAgICAgXG4gICAgICBleHBlY3QoUGV0LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgX2lkOiAncGV0MTIzJywgb3duZXI6ICd1c2VyMTIzJyB9KTtcbiAgICAgIGV4cGVjdChQZXQuZmluZEJ5SWRBbmREZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdwZXQxMjMnKTtcbiAgICAgIGV4cGVjdChDbG91ZGluYXJ5U2VydmljZS5kZWxldGVJbWFnZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Rlc3RfaWQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5oeJ6Kmy5Zyo5a+154mp5LiN5a2Y5Zyo5pmC5ouL5Ye66Yyv6KqkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChQZXRTZXJ2aWNlLmRlbGV0ZVBldCgncGV0MTIzJywgJ3VzZXIxMjMnKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygn5a+154mp5LiN5a2Y5Zyo5oiW5oKo5rKS5pyJ5qyK6ZmQ5Yiq6ZmkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBbGxQZXRzJywgKCkgPT4ge1xuICAgIGl0KCfmh4noqbLmiJDlip/njbLlj5bmiYDmnInlr7XniaknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUGV0cyA9IFttb2NrUGV0LCB7IC4uLm1vY2tQZXQsIF9pZDogJ3BldDQ1NicsIG5hbWU6ICflsI/pu5EnIH1dO1xuICAgICAgXG4gICAgICBQZXQuZmluZC5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICBwb3B1bGF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgc29ydDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgICAgICBza2lwOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgICAgICAgbGltaXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgICAgICAgICAgIGV4ZWM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGV0cylcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBQZXQuY291bnREb2N1bWVudHMubW9ja1Jlc29sdmVkVmFsdWUoMik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFBldFNlcnZpY2UuZ2V0QWxsUGV0cygxLCAxMCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQucGV0cykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGFnZSkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxQYWdlcykudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2luY3JlbWVudFZpZXdDb3VudCcsICgpID0+IHtcbiAgICBpdCgn5oeJ6Kmy5oiQ5Yqf5aKe5Yqg54CP6Ka95qyh5pW4JywgYXN5bmMgKCkgPT4ge1xuICAgICAgUGV0LmZpbmRCeUlkQW5kVXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQZXQpO1xuICAgICAgXG4gICAgICBhd2FpdCBQZXRTZXJ2aWNlLmluY3JlbWVudFZpZXdDb3VudCgncGV0MTIzJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChQZXQuZmluZEJ5SWRBbmRVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAncGV0MTIzJyxcbiAgICAgICAgeyAkaW5jOiB7IHZpZXdDb3VudDogMSB9IH0sXG4gICAgICAgIHsgbmV3OiB0cnVlIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbmNyZW1lbnRTaGFyZUNvdW50JywgKCkgPT4ge1xuICAgIGl0KCfmh4noqbLmiJDlip/lop7liqDliIbkuqvmrKHmlbgnLCBhc3luYyAoKSA9PiB7XG4gICAgICBQZXQuZmluZEJ5SWRBbmRVcGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BldCk7XG4gICAgICBcbiAgICAgIGF3YWl0IFBldFNlcnZpY2UuaW5jcmVtZW50U2hhcmVDb3VudCgncGV0MTIzJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChQZXQuZmluZEJ5SWRBbmRVcGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAncGV0MTIzJyxcbiAgICAgICAgeyAkaW5jOiB7IHNoYXJlQ291bnQ6IDEgfSB9LFxuICAgICAgICB7IG5ldzogdHJ1ZSB9XG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5jb25zb2xlLmxvZygn4pyFIHBldFNlcnZpY2Ug5ris6Kmm5qqU5qGI5bey6LyJ5YWlJyk7Il0sInZlcnNpb24iOjN9