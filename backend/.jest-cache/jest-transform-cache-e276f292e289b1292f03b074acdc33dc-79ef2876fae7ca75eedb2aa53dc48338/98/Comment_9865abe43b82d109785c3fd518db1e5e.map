{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\models\\Comment.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qDAAsD;AAkBtD,YAAY;AACZ,MAAM,aAAa,GAAG,IAAI,iBAAM,CAAW;IACzC,KAAK,EAAE;QACL,IAAI,EAAE,iBAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,GAAG,EAAE,KAAK;QACV,QAAQ,EAAE,CAAC,IAAI,EAAE,WAAW,CAAC;QAC7B,KAAK,EAAE,IAAI;KACZ;IACD,MAAM,EAAE;QACN,IAAI,EAAE,iBAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,GAAG,EAAE,MAAM;QACX,QAAQ,EAAE,CAAC,IAAI,EAAE,WAAW,CAAC;QAC7B,KAAK,EAAE,IAAI;KACZ;IACD,OAAO,EAAE;QACP,IAAI,EAAE,MAAM;QACZ,QAAQ,EAAE,CAAC,IAAI,EAAE,WAAW,CAAC;QAC7B,IAAI,EAAE,IAAI;QACV,SAAS,EAAE,CAAC,GAAG,EAAE,kBAAkB,CAAC;QACpC,SAAS,EAAE,CAAC,CAAC,EAAE,UAAU,CAAC;KAC3B;IACD,QAAQ,EAAE;QACR,IAAI,EAAE,iBAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,GAAG,EAAE,SAAS;QACd,OAAO,EAAE,IAAI;QACb,KAAK,EAAE,IAAI;KACZ;IACD,SAAS,EAAE;QACT,IAAI,EAAE,OAAO;QACb,OAAO,EAAE,KAAK;QACd,KAAK,EAAE,IAAI;KACZ;IACD,SAAS,EAAE;QACT,IAAI,EAAE,IAAI;QACV,OAAO,EAAE,IAAI;KACd;IACD,SAAS,EAAE;QACT,IAAI,EAAE,iBAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,GAAG,EAAE,MAAM;QACX,OAAO,EAAE,IAAI;KACd;IACD,WAAW,EAAE;QACX,IAAI,EAAE,MAAM;QACZ,OAAO,EAAE,CAAC;QACV,GAAG,EAAE,CAAC;KACP;IACD,QAAQ,EAAE;QACR,IAAI,EAAE,OAAO;QACb,OAAO,EAAE,KAAK;QACd,KAAK,EAAE,IAAI;KACZ;CACF,EAAE;IACD,UAAU,EAAE,IAAI;IAChB,MAAM,EAAE;QACN,SAAS,EAAE,UAAS,GAAG,EAAE,GAAG;YAC1B,GAAG,CAAC,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC;YACjB,OAAQ,GAAW,CAAC,GAAG,CAAC;YACxB,OAAQ,GAAW,CAAC,GAAG,CAAC;YACxB,OAAO,GAAG,CAAC;QACb,CAAC;KACF;CACF,CAAC,CAAC;AAEH,OAAO;AACP,aAAa,CAAC,KAAK,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AACjD,aAAa,CAAC,KAAK,CAAC,EAAE,MAAM,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AAClD,aAAa,CAAC,KAAK,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC;AACnD,aAAa,CAAC,KAAK,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC;AAEnD,wDAAwD;AAE3C,QAAA,OAAO,GAAG,kBAAQ,CAAC,KAAK,CAAW,SAAS,EAAE,aAAa,CAAC,CAAC","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\models\\Comment.ts"],"sourcesContent":["import mongoose, { Document, Schema } from 'mongoose';\n\n// 留言介面定義\nexport interface IComment extends Document {\n  _id: mongoose.Types.ObjectId;\n  petId: mongoose.Types.ObjectId;\n  userId: mongoose.Types.ObjectId;\n  content: string;\n  parentId?: mongoose.Types.ObjectId; // 用於回覆留言\n  isDeleted: boolean;\n  deletedAt?: Date;\n  deletedBy?: mongoose.Types.ObjectId; // 刪除者 (可能是管理員)\n  reportCount: number;\n  isHidden: boolean; // 被舉報後隱藏\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n// 留言 Schema\nconst commentSchema = new Schema<IComment>({\n  petId: {\n    type: Schema.Types.ObjectId,\n    ref: 'Pet',\n    required: [true, '寵物ID為必填項目'],\n    index: true,\n  },\n  userId: {\n    type: Schema.Types.ObjectId,\n    ref: 'User',\n    required: [true, '用戶ID為必填項目'],\n    index: true,\n  },\n  content: {\n    type: String,\n    required: [true, '留言內容為必填項目'],\n    trim: true,\n    maxlength: [500, '留言內容不能超過 500 個字符'],\n    minlength: [1, '留言內容不能為空'],\n  },\n  parentId: {\n    type: Schema.Types.ObjectId,\n    ref: 'Comment',\n    default: null,\n    index: true,\n  },\n  isDeleted: {\n    type: Boolean,\n    default: false,\n    index: true,\n  },\n  deletedAt: {\n    type: Date,\n    default: null,\n  },\n  deletedBy: {\n    type: Schema.Types.ObjectId,\n    ref: 'User',\n    default: null,\n  },\n  reportCount: {\n    type: Number,\n    default: 0,\n    min: 0,\n  },\n  isHidden: {\n    type: Boolean,\n    default: false,\n    index: true,\n  },\n}, {\n  timestamps: true,\n  toJSON: {\n    transform: function(doc, ret) {\n      ret.id = ret._id;\n      delete (ret as any)._id;\n      delete (ret as any).__v;\n      return ret;\n    },\n  },\n});\n\n// 複合索引\ncommentSchema.index({ petId: 1, createdAt: -1 });\ncommentSchema.index({ userId: 1, createdAt: -1 });\ncommentSchema.index({ parentId: 1, createdAt: 1 });\ncommentSchema.index({ isDeleted: 1, isHidden: 1 });\n\n// 注意：查詢時需要手動添加 { isDeleted: false, isHidden: false } 條件\n\nexport const Comment = mongoose.model<IComment>('Comment', commentSchema);"],"version":3}