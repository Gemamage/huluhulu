{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\routes\\reports.ts","mappings":"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","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\routes\\reports.ts"],"sourcesContent":["import express from 'express';\nimport { Request, Response } from 'express';\nimport { reportService } from '../services/reportService';\nimport { authenticate } from '../middleware/auth';\nimport { body, param, query } from 'express-validator';\n\nconst router = express.Router();\n\n/**\n * 創建舉報\n */\nrouter.post('/',\n  authenticate,\n  [\n    body('contentType').isIn(['user', 'comment', 'review', 'message', 'pet']).withMessage('無效的內容類型'),\n    body('contentId').isMongoId().withMessage('無效的內容ID'),\n    body('reason').trim().isLength({ min: 1, max: 500 }).withMessage('舉報原因長度必須在1-500字之間'),\n    body('category').optional().isIn(['spam', 'harassment', 'inappropriate', 'fake', 'other']).withMessage('無效的舉報類別')\n  ],\n  async (req: Request, res: Response) => {\n    try {\n      const { contentType, contentId, reason, category } = req.body;\n      const reporterId = req.user!.id;\n\n      const report = await reportService.createReport({\n        reporterId,\n        contentType,\n        contentId,\n        reason,\n        category\n      });\n\n      res.status(201).json({\n        success: true,\n        data: report,\n        message: '舉報提交成功'\n      });\n    } catch (error: any) {\n      res.status(400).json({\n        success: false,\n        message: error.message || '提交舉報失敗'\n      });\n    }\n  }\n);\n\n/**\n * 獲取用戶的舉報歷史\n */\nrouter.get('/my-reports',\n  authenticate,\n  [\n    query('page').optional().isInt({ min: 1 }).withMessage('頁碼必須是正整數'),\n    query('limit').optional().isInt({ min: 1, max: 50 }).withMessage('每頁數量必須在1-50之間'),\n    query('status').optional().isIn(['pending', 'investigating', 'resolved', 'dismissed']).withMessage('無效的狀態')\n  ],\n  async (req: Request, res: Response) => {\n    try {\n      const userId = req.user!.id;\n      const {\n        page = 1,\n        limit = 20,\n        status\n      } = req.query;\n\n      const result = await reportService.getReportsByUser(userId, {\n        page: Number(page),\n        limit: Number(limit),\n        status: status as string\n      });\n\n      res.json({\n        success: true,\n        data: result\n      });\n    } catch (error: any) {\n      res.status(400).json({\n        success: false,\n        message: error.message || '獲取舉報歷史失敗'\n      });\n    }\n  }\n);\n\n// ==================== 管理員專用路由 ====================\n\n/**\n * 獲取所有舉報（管理員）\n */\nrouter.get('/admin/all',\n  authenticate,\n  [\n    query('page').optional().isInt({ min: 1 }).withMessage('頁碼必須是正整數'),\n    query('limit').optional().isInt({ min: 1, max: 100 }).withMessage('每頁數量必須在1-100之間'),\n    query('status').optional().isIn(['pending', 'investigating', 'resolved', 'dismissed']).withMessage('無效的狀態'),\n    query('priority').optional().isIn(['low', 'medium', 'high', 'urgent']).withMessage('無效的優先級'),\n    query('contentType').optional().isIn(['user', 'comment', 'review', 'message', 'pet']).withMessage('無效的內容類型'),\n    query('assignedTo').optional().isMongoId().withMessage('無效的指派對象ID')\n  ],\n  async (req: Request, res: Response) => {\n    try {\n      const {\n        page = 1,\n        limit = 20,\n        status,\n        priority,\n        contentType,\n        assignedTo,\n        sortBy = 'createdAt',\n        sortOrder = 'desc'\n      } = req.query;\n\n      const result = await reportService.getReports({\n        status: status as string,\n        priority: priority as string,\n        contentType: contentType as string,\n        assignedTo: assignedTo as string,\n        page: Number(page),\n        limit: Number(limit),\n        sortBy: sortBy as 'createdAt' | 'priority' | 'status',\n        sortOrder: sortOrder as 'asc' | 'desc'\n      });\n\n      res.json({\n        success: true,\n        data: result\n      });\n    } catch (error: any) {\n      res.status(400).json({\n        success: false,\n        message: error.message || '獲取舉報列表失敗'\n      });\n    }\n  }\n);\n\n/**\n * 更新舉報狀態（管理員）\n */\nrouter.put('/admin/:reportId',\n  authenticate,\n  [\n    param('reportId').isMongoId().withMessage('無效的舉報ID'),\n    body('status').optional().isIn(['pending', 'investigating', 'resolved', 'dismissed']).withMessage('無效的狀態'),\n    body('priority').optional().isIn(['low', 'medium', 'high', 'urgent']).withMessage('無效的優先級'),\n    body('assignedTo').optional().isMongoId().withMessage('無效的指派對象ID'),\n    body('resolution').optional().trim().isLength({ max: 1000 }).withMessage('處理結果不能超過1000字')\n  ],\n  async (req: Request, res: Response) => {\n    try {\n      const { reportId } = req.params;\n      const { status, priority, assignedTo, resolution } = req.body;\n      const adminId = req.user!.id;\n\n      if (!reportId) {\n        return res.status(400).json({\n          success: false,\n          message: '缺少舉報ID參數'\n        });\n      }\n\n      const report = await reportService.updateReport(reportId, adminId, {\n        status,\n        priority,\n        assignedTo,\n        resolution\n      });\n\n      if (!report) {\n        return res.status(404).json({\n          success: false,\n          message: '舉報不存在'\n        });\n      }\n\n      return res.json({\n        success: true,\n        data: report,\n        message: '舉報更新成功'\n      });\n    } catch (error: any) {\n      return res.status(400).json({\n        success: false,\n        message: error.message || '更新舉報失敗'\n      });\n    }\n  }\n);\n\n/**\n * 批量處理舉報（管理員）\n */\nrouter.put('/admin/batch',\n  authenticate,\n  [\n    body('reportIds').isArray({ min: 1 }).withMessage('舉報ID列表不能為空'),\n    body('reportIds.*').isMongoId().withMessage('無效的舉報ID'),\n    body('status').optional().isIn(['pending', 'investigating', 'resolved', 'dismissed']).withMessage('無效的狀態'),\n    body('priority').optional().isIn(['low', 'medium', 'high', 'urgent']).withMessage('無效的優先級'),\n    body('assignedTo').optional().isMongoId().withMessage('無效的指派對象ID')\n  ],\n  async (req: Request, res: Response) => {\n    try {\n      const { reportIds, status, priority, assignedTo } = req.body;\n      const adminId = req.user!.id;\n\n      const updatedCount = await reportService.batchUpdateReports(reportIds, adminId, {\n        status,\n        priority,\n        assignedTo\n      });\n\n      res.json({\n        success: true,\n        data: { updatedCount },\n        message: `成功更新 ${updatedCount} 個舉報`\n      });\n    } catch (error: any) {\n      res.status(400).json({\n        success: false,\n        message: error.message || '批量更新舉報失敗'\n      });\n    }\n  }\n);\n\n/**\n * 獲取舉報統計（管理員）\n */\nrouter.get('/admin/stats',\n  authenticate,\n  [\n    query('timeRange').optional().isIn(['day', 'week', 'month', 'year']).withMessage('無效的時間範圍')\n  ],\n  async (req: Request, res: Response) => {\n    try {\n      const { timeRange } = req.query;\n      const stats = await reportService.getReportStats(timeRange as any);\n\n      res.json({\n        success: true,\n        data: stats\n      });\n    } catch (error: any) {\n      res.status(400).json({\n        success: false,\n        message: error.message || '獲取舉報統計失敗'\n      });\n    }\n  }\n);\n\n/**\n * 自動處理舉報（管理員）\n */\nrouter.post('/admin/auto-process',\n  authenticate,\n  async (req: Request, res: Response) => {\n    try {\n      const result = await reportService.autoProcessReports();\n\n      res.json({\n        success: true,\n        data: result,\n        message: `自動處理完成，處理了 ${result.processed} 個舉報`\n      });\n    } catch (error: any) {\n      res.status(400).json({\n        success: false,\n        message: error.message || '自動處理舉報失敗'\n      });\n    }\n  }\n);\n\nexport default router;"],"version":3}