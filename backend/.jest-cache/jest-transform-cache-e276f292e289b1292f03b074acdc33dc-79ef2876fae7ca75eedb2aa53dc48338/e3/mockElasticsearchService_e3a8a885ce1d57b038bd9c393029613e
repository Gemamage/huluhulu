1796038a3111d71441a145eb5e83070b
"use strict";
/**
 * Mock Elasticsearch Service
 * 用於在沒有 Elasticsearch 環境時提供模擬搜尋功能
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockElasticsearchService = void 0;
const Pet_1 = require("../models/Pet");
class MockElasticsearchService {
    constructor() {
        this.searchHistory = [];
    }
    /**
     * 模擬 Elasticsearch 連接檢查
     */
    async checkConnection() {
        // 模擬連接延遲
        await new Promise((resolve) => setTimeout(resolve, 100));
        return true;
    }
    /**
     * 模擬健康檢查
     */
    async getHealth() {
        return {
            status: "green",
            cluster_name: "mock-cluster",
            number_of_nodes: 1,
            number_of_data_nodes: 1,
            active_primary_shards: 5,
            active_shards: 5,
            relocating_shards: 0,
            initializing_shards: 0,
            unassigned_shards: 0,
            delayed_unassigned_shards: 0,
            number_of_pending_tasks: 0,
            number_of_in_flight_fetch: 0,
            task_max_waiting_in_queue_millis: 0,
            active_shards_percent_as_number: 100.0,
        };
    }
    /**
     * 模擬寵物搜尋
     */
    async searchPets(searchQuery) {
        const startTime = Date.now();
        // 記錄搜尋歷史
        this.searchHistory.push({
            query: searchQuery.query || "",
            timestamp: new Date(),
            filters: searchQuery,
        });
        try {
            // 建構 MongoDB 查詢
            const mongoQuery = {};
            // 文字搜尋
            if (searchQuery.query) {
                mongoQuery.$or = [
                    { name: { $regex: searchQuery.query, $options: "i" } },
                    { description: { $regex: searchQuery.query, $options: "i" } },
                    { lastSeenLocation: { $regex: searchQuery.query, $options: "i" } },
                    { breed: { $regex: searchQuery.query, $options: "i" } },
                ];
            }
            // 篩選條件
            if (searchQuery.type)
                mongoQuery.type = searchQuery.type;
            if (searchQuery.status)
                mongoQuery.status = searchQuery.status;
            if (searchQuery.breed)
                mongoQuery.breed = searchQuery.breed;
            if (searchQuery.size)
                mongoQuery.size = searchQuery.size;
            if (searchQuery.gender)
                mongoQuery.gender = searchQuery.gender;
            if (searchQuery.color)
                mongoQuery.color = searchQuery.color;
            if (searchQuery.location) {
                mongoQuery.lastSeenLocation = {
                    $regex: searchQuery.location,
                    $options: "i",
                };
            }
            // 分頁設定
            const page = searchQuery.page || 1;
            const limit = searchQuery.limit || 12;
            const skip = (page - 1) * limit;
            // 排序設定
            const sortBy = searchQuery.sortBy || "createdAt";
            const sortOrder = searchQuery.sortOrder === "asc" ? 1 : -1;
            const sort = { [sortBy]: sortOrder };
            // 執行查詢
            const [pets, total] = await Promise.all([
                Pet_1.Pet.find(mongoQuery)
                    .sort(sort)
                    .skip(skip)
                    .limit(limit)
                    .populate("userId", "username email")
                    .lean(),
                Pet_1.Pet.countDocuments(mongoQuery),
            ]);
            const took = Date.now() - startTime;
            // 轉換為 Elasticsearch 格式
            const hits = pets.map((pet, index) => ({
                id: pet._id.toString(),
                score: 1.0 - index * 0.1, // 模擬相關性分數
                source: pet,
                highlights: this.generateHighlights(pet, searchQuery.query),
            }));
            return {
                hits,
                total,
                maxScore: hits.length > 0 ? hits[0].score : 0,
                took,
            };
        }
        catch (error) {
            console.error("Mock search error:", error);
            throw error;
        }
    }
    /**
     * 模擬搜尋建議
     */
    async getSearchSuggestions(query) {
        if (!query || query.length < 2) {
            return [];
        }
        const suggestions = [];
        try {
            // 品種建議
            const breeds = await Pet_1.Pet.distinct("breed", {
                breed: { $regex: query, $options: "i" },
            });
            breeds.slice(0, 3).forEach((breed) => {
                suggestions.push({
                    text: breed,
                    score: 0.9,
                    type: "breed",
                });
            });
            // 地點建議
            const locations = await Pet_1.Pet.distinct("lastSeenLocation", {
                lastSeenLocation: { $regex: query, $options: "i" },
            });
            locations.slice(0, 3).forEach((location) => {
                suggestions.push({
                    text: location,
                    score: 0.8,
                    type: "location",
                });
            });
            // 名稱建議
            const names = await Pet_1.Pet.find({ name: { $regex: query, $options: "i" } }, { name: 1 }).limit(3);
            names.forEach((pet) => {
                suggestions.push({
                    text: pet.name,
                    score: 0.7,
                    type: "name",
                });
            });
        }
        catch (error) {
            console.error("Mock suggestions error:", error);
        }
        return suggestions.sort((a, b) => b.score - a.score);
    }
    /**
     * 模擬搜尋分析
     */
    async getSearchAnalytics(timeRange = "7d") {
        const days = parseInt(timeRange.replace("d", "")) || 7;
        const startDate = new Date();
        startDate.setDate(startDate.getDate() - days);
        const recentSearches = this.searchHistory.filter((search) => search.timestamp >= startDate);
        // 熱門查詢
        const queryCount = {};
        recentSearches.forEach((search) => {
            if (search.query) {
                queryCount[search.query] = (queryCount[search.query] || 0) + 1;
            }
        });
        const popularQueries = Object.entries(queryCount)
            .map(([query, count]) => ({ query, count }))
            .sort((a, b) => b.count - a.count)
            .slice(0, 10);
        // 熱門篩選
        const typeCount = {};
        const locationCount = {};
        const breedCount = {};
        recentSearches.forEach((search) => {
            if (search.filters.type) {
                typeCount[search.filters.type] =
                    (typeCount[search.filters.type] || 0) + 1;
            }
            if (search.filters.location) {
                locationCount[search.filters.location] =
                    (locationCount[search.filters.location] || 0) + 1;
            }
            if (search.filters.breed) {
                breedCount[search.filters.breed] =
                    (breedCount[search.filters.breed] || 0) + 1;
            }
        });
        // 搜尋趨勢
        const searchTrends = [];
        for (let i = days - 1; i >= 0; i--) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            const dateStr = date.toISOString().split("T")[0];
            const count = recentSearches.filter((search) => {
                const searchDate = search.timestamp.toISOString().split("T")[0];
                return searchDate === dateStr;
            }).length;
            searchTrends.push({ date: dateStr, count });
        }
        return {
            totalSearches: recentSearches.length,
            popularQueries,
            popularFilters: {
                types: Object.entries(typeCount).map(([key, count]) => ({
                    key,
                    count,
                })),
                locations: Object.entries(locationCount).map(([key, count]) => ({
                    key,
                    count,
                })),
                breeds: Object.entries(breedCount).map(([key, count]) => ({
                    key,
                    count,
                })),
            },
            searchTrends,
            averageResponseTime: 150, // 模擬平均回應時間
            successRate: 99.5, // 模擬成功率
        };
    }
    /**
     * 生成高亮顯示
     */
    generateHighlights(pet, query) {
        if (!query)
            return {};
        const highlights = {};
        const regex = new RegExp(query, "gi");
        if (pet.name && regex.test(pet.name)) {
            highlights.name = [pet.name.replace(regex, `<em>${query}</em>`)];
        }
        if (pet.description && regex.test(pet.description)) {
            const snippet = pet.description.substring(0, 200);
            highlights.description = [snippet.replace(regex, `<em>${query}</em>`)];
        }
        if (pet.lastSeenLocation && regex.test(pet.lastSeenLocation)) {
            highlights.lastSeenLocation = [
                pet.lastSeenLocation.replace(regex, `<em>${query}</em>`),
            ];
        }
        return highlights;
    }
    /**
     * 模擬索引初始化
     */
    async initializeIndex() {
        console.log("Mock Elasticsearch: 索引初始化完成");
        return true;
    }
    /**
     * 模擬文檔索引
     */
    async indexDocument(index, id, document) {
        console.log(`Mock Elasticsearch: 文檔已索引 - ${index}/${id}`);
        return true;
    }
    /**
     * 模擬批量索引
     */
    async bulkIndex(operations) {
        console.log(`Mock Elasticsearch: 批量索引 ${operations.length} 個文檔`);
        return {
            took: 100,
            errors: false,
            items: operations.map((_, index) => ({
                index: {
                    _index: "pets",
                    _id: `mock_${index}`,
                    _version: 1,
                    result: "created",
                    status: 201,
                },
            })),
        };
    }
    /**
     * 模擬重新索引
     */
    async reindexAllPets() {
        try {
            const totalPets = await Pet_1.Pet.countDocuments();
            console.log(`Mock Elasticsearch: 重新索引 ${totalPets} 個寵物文檔`);
            return {
                success: true,
                indexed: totalPets,
                failed: 0,
            };
        }
        catch (error) {
            console.error("Mock reindex error:", error);
            return {
                success: false,
                indexed: 0,
                failed: 1,
            };
        }
    }
    /**
     * 模擬效能指標
     */
    getPerformanceMetrics() {
        return {
            totalRequests: this.searchHistory.length,
            averageResponseTime: 150,
            successRate: 99.5,
            errorRate: 0.5,
            lastUpdated: new Date().toISOString(),
        };
    }
}
exports.mockElasticsearchService = new MockElasticsearchService();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHNlcnZpY2VzXFxtb2NrRWxhc3RpY3NlYXJjaFNlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsdUNBQW9DO0FBMkNwQyxNQUFNLHdCQUF3QjtJQUE5QjtRQUNVLGtCQUFhLEdBSWhCLEVBQUUsQ0FBQztJQXdXVixDQUFDO0lBdFdDOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGVBQWU7UUFDbkIsU0FBUztRQUNULE1BQU0sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN6RCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxTQUFTO1FBQ2IsT0FBTztZQUNMLE1BQU0sRUFBRSxPQUFPO1lBQ2YsWUFBWSxFQUFFLGNBQWM7WUFDNUIsZUFBZSxFQUFFLENBQUM7WUFDbEIsb0JBQW9CLEVBQUUsQ0FBQztZQUN2QixxQkFBcUIsRUFBRSxDQUFDO1lBQ3hCLGFBQWEsRUFBRSxDQUFDO1lBQ2hCLGlCQUFpQixFQUFFLENBQUM7WUFDcEIsbUJBQW1CLEVBQUUsQ0FBQztZQUN0QixpQkFBaUIsRUFBRSxDQUFDO1lBQ3BCLHlCQUF5QixFQUFFLENBQUM7WUFDNUIsdUJBQXVCLEVBQUUsQ0FBQztZQUMxQix5QkFBeUIsRUFBRSxDQUFDO1lBQzVCLGdDQUFnQyxFQUFFLENBQUM7WUFDbkMsK0JBQStCLEVBQUUsS0FBSztTQUN2QyxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLFVBQVUsQ0FBQyxXQUE0QjtRQUMzQyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFN0IsU0FBUztRQUNULElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDO1lB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LENBQUM7Q0FDRjtBQUVZLFFBQUEsd0JBQXdCLEdBQUcsSUFBSSx3QkFBd0IsRUFBRSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcVXNlclxcRGVza3RvcFxcdHJhZXByb2plY3RcXHRlc3QyXFxwZXQtZmluZGVyLWFwcFxcYmFja2VuZFxcc3JjXFxzZXJ2aWNlc1xcbW9ja0VsYXN0aWNzZWFyY2hTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9jayBFbGFzdGljc2VhcmNoIFNlcnZpY2VcbiAqIOeUqOaWvOWcqOaykuaciSBFbGFzdGljc2VhcmNoIOeSsOWig+aZguaPkOS+m+aooeaTrOaQnOWwi+WKn+iDvVxuICovXG5cbmltcG9ydCB7IFBldCB9IGZyb20gXCIuLi9tb2RlbHMvUGV0XCI7XG5pbXBvcnQgeyBTZWFyY2hSZXN1bHQsIFNlYXJjaFJlc3BvbnNlIH0gZnJvbSBcIi4vZWxhc3RpY3NlYXJjaFNlcnZpY2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBNb2NrU2VhcmNoUXVlcnkge1xuICBxdWVyeT86IHN0cmluZztcbiAgdHlwZT86IHN0cmluZztcbiAgc3RhdHVzPzogc3RyaW5nO1xuICBicmVlZD86IHN0cmluZztcbiAgbG9jYXRpb24/OiBzdHJpbmc7XG4gIHNpemU/OiBzdHJpbmc7XG4gIGdlbmRlcj86IHN0cmluZztcbiAgY29sb3I/OiBzdHJpbmc7XG4gIHBhZ2U/OiBudW1iZXI7XG4gIGxpbWl0PzogbnVtYmVyO1xuICBzb3J0Qnk/OiBzdHJpbmc7XG4gIHNvcnRPcmRlcj86IFwiYXNjXCIgfCBcImRlc2NcIjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2NrU2VhcmNoU3VnZ2VzdGlvbiB7XG4gIHRleHQ6IHN0cmluZztcbiAgc2NvcmU6IG51bWJlcjtcbiAgdHlwZTogXCJicmVlZFwiIHwgXCJsb2NhdGlvblwiIHwgXCJkZXNjcmlwdGlvblwiIHwgXCJuYW1lXCI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9ja1NlYXJjaEFuYWx5dGljcyB7XG4gIHRvdGFsU2VhcmNoZXM6IG51bWJlcjtcbiAgcG9wdWxhclF1ZXJpZXM6IEFycmF5PHtcbiAgICBxdWVyeTogc3RyaW5nO1xuICAgIGNvdW50OiBudW1iZXI7XG4gIH0+O1xuICBwb3B1bGFyRmlsdGVyczoge1xuICAgIHR5cGVzOiBBcnJheTx7IGtleTogc3RyaW5nOyBjb3VudDogbnVtYmVyIH0+O1xuICAgIGxvY2F0aW9uczogQXJyYXk8eyBrZXk6IHN0cmluZzsgY291bnQ6IG51bWJlciB9PjtcbiAgICBicmVlZHM6IEFycmF5PHsga2V5OiBzdHJpbmc7IGNvdW50OiBudW1iZXIgfT47XG4gIH07XG4gIHNlYXJjaFRyZW5kczogQXJyYXk8e1xuICAgIGRhdGU6IHN0cmluZztcbiAgICBjb3VudDogbnVtYmVyO1xuICB9PjtcbiAgYXZlcmFnZVJlc3BvbnNlVGltZTogbnVtYmVyO1xuICBzdWNjZXNzUmF0ZTogbnVtYmVyO1xufVxuXG5jbGFzcyBNb2NrRWxhc3RpY3NlYXJjaFNlcnZpY2Uge1xuICBwcml2YXRlIHNlYXJjaEhpc3Rvcnk6IEFycmF5PHtcbiAgICBxdWVyeTogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogRGF0ZTtcbiAgICBmaWx0ZXJzOiBhbnk7XG4gIH0+ID0gW107XG5cbiAgLyoqXG4gICAqIOaooeaTrCBFbGFzdGljc2VhcmNoIOmAo+aOpeaqouafpVxuICAgKi9cbiAgYXN5bmMgY2hlY2tDb25uZWN0aW9uKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIOaooeaTrOmAo+aOpeW7tumBslxuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIOaooeaTrOWBpeW6t+aqouafpVxuICAgKi9cbiAgYXN5bmMgZ2V0SGVhbHRoKCk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1czogXCJncmVlblwiLFxuICAgICAgY2x1c3Rlcl9uYW1lOiBcIm1vY2stY2x1c3RlclwiLFxuICAgICAgbnVtYmVyX29mX25vZGVzOiAxLFxuICAgICAgbnVtYmVyX29mX2RhdGFfbm9kZXM6IDEsXG4gICAgICBhY3RpdmVfcHJpbWFyeV9zaGFyZHM6IDUsXG4gICAgICBhY3RpdmVfc2hhcmRzOiA1LFxuICAgICAgcmVsb2NhdGluZ19zaGFyZHM6IDAsXG4gICAgICBpbml0aWFsaXppbmdfc2hhcmRzOiAwLFxuICAgICAgdW5hc3NpZ25lZF9zaGFyZHM6IDAsXG4gICAgICBkZWxheWVkX3VuYXNzaWduZWRfc2hhcmRzOiAwLFxuICAgICAgbnVtYmVyX29mX3BlbmRpbmdfdGFza3M6IDAsXG4gICAgICBudW1iZXJfb2ZfaW5fZmxpZ2h0X2ZldGNoOiAwLFxuICAgICAgdGFza19tYXhfd2FpdGluZ19pbl9xdWV1ZV9taWxsaXM6IDAsXG4gICAgICBhY3RpdmVfc2hhcmRzX3BlcmNlbnRfYXNfbnVtYmVyOiAxMDAuMCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOaooeaTrOWvteeJqeaQnOWwi1xuICAgKi9cbiAgYXN5bmMgc2VhcmNoUGV0cyhzZWFyY2hRdWVyeTogTW9ja1NlYXJjaFF1ZXJ5KTogUHJvbWlzZTxTZWFyY2hSZXNwb25zZT4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICAvLyDoqJjpjITmkJzlsIvmrbflj7JcbiAgICB0aGlzLnNlYXJjaEhpc3RvcnkucHVzaCh7XG4gICAgICBxdWVyeTogc2VhcmNoUXVlcnkucXVlcnkgfHwgXCJcIixcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGZpbHRlcnM6IHNlYXJjaFF1ZXJ5LFxuICAgIH0pO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIOW7uuaniyBNb25nb0RCIOafpeipolxuICAgICAgY29uc3QgbW9uZ29RdWVyeTogYW55ID0ge307XG5cbiAgICAgIC8vIOaWh+Wtl+aQnOWwi1xuICAgICAgaWYgKHNlYXJjaFF1ZXJ5LnF1ZXJ5KSB7XG4gICAgICAgIG1vbmdvUXVlcnkuJG9yID0gW1xuICAgICAgICAgIHsgbmFtZTogeyAkcmVnZXg6IHNlYXJjaFF1ZXJ5LnF1ZXJ5LCAkb3B0aW9uczogXCJpXCIgfSB9LFxuICAgICAgICAgIHsgZGVzY3JpcHRpb246IHsgJHJlZ2V4OiBzZWFyY2hRdWVyeS5xdWVyeSwgJG9wdGlvbnM6IFwiaVwiIH0gfSxcbiAgICAgICAgICB7IGxhc3RTZWVuTG9jYXRpb246IHsgJHJlZ2V4OiBzZWFyY2hRdWVyeS5xdWVyeSwgJG9wdGlvbnM6IFwiaVwiIH0gfSxcbiAgICAgICAgICB7IGJyZWVkOiB7ICRyZWdleDogc2VhcmNoUXVlcnkucXVlcnksICRvcHRpb25zOiBcImlcIiB9IH0sXG4gICAgICAgIF07XG4gICAgICB9XG5cbiAgICAgIC8vIOevqemBuOaineS7tlxuICAgICAgaWYgKHNlYXJjaFF1ZXJ5LnR5cGUpIG1vbmdvUXVlcnkudHlwZSA9IHNlYXJjaFF1ZXJ5LnR5cGU7XG4gICAgICBpZiAoc2VhcmNoUXVlcnkuc3RhdHVzKSBtb25nb1F1ZXJ5LnN0YXR1cyA9IHNlYXJjaFF1ZXJ5LnN0YXR1cztcbiAgICAgIGlmIChzZWFyY2hRdWVyeS5icmVlZCkgbW9uZ29RdWVyeS5icmVlZCA9IHNlYXJjaFF1ZXJ5LmJyZWVkO1xuICAgICAgaWYgKHNlYXJjaFF1ZXJ5LnNpemUpIG1vbmdvUXVlcnkuc2l6ZSA9IHNlYXJjaFF1ZXJ5LnNpemU7XG4gICAgICBpZiAoc2VhcmNoUXVlcnkuZ2VuZGVyKSBtb25nb1F1ZXJ5LmdlbmRlciA9IHNlYXJjaFF1ZXJ5LmdlbmRlcjtcbiAgICAgIGlmIChzZWFyY2hRdWVyeS5jb2xvcikgbW9uZ29RdWVyeS5jb2xvciA9IHNlYXJjaFF1ZXJ5LmNvbG9yO1xuICAgICAgaWYgKHNlYXJjaFF1ZXJ5LmxvY2F0aW9uKSB7XG4gICAgICAgIG1vbmdvUXVlcnkubGFzdFNlZW5Mb2NhdGlvbiA9IHtcbiAgICAgICAgICAkcmVnZXg6IHNlYXJjaFF1ZXJ5LmxvY2F0aW9uLFxuICAgICAgICAgICRvcHRpb25zOiBcImlcIixcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8g5YiG6aCB6Kit5a6aXG4gICAgICBjb25zdCBwYWdlID0gc2VhcmNoUXVlcnkucGFnZSB8fCAxO1xuICAgICAgY29uc3QgbGltaXQgPSBzZWFyY2hRdWVyeS5saW1pdCB8fCAxMjtcbiAgICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XG5cbiAgICAgIC8vIOaOkuW6j+ioreWumlxuICAgICAgY29uc3Qgc29ydEJ5ID0gc2VhcmNoUXVlcnkuc29ydEJ5IHx8IFwiY3JlYXRlZEF0XCI7XG4gICAgICBjb25zdCBzb3J0T3JkZXIgPSBzZWFyY2hRdWVyeS5zb3J0T3JkZXIgPT09IFwiYXNjXCIgPyAxIDogLTE7XG4gICAgICBjb25zdCBzb3J0OiBhbnkgPSB7IFtzb3J0QnldOiBzb3J0T3JkZXIgfTtcblxuICAgICAgLy8g5Z+36KGM5p+l6KmiXG4gICAgICBjb25zdCBbcGV0cywgdG90YWxdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBQZXQuZmluZChtb25nb1F1ZXJ5KVxuICAgICAgICAgIC5zb3J0KHNvcnQpXG4gICAgICAgICAgLnNraXAoc2tpcClcbiAgICAgICAgICAubGltaXQobGltaXQpXG4gICAgICAgICAgLnBvcHVsYXRlKFwidXNlcklkXCIsIFwidXNlcm5hbWUgZW1haWxcIilcbiAgICAgICAgICAubGVhbigpLFxuICAgICAgICBQZXQuY291bnREb2N1bWVudHMobW9uZ29RdWVyeSksXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgdG9vayA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIC8vIOi9ieaPm+eCuiBFbGFzdGljc2VhcmNoIOagvOW8j1xuICAgICAgY29uc3QgaGl0czogU2VhcmNoUmVzdWx0W10gPSBwZXRzLm1hcCgocGV0LCBpbmRleCkgPT4gKHtcbiAgICAgICAgaWQ6IHBldC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgc2NvcmU6IDEuMCAtIGluZGV4ICogMC4xLCAvLyDmqKHmk6znm7jpl5zmgKfliIbmlbhcbiAgICAgICAgc291cmNlOiBwZXQsXG4gICAgICAgIGhpZ2hsaWdodHM6IHRoaXMuZ2VuZXJhdGVIaWdobGlnaHRzKHBldCwgc2VhcmNoUXVlcnkucXVlcnkpLFxuICAgICAgfSkpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBoaXRzLFxuICAgICAgICB0b3RhbCxcbiAgICAgICAgbWF4U2NvcmU6IGhpdHMubGVuZ3RoID4gMCA/IGhpdHNbMF0uc2NvcmUgOiAwLFxuICAgICAgICB0b29rLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIk1vY2sgc2VhcmNoIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5qih5pOs5pCc5bCL5bu66K2wXG4gICAqL1xuICBhc3luYyBnZXRTZWFyY2hTdWdnZXN0aW9ucyhxdWVyeTogc3RyaW5nKTogUHJvbWlzZTxNb2NrU2VhcmNoU3VnZ2VzdGlvbltdPiB7XG4gICAgaWYgKCFxdWVyeSB8fCBxdWVyeS5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3Qgc3VnZ2VzdGlvbnM6IE1vY2tTZWFyY2hTdWdnZXN0aW9uW10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICAvLyDlk4HnqK7lu7rorbBcbiAgICAgIGNvbnN0IGJyZWVkcyA9IGF3YWl0IFBldC5kaXN0aW5jdChcImJyZWVkXCIsIHtcbiAgICAgICAgYnJlZWQ6IHsgJHJlZ2V4OiBxdWVyeSwgJG9wdGlvbnM6IFwiaVwiIH0sXG4gICAgICB9KTtcbiAgICAgIGJyZWVkcy5zbGljZSgwLCAzKS5mb3JFYWNoKChicmVlZCkgPT4ge1xuICAgICAgICBzdWdnZXN0aW9ucy5wdXNoKHtcbiAgICAgICAgICB0ZXh0OiBicmVlZCxcbiAgICAgICAgICBzY29yZTogMC45LFxuICAgICAgICAgIHR5cGU6IFwiYnJlZWRcIixcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgLy8g5Zyw6bue5bu66K2wXG4gICAgICBjb25zdCBsb2NhdGlvbnMgPSBhd2FpdCBQZXQuZGlzdGluY3QoXCJsYXN0U2VlbkxvY2F0aW9uXCIsIHtcbiAgICAgICAgbGFzdFNlZW5Mb2NhdGlvbjogeyAkcmVnZXg6IHF1ZXJ5LCAkb3B0aW9uczogXCJpXCIgfSxcbiAgICAgIH0pO1xuICAgICAgbG9jYXRpb25zLnNsaWNlKDAsIDMpLmZvckVhY2goKGxvY2F0aW9uKSA9PiB7XG4gICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goe1xuICAgICAgICAgIHRleHQ6IGxvY2F0aW9uLFxuICAgICAgICAgIHNjb3JlOiAwLjgsXG4gICAgICAgICAgdHlwZTogXCJsb2NhdGlvblwiLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyDlkI3nqLHlu7rorbBcbiAgICAgIGNvbnN0IG5hbWVzID0gYXdhaXQgUGV0LmZpbmQoXG4gICAgICAgIHsgbmFtZTogeyAkcmVnZXg6IHF1ZXJ5LCAkb3B0aW9uczogXCJpXCIgfSB9LFxuICAgICAgICB7IG5hbWU6IDEgfSxcbiAgICAgICkubGltaXQoMyk7XG4gICAgICBuYW1lcy5mb3JFYWNoKChwZXQpID0+IHtcbiAgICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgICAgdGV4dDogcGV0Lm5hbWUsXG4gICAgICAgICAgc2NvcmU6IDAuNyxcbiAgICAgICAgICB0eXBlOiBcIm5hbWVcIixcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIk1vY2sgc3VnZ2VzdGlvbnMgZXJyb3I6XCIsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3VnZ2VzdGlvbnMuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICB9XG5cbiAgLyoqXG4gICAqIOaooeaTrOaQnOWwi+WIhuaekFxuICAgKi9cbiAgYXN5bmMgZ2V0U2VhcmNoQW5hbHl0aWNzKFxuICAgIHRpbWVSYW5nZTogc3RyaW5nID0gXCI3ZFwiLFxuICApOiBQcm9taXNlPE1vY2tTZWFyY2hBbmFseXRpY3M+IHtcbiAgICBjb25zdCBkYXlzID0gcGFyc2VJbnQodGltZVJhbmdlLnJlcGxhY2UoXCJkXCIsIFwiXCIpKSB8fCA3O1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgc3RhcnREYXRlLnNldERhdGUoc3RhcnREYXRlLmdldERhdGUoKSAtIGRheXMpO1xuXG4gICAgY29uc3QgcmVjZW50U2VhcmNoZXMgPSB0aGlzLnNlYXJjaEhpc3RvcnkuZmlsdGVyKFxuICAgICAgKHNlYXJjaCkgPT4gc2VhcmNoLnRpbWVzdGFtcCA+PSBzdGFydERhdGUsXG4gICAgKTtcblxuICAgIC8vIOeGsemWgOafpeipolxuICAgIGNvbnN0IHF1ZXJ5Q291bnQ6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0gPSB7fTtcbiAgICByZWNlbnRTZWFyY2hlcy5mb3JFYWNoKChzZWFyY2gpID0+IHtcbiAgICAgIGlmIChzZWFyY2gucXVlcnkpIHtcbiAgICAgICAgcXVlcnlDb3VudFtzZWFyY2gucXVlcnldID0gKHF1ZXJ5Q291bnRbc2VhcmNoLnF1ZXJ5XSB8fCAwKSArIDE7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBwb3B1bGFyUXVlcmllcyA9IE9iamVjdC5lbnRyaWVzKHF1ZXJ5Q291bnQpXG4gICAgICAubWFwKChbcXVlcnksIGNvdW50XSkgPT4gKHsgcXVlcnksIGNvdW50IH0pKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIuY291bnQgLSBhLmNvdW50KVxuICAgICAgLnNsaWNlKDAsIDEwKTtcblxuICAgIC8vIOeGsemWgOevqemBuFxuICAgIGNvbnN0IHR5cGVDb3VudDogeyBba2V5OiBzdHJpbmddOiBudW1iZXIgfSA9IHt9O1xuICAgIGNvbnN0IGxvY2F0aW9uQ291bnQ6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0gPSB7fTtcbiAgICBjb25zdCBicmVlZENvdW50OiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9ID0ge307XG5cbiAgICByZWNlbnRTZWFyY2hlcy5mb3JFYWNoKChzZWFyY2gpID0+IHtcbiAgICAgIGlmIChzZWFyY2guZmlsdGVycy50eXBlKSB7XG4gICAgICAgIHR5cGVDb3VudFtzZWFyY2guZmlsdGVycy50eXBlXSA9XG4gICAgICAgICAgKHR5cGVDb3VudFtzZWFyY2guZmlsdGVycy50eXBlXSB8fCAwKSArIDE7XG4gICAgICB9XG4gICAgICBpZiAoc2VhcmNoLmZpbHRlcnMubG9jYXRpb24pIHtcbiAgICAgICAgbG9jYXRpb25Db3VudFtzZWFyY2guZmlsdGVycy5sb2NhdGlvbl0gPVxuICAgICAgICAgIChsb2NhdGlvbkNvdW50W3NlYXJjaC5maWx0ZXJzLmxvY2F0aW9uXSB8fCAwKSArIDE7XG4gICAgICB9XG4gICAgICBpZiAoc2VhcmNoLmZpbHRlcnMuYnJlZWQpIHtcbiAgICAgICAgYnJlZWRDb3VudFtzZWFyY2guZmlsdGVycy5icmVlZF0gPVxuICAgICAgICAgIChicmVlZENvdW50W3NlYXJjaC5maWx0ZXJzLmJyZWVkXSB8fCAwKSArIDE7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyDmkJzlsIvotqjli6JcbiAgICBjb25zdCBzZWFyY2hUcmVuZHM6IEFycmF5PHsgZGF0ZTogc3RyaW5nOyBjb3VudDogbnVtYmVyIH0+ID0gW107XG4gICAgZm9yIChsZXQgaSA9IGRheXMgLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSBpKTtcbiAgICAgIGNvbnN0IGRhdGVTdHIgPSBkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoXCJUXCIpWzBdO1xuXG4gICAgICBjb25zdCBjb3VudCA9IHJlY2VudFNlYXJjaGVzLmZpbHRlcigoc2VhcmNoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNlYXJjaERhdGUgPSBzZWFyY2gudGltZXN0YW1wLnRvSVNPU3RyaW5nKCkuc3BsaXQoXCJUXCIpWzBdO1xuICAgICAgICByZXR1cm4gc2VhcmNoRGF0ZSA9PT0gZGF0ZVN0cjtcbiAgICAgIH0pLmxlbmd0aDtcblxuICAgICAgc2VhcmNoVHJlbmRzLnB1c2goeyBkYXRlOiBkYXRlU3RyLCBjb3VudCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxTZWFyY2hlczogcmVjZW50U2VhcmNoZXMubGVuZ3RoLFxuICAgICAgcG9wdWxhclF1ZXJpZXMsXG4gICAgICBwb3B1bGFyRmlsdGVyczoge1xuICAgICAgICB0eXBlczogT2JqZWN0LmVudHJpZXModHlwZUNvdW50KS5tYXAoKFtrZXksIGNvdW50XSkgPT4gKHtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgY291bnQsXG4gICAgICAgIH0pKSxcbiAgICAgICAgbG9jYXRpb25zOiBPYmplY3QuZW50cmllcyhsb2NhdGlvbkNvdW50KS5tYXAoKFtrZXksIGNvdW50XSkgPT4gKHtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgY291bnQsXG4gICAgICAgIH0pKSxcbiAgICAgICAgYnJlZWRzOiBPYmplY3QuZW50cmllcyhicmVlZENvdW50KS5tYXAoKFtrZXksIGNvdW50XSkgPT4gKHtcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgY291bnQsXG4gICAgICAgIH0pKSxcbiAgICAgIH0sXG4gICAgICBzZWFyY2hUcmVuZHMsXG4gICAgICBhdmVyYWdlUmVzcG9uc2VUaW1lOiAxNTAsIC8vIOaooeaTrOW5s+Wdh+WbnuaHieaZgumWk1xuICAgICAgc3VjY2Vzc1JhdGU6IDk5LjUsIC8vIOaooeaTrOaIkOWKn+eOh1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog55Sf5oiQ6auY5Lqu6aGv56S6XG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlSGlnaGxpZ2h0cyhwZXQ6IGFueSwgcXVlcnk/OiBzdHJpbmcpOiBhbnkge1xuICAgIGlmICghcXVlcnkpIHJldHVybiB7fTtcblxuICAgIGNvbnN0IGhpZ2hsaWdodHM6IGFueSA9IHt9O1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChxdWVyeSwgXCJnaVwiKTtcblxuICAgIGlmIChwZXQubmFtZSAmJiByZWdleC50ZXN0KHBldC5uYW1lKSkge1xuICAgICAgaGlnaGxpZ2h0cy5uYW1lID0gW3BldC5uYW1lLnJlcGxhY2UocmVnZXgsIGA8ZW0+JHtxdWVyeX08L2VtPmApXTtcbiAgICB9XG4gICAgaWYgKHBldC5kZXNjcmlwdGlvbiAmJiByZWdleC50ZXN0KHBldC5kZXNjcmlwdGlvbikpIHtcbiAgICAgIGNvbnN0IHNuaXBwZXQgPSBwZXQuZGVzY3JpcHRpb24uc3Vic3RyaW5nKDAsIDIwMCk7XG4gICAgICBoaWdobGlnaHRzLmRlc2NyaXB0aW9uID0gW3NuaXBwZXQucmVwbGFjZShyZWdleCwgYDxlbT4ke3F1ZXJ5fTwvZW0+YCldO1xuICAgIH1cbiAgICBpZiAocGV0Lmxhc3RTZWVuTG9jYXRpb24gJiYgcmVnZXgudGVzdChwZXQubGFzdFNlZW5Mb2NhdGlvbikpIHtcbiAgICAgIGhpZ2hsaWdodHMubGFzdFNlZW5Mb2NhdGlvbiA9IFtcbiAgICAgICAgcGV0Lmxhc3RTZWVuTG9jYXRpb24ucmVwbGFjZShyZWdleCwgYDxlbT4ke3F1ZXJ5fTwvZW0+YCksXG4gICAgICBdO1xuICAgIH1cblxuICAgIHJldHVybiBoaWdobGlnaHRzO1xuICB9XG5cbiAgLyoqXG4gICAqIOaooeaTrOe0ouW8leWIneWni+WMllxuICAgKi9cbiAgYXN5bmMgaW5pdGlhbGl6ZUluZGV4KCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnNvbGUubG9nKFwiTW9jayBFbGFzdGljc2VhcmNoOiDntKLlvJXliJ3lp4vljJblrozmiJBcIik7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICog5qih5pOs5paH5qqU57Si5byVXG4gICAqL1xuICBhc3luYyBpbmRleERvY3VtZW50KFxuICAgIGluZGV4OiBzdHJpbmcsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBkb2N1bWVudDogYW55LFxuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zb2xlLmxvZyhgTW9jayBFbGFzdGljc2VhcmNoOiDmlofmqpTlt7LntKLlvJUgLSAke2luZGV4fS8ke2lkfWApO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIOaooeaTrOaJuemHj+e0ouW8lVxuICAgKi9cbiAgYXN5bmMgYnVsa0luZGV4KG9wZXJhdGlvbnM6IGFueVtdKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zb2xlLmxvZyhgTW9jayBFbGFzdGljc2VhcmNoOiDmibnph4/ntKLlvJUgJHtvcGVyYXRpb25zLmxlbmd0aH0g5YCL5paH5qqUYCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvb2s6IDEwMCxcbiAgICAgIGVycm9yczogZmFsc2UsXG4gICAgICBpdGVtczogb3BlcmF0aW9ucy5tYXAoKF8sIGluZGV4KSA9PiAoe1xuICAgICAgICBpbmRleDoge1xuICAgICAgICAgIF9pbmRleDogXCJwZXRzXCIsXG4gICAgICAgICAgX2lkOiBgbW9ja18ke2luZGV4fWAsXG4gICAgICAgICAgX3ZlcnNpb246IDEsXG4gICAgICAgICAgcmVzdWx0OiBcImNyZWF0ZWRcIixcbiAgICAgICAgICBzdGF0dXM6IDIwMSxcbiAgICAgICAgfSxcbiAgICAgIH0pKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOaooeaTrOmHjeaWsOe0ouW8lVxuICAgKi9cbiAgYXN5bmMgcmVpbmRleEFsbFBldHMoKTogUHJvbWlzZTx7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICBpbmRleGVkOiBudW1iZXI7XG4gICAgZmFpbGVkOiBudW1iZXI7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG90YWxQZXRzID0gYXdhaXQgUGV0LmNvdW50RG9jdW1lbnRzKCk7XG4gICAgICBjb25zb2xlLmxvZyhgTW9jayBFbGFzdGljc2VhcmNoOiDph43mlrDntKLlvJUgJHt0b3RhbFBldHN9IOWAi+WvteeJqeaWh+aqlGApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBpbmRleGVkOiB0b3RhbFBldHMsXG4gICAgICAgIGZhaWxlZDogMCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJNb2NrIHJlaW5kZXggZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBpbmRleGVkOiAwLFxuICAgICAgICBmYWlsZWQ6IDEsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDmqKHmk6zmlYjog73mjIfmqJlcbiAgICovXG4gIGdldFBlcmZvcm1hbmNlTWV0cmljcygpOiBhbnkge1xuICAgIHJldHVybiB7XG4gICAgICB0b3RhbFJlcXVlc3RzOiB0aGlzLnNlYXJjaEhpc3RvcnkubGVuZ3RoLFxuICAgICAgYXZlcmFnZVJlc3BvbnNlVGltZTogMTUwLFxuICAgICAgc3VjY2Vzc1JhdGU6IDk5LjUsXG4gICAgICBlcnJvclJhdGU6IDAuNSxcbiAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgbW9ja0VsYXN0aWNzZWFyY2hTZXJ2aWNlID0gbmV3IE1vY2tFbGFzdGljc2VhcmNoU2VydmljZSgpO1xuIl0sInZlcnNpb24iOjN9