6f1f807f076528474ec5d7574fbb9bf8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Pet_1 = require("../../src/models/Pet");
const User_1 = require("../../src/models/User");
const testData_1 = require("../utils/testData");
describe('Pet Model', () => {
    let testUser;
    beforeEach(async () => {
        testUser = await new User_1.User(testData_1.validUserData).save();
    });
    afterEach(async () => {
        await Pet_1.Pet.deleteMany({});
        await User_1.User.deleteMany({});
    });
    describe('Pet Creation', () => {
        it('should create a valid pet', async () => {
            const petData = {
                ...testData_1.validPetData,
                userId: testUser._id
            };
            const pet = new Pet_1.Pet(petData);
            const savedPet = await pet.save();
            expect(savedPet._id).toBeDefined();
            expect(savedPet.name).toBe(petData.name);
            expect(savedPet.type).toBe(petData.type);
            expect(savedPet.breed).toBe(petData.breed);
            expect(savedPet.status).toBe(petData.status);
            expect(savedPet.userId.toString()).toBe(testUser._id.toString());
            expect(savedPet.viewCount).toBe(0);
            expect(savedPet.shareCount).toBe(0);
        });
        it('should not save pet without required fields', async () => {
            const pet = new Pet_1.Pet({});
            await expect(pet.save()).rejects.toThrow();
        });
        it('should not save pet without userId', async () => {
            const pet = new Pet_1.Pet(testData_1.validPetData);
            await expect(pet.save()).rejects.toThrow();
        });
        it('should validate pet type', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                type: 'invalid-type'
            });
            await expect(pet.save()).rejects.toThrow();
        });
        it('should validate pet gender', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                gender: 'invalid-gender'
            });
            await expect(pet.save()).rejects.toThrow();
        });
        it('should validate pet size', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                size: 'invalid-size'
            });
            await expect(pet.save()).rejects.toThrow();
        });
        it('should validate pet status', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                status: 'invalid-status'
            });
            await expect(pet.save()).rejects.toThrow();
        });
    });
    describe('Pet Location', () => {
        it('should save location information', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id
            });
            const savedPet = await pet.save();
            expect(savedPet.lastSeenLocation).toBe(testData_1.validPetData.lastSeenLocation);
        });
        it('should validate location is required', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                lastSeenLocation: ''
            });
            await expect(pet.save()).rejects.toThrow();
        });
    });
    describe('Pet Contact Info', () => {
        it('should save contact information', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id
            });
            const savedPet = await pet.save();
            expect(savedPet.contactInfo.name).toBe(testData_1.validPetData.contactInfo.name);
            expect(savedPet.contactInfo.phone).toBe(testData_1.validPetData.contactInfo.phone);
            expect(savedPet.contactInfo.email).toBe(testData_1.validPetData.contactInfo.email);
        });
        it('should validate email format in contact info', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                contactInfo: {
                    ...testData_1.validPetData.contactInfo,
                    email: 'invalid-email'
                }
            });
            await expect(pet.save()).rejects.toThrow();
        });
        it('should validate phone format in contact info', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                contactInfo: {
                    ...testData_1.validPetData.contactInfo,
                    phone: 'invalid-phone'
                }
            });
            await expect(pet.save()).rejects.toThrow();
        });
    });
    describe('Pet AI Features', () => {
        it('should save AI analysis data', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                aiFeatures: [{
                        imageUrl: 'https://example.com/image1.jpg',
                        features: [0.1, 0.2, 0.3, 0.4, 0.5],
                        analysis: {
                            confidence: 0.95,
                            labels: ['dog', 'golden retriever'],
                            detectedBreed: 'Golden Retriever',
                            colors: ['golden', 'white'],
                            features: ['long fur', 'friendly face']
                        },
                        processedAt: new Date()
                    }],
                aiBreedPrediction: 'Golden Retriever',
                aiConfidence: 0.95,
                aiTags: ['friendly', 'large', 'golden']
            });
            const savedPet = await pet.save();
            expect(savedPet.aiFeatures[0].imageUrl).toBe('https://example.com/image1.jpg');
            expect(savedPet.aiFeatures[0].analysis.detectedBreed).toBe('Golden Retriever');
            expect(savedPet.aiFeatures[0].analysis.confidence).toBe(0.95);
            expect(savedPet.aiBreedPrediction).toBe('Golden Retriever');
            expect(savedPet.aiConfidence).toBe(0.95);
            expect(savedPet.aiTags).toEqual(['friendly', 'large', 'golden']);
        });
        it('should validate AI confidence range', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id,
                aiConfidence: 1.5 // Invalid confidence > 1
            });
            await expect(pet.save()).rejects.toThrow();
        });
    });
    describe('Pet Statistics', () => {
        it('should initialize view and share counts to 0', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id
            });
            const savedPet = await pet.save();
            expect(savedPet.viewCount).toBe(0);
            expect(savedPet.shareCount).toBe(0);
        });
        it('should allow updating view and share counts', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id
            });
            const savedPet = await pet.save();
            savedPet.viewCount = 10;
            savedPet.shareCount = 5;
            const updatedPet = await savedPet.save();
            expect(updatedPet.viewCount).toBe(10);
            expect(updatedPet.shareCount).toBe(5);
        });
    });
    describe('Pet Timestamps', () => {
        it('should set createdAt and updatedAt on creation', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id
            });
            const savedPet = await pet.save();
            expect(savedPet.createdAt).toBeDefined();
            expect(savedPet.updatedAt).toBeDefined();
        });
        it('should update updatedAt on modification', async () => {
            const pet = new Pet_1.Pet({
                ...testData_1.validPetData,
                userId: testUser._id
            });
            const savedPet = await pet.save();
            const originalUpdatedAt = savedPet.updatedAt;
            // 等待一毫秒確保時間戳不同
            await new Promise(resolve => setTimeout(resolve, 1));
            savedPet.description = 'Updated description';
            const updatedPet = await savedPet.save();
            expect(updatedPet.updatedAt.getTime()).toBeGreaterThan(originalUpdatedAt.getTime());
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxtb2RlbHNcXFBldC50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsOENBQWlEO0FBQ2pELGdEQUFvRDtBQUVwRCxnREFBK0U7QUFFL0UsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7SUFDekIsSUFBSSxRQUFlLENBQUM7SUFJcEIsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLFFBQVEsR0FBRyxNQUFNLElBQUksV0FBSSxDQUFDLHdCQUFhLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsRCxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLFNBQUcsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDekIsTUFBTSxXQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzVCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7UUFDNUIsRUFBRSxDQUFDLDJCQUEyQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pDLE1BQU0sT0FBTyxHQUFHO2dCQUNkLEdBQUcsdUJBQVk7Z0JBQ2YsTUFBTSxFQUFFLFFBQVEsQ0FBQyxHQUFHO2FBQ3JCLENBQUM7WUFFRixNQUFNLEdBQUcsR0FBRyxJQUFJLFNBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUM3QixNQUFNLFFBQVEsR0FBRyxNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUVsQyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUks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UUFBUSxHQUFHLE1BQU0sR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1lBRWxDLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDekMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMzQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RCxNQUFNLEdBQUcsR0FBRyxJQUFJLFNBQUcsQ0FBQztnQkFDbEIsR0FBRyx1QkFBWTtnQkFDZixNQUFNLEVBQUUsUUFBUSxDQUFDLEdBQUc7YUFDckIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxRQUFRLEdBQUcsTUFBTSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDbEMsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDO1lBRTdDLGVBQWU7WUFDZixNQUFNLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXJELFFBQVEsQ0FBQyxXQUFXLEdBQUcscUJBQXFCLENBQUM7WUFDN0MsTUFBTSxVQUFVLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFekMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUN0RixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxtb2RlbHNcXFBldC50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBldCwgSVBldCB9IGZyb20gJy4uLy4uL3NyYy9tb2RlbHMvUGV0JztcbmltcG9ydCB7IFVzZXIsIElVc2VyIH0gZnJvbSAnLi4vLi4vc3JjL21vZGVscy9Vc2VyJztcbmltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSc7XG5pbXBvcnQgeyB2YWxpZFVzZXJEYXRhLCB2YWxpZFBldERhdGEsIGNyZWF0ZVRlc3RQZXQgfSBmcm9tICcuLi91dGlscy90ZXN0RGF0YSc7XG5cbmRlc2NyaWJlKCdQZXQgTW9kZWwnLCAoKSA9PiB7XG4gIGxldCB0ZXN0VXNlcjogSVVzZXI7XG5cblxuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIHRlc3RVc2VyID0gYXdhaXQgbmV3IFVzZXIodmFsaWRVc2VyRGF0YSkuc2F2ZSgpO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IFBldC5kZWxldGVNYW55KHt9KTtcbiAgICBhd2FpdCBVc2VyLmRlbGV0ZU1hbnkoe30pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGV0IENyZWF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgdmFsaWQgcGV0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0RGF0YSA9IHtcbiAgICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLl9pZFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldChwZXREYXRhKTtcbiAgICAgIGNvbnN0IHNhdmVkUGV0ID0gYXdhaXQgcGV0LnNhdmUoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHNhdmVkUGV0Ll9pZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzYXZlZFBldC5uYW1lKS50b0JlKHBldERhdGEubmFtZSk7XG4gICAgICBleHBlY3Qoc2F2ZWRQZXQudHlwZSkudG9CZShwZXREYXRhLnR5cGUpO1xuICAgICAgZXhwZWN0KHNhdmVkUGV0LmJyZWVkKS50b0JlKHBldERhdGEuYnJlZWQpO1xuICAgICAgZXhwZWN0KHNhdmVkUGV0LnN0YXR1cykudG9CZShwZXREYXRhLnN0YXR1cyk7XG4gICAgICBleHBlY3Qoc2F2ZWRQZXQudXNlcklkLnRvU3RyaW5nKCkpLnRvQmUodGVzdFVzZXIuX2lkLnRvU3RyaW5nKCkpO1xuICAgICAgZXhwZWN0KHNhdmVkUGV0LnZpZXdDb3VudCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzYXZlZFBldC5zaGFyZUNvdW50KS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3Qgc2F2ZSBwZXQgd2l0aG91dCByZXF1aXJlZCBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZXQgPSBuZXcgUGV0KHt9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHBldC5zYXZlKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3Qgc2F2ZSBwZXQgd2l0aG91dCB1c2VySWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZXQgPSBuZXcgUGV0KHZhbGlkUGV0RGF0YSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChwZXQuc2F2ZSgpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcGV0IHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZXQgPSBuZXcgUGV0KHtcbiAgICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLl9pZCxcbiAgICAgICAgdHlwZTogJ2ludmFsaWQtdHlwZScgYXMgYW55XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHBldC5zYXZlKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBwZXQgZ2VuZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5faWQsXG4gICAgICAgIGdlbmRlcjogJ2ludmFsaWQtZ2VuZGVyJyBhcyBhbnlcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QocGV0LnNhdmUoKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHBldCBzaXplJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5faWQsXG4gICAgICAgIHNpemU6ICdpbnZhbGlkLXNpemUnIGFzIGFueVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChwZXQuc2F2ZSgpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcGV0IHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBldCA9IG5ldyBQZXQoe1xuICAgICAgICAuLi52YWxpZFBldERhdGEsXG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuX2lkLFxuICAgICAgICBzdGF0dXM6ICdpbnZhbGlkLXN0YXR1cycgYXMgYW55XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHBldC5zYXZlKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGV0IExvY2F0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2F2ZSBsb2NhdGlvbiBpbmZvcm1hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBldCA9IG5ldyBQZXQoe1xuICAgICAgICAuLi52YWxpZFBldERhdGEsXG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuX2lkXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2F2ZWRQZXQgPSBhd2FpdCBwZXQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc2F2ZWRQZXQubGFzdFNlZW5Mb2NhdGlvbikudG9CZSh2YWxpZFBldERhdGEubGFzdFNlZW5Mb2NhdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGxvY2F0aW9uIGlzIHJlcXVpcmVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5faWQsXG4gICAgICAgIGxhc3RTZWVuTG9jYXRpb246ICcnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHBldC5zYXZlKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGV0IENvbnRhY3QgSW5mbycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhdmUgY29udGFjdCBpbmZvcm1hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBldCA9IG5ldyBQZXQoe1xuICAgICAgICAuLi52YWxpZFBldERhdGEsXG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuX2lkXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2F2ZWRQZXQgPSBhd2FpdCBwZXQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc2F2ZWRQZXQuY29udGFjdEluZm8ubmFtZSkudG9CZSh2YWxpZFBldERhdGEuY29udGFjdEluZm8ubmFtZSk7XG4gICAgICBleHBlY3Qoc2F2ZWRQZXQuY29udGFjdEluZm8ucGhvbmUpLnRvQmUodmFsaWRQZXREYXRhLmNvbnRhY3RJbmZvLnBob25lKTtcbiAgICAgIGV4cGVjdChzYXZlZFBldC5jb250YWN0SW5mby5lbWFpbCkudG9CZSh2YWxpZFBldERhdGEuY29udGFjdEluZm8uZW1haWwpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBlbWFpbCBmb3JtYXQgaW4gY29udGFjdCBpbmZvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5faWQsXG4gICAgICAgIGNvbnRhY3RJbmZvOiB7XG4gICAgICAgICAgLi4udmFsaWRQZXREYXRhLmNvbnRhY3RJbmZvLFxuICAgICAgICAgIGVtYWlsOiAnaW52YWxpZC1lbWFpbCdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChwZXQuc2F2ZSgpKS5yZWplY3RzLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcGhvbmUgZm9ybWF0IGluIGNvbnRhY3QgaW5mbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBldCA9IG5ldyBQZXQoe1xuICAgICAgICAuLi52YWxpZFBldERhdGEsXG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuX2lkLFxuICAgICAgICBjb250YWN0SW5mbzoge1xuICAgICAgICAgIC4uLnZhbGlkUGV0RGF0YS5jb250YWN0SW5mbyxcbiAgICAgICAgICBwaG9uZTogJ2ludmFsaWQtcGhvbmUnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QocGV0LnNhdmUoKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQZXQgQUkgRmVhdHVyZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzYXZlIEFJIGFuYWx5c2lzIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZXQgPSBuZXcgUGV0KHtcbiAgICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLl9pZCxcbiAgICAgICAgYWlGZWF0dXJlczogW3tcbiAgICAgICAgICBpbWFnZVVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vaW1hZ2UxLmpwZycsXG4gICAgICAgICAgZmVhdHVyZXM6IFswLjEsIDAuMiwgMC4zLCAwLjQsIDAuNV0sXG4gICAgICAgICAgYW5hbHlzaXM6IHtcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOTUsXG4gICAgICAgICAgICBsYWJlbHM6IFsnZG9nJywgJ2dvbGRlbiByZXRyaWV2ZXInXSxcbiAgICAgICAgICAgIGRldGVjdGVkQnJlZWQ6ICdHb2xkZW4gUmV0cmlldmVyJyxcbiAgICAgICAgICAgIGNvbG9yczogWydnb2xkZW4nLCAnd2hpdGUnXSxcbiAgICAgICAgICAgIGZlYXR1cmVzOiBbJ2xvbmcgZnVyJywgJ2ZyaWVuZGx5IGZhY2UnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvY2Vzc2VkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgfV0sXG4gICAgICAgIGFpQnJlZWRQcmVkaWN0aW9uOiAnR29sZGVuIFJldHJpZXZlcicsXG4gICAgICAgIGFpQ29uZmlkZW5jZTogMC45NSxcbiAgICAgICAgYWlUYWdzOiBbJ2ZyaWVuZGx5JywgJ2xhcmdlJywgJ2dvbGRlbiddXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2F2ZWRQZXQgPSBhd2FpdCBwZXQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc2F2ZWRQZXQuYWlGZWF0dXJlc1swXS5pbWFnZVVybCkudG9CZSgnaHR0cHM6Ly9leGFtcGxlLmNvbS9pbWFnZTEuanBnJyk7XG4gICAgICBleHBlY3Qoc2F2ZWRQZXQuYWlGZWF0dXJlc1swXS5hbmFseXNpcy5kZXRlY3RlZEJyZWVkKS50b0JlKCdHb2xkZW4gUmV0cmlldmVyJyk7XG4gICAgICBleHBlY3Qoc2F2ZWRQZXQuYWlGZWF0dXJlc1swXS5hbmFseXNpcy5jb25maWRlbmNlKS50b0JlKDAuOTUpO1xuICAgICAgZXhwZWN0KHNhdmVkUGV0LmFpQnJlZWRQcmVkaWN0aW9uKS50b0JlKCdHb2xkZW4gUmV0cmlldmVyJyk7XG4gICAgICBleHBlY3Qoc2F2ZWRQZXQuYWlDb25maWRlbmNlKS50b0JlKDAuOTUpO1xuICAgICAgZXhwZWN0KHNhdmVkUGV0LmFpVGFncykudG9FcXVhbChbJ2ZyaWVuZGx5JywgJ2xhcmdlJywgJ2dvbGRlbiddKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgQUkgY29uZmlkZW5jZSByYW5nZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBldCA9IG5ldyBQZXQoe1xuICAgICAgICAuLi52YWxpZFBldERhdGEsXG4gICAgICAgIHVzZXJJZDogdGVzdFVzZXIuX2lkLFxuICAgICAgICBhaUNvbmZpZGVuY2U6IDEuNSAvLyBJbnZhbGlkIGNvbmZpZGVuY2UgPiAxXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KHBldC5zYXZlKCkpLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGV0IFN0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIHZpZXcgYW5kIHNoYXJlIGNvdW50cyB0byAwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5faWRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBzYXZlZFBldCA9IGF3YWl0IHBldC5zYXZlKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzYXZlZFBldC52aWV3Q291bnQpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc2F2ZWRQZXQuc2hhcmVDb3VudCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgdXBkYXRpbmcgdmlldyBhbmQgc2hhcmUgY291bnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5faWRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBzYXZlZFBldCA9IGF3YWl0IHBldC5zYXZlKCk7XG4gICAgICBcbiAgICAgIHNhdmVkUGV0LnZpZXdDb3VudCA9IDEwO1xuICAgICAgc2F2ZWRQZXQuc2hhcmVDb3VudCA9IDU7XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWRQZXQgPSBhd2FpdCBzYXZlZFBldC5zYXZlKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCh1cGRhdGVkUGV0LnZpZXdDb3VudCkudG9CZSgxMCk7XG4gICAgICBleHBlY3QodXBkYXRlZFBldC5zaGFyZUNvdW50KS50b0JlKDUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGV0IFRpbWVzdGFtcHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgY3JlYXRlZEF0IGFuZCB1cGRhdGVkQXQgb24gY3JlYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZXQgPSBuZXcgUGV0KHtcbiAgICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgICB1c2VySWQ6IHRlc3RVc2VyLl9pZFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNhdmVkUGV0ID0gYXdhaXQgcGV0LnNhdmUoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHNhdmVkUGV0LmNyZWF0ZWRBdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzYXZlZFBldC51cGRhdGVkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB1cGRhdGVkQXQgb24gbW9kaWZpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGV0ID0gbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgdXNlcklkOiB0ZXN0VXNlci5faWRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBzYXZlZFBldCA9IGF3YWl0IHBldC5zYXZlKCk7XG4gICAgICBjb25zdCBvcmlnaW5hbFVwZGF0ZWRBdCA9IHNhdmVkUGV0LnVwZGF0ZWRBdDtcbiAgICAgIFxuICAgICAgLy8g562J5b6F5LiA5q+r56eS56K65L+d5pmC6ZaT5oiz5LiN5ZCMXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMSkpO1xuICAgICAgXG4gICAgICBzYXZlZFBldC5kZXNjcmlwdGlvbiA9ICdVcGRhdGVkIGRlc2NyaXB0aW9uJztcbiAgICAgIGNvbnN0IHVwZGF0ZWRQZXQgPSBhd2FpdCBzYXZlZFBldC5zYXZlKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCh1cGRhdGVkUGV0LnVwZGF0ZWRBdC5nZXRUaW1lKCkpLnRvQmVHcmVhdGVyVGhhbihvcmlnaW5hbFVwZGF0ZWRBdC5nZXRUaW1lKCkpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==