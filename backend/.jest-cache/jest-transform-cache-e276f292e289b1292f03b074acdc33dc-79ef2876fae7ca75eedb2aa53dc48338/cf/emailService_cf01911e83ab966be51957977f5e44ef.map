{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\services\\emailService.ts","mappings":"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","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\services\\emailService.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\nimport { config } from '../config/environment';\nimport { logger } from '../utils/logger';\n\n/**\n * 電子郵件服務類別\n */\nexport class EmailService {\n  private static transporter = nodemailer.createTransport({\n    host: config.email.host,\n    port: config.email.port,\n    secure: config.email.secure,\n    auth: {\n      user: config.email.user,\n      pass: config.email.password,\n    },\n  });\n\n  /**\n   * 發送電子郵件\n   */\n  private static async sendEmail(\n    to: string,\n    subject: string,\n    html: string,\n    text?: string\n  ): Promise<void> {\n    try {\n      const mailOptions = {\n        from: `${config.email.fromName} <${config.email.fromEmail}>`,\n        to,\n        subject,\n        html,\n        text: text || html.replace(/<[^>]*>/g, ''), // 如果沒有提供純文本，則從 HTML 中移除標籤\n      };\n\n      // 在開發環境中記錄郵件內容\n      if (config.env !== 'production') {\n        logger.debug('準備發送電子郵件', {\n          to,\n          subject,\n          html: html.substring(0, 100) + '...',\n        });\n      }\n\n      // 發送郵件\n      const info = await this.transporter.sendMail(mailOptions);\n      logger.info('電子郵件發送成功', {\n        messageId: info.messageId,\n        to,\n        subject,\n      });\n    } catch (error) {\n      logger.error('電子郵件發送失敗', { error, to, subject });\n      throw error;\n    }\n  }\n\n  /**\n   * 發送電子郵件驗證郵件\n   */\n  static async sendVerificationEmail(\n    to: string,\n    token: string,\n    userName: string\n  ): Promise<void> {\n    const verificationUrl = `${config.clientUrl}/verify-email?token=${token}`;\n    const subject = '呼嚕寵物協尋網站 - 請驗證您的電子郵件';\n\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #4a5568;\">您好，${userName}！</h2>\n        <p>感謝您註冊呼嚕寵物協尋網站。請點擊下方按鈕驗證您的電子郵件地址：</p>\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${verificationUrl}\" style=\"background-color: #4f46e5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; font-weight: bold;\">\n            驗證電子郵件\n          </a>\n        </div>\n        <p>或者，您可以複製以下連結並貼上到瀏覽器地址欄：</p>\n        <p style=\"word-break: break-all; color: #4a5568;\">${verificationUrl}</p>\n        <p>此驗證連結將在 24 小時後過期。</p>\n        <p>如果您沒有註冊呼嚕寵物協尋網站，請忽略此郵件。</p>\n        <hr style=\"border: none; border-top: 1px solid #e2e8f0; margin: 20px 0;\">\n        <p style=\"color: #718096; font-size: 14px;\">呼嚕寵物協尋網站團隊</p>\n      </div>\n    `;\n\n    await this.sendEmail(to, subject, html);\n  }\n\n  /**\n   * 發送密碼重設郵件\n   */\n  static async sendPasswordResetEmail(\n    to: string,\n    token: string,\n    userName: string\n  ): Promise<void> {\n    const resetUrl = `${config.clientUrl}/reset-password?token=${token}`;\n    const subject = '呼嚕寵物協尋網站 - 密碼重設請求';\n\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #4a5568;\">您好，${userName}！</h2>\n        <p>我們收到了重設您呼嚕寵物協尋網站帳號密碼的請求。請點擊下方按鈕重設密碼：</p>\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${resetUrl}\" style=\"background-color: #4f46e5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; font-weight: bold;\">\n            重設密碼\n          </a>\n        </div>\n        <p>或者，您可以複製以下連結並貼上到瀏覽器地址欄：</p>\n        <p style=\"word-break: break-all; color: #4a5568;\">${resetUrl}</p>\n        <p>此重設連結將在 1 小時後過期。</p>\n        <p>如果您沒有請求重設密碼，請忽略此郵件，您的帳號仍然安全。</p>\n        <hr style=\"border: none; border-top: 1px solid #e2e8f0; margin: 20px 0;\">\n        <p style=\"color: #718096; font-size: 14px;\">呼嚕寵物協尋網站團隊</p>\n      </div>\n    `;\n\n    await this.sendEmail(to, subject, html);\n  }\n\n  /**\n   * 發送歡迎郵件\n   */\n  static async sendWelcomeEmail(to: string, userName: string): Promise<void> {\n    const subject = '歡迎加入呼嚕寵物協尋網站';\n\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #4a5568;\">歡迎加入，${userName}！</h2>\n        <p>感謝您註冊呼嚕寵物協尋網站。我們致力於幫助失蹤寵物與主人團聚。</p>\n        <p>在我們的平台上，您可以：</p>\n        <ul>\n          <li>發布寵物協尋資訊</li>\n          <li>分享發現的寵物</li>\n          <li>加入愛心社群，協助他人尋找寵物</li>\n          <li>獲取寵物安全與照顧的專業建議</li>\n        </ul>\n        <p>如果您有任何問題或需要協助，請隨時聯繫我們的客服團隊。</p>\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${config.clientUrl}\" style=\"background-color: #4f46e5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; font-weight: bold;\">\n            立即開始使用\n          </a>\n        </div>\n        <hr style=\"border: none; border-top: 1px solid #e2e8f0; margin: 20px 0;\">\n        <p style=\"color: #718096; font-size: 14px;\">呼嚕寵物協尋網站團隊</p>\n      </div>\n    `;\n\n    await this.sendEmail(to, subject, html);\n  }\n\n  /**\n   * 發送通知郵件\n   */\n  static async sendNotificationEmail(\n    to: string,\n    subject: string,\n    message: string,\n    userName: string\n  ): Promise<void> {\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #4a5568;\">您好，${userName}！</h2>\n        <p>${message}</p>\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${config.clientUrl}\" style=\"background-color: #4f46e5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; font-weight: bold;\">\n            前往網站\n          </a>\n        </div>\n        <hr style=\"border: none; border-top: 1px solid #e2e8f0; margin: 20px 0;\">\n        <p style=\"color: #718096; font-size: 14px;\">呼嚕寵物協尋網站團隊</p>\n      </div>\n    `;\n\n    await this.sendEmail(to, subject, html);\n  }\n}"],"version":3}