22b16ab4e829dd73c14ea47e890492b7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.responseMiddleware = exports.ResponseUtil = void 0;
const errors_1 = require("./errors");
/**
 * 響應工具類
 */
class ResponseUtil {
    /**
     * 發送成功響應
     */
    static success(res, data, message, statusCode = 200, meta) {
        const response = {
            success: true,
            timestamp: new Date().toISOString(),
        };
        if (message) {
            response.message = message;
        }
        if (data !== undefined) {
            response.data = data;
        }
        if (meta) {
            response.meta = meta;
        }
        res.status(statusCode).json(response);
    }
    /**
     * 發送創建成功響應
     */
    static created(res, data, message = '創建成功') {
        ResponseUtil.success(res, data, message, 201);
    }
    /**
     * 發送更新成功響應
     */
    static updated(res, data, message = '更新成功') {
        ResponseUtil.success(res, data, message, 200);
    }
    /**
     * 發送刪除成功響應
     */
    static deleted(res, message = '刪除成功') {
        ResponseUtil.success(res, undefined, message, 200);
    }
    /**
     * 發送分頁響應
     */
    static paginated(res, data, pagination, message) {
        const totalPages = Math.ceil(pagination.total / pagination.limit);
        const meta = {
            page: pagination.page,
            limit: pagination.limit,
            total: pagination.total,
            totalPages,
            hasNext: pagination.page < totalPages,
            hasPrev: pagination.page > 1,
        };
        ResponseUtil.success(res, data, message, 200, meta);
    }
    /**
     * 發送錯誤響應
     */
    static error(res, error, path, method) {
        const response = {
            success: false,
            error: {
                message: error.message,
                code: error.errorCode,
                statusCode: error.statusCode,
                timestamp: error.timestamp,
            },
        };
        if (error.details && error.details.length > 0) {
            response.error.details = error.details;
        }
        if (path) {
            response.error.path = path;
        }
        if (method) {
            response.error.method = method;
        }
        res.status(error.statusCode).json(response);
    }
    /**
     * 發送驗證錯誤響應
     */
    static validationError(res, errors, message = '輸入資料驗證失敗') {
        const appError = new errors_1.AppError(message, 400, errors_1.ErrorCode.VALIDATION_ERROR, errors);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送未授權響應
     */
    static unauthorized(res, message = '認證失敗') {
        const appError = new errors_1.AppError(message, 401, errors_1.ErrorCode.AUTHENTICATION_FAILED);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送禁止訪問響應
     */
    static forbidden(res, message = '權限不足') {
        const appError = new errors_1.AppError(message, 403, errors_1.ErrorCode.INSUFFICIENT_PERMISSIONS);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送未找到響應
     */
    static notFound(res, resource = '資源', identifier) {
        const message = identifier
            ? `${resource} (${identifier}) 未找到`
            : `${resource} 未找到`;
        const appError = new errors_1.AppError(message, 404, errors_1.ErrorCode.RESOURCE_NOT_FOUND, [{ resource, identifier }]);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送衝突響應
     */
    static conflict(res, resource, field, value) {
        const message = `${resource} 的 ${field} 已存在`;
        const appError = new errors_1.AppError(message, 409, errors_1.ErrorCode.RESOURCE_CONFLICT, [{ resource, field, value, constraint: 'unique' }]);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送速率限制響應
     */
    static rateLimited(res, message = '請求過於頻繁，請稍後再試') {
        const appError = new errors_1.AppError(message, 429, errors_1.ErrorCode.RATE_LIMIT_EXCEEDED);
        ResponseUtil.error(res, appError);
    }
    /**
     * 發送內部伺服器錯誤響應
     */
    static internalError(res, message = '內部伺服器錯誤') {
        const appError = new errors_1.AppError(message, 500, errors_1.ErrorCode.INTERNAL_SERVER_ERROR, undefined, false);
        ResponseUtil.error(res, appError);
    }
}
exports.ResponseUtil = ResponseUtil;
/**
 * 響應中間件 - 為 Response 對象添加便捷方法
 */
const responseMiddleware = (req, res, next) => {
    // 添加便捷方法到 Response 對象
    res.success = function (data, message, statusCode, meta) {
        return ResponseUtil.success(this, data, message, statusCode, meta);
    };
    res.created = function (data, message) {
        return ResponseUtil.created(this, data, message);
    };
    res.updated = function (data, message) {
        return ResponseUtil.updated(this, data, message);
    };
    res.deleted = function (message) {
        return ResponseUtil.deleted(this, message);
    };
    res.paginated = function (data, pagination, message) {
        return ResponseUtil.paginated(this, data, pagination, message);
    };
    res.validationError = function (errors, message) {
        return ResponseUtil.validationError(this, errors, message);
    };
    res.unauthorized = function (message) {
        return ResponseUtil.unauthorized(this, message);
    };
    res.forbidden = function (message) {
        return ResponseUtil.forbidden(this, message);
    };
    res.notFound = function (resource, identifier) {
        return ResponseUtil.notFound(this, resource, identifier);
    };
    res.conflict = function (resource, field, value) {
        return ResponseUtil.conflict(this, resource, field, value);
    };
    res.rateLimited = function (message) {
        return ResponseUtil.rateLimited(this, message);
    };
    res.internalError = function (message) {
        return ResponseUtil.internalError(this, message);
    };
    next();
};
exports.responseMiddleware = responseMiddleware;
exports.default = ResponseUtil;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHV0aWxzXFxyZXNwb25zZS50cyIsIm1hcHBpbmdzIjoiOzs7QUFDQSxxQ0FBK0M7QUFnRC9DOztHQUVHO0FBQ0gsTUFBYSxZQUFZO0lBQ3ZCOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FDWixHQUFhLEVBQ2IsSUFBUSxFQUNSLE9BQWdCLEVBQ2hCLGFBQXFCLEdBQUcsRUFDeEIsSUFBOEI7UUFFOUIsTUFBTSxRQUFRLEdBQXVCO1lBQ25DLE9BQU8sRUFBRSxJQUFJO1lBQ2IsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1NBQ3BDLENBQUM7UUFFRixJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ1osUUFBUSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDN0IsQ0FBQztRQUVELElBQUksSUFBSSxLQUFLLFNBQVMsRUFBRSxDQUFDO1lBQ3ZCLFFBQVEsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ3ZCLENBQUM7UUFFRCxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ1QsUUFBUSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDdkIsQ0FBQztRQUVELEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxPQUFPLENBQ1osR0FBYSxFQUNiLElBQVEsRUFDUixVQUFrQixNQUFNO1FBRXhCLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FDWixHQUFhLEVBQ2IsSUFBUSxFQUNSLFVBQWtCLE1BQU07UUFFeEIsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVB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Q0FBQztJQUVGLEdBQUcsQ0FBQyxXQUFXLEdBQUcsVUFBUyxPQUFnQjtRQUN6QyxPQUFPLFlBQVksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pELENBQUMsQ0FBQztJQUVGLEdBQUcsQ0FBQyxhQUFhLEdBQUcsVUFBUyxPQUFnQjtRQUMzQyxPQUFPLFlBQVksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ25ELENBQUMsQ0FBQztJQUVGLElBQUksRUFBRSxDQUFDO0FBQ1QsQ0FBQyxDQUFDO0FBbkVXLFFBQUEsa0JBQWtCLHNCQW1FN0I7QUFrQ0Ysa0JBQWUsWUFBWSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcVXNlclxcRGVza3RvcFxcdHJhZXByb2plY3RcXHRlc3QyXFxwZXQtZmluZGVyLWFwcFxcYmFja2VuZFxcc3JjXFx1dGlsc1xccmVzcG9uc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IEFwcEVycm9yLCBFcnJvckNvZGUgfSBmcm9tICcuL2Vycm9ycyc7XG5cbi8qKlxuICog5oiQ5Yqf6Z+/5oeJ5LuL6Z2iXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU3VjY2Vzc1Jlc3BvbnNlPFQgPSBhbnk+IHtcbiAgc3VjY2VzczogdHJ1ZTtcbiAgbWVzc2FnZT86IHN0cmluZztcbiAgZGF0YT86IFQ7XG4gIG1ldGE/OiB7XG4gICAgcGFnZT86IG51bWJlcjtcbiAgICBsaW1pdD86IG51bWJlcjtcbiAgICB0b3RhbD86IG51bWJlcjtcbiAgICB0b3RhbFBhZ2VzPzogbnVtYmVyO1xuICAgIGhhc05leHQ/OiBib29sZWFuO1xuICAgIGhhc1ByZXY/OiBib29sZWFuO1xuICB9O1xuICB0aW1lc3RhbXA6IHN0cmluZztcbn1cblxuLyoqXG4gKiDpjK/oqqTpn7/mh4nku4vpnaJcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFcnJvclJlc3BvbnNlIHtcbiAgc3VjY2VzczogZmFsc2U7XG4gIGVycm9yOiB7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGNvZGU6IEVycm9yQ29kZTtcbiAgICBzdGF0dXNDb2RlOiBudW1iZXI7XG4gICAgZGV0YWlscz86IGFueVtdO1xuICAgIHBhdGg/OiBzdHJpbmc7XG4gICAgbWV0aG9kPzogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICB9O1xufVxuXG4vKipcbiAqIOWIhumggeizh+ioiuS7i+mdolxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhZ2luYXRpb25NZXRhIHtcbiAgcGFnZTogbnVtYmVyO1xuICBsaW1pdDogbnVtYmVyO1xuICB0b3RhbDogbnVtYmVyO1xuICB0b3RhbFBhZ2VzOiBudW1iZXI7XG4gIGhhc05leHQ6IGJvb2xlYW47XG4gIGhhc1ByZXY6IGJvb2xlYW47XG59XG5cbi8qKlxuICog6Z+/5oeJ5bel5YW36aGeXG4gKi9cbmV4cG9ydCBjbGFzcyBSZXNwb25zZVV0aWwge1xuICAvKipcbiAgICog55m86YCB5oiQ5Yqf6Z+/5oeJXG4gICAqL1xuICBzdGF0aWMgc3VjY2VzczxUPihcbiAgICByZXM6IFJlc3BvbnNlLFxuICAgIGRhdGE/OiBULFxuICAgIG1lc3NhZ2U/OiBzdHJpbmcsXG4gICAgc3RhdHVzQ29kZTogbnVtYmVyID0gMjAwLFxuICAgIG1ldGE/OiBQYXJ0aWFsPFBhZ2luYXRpb25NZXRhPlxuICApOiB2b2lkIHtcbiAgICBjb25zdCByZXNwb25zZTogU3VjY2Vzc1Jlc3BvbnNlPFQ+ID0ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG5cbiAgICBpZiAobWVzc2FnZSkge1xuICAgICAgcmVzcG9uc2UubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmVzcG9uc2UuZGF0YSA9IGRhdGE7XG4gICAgfVxuXG4gICAgaWYgKG1ldGEpIHtcbiAgICAgIHJlc3BvbnNlLm1ldGEgPSBtZXRhO1xuICAgIH1cblxuICAgIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuanNvbihyZXNwb25zZSk7XG4gIH1cblxuICAvKipcbiAgICog55m86YCB5Ym15bu65oiQ5Yqf6Z+/5oeJXG4gICAqL1xuICBzdGF0aWMgY3JlYXRlZDxUPihcbiAgICByZXM6IFJlc3BvbnNlLFxuICAgIGRhdGE/OiBULFxuICAgIG1lc3NhZ2U6IHN0cmluZyA9ICflibXlu7rmiJDlip8nXG4gICk6IHZvaWQge1xuICAgIFJlc3BvbnNlVXRpbC5zdWNjZXNzKHJlcywgZGF0YSwgbWVzc2FnZSwgMjAxKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHmm7TmlrDmiJDlip/pn7/mh4lcbiAgICovXG4gIHN0YXRpYyB1cGRhdGVkPFQ+KFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgZGF0YT86IFQsXG4gICAgbWVzc2FnZTogc3RyaW5nID0gJ+abtOaWsOaIkOWKnydcbiAgKTogdm9pZCB7XG4gICAgUmVzcG9uc2VVdGlsLnN1Y2Nlc3MocmVzLCBkYXRhLCBtZXNzYWdlLCAyMDApO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgeWIqumZpOaIkOWKn+mfv+aHiVxuICAgKi9cbiAgc3RhdGljIGRlbGV0ZWQoXG4gICAgcmVzOiBSZXNwb25zZSxcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn5Yiq6Zmk5oiQ5YqfJ1xuICApOiB2b2lkIHtcbiAgICBSZXNwb25zZVV0aWwuc3VjY2VzcyhyZXMsIHVuZGVmaW5lZCwgbWVzc2FnZSwgMjAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHliIbpoIHpn7/mh4lcbiAgICovXG4gIHN0YXRpYyBwYWdpbmF0ZWQ8VD4oXG4gICAgcmVzOiBSZXNwb25zZSxcbiAgICBkYXRhOiBUW10sXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgcGFnZTogbnVtYmVyO1xuICAgICAgbGltaXQ6IG51bWJlcjtcbiAgICAgIHRvdGFsOiBudW1iZXI7XG4gICAgfSxcbiAgICBtZXNzYWdlPzogc3RyaW5nXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwocGFnaW5hdGlvbi50b3RhbCAvIHBhZ2luYXRpb24ubGltaXQpO1xuICAgIGNvbnN0IG1ldGE6IFBhZ2luYXRpb25NZXRhID0ge1xuICAgICAgcGFnZTogcGFnaW5hdGlvbi5wYWdlLFxuICAgICAgbGltaXQ6IHBhZ2luYXRpb24ubGltaXQsXG4gICAgICB0b3RhbDogcGFnaW5hdGlvbi50b3RhbCxcbiAgICAgIHRvdGFsUGFnZXMsXG4gICAgICBoYXNOZXh0OiBwYWdpbmF0aW9uLnBhZ2UgPCB0b3RhbFBhZ2VzLFxuICAgICAgaGFzUHJldjogcGFnaW5hdGlvbi5wYWdlID4gMSxcbiAgICB9O1xuXG4gICAgUmVzcG9uc2VVdGlsLnN1Y2Nlc3MocmVzLCBkYXRhLCBtZXNzYWdlLCAyMDAsIG1ldGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgemMr+iqpOmfv+aHiVxuICAgKi9cbiAgc3RhdGljIGVycm9yKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgZXJyb3I6IEFwcEVycm9yLFxuICAgIHBhdGg/OiBzdHJpbmcsXG4gICAgbWV0aG9kPzogc3RyaW5nXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHJlc3BvbnNlOiBFcnJvclJlc3BvbnNlID0ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBjb2RlOiBlcnJvci5lcnJvckNvZGUsXG4gICAgICAgIHN0YXR1c0NvZGU6IGVycm9yLnN0YXR1c0NvZGUsXG4gICAgICAgIHRpbWVzdGFtcDogZXJyb3IudGltZXN0YW1wLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgaWYgKGVycm9yLmRldGFpbHMgJiYgZXJyb3IuZGV0YWlscy5sZW5ndGggPiAwKSB7XG4gICAgICByZXNwb25zZS5lcnJvci5kZXRhaWxzID0gZXJyb3IuZGV0YWlscztcbiAgICB9XG5cbiAgICBpZiAocGF0aCkge1xuICAgICAgcmVzcG9uc2UuZXJyb3IucGF0aCA9IHBhdGg7XG4gICAgfVxuXG4gICAgaWYgKG1ldGhvZCkge1xuICAgICAgcmVzcG9uc2UuZXJyb3IubWV0aG9kID0gbWV0aG9kO1xuICAgIH1cblxuICAgIHJlcy5zdGF0dXMoZXJyb3Iuc3RhdHVzQ29kZSkuanNvbihyZXNwb25zZSk7XG4gIH1cblxuICAvKipcbiAgICog55m86YCB6amX6K2J6Yyv6Kqk6Z+/5oeJXG4gICAqL1xuICBzdGF0aWMgdmFsaWRhdGlvbkVycm9yKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgZXJyb3JzOiBBcnJheTx7IGZpZWxkOiBzdHJpbmc7IG1lc3NhZ2U6IHN0cmluZzsgdmFsdWU/OiBhbnkgfT4sXG4gICAgbWVzc2FnZTogc3RyaW5nID0gJ+i8uOWFpeizh+aWmempl+itieWkseaVlydcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYXBwRXJyb3IgPSBuZXcgQXBwRXJyb3IoXG4gICAgICBtZXNzYWdlLFxuICAgICAgNDAwLFxuICAgICAgRXJyb3JDb2RlLlZBTElEQVRJT05fRVJST1IsXG4gICAgICBlcnJvcnNcbiAgICApO1xuICAgIFJlc3BvbnNlVXRpbC5lcnJvcihyZXMsIGFwcEVycm9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHmnKrmjojmrIrpn7/mh4lcbiAgICovXG4gIHN0YXRpYyB1bmF1dGhvcml6ZWQoXG4gICAgcmVzOiBSZXNwb25zZSxcbiAgICBtZXNzYWdlOiBzdHJpbmcgPSAn6KqN6K2J5aSx5pWXJ1xuICApOiB2b2lkIHtcbiAgICBjb25zdCBhcHBFcnJvciA9IG5ldyBBcHBFcnJvcihcbiAgICAgIG1lc3NhZ2UsXG4gICAgICA0MDEsXG4gICAgICBFcnJvckNvZGUuQVVUSEVOVElDQVRJT05fRkFJTEVEXG4gICAgKTtcbiAgICBSZXNwb25zZVV0aWwuZXJyb3IocmVzLCBhcHBFcnJvcik7XG4gIH1cblxuICAvKipcbiAgICog55m86YCB56aB5q2i6Kiq5ZWP6Z+/5oeJXG4gICAqL1xuICBzdGF0aWMgZm9yYmlkZGVuKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgbWVzc2FnZTogc3RyaW5nID0gJ+asiumZkOS4jei2sydcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYXBwRXJyb3IgPSBuZXcgQXBwRXJyb3IoXG4gICAgICBtZXNzYWdlLFxuICAgICAgNDAzLFxuICAgICAgRXJyb3JDb2RlLklOU1VGRklDSUVOVF9QRVJNSVNTSU9OU1xuICAgICk7XG4gICAgUmVzcG9uc2VVdGlsLmVycm9yKHJlcywgYXBwRXJyb3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgeacquaJvuWIsOmfv+aHiVxuICAgKi9cbiAgc3RhdGljIG5vdEZvdW5kKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgcmVzb3VyY2U6IHN0cmluZyA9ICfos4fmupAnLFxuICAgIGlkZW50aWZpZXI/OiBzdHJpbmcgfCBudW1iZXJcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGlkZW50aWZpZXJcbiAgICAgID8gYCR7cmVzb3VyY2V9ICgke2lkZW50aWZpZXJ9KSDmnKrmib7liLBgXG4gICAgICA6IGAke3Jlc291cmNlfSDmnKrmib7liLBgO1xuICAgIFxuICAgIGNvbnN0IGFwcEVycm9yID0gbmV3IEFwcEVycm9yKFxuICAgICAgbWVzc2FnZSxcbiAgICAgIDQwNCxcbiAgICAgIEVycm9yQ29kZS5SRVNPVVJDRV9OT1RfRk9VTkQsXG4gICAgICBbeyByZXNvdXJjZSwgaWRlbnRpZmllciB9XVxuICAgICk7XG4gICAgUmVzcG9uc2VVdGlsLmVycm9yKHJlcywgYXBwRXJyb3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgeihneeqgemfv+aHiVxuICAgKi9cbiAgc3RhdGljIGNvbmZsaWN0KFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgcmVzb3VyY2U6IHN0cmluZyxcbiAgICBmaWVsZDogc3RyaW5nLFxuICAgIHZhbHVlOiBhbnlcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGAke3Jlc291cmNlfSDnmoQgJHtmaWVsZH0g5bey5a2Y5ZyoYDtcbiAgICBjb25zdCBhcHBFcnJvciA9IG5ldyBBcHBFcnJvcihcbiAgICAgIG1lc3NhZ2UsXG4gICAgICA0MDksXG4gICAgICBFcnJvckNvZGUuUkVTT1VSQ0VfQ09ORkxJQ1QsXG4gICAgICBbeyByZXNvdXJjZSwgZmllbGQsIHZhbHVlLCBjb25zdHJhaW50OiAndW5pcXVlJyB9XVxuICAgICk7XG4gICAgUmVzcG9uc2VVdGlsLmVycm9yKHJlcywgYXBwRXJyb3IpO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZvOmAgemAn+eOh+mZkOWItumfv+aHiVxuICAgKi9cbiAgc3RhdGljIHJhdGVMaW1pdGVkKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgbWVzc2FnZTogc3RyaW5nID0gJ+iri+axgumBjuaWvOmgu+e5ge+8jOiri+eojeW+jOWGjeippidcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYXBwRXJyb3IgPSBuZXcgQXBwRXJyb3IoXG4gICAgICBtZXNzYWdlLFxuICAgICAgNDI5LFxuICAgICAgRXJyb3JDb2RlLlJBVEVfTElNSVRfRVhDRUVERURcbiAgICApO1xuICAgIFJlc3BvbnNlVXRpbC5lcnJvcihyZXMsIGFwcEVycm9yKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbzpgIHlhafpg6jkvLrmnI3lmajpjK/oqqTpn7/mh4lcbiAgICovXG4gIHN0YXRpYyBpbnRlcm5hbEVycm9yKFxuICAgIHJlczogUmVzcG9uc2UsXG4gICAgbWVzc2FnZTogc3RyaW5nID0gJ+WFp+mDqOS8uuacjeWZqOmMr+iqpCdcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgYXBwRXJyb3IgPSBuZXcgQXBwRXJyb3IoXG4gICAgICBtZXNzYWdlLFxuICAgICAgNTAwLFxuICAgICAgRXJyb3JDb2RlLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgIHVuZGVmaW5lZCxcbiAgICAgIGZhbHNlXG4gICAgKTtcbiAgICBSZXNwb25zZVV0aWwuZXJyb3IocmVzLCBhcHBFcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiDpn7/mh4nkuK3plpPku7YgLSDngrogUmVzcG9uc2Ug5bCN6LGh5re75Yqg5L6/5o235pa55rOVXG4gKi9cbmV4cG9ydCBjb25zdCByZXNwb25zZU1pZGRsZXdhcmUgPSAoXG4gIHJlcTogYW55LFxuICByZXM6IFJlc3BvbnNlLFxuICBuZXh0OiBhbnlcbik6IHZvaWQgPT4ge1xuICAvLyDmt7vliqDkvr/mjbfmlrnms5XliLAgUmVzcG9uc2Ug5bCN6LGhXG4gIHJlcy5zdWNjZXNzID0gZnVuY3Rpb248VD4oXG4gICAgZGF0YT86IFQsXG4gICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICBzdGF0dXNDb2RlPzogbnVtYmVyLFxuICAgIG1ldGE/OiBQYXJ0aWFsPFBhZ2luYXRpb25NZXRhPlxuICApIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLnN1Y2Nlc3ModGhpcywgZGF0YSwgbWVzc2FnZSwgc3RhdHVzQ29kZSwgbWV0YSk7XG4gIH07XG5cbiAgcmVzLmNyZWF0ZWQgPSBmdW5jdGlvbjxUPihkYXRhPzogVCwgbWVzc2FnZT86IHN0cmluZykge1xuICAgIHJldHVybiBSZXNwb25zZVV0aWwuY3JlYXRlZCh0aGlzLCBkYXRhLCBtZXNzYWdlKTtcbiAgfTtcblxuICByZXMudXBkYXRlZCA9IGZ1bmN0aW9uPFQ+KGRhdGE/OiBULCBtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC51cGRhdGVkKHRoaXMsIGRhdGEsIG1lc3NhZ2UpO1xuICB9O1xuXG4gIHJlcy5kZWxldGVkID0gZnVuY3Rpb24obWVzc2FnZT86IHN0cmluZykge1xuICAgIHJldHVybiBSZXNwb25zZVV0aWwuZGVsZXRlZCh0aGlzLCBtZXNzYWdlKTtcbiAgfTtcblxuICByZXMucGFnaW5hdGVkID0gZnVuY3Rpb248VD4oXG4gICAgZGF0YTogVFtdLFxuICAgIHBhZ2luYXRpb246IHsgcGFnZTogbnVtYmVyOyBsaW1pdDogbnVtYmVyOyB0b3RhbDogbnVtYmVyIH0sXG4gICAgbWVzc2FnZT86IHN0cmluZ1xuICApIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLnBhZ2luYXRlZCh0aGlzLCBkYXRhLCBwYWdpbmF0aW9uLCBtZXNzYWdlKTtcbiAgfTtcblxuICByZXMudmFsaWRhdGlvbkVycm9yID0gZnVuY3Rpb24oXG4gICAgZXJyb3JzOiBBcnJheTx7IGZpZWxkOiBzdHJpbmc7IG1lc3NhZ2U6IHN0cmluZzsgdmFsdWU/OiBhbnkgfT4sXG4gICAgbWVzc2FnZT86IHN0cmluZ1xuICApIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLnZhbGlkYXRpb25FcnJvcih0aGlzLCBlcnJvcnMsIG1lc3NhZ2UpO1xuICB9O1xuXG4gIHJlcy51bmF1dGhvcml6ZWQgPSBmdW5jdGlvbihtZXNzYWdlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIFJlc3BvbnNlVXRpbC51bmF1dGhvcml6ZWQodGhpcywgbWVzc2FnZSk7XG4gIH07XG5cbiAgcmVzLmZvcmJpZGRlbiA9IGZ1bmN0aW9uKG1lc3NhZ2U/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLmZvcmJpZGRlbih0aGlzLCBtZXNzYWdlKTtcbiAgfTtcblxuICByZXMubm90Rm91bmQgPSBmdW5jdGlvbihyZXNvdXJjZT86IHN0cmluZywgaWRlbnRpZmllcj86IHN0cmluZyB8IG51bWJlcikge1xuICAgIHJldHVybiBSZXNwb25zZVV0aWwubm90Rm91bmQodGhpcywgcmVzb3VyY2UsIGlkZW50aWZpZXIpO1xuICB9O1xuXG4gIHJlcy5jb25mbGljdCA9IGZ1bmN0aW9uKHJlc291cmNlOiBzdHJpbmcsIGZpZWxkOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLmNvbmZsaWN0KHRoaXMsIHJlc291cmNlLCBmaWVsZCwgdmFsdWUpO1xuICB9O1xuXG4gIHJlcy5yYXRlTGltaXRlZCA9IGZ1bmN0aW9uKG1lc3NhZ2U/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlsLnJhdGVMaW1pdGVkKHRoaXMsIG1lc3NhZ2UpO1xuICB9O1xuXG4gIHJlcy5pbnRlcm5hbEVycm9yID0gZnVuY3Rpb24obWVzc2FnZT86IHN0cmluZykge1xuICAgIHJldHVybiBSZXNwb25zZVV0aWwuaW50ZXJuYWxFcnJvcih0aGlzLCBtZXNzYWdlKTtcbiAgfTtcblxuICBuZXh0KCk7XG59O1xuXG4vLyDmk7TlsZUgRXhwcmVzcyBSZXNwb25zZSDku4vpnaJcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIEV4cHJlc3Mge1xuICAgIGludGVyZmFjZSBSZXNwb25zZSB7XG4gICAgICBzdWNjZXNzPFQ+KFxuICAgICAgICBkYXRhPzogVCxcbiAgICAgICAgbWVzc2FnZT86IHN0cmluZyxcbiAgICAgICAgc3RhdHVzQ29kZT86IG51bWJlcixcbiAgICAgICAgbWV0YT86IFBhcnRpYWw8UGFnaW5hdGlvbk1ldGE+XG4gICAgICApOiB2b2lkO1xuICAgICAgY3JlYXRlZDxUPihkYXRhPzogVCwgbWVzc2FnZT86IHN0cmluZyk6IHZvaWQ7XG4gICAgICB1cGRhdGVkPFQ+KGRhdGE/OiBULCBtZXNzYWdlPzogc3RyaW5nKTogdm9pZDtcbiAgICAgIGRlbGV0ZWQobWVzc2FnZT86IHN0cmluZyk6IHZvaWQ7XG4gICAgICBwYWdpbmF0ZWQ8VD4oXG4gICAgICAgIGRhdGE6IFRbXSxcbiAgICAgICAgcGFnaW5hdGlvbjogeyBwYWdlOiBudW1iZXI7IGxpbWl0OiBudW1iZXI7IHRvdGFsOiBudW1iZXIgfSxcbiAgICAgICAgbWVzc2FnZT86IHN0cmluZ1xuICAgICAgKTogdm9pZDtcbiAgICAgIHZhbGlkYXRpb25FcnJvcihcbiAgICAgICAgZXJyb3JzOiBBcnJheTx7IGZpZWxkOiBzdHJpbmc7IG1lc3NhZ2U6IHN0cmluZzsgdmFsdWU/OiBhbnkgfT4sXG4gICAgICAgIG1lc3NhZ2U/OiBzdHJpbmdcbiAgICAgICk6IHZvaWQ7XG4gICAgICB1bmF1dGhvcml6ZWQobWVzc2FnZT86IHN0cmluZyk6IHZvaWQ7XG4gICAgICBmb3JiaWRkZW4obWVzc2FnZT86IHN0cmluZyk6IHZvaWQ7XG4gICAgICBub3RGb3VuZChyZXNvdXJjZT86IHN0cmluZywgaWRlbnRpZmllcj86IHN0cmluZyB8IG51bWJlcik6IHZvaWQ7XG4gICAgICBjb25mbGljdChyZXNvdXJjZTogc3RyaW5nLCBmaWVsZDogc3RyaW5nLCB2YWx1ZTogYW55KTogdm9pZDtcbiAgICAgIHJhdGVMaW1pdGVkKG1lc3NhZ2U/OiBzdHJpbmcpOiB2b2lkO1xuICAgICAgaW50ZXJuYWxFcnJvcihtZXNzYWdlPzogc3RyaW5nKTogdm9pZDtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVzcG9uc2VVdGlsOyJdLCJ2ZXJzaW9uIjozfQ==