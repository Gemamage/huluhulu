{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\utils\\response.ts","mappings":"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","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\utils\\response.ts"],"sourcesContent":["import { Response } from 'express';\nimport { AppError, ErrorCode } from './errors';\n\n/**\n * 成功響應介面\n */\nexport interface SuccessResponse<T = any> {\n  success: true;\n  message?: string;\n  data?: T;\n  meta?: {\n    page?: number;\n    limit?: number;\n    total?: number;\n    totalPages?: number;\n    hasNext?: boolean;\n    hasPrev?: boolean;\n  };\n  timestamp: string;\n}\n\n/**\n * 錯誤響應介面\n */\nexport interface ErrorResponse {\n  success: false;\n  error: {\n    message: string;\n    code: ErrorCode;\n    statusCode: number;\n    details?: any[];\n    path?: string;\n    method?: string;\n    timestamp: string;\n  };\n}\n\n/**\n * 分頁資訊介面\n */\nexport interface PaginationMeta {\n  page: number;\n  limit: number;\n  total: number;\n  totalPages: number;\n  hasNext: boolean;\n  hasPrev: boolean;\n}\n\n/**\n * 響應工具類\n */\nexport class ResponseUtil {\n  /**\n   * 發送成功響應\n   */\n  static success<T>(\n    res: Response,\n    data?: T,\n    message?: string,\n    statusCode: number = 200,\n    meta?: Partial<PaginationMeta>\n  ): void {\n    const response: SuccessResponse<T> = {\n      success: true,\n      timestamp: new Date().toISOString(),\n    };\n\n    if (message) {\n      response.message = message;\n    }\n\n    if (data !== undefined) {\n      response.data = data;\n    }\n\n    if (meta) {\n      response.meta = meta;\n    }\n\n    res.status(statusCode).json(response);\n  }\n\n  /**\n   * 發送創建成功響應\n   */\n  static created<T>(\n    res: Response,\n    data?: T,\n    message: string = '創建成功'\n  ): void {\n    ResponseUtil.success(res, data, message, 201);\n  }\n\n  /**\n   * 發送更新成功響應\n   */\n  static updated<T>(\n    res: Response,\n    data?: T,\n    message: string = '更新成功'\n  ): void {\n    ResponseUtil.success(res, data, message, 200);\n  }\n\n  /**\n   * 發送刪除成功響應\n   */\n  static deleted(\n    res: Response,\n    message: string = '刪除成功'\n  ): void {\n    ResponseUtil.success(res, undefined, message, 200);\n  }\n\n  /**\n   * 發送分頁響應\n   */\n  static paginated<T>(\n    res: Response,\n    data: T[],\n    pagination: {\n      page: number;\n      limit: number;\n      total: number;\n    },\n    message?: string\n  ): void {\n    const totalPages = Math.ceil(pagination.total / pagination.limit);\n    const meta: PaginationMeta = {\n      page: pagination.page,\n      limit: pagination.limit,\n      total: pagination.total,\n      totalPages,\n      hasNext: pagination.page < totalPages,\n      hasPrev: pagination.page > 1,\n    };\n\n    ResponseUtil.success(res, data, message, 200, meta);\n  }\n\n  /**\n   * 發送錯誤響應\n   */\n  static error(\n    res: Response,\n    error: AppError,\n    path?: string,\n    method?: string\n  ): void {\n    const response: ErrorResponse = {\n      success: false,\n      error: {\n        message: error.message,\n        code: error.errorCode,\n        statusCode: error.statusCode,\n        timestamp: error.timestamp,\n      },\n    };\n\n    if (error.details && error.details.length > 0) {\n      response.error.details = error.details;\n    }\n\n    if (path) {\n      response.error.path = path;\n    }\n\n    if (method) {\n      response.error.method = method;\n    }\n\n    res.status(error.statusCode).json(response);\n  }\n\n  /**\n   * 發送驗證錯誤響應\n   */\n  static validationError(\n    res: Response,\n    errors: Array<{ field: string; message: string; value?: any }>,\n    message: string = '輸入資料驗證失敗'\n  ): void {\n    const appError = new AppError(\n      message,\n      400,\n      ErrorCode.VALIDATION_ERROR,\n      errors\n    );\n    ResponseUtil.error(res, appError);\n  }\n\n  /**\n   * 發送未授權響應\n   */\n  static unauthorized(\n    res: Response,\n    message: string = '認證失敗'\n  ): void {\n    const appError = new AppError(\n      message,\n      401,\n      ErrorCode.AUTHENTICATION_FAILED\n    );\n    ResponseUtil.error(res, appError);\n  }\n\n  /**\n   * 發送禁止訪問響應\n   */\n  static forbidden(\n    res: Response,\n    message: string = '權限不足'\n  ): void {\n    const appError = new AppError(\n      message,\n      403,\n      ErrorCode.INSUFFICIENT_PERMISSIONS\n    );\n    ResponseUtil.error(res, appError);\n  }\n\n  /**\n   * 發送未找到響應\n   */\n  static notFound(\n    res: Response,\n    resource: string = '資源',\n    identifier?: string | number\n  ): void {\n    const message = identifier\n      ? `${resource} (${identifier}) 未找到`\n      : `${resource} 未找到`;\n    \n    const appError = new AppError(\n      message,\n      404,\n      ErrorCode.RESOURCE_NOT_FOUND,\n      [{ resource, identifier }]\n    );\n    ResponseUtil.error(res, appError);\n  }\n\n  /**\n   * 發送衝突響應\n   */\n  static conflict(\n    res: Response,\n    resource: string,\n    field: string,\n    value: any\n  ): void {\n    const message = `${resource} 的 ${field} 已存在`;\n    const appError = new AppError(\n      message,\n      409,\n      ErrorCode.RESOURCE_CONFLICT,\n      [{ resource, field, value, constraint: 'unique' }]\n    );\n    ResponseUtil.error(res, appError);\n  }\n\n  /**\n   * 發送速率限制響應\n   */\n  static rateLimited(\n    res: Response,\n    message: string = '請求過於頻繁，請稍後再試'\n  ): void {\n    const appError = new AppError(\n      message,\n      429,\n      ErrorCode.RATE_LIMIT_EXCEEDED\n    );\n    ResponseUtil.error(res, appError);\n  }\n\n  /**\n   * 發送內部伺服器錯誤響應\n   */\n  static internalError(\n    res: Response,\n    message: string = '內部伺服器錯誤'\n  ): void {\n    const appError = new AppError(\n      message,\n      500,\n      ErrorCode.INTERNAL_SERVER_ERROR,\n      undefined,\n      false\n    );\n    ResponseUtil.error(res, appError);\n  }\n}\n\n/**\n * 響應中間件 - 為 Response 對象添加便捷方法\n */\nexport const responseMiddleware = (\n  req: any,\n  res: Response,\n  next: any\n): void => {\n  // 添加便捷方法到 Response 對象\n  res.success = function<T>(\n    data?: T,\n    message?: string,\n    statusCode?: number,\n    meta?: Partial<PaginationMeta>\n  ) {\n    return ResponseUtil.success(this, data, message, statusCode, meta);\n  };\n\n  res.created = function<T>(data?: T, message?: string) {\n    return ResponseUtil.created(this, data, message);\n  };\n\n  res.updated = function<T>(data?: T, message?: string) {\n    return ResponseUtil.updated(this, data, message);\n  };\n\n  res.deleted = function(message?: string) {\n    return ResponseUtil.deleted(this, message);\n  };\n\n  res.paginated = function<T>(\n    data: T[],\n    pagination: { page: number; limit: number; total: number },\n    message?: string\n  ) {\n    return ResponseUtil.paginated(this, data, pagination, message);\n  };\n\n  res.validationError = function(\n    errors: Array<{ field: string; message: string; value?: any }>,\n    message?: string\n  ) {\n    return ResponseUtil.validationError(this, errors, message);\n  };\n\n  res.unauthorized = function(message?: string) {\n    return ResponseUtil.unauthorized(this, message);\n  };\n\n  res.forbidden = function(message?: string) {\n    return ResponseUtil.forbidden(this, message);\n  };\n\n  res.notFound = function(resource?: string, identifier?: string | number) {\n    return ResponseUtil.notFound(this, resource, identifier);\n  };\n\n  res.conflict = function(resource: string, field: string, value: any) {\n    return ResponseUtil.conflict(this, resource, field, value);\n  };\n\n  res.rateLimited = function(message?: string) {\n    return ResponseUtil.rateLimited(this, message);\n  };\n\n  res.internalError = function(message?: string) {\n    return ResponseUtil.internalError(this, message);\n  };\n\n  next();\n};\n\n// 擴展 Express Response 介面\ndeclare global {\n  namespace Express {\n    interface Response {\n      success<T>(\n        data?: T,\n        message?: string,\n        statusCode?: number,\n        meta?: Partial<PaginationMeta>\n      ): void;\n      created<T>(data?: T, message?: string): void;\n      updated<T>(data?: T, message?: string): void;\n      deleted(message?: string): void;\n      paginated<T>(\n        data: T[],\n        pagination: { page: number; limit: number; total: number },\n        message?: string\n      ): void;\n      validationError(\n        errors: Array<{ field: string; message: string; value?: any }>,\n        message?: string\n      ): void;\n      unauthorized(message?: string): void;\n      forbidden(message?: string): void;\n      notFound(resource?: string, identifier?: string | number): void;\n      conflict(resource: string, field: string, value: any): void;\n      rateLimited(message?: string): void;\n      internalError(message?: string): void;\n    }\n  }\n}\n\nexport default ResponseUtil;"],"version":3}