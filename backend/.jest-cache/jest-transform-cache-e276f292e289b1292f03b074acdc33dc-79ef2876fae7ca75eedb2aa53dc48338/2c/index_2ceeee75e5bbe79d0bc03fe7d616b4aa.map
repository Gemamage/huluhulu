{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\services\\search\\index.ts","mappings":"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","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\services\\search\\index.ts"],"sourcesContent":["import { indexingService, IndexingService } from './indexing';\nimport { searchCoreService, SearchCoreService } from './core';\nimport { searchSuggestionsService, SearchSuggestionsService } from './suggestions';\nimport { searchAnalyticsService, SearchAnalyticsService } from './analytics';\nimport { logger } from '../../utils/logger';\n\n// 重新導出介面和類型\nexport * from './indexing';\nexport * from './core';\nexport * from './suggestions';\nexport * from './analytics';\n\n/**\n * 統一的寵物搜尋服務\n * 整合索引管理、核心搜尋、建議和分析功能\n */\nexport class PetSearchService {\n  private indexing: IndexingService;\n  private core: SearchCoreService;\n  private suggestions: SearchSuggestionsService;\n  private analytics: SearchAnalyticsService;\n  private isInitialized: boolean = false;\n\n  constructor() {\n    this.indexing = indexingService;\n    this.core = searchCoreService;\n    this.suggestions = searchSuggestionsService;\n    this.analytics = searchAnalyticsService;\n  }\n\n  /**\n   * 初始化搜尋服務\n   */\n  public async initialize(): Promise<void> {\n    try {\n      logger.info('正在初始化寵物搜尋服務...');\n      \n      // 初始化索引\n      await this.indexing.initializePetIndex();\n      await this.indexing.initializeSearchAnalyticsIndex();\n      \n      this.isInitialized = true;\n      logger.info('寵物搜尋服務初始化完成');\n    } catch (error) {\n      logger.error('寵物搜尋服務初始化失敗:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 檢查服務是否已初始化\n   */\n  public isServiceInitialized(): boolean {\n    return this.isInitialized;\n  }\n\n  /**\n   * 獲取索引服務\n   */\n  public getIndexingService(): IndexingService {\n    return this.indexing;\n  }\n\n  /**\n   * 獲取核心搜尋服務\n   */\n  public getCoreService(): SearchCoreService {\n    return this.core;\n  }\n\n  /**\n   * 獲取建議服務\n   */\n  public getSuggestionsService(): SearchSuggestionsService {\n    return this.suggestions;\n  }\n\n  /**\n   * 獲取分析服務\n   */\n  public getAnalyticsService(): SearchAnalyticsService {\n    return this.analytics;\n  }\n\n  /**\n   * 搜尋寵物（帶分析記錄）\n   */\n  public async searchPets(query: any, userId?: string, sessionId?: string, userAgent?: string, ipAddress?: string) {\n    try {\n      const startTime = Date.now();\n      \n      // 執行搜尋\n      const searchResult = await this.core.searchPets(query);\n      \n      const searchDuration = Date.now() - startTime;\n      \n      // 記錄搜尋分析\n      if (query.query || Object.keys(query.filters || {}).length > 0) {\n        await this.analytics.recordSearchAnalytics({\n          query: query.query || '',\n          filters: query.filters || {},\n          userId,\n          resultCount: searchResult.total,\n          timestamp: new Date(),\n          sessionId,\n          userAgent,\n          ipAddress,\n          searchDuration,\n          location: query.location\n        });\n      }\n      \n      return searchResult;\n    } catch (error) {\n      logger.error('搜尋寵物失敗:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 高級搜尋\n   */\n  public async advancedSearch(query: any, userId?: string) {\n    try {\n      const startTime = Date.now();\n      \n      const searchResult = await this.core.advancedSearch(query);\n      \n      const searchDuration = Date.now() - startTime;\n      \n      // 記錄搜尋分析\n      await this.analytics.recordSearchAnalytics({\n        query: query.query || 'advanced_search',\n        filters: query.filters || {},\n        userId,\n        resultCount: searchResult.total,\n        timestamp: new Date(),\n        searchDuration\n      });\n      \n      return searchResult;\n    } catch (error) {\n      logger.error('高級搜尋失敗:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 尋找相似寵物\n   */\n  public async findSimilarPets(petId: string, userId?: string) {\n    try {\n      const similarPets = await this.core.findSimilarPets(petId);\n      \n      // 記錄搜尋分析\n      await this.analytics.recordSearchAnalytics({\n        query: `similar_to_${petId}`,\n        filters: {},\n        userId,\n        resultCount: similarPets.length,\n        timestamp: new Date()\n      });\n      \n      return similarPets;\n    } catch (error) {\n      logger.error('尋找相似寵物失敗:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 獲取搜尋建議\n   */\n  public async getSearchSuggestions(query: string, limit?: number) {\n    return this.suggestions.getSearchSuggestions(query, limit);\n  }\n\n  /**\n   * 獲取智能建議\n   */\n  public async getSmartSuggestions(query: string, userId?: string, limit?: number) {\n    return this.suggestions.getSmartSuggestions(query, userId, limit);\n  }\n\n  /**\n   * 獲取熱門搜尋\n   */\n  public async getPopularSearches(limit?: number, category?: string) {\n    return this.suggestions.getPopularSearches(limit, category);\n  }\n\n  /**\n   * 獲取用戶搜尋歷史\n   */\n  public async getUserSearchHistory(userId: string, limit?: number) {\n    return this.suggestions.getUserSearchHistory(userId, limit);\n  }\n\n  /**\n   * 記錄搜尋點擊\n   */\n  public async recordSearchClick(searchId: string, petId: string, position: number) {\n    return this.analytics.recordSearchClick(searchId, petId, position);\n  }\n\n  /**\n   * 索引寵物文檔\n   */\n  public async indexPet(pet: any) {\n    return this.indexing.indexPetDocument(pet);\n  }\n\n  /**\n   * 批量索引寵物文檔\n   */\n  public async indexPetsBulk(pets: any[]) {\n    return this.indexing.indexPetDocumentsBulk(pets);\n  }\n\n  /**\n   * 刪除寵物文檔\n   */\n  public async deletePet(petId: string) {\n    return this.indexing.deletePetDocument(petId);\n  }\n\n  /**\n   * 更新寵物文檔\n   */\n  public async updatePet(petId: string, updates: any) {\n    return this.indexing.updatePetDocument(petId, updates);\n  }\n\n  /**\n   * 獲取搜尋統計\n   */\n  public async getSearchStats(startDate?: Date, endDate?: Date) {\n    return this.analytics.getSearchStats(startDate, endDate);\n  }\n\n  /**\n   * 獲取用戶搜尋統計\n   */\n  public async getUserSearchStats(userId: string, startDate?: Date, endDate?: Date) {\n    return this.analytics.getUserSearchStats(userId, startDate, endDate);\n  }\n\n  /**\n   * 獲取搜尋趨勢\n   */\n  public async getSearchTrends(period: 'daily' | 'weekly' | 'monthly', startDate?: Date, endDate?: Date) {\n    return this.analytics.getSearchTrends(period, startDate, endDate);\n  }\n\n  /**\n   * 獲取搜尋效果分析\n   */\n  public async getSearchEffectiveness() {\n    return this.analytics.getSearchEffectiveness();\n  }\n\n  /**\n   * 獲取索引統計\n   */\n  public async getIndexStats() {\n    return this.indexing.getIndexStats();\n  }\n\n  /**\n   * 重建寵物索引\n   */\n  public async rebuildPetIndex() {\n    return this.indexing.rebuildPetIndex();\n  }\n\n  /**\n   * 檢查索引是否存在\n   */\n  public async checkIndexExists(indexName: string) {\n    return this.indexing.checkIndexExists(indexName);\n  }\n\n  /**\n   * 清理過期數據\n   */\n  public async cleanupExpiredData(analyticsDays: number = 90, suggestionDays: number = 30) {\n    try {\n      const [analyticsResult, suggestionsResult] = await Promise.all([\n        this.analytics.cleanupAnalyticsData(analyticsDays),\n        this.suggestions.cleanupSuggestionCache(suggestionDays)\n      ]);\n      \n      logger.info('清理過期數據完成', {\n        deletedAnalytics: analyticsResult.deletedCount,\n        deletedSuggestions: suggestionsResult.deletedCount\n      });\n      \n      return {\n        deletedAnalytics: analyticsResult.deletedCount,\n        deletedSuggestions: suggestionsResult.deletedCount\n      };\n    } catch (error) {\n      logger.error('清理過期數據失敗:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 獲取服務健康狀態\n   */\n  public async getHealthStatus() {\n    try {\n      const [petIndexExists, analyticsIndexExists, indexStats] = await Promise.all([\n        this.indexing.checkIndexExists(this.indexing.getPetIndexName()),\n        this.indexing.checkIndexExists(this.indexing.getSearchAnalyticsIndexName()),\n        this.indexing.getIndexStats()\n      ]);\n      \n      return {\n        isInitialized: this.isInitialized,\n        petIndexExists,\n        analyticsIndexExists,\n        indexStats,\n        timestamp: new Date()\n      };\n    } catch (error) {\n      logger.error('獲取服務健康狀態失敗:', error);\n      return {\n        isInitialized: this.isInitialized,\n        petIndexExists: false,\n        analyticsIndexExists: false,\n        indexStats: null,\n        error: error.message,\n        timestamp: new Date()\n      };\n    }\n  }\n\n  /**\n   * 重啟服務\n   */\n  public async restart() {\n    try {\n      logger.info('正在重啟寵物搜尋服務...');\n      this.isInitialized = false;\n      await this.initialize();\n      logger.info('寵物搜尋服務重啟完成');\n    } catch (error) {\n      logger.error('寵物搜尋服務重啟失敗:', error);\n      throw error;\n    }\n  }\n}\n\n// 導出單例實例\nexport const petSearchService = new PetSearchService();\n\n// 導出子服務實例（向後兼容）\nexport {\n  indexingService,\n  searchCoreService,\n  searchSuggestionsService,\n  searchAnalyticsService\n};\n\n// 默認導出\nexport default petSearchService;"],"version":3}