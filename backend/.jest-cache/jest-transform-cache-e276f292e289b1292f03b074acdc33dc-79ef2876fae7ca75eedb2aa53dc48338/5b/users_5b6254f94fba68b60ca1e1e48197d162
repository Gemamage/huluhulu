6a0903fb8170c9db97dfc3955a3753a7
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.userRoutes = void 0;
const express_1 = require("express");
const express_validator_1 = require("express-validator");
const logger_1 = require("../utils/logger");
const errors_1 = require("../utils/errors");
const userService_1 = require("../services/userService");
const emailService_1 = require("../services/emailService");
const cloudinaryService_1 = require("../services/cloudinaryService");
const auth_1 = require("../middleware/auth");
const environment_1 = require("../config/environment");
const multer_1 = __importDefault(require("multer"));
const router = (0, express_1.Router)();
exports.userRoutes = router;
const userService = new userService_1.UserService();
// Cloudinary 配置已移至 CloudinaryService
// 配置 multer 用於檔案上傳
const upload = (0, multer_1.default)({
    storage: multer_1.default.memoryStorage(),
    limits: {
        fileSize: environment_1.config.upload.maxFileSize,
    },
    fileFilter: (_req, file, cb) => {
        if (environment_1.config.upload.allowedMimeTypes.includes(file.mimetype)) {
            cb(null, true);
        }
        else {
            cb(new errors_1.AppError("不支援的檔案格式", 400));
        }
    },
});
// 獲取用戶列表（僅管理員）
router.get("/", auth_1.authenticate, (0, auth_1.authorize)("admin"), [
    (0, express_validator_1.query)("page").optional().isInt({ min: 1 }),
    (0, express_validator_1.query)("limit").optional().isInt({ min: 1, max: 100 }),
    (0, express_validator_1.query)("search").optional().isString(),
    (0, express_validator_1.query)("role").optional().isIn(["user", "admin"]),
    (0, express_validator_1.query)("isActive").optional().isBoolean(),
    (0, express_validator_1.query)("isEmailVerified").optional().isBoolean(),
], async (req, res) => {
    try {
        const errors = (0, express_validator_1.validationResult)(req);
        if (!errors.isEmpty()) {
            res.status(400).json({
                success: false,
                message: "查詢參數驗證失敗",
                errors: errors.array(),
            });
            return;
        }
        const { page = 1, limit = 20, search, role, isActive, isEmailVerified, sortBy = "createdAt", sortOrder = "desc", } = req.query;
        // 獲取用戶列表
        const queryOptions = {
            page: Number(page),
            limit: Number(limit),
            search: search,
            sortBy: sortBy,
            sortOrder: sortOrder,
        };
        if (role) {
            queryOptions.role = role;
        }
        if (isActive !== undefined) {
            queryOptions.isActive = Boolean(isActive);
        }
        if (isEmailVerified !== undefined) {
            queryOptions.isEmailVerified = Boolean(isEmailVerified);
        }
        const result = await userService.getUsers(queryOptions);
        logger_1.logger.info("獲取用戶列表成功", {
            page,
            limit,
            total: result.total,
            adminId: req.user?._id.toString(),
        });
        res.json({
            success: true,
            data: result,
        });
    }
    catch (error) {
        logger_1.logger.error("獲取用戶列表失敗", { error });
        res.status(500).json({
            success: false,
            message: "獲取用戶列表失敗，請稍後再試",
        });
    }
});
// 獲取特定用戶資訊
router.get("/:id", auth_1.authenticate, auth_1.authorizeOwnerOrAdmin, async (req, res) => {
    try {
        const { id } = req.params;
        if (!id) {
            res.status(400).json({
                success: false,
                message: "缺少用戶 ID",
            });
            return;
        }
        // 獲取用戶資訊
        const user = await userService.getUserById(id);
        if (!user) {
            res.status(404).json({
                success: false,
                message: "用戶不存在",
            });
            return;
        }
        logger_1.logger.info("獲取用戶資訊成功", {
            userId: id,
            requesterId: req.user?._id.toString(),
        });
        res.json({
            success: true,
            data: {
                user: {
                    id: user._id,
                    email: user.email,
                    name: user.name,
                    phone: user.phone,
                    avatar: user.avatar,
                    role: user.role,
                    isEmailVerified: user.isEmailVerified,
                    isActive: user.isActive,
                    createdAt: user.createdAt,
                    updatedAt: user.updatedAt,
                    lastLoginAt: user.lastLoginAt,
                },
            },
        });
    }
    catch (error) {
        logger_1.logger.error("獲取用戶資訊失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "獲取用戶資訊失敗，請稍後再試",
        });
    }
});
// 更新用戶資訊
router.put("/:id", auth_1.authenticate, auth_1.authorizeOwnerOrAdmin, [
    (0, express_validator_1.body)("name")
        .optional()
        .trim()
        .isLength({ min: 1 })
        .withMessage("姓名不能為空"),
    (0, express_validator_1.body)("phone")
        .optional()
        .isMobilePhone("zh-TW")
        .withMessage("請提供有效的手機號碼"),
], async (req, res) => {
    try {
        const errors = (0, express_validator_1.validationResult)(req);
        if (!errors.isEmpty()) {
            res.status(400).json({
                success: false,
                message: "輸入資料驗證失敗",
                errors: errors.array(),
            });
            return;
        }
        const { id } = req.params;
        const updateData = req.body;
        if (!id) {
            res.status(400).json({
                success: false,
                message: "缺少用戶 ID",
            });
            return;
        }
        // 更新用戶資訊
        const updatedUser = await userService.updateUser(id, updateData);
        logger_1.logger.info("用戶資訊更新成功", {
            userId: id,
            updateData,
            updaterId: req.user?._id.toString(),
        });
        res.json({
            success: true,
            message: "用戶資訊更新成功",
            data: {
                user: {
                    id: updatedUser._id,
                    email: updatedUser.email,
                    name: updatedUser.name,
                    phone: updatedUser.phone,
                    avatar: updatedUser.avatar,
                    role: updatedUser.role,
                    isEmailVerified: updatedUser.isEmailVerified,
                    isActive: updatedUser.isActive,
                    updatedAt: updatedUser.updatedAt,
                },
            },
        });
    }
    catch (error) {
        logger_1.logger.error("用戶資訊更新失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "用戶資訊更新失敗，請稍後再試",
        });
    }
});
// 停用用戶帳號（軟刪除）
router.delete("/:id", auth_1.authenticate, auth_1.authorizeOwnerOrAdmin, async (req, res) => {
    try {
        const { id } = req.params;
        if (!id) {
            res.status(400).json({
                success: false,
                message: "缺少用戶 ID",
            });
            return;
        }
        // 停用用戶帳號
        await userService.deactivateUser(id);
        logger_1.logger.info("用戶帳號已停用", {
            userId: id,
            deactivatedBy: req.user?._id.toString(),
        });
        res.json({
            success: true,
            message: "用戶帳號已停用",
        });
    }
    catch (error) {
        logger_1.logger.error("停用用戶帳號失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "停用用戶帳號失敗，請稍後再試",
        });
    }
});
// 上傳用戶頭像
router.post("/:id/avatar", auth_1.authenticate, auth_1.authorizeOwnerOrAdmin, upload.single("avatar"), async (req, res) => {
    try {
        const { id } = req.params;
        const file = req.file;
        if (!id) {
            res.status(400).json({
                success: false,
                message: "缺少用戶 ID",
            });
            return;
        }
        if (!file) {
            res.status(400).json({
                success: false,
                message: "請選擇要上傳的頭像檔案",
            });
            return;
        }
        // 上傳到 Cloudinary
        const uploadResult = await cloudinaryService_1.CloudinaryService.uploadFile(file.buffer, file.originalname, file.mimetype, id, "avatar");
        const avatarUrl = uploadResult.secureUrl;
        // 更新用戶頭像
        const updatedUser = await userService.updateUser(id, {
            avatar: avatarUrl,
        });
        logger_1.logger.info("用戶頭像上傳成功", {
            userId: id,
            avatarUrl,
            uploaderId: req.user?._id.toString(),
        });
        res.json({
            success: true,
            message: "頭像上傳成功",
            data: {
                avatarUrl,
                user: {
                    id: updatedUser._id,
                    avatar: updatedUser.avatar,
                },
            },
        });
    }
    catch (error) {
        logger_1.logger.error("頭像上傳失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "頭像上傳失敗，請稍後再試",
        });
    }
});
// 發送電子郵件驗證
router.post("/:id/send-verification", auth_1.authenticate, auth_1.authorizeOwnerOrAdmin, async (req, res) => {
    try {
        const { id } = req.params;
        if (!id) {
            res.status(400).json({
                success: false,
                message: "缺少用戶 ID",
            });
            return;
        }
        // 獲取用戶資訊
        const user = await userService.getUserById(id);
        if (user.isEmailVerified) {
            res.status(400).json({
                success: false,
                message: "電子郵件已經驗證過了",
            });
            return;
        }
        // 生成驗證令牌
        const verificationToken = user.generateEmailVerificationToken();
        await user.save();
        // 發送驗證郵件
        await emailService_1.EmailService.sendVerificationEmail(user.email, user.name, verificationToken);
        logger_1.logger.info("驗證郵件發送成功", {
            userId: id,
            email: user.email,
            requesterId: req.user?._id.toString(),
        });
        res.json({
            success: true,
            message: "驗證郵件已發送，請檢查您的信箱",
        });
    }
    catch (error) {
        logger_1.logger.error("發送驗證郵件失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "發送驗證郵件失敗，請稍後再試",
        });
    }
});
// 驗證電子郵件
router.post("/:id/verify-email", [(0, express_validator_1.body)("token").notEmpty().withMessage("請提供驗證令牌")], async (req, res) => {
    try {
        const errors = (0, express_validator_1.validationResult)(req);
        if (!errors.isEmpty()) {
            res.status(400).json({
                success: false,
                message: "輸入資料驗證失敗",
                errors: errors.array(),
            });
            return;
        }
        const { id } = req.params;
        const { token } = req.body;
        // 驗證電子郵件
        await userService.verifyEmailByToken(token);
        logger_1.logger.info("電子郵件驗證成功", {
            userId: id,
        });
        res.json({
            success: true,
            message: "電子郵件驗證成功",
        });
    }
    catch (error) {
        logger_1.logger.error("電子郵件驗證失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "電子郵件驗證失敗，請稍後再試",
        });
    }
});
// 獲取用戶的寵物列表
router.get("/:id/pets", auth_1.authenticate, auth_1.authorizeOwnerOrAdmin, [
    (0, express_validator_1.query)("page").optional().isInt({ min: 1 }),
    (0, express_validator_1.query)("limit").optional().isInt({ min: 1, max: 50 }),
    (0, express_validator_1.query)("status").optional().isIn(["lost", "found", "adopted"]),
    (0, express_validator_1.query)("type").optional().isIn(["dog", "cat", "other"]),
], async (req, res) => {
    try {
        const errors = (0, express_validator_1.validationResult)(req);
        if (!errors.isEmpty()) {
            res.status(400).json({
                success: false,
                message: "查詢參數驗證失敗",
                errors: errors.array(),
            });
            return;
        }
        const { id } = req.params;
        if (!id) {
            res.status(400).json({
                success: false,
                message: "缺少用戶 ID",
            });
            return;
        }
        const { page = 1, limit = 10, status, type,
        // sortBy = 'createdAt',
        // sortOrder = 'desc',
         } = req.query;
        // 構建查詢條件
        const query = { owner: id };
        if (status) {
            query.status = status;
        }
        if (type) {
            query.type = type;
        }
        // 分頁參數
        const pageNum = Math.max(1, parseInt(page));
        const limitNum = Math.min(50, Math.max(1, parseInt(limit)));
        // 查詢寵物（這裡假設有 Pet 模型，實際需要根據寵物模組實作）
        // 暫時返回空列表，等寵物模組完成後再實作
        const pets = [];
        const total = 0;
        logger_1.logger.info("獲取用戶寵物列表成功", {
            userId: id,
            query,
            pagination: { page: pageNum, limit: limitNum },
            requesterId: req.user?._id.toString(),
        });
        res.json({
            success: true,
            message: "獲取用戶寵物列表成功",
            data: {
                pets,
                pagination: {
                    currentPage: pageNum,
                    totalPages: Math.ceil(total / limitNum),
                    totalItems: total,
                    itemsPerPage: limitNum,
                    hasNextPage: pageNum < Math.ceil(total / limitNum),
                    hasPrevPage: pageNum > 1,
                },
            },
        });
    }
    catch (error) {
        logger_1.logger.error("獲取用戶寵物列表失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "獲取用戶寵物列表失敗，請稍後再試",
        });
    }
});
// 更改密碼
router.put("/:id/change-password", auth_1.authenticate, auth_1.authorizeOwnerOrAdmin, [
    (0, express_validator_1.body)("currentPassword").notEmpty().withMessage("請提供當前密碼"),
    (0, express_validator_1.body)("newPassword")
        .isLength({ min: 8 })
        .withMessage("新密碼長度至少為 8 個字符")
        .matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/)
        .withMessage("新密碼必須包含至少一個小寫字母、一個大寫字母和一個數字"),
], async (req, res) => {
    try {
        const errors = (0, express_validator_1.validationResult)(req);
        if (!errors.isEmpty()) {
            res.status(400).json({
                success: false,
                message: "輸入資料驗證失敗",
                errors: errors.array(),
            });
            return;
        }
        const { id } = req.params;
        const { currentPassword, newPassword } = req.body;
        if (!id || !currentPassword || !newPassword) {
            res.status(400).json({
                success: false,
                message: "缺少必要參數",
            });
            return;
        }
        // 更改密碼
        await userService.changePassword(id, currentPassword, newPassword);
        logger_1.logger.info("密碼更改成功", {
            userId: id,
            changedBy: req.user?._id.toString(),
        });
        res.json({
            success: true,
            message: "密碼更改成功",
        });
    }
    catch (error) {
        logger_1.logger.error("密碼更改失敗", { error });
        if (error instanceof errors_1.AppError) {
            res.status(error.statusCode).json({
                success: false,
                message: error.message,
            });
            return;
        }
        res.status(500).json({
            success: false,
            message: "密碼更改失敗，請稍後再試",
        });
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcdXNlcnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEscUNBQW9EO0FBQ3BELHlEQUFrRTtBQUNsRSw0Q0FBeUM7QUFDekMsNENBQTJDO0FBQzNDLHlEQUFzRDtBQUN0RCwyREFBd0Q7QUFDeEQscUVBQWtFO0FBQ2xFLDZDQUk0QjtBQUU1Qix1REFBK0M7QUFDL0Msb0RBQTRCO0FBRTVCLE1BQU0sTUFBTSxHQUFHLElBQUEsZ0JBQU0sR0FBRSxDQUFDO0FBMnBCTCw0QkFBVTtBQTFwQjdCLE1BQU0sV0FBVyxHQUFHLElBQUkseUJBQVcsRUFBRSxDQUFDO0FBRXRDLHFDQUFxQztBQUVyQyxtQkFBbUI7QUFDbkIsTUFBTSxNQUFNLEdBQUcsSUFBQSxnQkFBTSxFQUFDO0lBQ3BCLE9BQU8sRUFBRSxnQkFBTSxDQUFDLGFBQWEsRUFBRTtJQUMvQixNQUFNLEVBQUU7UUFDTixRQUFRLEVBQUUsb0JBQU0sQ0FBQyxNQUFNLENBQUMsV0FBVztLQUNwQztJQUNELFVBQVUsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUU7UUFDN0IsSUFBSSxvQkFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQWUsQ0FBQyxFQUFFLENBQUM7WUFDbEUsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNqQixDQUFDO2FBQU0sQ0FBQztZQUNOLEVBQUUsQ0FBQyxJQUFJLGlCQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsQ0FBQztJQUNILENBQUM7Q0FDRixDQUFDLENBQUM7QUFFSCxlQUFlO0FBQ2YsTUFBTSxDQUFDLEdBQUcsQ0FDUixHQUFHLEVBQ0gsbUJBQVksRUFDWixJQUFBLGdCQUFTLEVBQUMsT0FBTyxDQUFDLEVBQ2xCO0lB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QyxRQUFRLEVBQUU7U0FDL0MsQ0FBQyxDQUFDO1FBRUgsR0FBRyxDQUFDLElBQUksQ0FBQztZQUNQLE9BQU8sRUFBRSxJQUFJO1lBQ2IsT0FBTyxFQUFFLFFBQVE7U0FDbEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixlQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFbEMsSUFBSSxLQUFLLFlBQVksaUJBQVEsRUFBRSxDQUFDO1lBQzlCLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDaEMsT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO2FBQ3ZCLENBQUMsQ0FBQztZQUNILE9BQU87UUFDVCxDQUFDO1FBRUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDbkIsT0FBTyxFQUFFLEtBQUs7WUFDZCxPQUFPLEVBQUUsY0FBYztTQUN4QixDQUFDLENBQUM7SUFDTCxDQUFDO0FBQ0gsQ0FBQyxDQUNGLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFxzcmNcXHJvdXRlc1xcdXNlcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyLCBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBib2R5LCB2YWxpZGF0aW9uUmVzdWx0LCBxdWVyeSB9IGZyb20gXCJleHByZXNzLXZhbGlkYXRvclwiO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSBcIi4uL3V0aWxzL2xvZ2dlclwiO1xuaW1wb3J0IHsgQXBwRXJyb3IgfSBmcm9tIFwiLi4vdXRpbHMvZXJyb3JzXCI7XG5pbXBvcnQgeyBVc2VyU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy91c2VyU2VydmljZVwiO1xuaW1wb3J0IHsgRW1haWxTZXJ2aWNlIH0gZnJvbSBcIi4uL3NlcnZpY2VzL2VtYWlsU2VydmljZVwiO1xuaW1wb3J0IHsgQ2xvdWRpbmFyeVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvY2xvdWRpbmFyeVNlcnZpY2VcIjtcbmltcG9ydCB7XG4gIGF1dGhlbnRpY2F0ZSxcbiAgYXV0aG9yaXplLFxuICBhdXRob3JpemVPd25lck9yQWRtaW4sXG59IGZyb20gXCIuLi9taWRkbGV3YXJlL2F1dGhcIjtcbmltcG9ydCB7IElVc2VyIH0gZnJvbSBcIi4uL21vZGVscy9Vc2VyXCI7XG5pbXBvcnQgeyBjb25maWcgfSBmcm9tIFwiLi4vY29uZmlnL2Vudmlyb25tZW50XCI7XG5pbXBvcnQgbXVsdGVyIGZyb20gXCJtdWx0ZXJcIjtcblxuY29uc3Qgcm91dGVyID0gUm91dGVyKCk7XG5jb25zdCB1c2VyU2VydmljZSA9IG5ldyBVc2VyU2VydmljZSgpO1xuXG4vLyBDbG91ZGluYXJ5IOmFjee9ruW3suenu+iHsyBDbG91ZGluYXJ5U2VydmljZVxuXG4vLyDphY3nva4gbXVsdGVyIOeUqOaWvOaqlOahiOS4iuWCs1xuY29uc3QgdXBsb2FkID0gbXVsdGVyKHtcbiAgc3RvcmFnZTogbXVsdGVyLm1lbW9yeVN0b3JhZ2UoKSxcbiAgbGltaXRzOiB7XG4gICAgZmlsZVNpemU6IGNvbmZpZy51cGxvYWQubWF4RmlsZVNpemUsXG4gIH0sXG4gIGZpbGVGaWx0ZXI6IChfcmVxLCBmaWxlLCBjYikgPT4ge1xuICAgIGlmIChjb25maWcudXBsb2FkLmFsbG93ZWRNaW1lVHlwZXMuaW5jbHVkZXMoZmlsZS5taW1ldHlwZSBhcyBhbnkpKSB7XG4gICAgICBjYihudWxsLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2IobmV3IEFwcEVycm9yKFwi5LiN5pSv5o+055qE5qqU5qGI5qC85byPXCIsIDQwMCkpO1xuICAgIH1cbiAgfSxcbn0pO1xuXG4vLyDnjbLlj5bnlKjmiLbliJfooajvvIjlg4XnrqHnkIblk6HvvIlcbnJvdXRlci5nZXQoXG4gIFwiL1wiLFxuICBhdXRoZW50aWNhdGUsXG4gIGF1dGhvcml6ZShcImFkbWluXCIpLFxuICBbXG4gICAgcXVlcnkoXCJwYWdlXCIpLm9wdGlvbmFsKCkuaXNJbnQoeyBtaW46IDEgfSksXG4gICAgcXVlcnkoXCJsaW1pdFwiKS5vcHRpb25hbCgpLmlzSW50KHsgbWluOiAxLCBtYXg6IDEwMCB9KSxcbiAgICBxdWVyeShcInNlYXJjaFwiKS5vcHRpb25hbCgpLmlzU3RyaW5nKCksXG4gICAgcXVlcnkoXCJyb2xlXCIpLm9wdGlvbmFsKCkuaXNJbihbXCJ1c2VyXCIsIFwiYWRtaW5cIl0pLFxuICAgIHF1ZXJ5KFwiaXNBY3RpdmVcIikub3B0aW9uYWwoKS5pc0Jvb2xlYW4oKSxcbiAgICBxdWVyeShcImlzRW1haWxWZXJpZmllZFwiKS5vcHRpb25hbCgpLmlzQm9vbGVhbigpLFxuICBdLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRpb25SZXN1bHQocmVxKTtcbiAgICAgIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogXCLmn6XoqaLlj4PmlbjpqZforYnlpLHmlZdcIixcbiAgICAgICAgICBlcnJvcnM6IGVycm9ycy5hcnJheSgpLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIHBhZ2UgPSAxLFxuICAgICAgICBsaW1pdCA9IDIwLFxuICAgICAgICBzZWFyY2gsXG4gICAgICAgIHJvbGUsXG4gICAgICAgIGlzQWN0aXZlLFxuICAgICAgICBpc0VtYWlsVmVyaWZpZWQsXG4gICAgICAgIHNvcnRCeSA9IFwiY3JlYXRlZEF0XCIsXG4gICAgICAgIHNvcnRPcmRlciA9IFwiZGVzY1wiLFxuICAgICAgfSA9IHJlcS5xdWVyeTtcblxuICAgICAgLy8g542y5Y+W55So5oi25YiX6KGoXG4gICAgICBjb25zdCBxdWVyeU9wdGlvbnM6IGFueSA9IHtcbiAgICAgICAgcGFnZTogTnVtYmVyKHBhZ2UpLFxuICAgICAgICBsaW1pdDogTnVtYmVyKGxpbWl0KSxcbiAgICAgICAgc2VhcmNoOiBzZWFyY2ggYXMgc3RyaW5nLFxuICAgICAgICBzb3J0Qnk6IHNvcnRCeSBhcyBzdHJpbmcsXG4gICAgICAgIHNvcnRPcmRlcjogc29ydE9yZGVyIGFzIFwiYXNjXCIgfCBcImRlc2NcIixcbiAgICAgIH07XG5cbiAgICAgIGlmIChyb2xlKSB7XG4gICAgICAgIHF1ZXJ5T3B0aW9ucy5yb2xlID0gcm9sZSBhcyBcInVzZXJcIiB8IFwiYWRtaW5cIjtcbiAgICAgIH1cblxuICAgICAgaWYgKGlzQWN0aXZlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcXVlcnlPcHRpb25zLmlzQWN0aXZlID0gQm9vbGVhbihpc0FjdGl2ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpc0VtYWlsVmVyaWZpZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBxdWVyeU9wdGlvbnMuaXNFbWFpbFZlcmlmaWVkID0gQm9vbGVhbihpc0VtYWlsVmVyaWZpZWQpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5nZXRVc2VycyhxdWVyeU9wdGlvbnMpO1xuXG4gICAgICBsb2dnZXIuaW5mbyhcIueNsuWPlueUqOaItuWIl+ihqOaIkOWKn1wiLCB7XG4gICAgICAgIHBhZ2UsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICB0b3RhbDogcmVzdWx0LnRvdGFsLFxuICAgICAgICBhZG1pbklkOiAocmVxLnVzZXIgYXMgSVVzZXIpPy5faWQudG9TdHJpbmcoKSxcbiAgICAgIH0pO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCLnjbLlj5bnlKjmiLbliJfooajlpLHmlZdcIiwgeyBlcnJvciB9KTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IFwi542y5Y+W55So5oi25YiX6KGo5aSx5pWX77yM6KuL56iN5b6M5YaN6KmmXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4pO1xuXG4vLyDnjbLlj5bnibnlrprnlKjmiLbos4foqIpcbnJvdXRlci5nZXQoXG4gIFwiLzppZFwiLFxuICBhdXRoZW50aWNhdGUsXG4gIGF1dGhvcml6ZU93bmVyT3JBZG1pbixcbiAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBpZiAoIWlkKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIue8uuWwkeeUqOaItiBJRFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyDnjbLlj5bnlKjmiLbos4foqIpcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2VyU2VydmljZS5nZXRVc2VyQnlJZChpZCk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwi55So5oi25LiN5a2Y5ZyoXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwi542y5Y+W55So5oi26LOH6KiK5oiQ5YqfXCIsIHtcbiAgICAgICAgdXNlcklkOiBpZCxcbiAgICAgICAgcmVxdWVzdGVySWQ6IChyZXEudXNlciBhcyBJVXNlcik/Ll9pZC50b1N0cmluZygpLFxuICAgICAgfSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIGlkOiB1c2VyLl9pZCxcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxuICAgICAgICAgICAgcGhvbmU6IHVzZXIucGhvbmUsXG4gICAgICAgICAgICBhdmF0YXI6IHVzZXIuYXZhdGFyLFxuICAgICAgICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgICAgICAgaXNFbWFpbFZlcmlmaWVkOiB1c2VyLmlzRW1haWxWZXJpZmllZCxcbiAgICAgICAgICAgIGlzQWN0aXZlOiB1c2VyLmlzQWN0aXZlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiB1c2VyLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogdXNlci51cGRhdGVkQXQsXG4gICAgICAgICAgICBsYXN0TG9naW5BdDogdXNlci5sYXN0TG9naW5BdCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIueNsuWPlueUqOaItuizh+ioiuWkseaVl1wiLCB7IGVycm9yIH0pO1xuXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBcHBFcnJvcikge1xuICAgICAgICByZXMuc3RhdHVzKGVycm9yLnN0YXR1c0NvZGUpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IFwi542y5Y+W55So5oi26LOH6KiK5aSx5pWX77yM6KuL56iN5b6M5YaN6KmmXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4pO1xuXG4vLyDmm7TmlrDnlKjmiLbos4foqIpcbnJvdXRlci5wdXQoXG4gIFwiLzppZFwiLFxuICBhdXRoZW50aWNhdGUsXG4gIGF1dGhvcml6ZU93bmVyT3JBZG1pbixcbiAgW1xuICAgIGJvZHkoXCJuYW1lXCIpXG4gICAgICAub3B0aW9uYWwoKVxuICAgICAgLnRyaW0oKVxuICAgICAgLmlzTGVuZ3RoKHsgbWluOiAxIH0pXG4gICAgICAud2l0aE1lc3NhZ2UoXCLlp5PlkI3kuI3og73ngrrnqbpcIiksXG4gICAgYm9keShcInBob25lXCIpXG4gICAgICAub3B0aW9uYWwoKVxuICAgICAgLmlzTW9iaWxlUGhvbmUoXCJ6aC1UV1wiKVxuICAgICAgLndpdGhNZXNzYWdlKFwi6KuL5o+Q5L6b5pyJ5pWI55qE5omL5qmf6Jmf56K8XCIpLFxuICBdLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRpb25SZXN1bHQocmVxKTtcbiAgICAgIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogXCLovLjlhaXos4fmlpnpqZforYnlpLHmlZdcIixcbiAgICAgICAgICBlcnJvcnM6IGVycm9ycy5hcnJheSgpLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIWlkKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIue8uuWwkeeUqOaItiBJRFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyDmm7TmlrDnlKjmiLbos4foqIpcbiAgICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgdXNlclNlcnZpY2UudXBkYXRlVXNlcihpZCwgdXBkYXRlRGF0YSk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwi55So5oi26LOH6KiK5pu05paw5oiQ5YqfXCIsIHtcbiAgICAgICAgdXNlcklkOiBpZCxcbiAgICAgICAgdXBkYXRlRGF0YSxcbiAgICAgICAgdXBkYXRlcklkOiAocmVxLnVzZXIgYXMgSVVzZXIpPy5faWQudG9TdHJpbmcoKSxcbiAgICAgIH0pO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwi55So5oi26LOH6KiK5pu05paw5oiQ5YqfXCIsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBpZDogdXBkYXRlZFVzZXIuX2lkLFxuICAgICAgICAgICAgZW1haWw6IHVwZGF0ZWRVc2VyLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogdXBkYXRlZFVzZXIubmFtZSxcbiAgICAgICAgICAgIHBob25lOiB1cGRhdGVkVXNlci5waG9uZSxcbiAgICAgICAgICAgIGF2YXRhcjogdXBkYXRlZFVzZXIuYXZhdGFyLFxuICAgICAgICAgICAgcm9sZTogdXBkYXRlZFVzZXIucm9sZSxcbiAgICAgICAgICAgIGlzRW1haWxWZXJpZmllZDogdXBkYXRlZFVzZXIuaXNFbWFpbFZlcmlmaWVkLFxuICAgICAgICAgICAgaXNBY3RpdmU6IHVwZGF0ZWRVc2VyLmlzQWN0aXZlLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiB1cGRhdGVkVXNlci51cGRhdGVkQXQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCLnlKjmiLbos4foqIrmm7TmlrDlpLHmlZdcIiwgeyBlcnJvciB9KTtcblxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXBwRXJyb3IpIHtcbiAgICAgICAgcmVzLnN0YXR1cyhlcnJvci5zdGF0dXNDb2RlKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBcIueUqOaItuizh+ioiuabtOaWsOWkseaVl++8jOiri+eojeW+jOWGjeipplwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuKTtcblxuLy8g5YGc55So55So5oi25biz6Jmf77yI6Luf5Yiq6Zmk77yJXG5yb3V0ZXIuZGVsZXRlKFxuICBcIi86aWRcIixcbiAgYXV0aGVudGljYXRlLFxuICBhdXRob3JpemVPd25lck9yQWRtaW4sXG4gIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgaWYgKCFpZCkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogXCLnvLrlsJHnlKjmiLYgSURcIixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8g5YGc55So55So5oi25biz6JmfXG4gICAgICBhd2FpdCB1c2VyU2VydmljZS5kZWFjdGl2YXRlVXNlcihpZCk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwi55So5oi25biz6Jmf5bey5YGc55SoXCIsIHtcbiAgICAgICAgdXNlcklkOiBpZCxcbiAgICAgICAgZGVhY3RpdmF0ZWRCeTogKHJlcS51c2VyIGFzIElVc2VyKT8uX2lkLnRvU3RyaW5nKCksXG4gICAgICB9KTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIueUqOaItuW4s+iZn+W3suWBnOeUqFwiLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIuWBnOeUqOeUqOaItuW4s+iZn+WkseaVl1wiLCB7IGVycm9yIH0pO1xuXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBcHBFcnJvcikge1xuICAgICAgICByZXMuc3RhdHVzKGVycm9yLnN0YXR1c0NvZGUpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IFwi5YGc55So55So5oi25biz6Jmf5aSx5pWX77yM6KuL56iN5b6M5YaN6KmmXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4pO1xuXG4vLyDkuIrlgrPnlKjmiLbpoK3lg49cbnJvdXRlci5wb3N0KFxuICBcIi86aWQvYXZhdGFyXCIsXG4gIGF1dGhlbnRpY2F0ZSxcbiAgYXV0aG9yaXplT3duZXJPckFkbWluLFxuICB1cGxvYWQuc2luZ2xlKFwiYXZhdGFyXCIpLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCBmaWxlID0gcmVxLmZpbGU7XG5cbiAgICAgIGlmICghaWQpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwi57y65bCR55So5oi2IElEXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghZmlsZSkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogXCLoq4vpgbjmk4fopoHkuIrlgrPnmoTpoK3lg4/mqpTmoYhcIixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8g5LiK5YKz5YiwIENsb3VkaW5hcnlcbiAgICAgIGNvbnN0IHVwbG9hZFJlc3VsdCA9IGF3YWl0IENsb3VkaW5hcnlTZXJ2aWNlLnVwbG9hZEZpbGUoXG4gICAgICAgIGZpbGUuYnVmZmVyLFxuICAgICAgICBmaWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgZmlsZS5taW1ldHlwZSxcbiAgICAgICAgaWQsXG4gICAgICAgIFwiYXZhdGFyXCIsXG4gICAgICApO1xuXG4gICAgICBjb25zdCBhdmF0YXJVcmwgPSB1cGxvYWRSZXN1bHQuc2VjdXJlVXJsO1xuXG4gICAgICAvLyDmm7TmlrDnlKjmiLbpoK3lg49cbiAgICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgdXNlclNlcnZpY2UudXBkYXRlVXNlcihpZCwge1xuICAgICAgICBhdmF0YXI6IGF2YXRhclVybCxcbiAgICAgIH0pO1xuXG4gICAgICBsb2dnZXIuaW5mbyhcIueUqOaItumgreWDj+S4iuWCs+aIkOWKn1wiLCB7XG4gICAgICAgIHVzZXJJZDogaWQsXG4gICAgICAgIGF2YXRhclVybCxcbiAgICAgICAgdXBsb2FkZXJJZDogKHJlcS51c2VyIGFzIElVc2VyKT8uX2lkLnRvU3RyaW5nKCksXG4gICAgICB9KTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIumgreWDj+S4iuWCs+aIkOWKn1wiLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgYXZhdGFyVXJsLFxuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIGlkOiB1cGRhdGVkVXNlci5faWQsXG4gICAgICAgICAgICBhdmF0YXI6IHVwZGF0ZWRVc2VyLmF2YXRhcixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIumgreWDj+S4iuWCs+WkseaVl1wiLCB7IGVycm9yIH0pO1xuXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBBcHBFcnJvcikge1xuICAgICAgICByZXMuc3RhdHVzKGVycm9yLnN0YXR1c0NvZGUpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IFwi6aCt5YOP5LiK5YKz5aSx5pWX77yM6KuL56iN5b6M5YaN6KmmXCIsXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4pO1xuXG4vLyDnmbzpgIHpm7vlrZDpg7Xku7bpqZforYlcbnJvdXRlci5wb3N0KFxuICBcIi86aWQvc2VuZC12ZXJpZmljYXRpb25cIixcbiAgYXV0aGVudGljYXRlLFxuICBhdXRob3JpemVPd25lck9yQWRtaW4sXG4gIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgaWYgKCFpZCkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogXCLnvLrlsJHnlKjmiLYgSURcIixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8g542y5Y+W55So5oi26LOH6KiKXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdXNlclNlcnZpY2UuZ2V0VXNlckJ5SWQoaWQpO1xuXG4gICAgICBpZiAodXNlci5pc0VtYWlsVmVyaWZpZWQpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwi6Zu75a2Q6YO15Lu25bey57aT6amX6K2J6YGO5LqGXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIOeUn+aIkOmpl+itieS7pOeJjFxuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSB1c2VyLmdlbmVyYXRlRW1haWxWZXJpZmljYXRpb25Ub2tlbigpO1xuICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XG5cbiAgICAgIC8vIOeZvOmAgempl+itiemDteS7tlxuICAgICAgYXdhaXQgRW1haWxTZXJ2aWNlLnNlbmRWZXJpZmljYXRpb25FbWFpbChcbiAgICAgICAgdXNlci5lbWFpbCxcbiAgICAgICAgdXNlci5uYW1lLFxuICAgICAgICB2ZXJpZmljYXRpb25Ub2tlbixcbiAgICAgICk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwi6amX6K2J6YO15Lu255m86YCB5oiQ5YqfXCIsIHtcbiAgICAgICAgdXNlcklkOiBpZCxcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIHJlcXVlc3RlcklkOiAocmVxLnVzZXIgYXMgSVVzZXIpPy5faWQudG9TdHJpbmcoKSxcbiAgICAgIH0pO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwi6amX6K2J6YO15Lu25bey55m86YCB77yM6KuL5qqi5p+l5oKo55qE5L+h566xXCIsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwi55m86YCB6amX6K2J6YO15Lu25aSx5pWXXCIsIHsgZXJyb3IgfSk7XG5cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEFwcEVycm9yKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoZXJyb3Iuc3RhdHVzQ29kZSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogXCLnmbzpgIHpqZforYnpg7Xku7blpLHmlZfvvIzoq4vnqI3lvozlho3oqaZcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbik7XG5cbi8vIOmpl+itiembu+WtkOmDteS7tlxucm91dGVyLnBvc3QoXG4gIFwiLzppZC92ZXJpZnktZW1haWxcIixcbiAgW2JvZHkoXCJ0b2tlblwiKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwi6KuL5o+Q5L6b6amX6K2J5Luk54mMXCIpXSxcbiAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XG4gICAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwi6Ly45YWl6LOH5paZ6amX6K2J5aSx5pWXXCIsXG4gICAgICAgICAgZXJyb3JzOiBlcnJvcnMuYXJyYXkoKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcbiAgICAgIGNvbnN0IHsgdG9rZW4gfSA9IHJlcS5ib2R5O1xuXG4gICAgICAvLyDpqZforYnpm7vlrZDpg7Xku7ZcbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLnZlcmlmeUVtYWlsQnlUb2tlbih0b2tlbik7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwi6Zu75a2Q6YO15Lu26amX6K2J5oiQ5YqfXCIsIHtcbiAgICAgICAgdXNlcklkOiBpZCxcbiAgICAgIH0pO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwi6Zu75a2Q6YO15Lu26amX6K2J5oiQ5YqfXCIsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKFwi6Zu75a2Q6YO15Lu26amX6K2J5aSx5pWXXCIsIHsgZXJyb3IgfSk7XG5cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEFwcEVycm9yKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoZXJyb3Iuc3RhdHVzQ29kZSkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogXCLpm7vlrZDpg7Xku7bpqZforYnlpLHmlZfvvIzoq4vnqI3lvozlho3oqaZcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbik7XG5cbi8vIOeNsuWPlueUqOaItueahOWvteeJqeWIl+ihqFxucm91dGVyLmdldChcbiAgXCIvOmlkL3BldHNcIixcbiAgYXV0aGVudGljYXRlLFxuICBhdXRob3JpemVPd25lck9yQWRtaW4sXG4gIFtcbiAgICBxdWVyeShcInBhZ2VcIikub3B0aW9uYWwoKS5pc0ludCh7IG1pbjogMSB9KSxcbiAgICBxdWVyeShcImxpbWl0XCIpLm9wdGlvbmFsKCkuaXNJbnQoeyBtaW46IDEsIG1heDogNTAgfSksXG4gICAgcXVlcnkoXCJzdGF0dXNcIikub3B0aW9uYWwoKS5pc0luKFtcImxvc3RcIiwgXCJmb3VuZFwiLCBcImFkb3B0ZWRcIl0pLFxuICAgIHF1ZXJ5KFwidHlwZVwiKS5vcHRpb25hbCgpLmlzSW4oW1wiZG9nXCIsIFwiY2F0XCIsIFwib3RoZXJcIl0pLFxuICBdLFxuICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRpb25SZXN1bHQocmVxKTtcbiAgICAgIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogXCLmn6XoqaLlj4PmlbjpqZforYnlpLHmlZdcIixcbiAgICAgICAgICBlcnJvcnM6IGVycm9ycy5hcnJheSgpLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBpZiAoIWlkKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIue8uuWwkeeUqOaItiBJRFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIHBhZ2UgPSAxLFxuICAgICAgICBsaW1pdCA9IDEwLFxuICAgICAgICBzdGF0dXMsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIC8vIHNvcnRCeSA9ICdjcmVhdGVkQXQnLFxuICAgICAgICAvLyBzb3J0T3JkZXIgPSAnZGVzYycsXG4gICAgICB9ID0gcmVxLnF1ZXJ5O1xuXG4gICAgICAvLyDmp4vlu7rmn6XoqaLmop3ku7ZcbiAgICAgIGNvbnN0IHF1ZXJ5OiBhbnkgPSB7IG93bmVyOiBpZCB9O1xuXG4gICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgIHF1ZXJ5LnN0YXR1cyA9IHN0YXR1cztcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgcXVlcnkudHlwZSA9IHR5cGU7XG4gICAgICB9XG5cbiAgICAgIC8vIOWIhumggeWPg+aVuFxuICAgICAgY29uc3QgcGFnZU51bSA9IE1hdGgubWF4KDEsIHBhcnNlSW50KHBhZ2UgYXMgc3RyaW5nKSk7XG4gICAgICBjb25zdCBsaW1pdE51bSA9IE1hdGgubWluKDUwLCBNYXRoLm1heCgxLCBwYXJzZUludChsaW1pdCBhcyBzdHJpbmcpKSk7XG5cbiAgICAgIC8vIOafpeipouWvteeJqe+8iOmAmeijoeWBh+ioreaciSBQZXQg5qih5Z6L77yM5a+m6Zqb6ZyA6KaB5qC55pOa5a+154mp5qih57WE5a+m5L2c77yJXG4gICAgICAvLyDmmqvmmYLov5Tlm57nqbrliJfooajvvIznrYnlr7XnianmqKHntYTlrozmiJDlvozlho3lr6bkvZxcbiAgICAgIGNvbnN0IHBldHM6IGFueVtdID0gW107XG4gICAgICBjb25zdCB0b3RhbCA9IDA7XG5cbiAgICAgIGxvZ2dlci5pbmZvKFwi542y5Y+W55So5oi25a+154mp5YiX6KGo5oiQ5YqfXCIsIHtcbiAgICAgICAgdXNlcklkOiBpZCxcbiAgICAgICAgcXVlcnksXG4gICAgICAgIHBhZ2luYXRpb246IHsgcGFnZTogcGFnZU51bSwgbGltaXQ6IGxpbWl0TnVtIH0sXG4gICAgICAgIHJlcXVlc3RlcklkOiAocmVxLnVzZXIgYXMgSVVzZXIpPy5faWQudG9TdHJpbmcoKSxcbiAgICAgIH0pO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwi542y5Y+W55So5oi25a+154mp5YiX6KGo5oiQ5YqfXCIsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBwZXRzLFxuICAgICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICAgIGN1cnJlbnRQYWdlOiBwYWdlTnVtLFxuICAgICAgICAgICAgdG90YWxQYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXROdW0pLFxuICAgICAgICAgICAgdG90YWxJdGVtczogdG90YWwsXG4gICAgICAgICAgICBpdGVtc1BlclBhZ2U6IGxpbWl0TnVtLFxuICAgICAgICAgICAgaGFzTmV4dFBhZ2U6IHBhZ2VOdW0gPCBNYXRoLmNlaWwodG90YWwgLyBsaW1pdE51bSksXG4gICAgICAgICAgICBoYXNQcmV2UGFnZTogcGFnZU51bSA+IDEsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCLnjbLlj5bnlKjmiLblr7XnianliJfooajlpLHmlZdcIiwgeyBlcnJvciB9KTtcblxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXBwRXJyb3IpIHtcbiAgICAgICAgcmVzLnN0YXR1cyhlcnJvci5zdGF0dXNDb2RlKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBcIueNsuWPlueUqOaItuWvteeJqeWIl+ihqOWkseaVl++8jOiri+eojeW+jOWGjeipplwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuKTtcblxuLy8g5pu05pS55a+G56K8XG5yb3V0ZXIucHV0KFxuICBcIi86aWQvY2hhbmdlLXBhc3N3b3JkXCIsXG4gIGF1dGhlbnRpY2F0ZSxcbiAgYXV0aG9yaXplT3duZXJPckFkbWluLFxuICBbXG4gICAgYm9keShcImN1cnJlbnRQYXNzd29yZFwiKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKFwi6KuL5o+Q5L6b55W25YmN5a+G56K8XCIpLFxuICAgIGJvZHkoXCJuZXdQYXNzd29yZFwiKVxuICAgICAgLmlzTGVuZ3RoKHsgbWluOiA4IH0pXG4gICAgICAud2l0aE1lc3NhZ2UoXCLmlrDlr4bnorzplbfluqboh7PlsJHngrogOCDlgIvlrZfnrKZcIilcbiAgICAgIC5tYXRjaGVzKC9eKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qXFxkKS8pXG4gICAgICAud2l0aE1lc3NhZ2UoXCLmlrDlr4bnorzlv4XpoIjljIXlkKvoh7PlsJHkuIDlgIvlsI/lr6vlrZfmr43jgIHkuIDlgIvlpKflr6vlrZfmr43lkozkuIDlgIvmlbjlrZdcIiksXG4gIF0sXG4gIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xuICAgICAgaWYgKCFlcnJvcnMuaXNFbXB0eSgpKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIui8uOWFpeizh+aWmempl+itieWkseaVl1wiLFxuICAgICAgICAgIGVycm9yczogZXJyb3JzLmFycmF5KCksXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCB7IGN1cnJlbnRQYXNzd29yZCwgbmV3UGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIWlkIHx8ICFjdXJyZW50UGFzc3dvcmQgfHwgIW5ld1Bhc3N3b3JkKSB7XG4gICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIue8uuWwkeW/heimgeWPg+aVuFwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyDmm7TmlLnlr4bnorxcbiAgICAgIGF3YWl0IHVzZXJTZXJ2aWNlLmNoYW5nZVBhc3N3b3JkKGlkLCBjdXJyZW50UGFzc3dvcmQsIG5ld1Bhc3N3b3JkKTtcblxuICAgICAgbG9nZ2VyLmluZm8oXCLlr4bnorzmm7TmlLnmiJDlip9cIiwge1xuICAgICAgICB1c2VySWQ6IGlkLFxuICAgICAgICBjaGFuZ2VkQnk6IChyZXEudXNlciBhcyBJVXNlcik/Ll9pZC50b1N0cmluZygpLFxuICAgICAgfSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCLlr4bnorzmm7TmlLnmiJDlip9cIixcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoXCLlr4bnorzmm7TmlLnlpLHmlZdcIiwgeyBlcnJvciB9KTtcblxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQXBwRXJyb3IpIHtcbiAgICAgICAgcmVzLnN0YXR1cyhlcnJvci5zdGF0dXNDb2RlKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBcIuWvhueivOabtOaUueWkseaVl++8jOiri+eojeW+jOWGjeipplwiLFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuKTtcblxuZXhwb3J0IHsgcm91dGVyIGFzIHVzZXJSb3V0ZXMgfTtcbiJdLCJ2ZXJzaW9uIjozfQ==