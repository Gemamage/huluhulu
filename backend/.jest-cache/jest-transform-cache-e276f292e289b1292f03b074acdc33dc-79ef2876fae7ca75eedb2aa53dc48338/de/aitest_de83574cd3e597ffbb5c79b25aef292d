3b1a53cf0cb4f3365a26e9319ad2f89f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ai_1 = require("../../src/schemas/ai");
describe('AI Schemas', () => {
    describe('imageOptimizeSchema', () => {
        it('should validate valid image optimization parameters', () => {
            const validData = {
                maxWidth: 800,
                maxHeight: 600,
                quality: 80,
                format: 'jpeg'
            };
            const result = ai_1.imageOptimizeSchema.safeParse(validData);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data).toEqual(validData);
            }
        });
        it('should reject invalid width values', () => {
            const invalidData = {
                maxWidth: 50, // 小於最小值 100
                quality: 80
            };
            const result = ai_1.imageOptimizeSchema.safeParse(invalidData);
            expect(result.success).toBe(false);
        });
        it('should reject invalid quality values', () => {
            const invalidData = {
                quality: 5 // 小於最小值 10
            };
            const result = ai_1.imageOptimizeSchema.safeParse(invalidData);
            expect(result.success).toBe(false);
        });
        it('should accept empty object (all optional)', () => {
            const result = ai_1.imageOptimizeSchema.safeParse({});
            expect(result.success).toBe(true);
        });
    });
    describe('imageCropSchema', () => {
        it('should validate valid crop parameters', () => {
            const validData = {
                x: 10,
                y: 20,
                width: 100,
                height: 150
            };
            const result = ai_1.imageCropSchema.safeParse(validData);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data).toEqual(validData);
            }
        });
        it('should coerce string numbers to numbers', () => {
            const stringData = {
                x: '10',
                y: '20',
                width: '100',
                height: '150'
            };
            const result = ai_1.imageCropSchema.safeParse(stringData);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data).toEqual({
                    x: 10,
                    y: 20,
                    width: 100,
                    height: 150
                });
            }
        });
        it('should reject negative coordinates', () => {
            const invalidData = {
                x: -5,
                y: 10,
                width: 100,
                height: 150
            };
            const result = ai_1.imageCropSchema.safeParse(invalidData);
            expect(result.success).toBe(false);
        });
        it('should reject zero or negative dimensions', () => {
            const invalidData = {
                x: 10,
                y: 20,
                width: 0,
                height: 150
            };
            const result = ai_1.imageCropSchema.safeParse(invalidData);
            expect(result.success).toBe(false);
        });
    });
    describe('similaritySearchSchema', () => {
        it('should validate valid similarity search parameters', () => {
            const validData = {
                petId: '507f1f77bcf86cd799439011',
                threshold: 0.8,
                limit: 20
            };
            const result = ai_1.similaritySearchSchema.safeParse(validData);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data).toEqual(validData);
            }
        });
        it('should apply default values', () => {
            const minimalData = {};
            const result = ai_1.similaritySearchSchema.safeParse(minimalData);
            expect(result.success).toBe(true);
            if (result.success) {
                expect(result.data.threshold).toBe(0.7);
                expect(result.data.limit).toBe(10);
            }
        });
        it('should reject invalid threshold values', () => {
            const invalidData = {
                threshold: 1.5 // 大於最大值 1
            };
            const result = ai_1.similaritySearchSchema.safeParse(invalidData);
            expect(result.success).toBe(false);
        });
        it('should reject invalid limit values', () => {
            const invalidData = {
                limit: 0 // 小於最小值 1
            };
            const result = ai_1.similaritySearchSchema.safeParse(invalidData);
            expect(result.success).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzY2hlbWFzXFxhaS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBTzhCO0FBRTlCLFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQzFCLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEdBQUcsRUFBRTtZQUM3RCxNQUFNLFNBQVMsR0FBeUI7Z0JBQ3RDLFFBQVEsRUFBRSxHQUFHO2dCQUNiLFNBQVMsRUFBRSxHQUFHO2dCQUNkLE9BQU8sRUFBRSxFQUFFO2dCQUNYLE1BQU0sRUFBRSxNQUFNO2FBQ2YsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLHdCQUFtQixDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDbkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDekMsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxNQUFNLFdBQVcsR0FBRztnQkFDbEIsUUFBUSxFQUFFLEVBQUUsRUFBRSxZQUFZO2dCQUMxQixPQUFPLEVBQUUsRUFBRTthQUNaLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyx3QkFBbUIsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDMUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMs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QyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNyQyxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0NBQXdDLEVBQUUsR0FBRyxFQUFFO1lBQ2hELE1BQU0sV0FBVyxHQUFHO2dCQUNsQixTQUFTLEVBQUUsR0FBRyxDQUFDLFVBQVU7YUFDMUIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLDJCQUFzQixDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUM3RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUU7WUFDNUMsTUFBTSxXQUFXLEdBQUc7Z0JBQ2xCLEtBQUssRUFBRSxDQUFDLENBQUMsVUFBVTthQUNwQixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsMkJBQXNCLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzdELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXFVzZXJcXERlc2t0b3BcXHRyYWVwcm9qZWN0XFx0ZXN0MlxccGV0LWZpbmRlci1hcHBcXGJhY2tlbmRcXHRlc3RcXHNjaGVtYXNcXGFpLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXG4gIGltYWdlT3B0aW1pemVTY2hlbWEsXG4gIGltYWdlQ3JvcFNjaGVtYSxcbiAgc2ltaWxhcml0eVNlYXJjaFNjaGVtYSxcbiAgSW1hZ2VPcHRpbWl6ZVJlcXVlc3QsXG4gIEltYWdlQ3JvcFJlcXVlc3QsXG4gIFNpbWlsYXJpdHlTZWFyY2hSZXF1ZXN0XG59IGZyb20gJy4uLy4uL3NyYy9zY2hlbWFzL2FpJztcblxuZGVzY3JpYmUoJ0FJIFNjaGVtYXMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdpbWFnZU9wdGltaXplU2NoZW1hJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgdmFsaWQgaW1hZ2Ugb3B0aW1pemF0aW9uIHBhcmFtZXRlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZERhdGE6IEltYWdlT3B0aW1pemVSZXF1ZXN0ID0ge1xuICAgICAgICBtYXhXaWR0aDogODAwLFxuICAgICAgICBtYXhIZWlnaHQ6IDYwMCxcbiAgICAgICAgcXVhbGl0eTogODAsXG4gICAgICAgIGZvcm1hdDogJ2pwZWcnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBpbWFnZU9wdGltaXplU2NoZW1hLnNhZmVQYXJzZSh2YWxpZERhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbCh2YWxpZERhdGEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCB3aWR0aCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcbiAgICAgICAgbWF4V2lkdGg6IDUwLCAvLyDlsI/mlrzmnIDlsI/lgLwgMTAwXG4gICAgICAgIHF1YWxpdHk6IDgwXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBpbWFnZU9wdGltaXplU2NoZW1hLnNhZmVQYXJzZShpbnZhbGlkRGF0YSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBxdWFsaXR5IHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xuICAgICAgICBxdWFsaXR5OiA1IC8vIOWwj+aWvOacgOWwj+WAvCAxMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gaW1hZ2VPcHRpbWl6ZVNjaGVtYS5zYWZlUGFyc2UoaW52YWxpZERhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWNjZXB0IGVtcHR5IG9iamVjdCAoYWxsIG9wdGlvbmFsKScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGltYWdlT3B0aW1pemVTY2hlbWEuc2FmZVBhcnNlKHt9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ltYWdlQ3JvcFNjaGVtYScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHZhbGlkIGNyb3AgcGFyYW1ldGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkRGF0YTogSW1hZ2VDcm9wUmVxdWVzdCA9IHtcbiAgICAgICAgeDogMTAsXG4gICAgICAgIHk6IDIwLFxuICAgICAgICB3aWR0aDogMTAwLFxuICAgICAgICBoZWlnaHQ6IDE1MFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gaW1hZ2VDcm9wU2NoZW1hLnNhZmVQYXJzZSh2YWxpZERhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbCh2YWxpZERhdGEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb2VyY2Ugc3RyaW5nIG51bWJlcnMgdG8gbnVtYmVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0cmluZ0RhdGEgPSB7XG4gICAgICAgIHg6ICcxMCcsXG4gICAgICAgIHk6ICcyMCcsXG4gICAgICAgIHdpZHRoOiAnMTAwJyxcbiAgICAgICAgaGVpZ2h0OiAnMTUwJ1xuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gaW1hZ2VDcm9wU2NoZW1hLnNhZmVQYXJzZShzdHJpbmdEYXRhKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvRXF1YWwoe1xuICAgICAgICAgIHg6IDEwLFxuICAgICAgICAgIHk6IDIwLFxuICAgICAgICAgIHdpZHRoOiAxMDAsXG4gICAgICAgICAgaGVpZ2h0OiAxNTBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBuZWdhdGl2ZSBjb29yZGluYXRlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xuICAgICAgICB4OiAtNSxcbiAgICAgICAgeTogMTAsXG4gICAgICAgIHdpZHRoOiAxMDAsXG4gICAgICAgIGhlaWdodDogMTUwXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBpbWFnZUNyb3BTY2hlbWEuc2FmZVBhcnNlKGludmFsaWREYXRhKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCB6ZXJvIG9yIG5lZ2F0aXZlIGRpbWVuc2lvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcbiAgICAgICAgeDogMTAsXG4gICAgICAgIHk6IDIwLFxuICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgaGVpZ2h0OiAxNTBcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGltYWdlQ3JvcFNjaGVtYS5zYWZlUGFyc2UoaW52YWxpZERhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NpbWlsYXJpdHlTZWFyY2hTY2hlbWEnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSB2YWxpZCBzaW1pbGFyaXR5IHNlYXJjaCBwYXJhbWV0ZXJzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWREYXRhOiBTaW1pbGFyaXR5U2VhcmNoUmVxdWVzdCA9IHtcbiAgICAgICAgcGV0SWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLFxuICAgICAgICB0aHJlc2hvbGQ6IDAuOCxcbiAgICAgICAgbGltaXQ6IDIwXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzaW1pbGFyaXR5U2VhcmNoU2NoZW1hLnNhZmVQYXJzZSh2YWxpZERhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9FcXVhbCh2YWxpZERhdGEpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhcHBseSBkZWZhdWx0IHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1pbmltYWxEYXRhID0ge307XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNpbWlsYXJpdHlTZWFyY2hTY2hlbWEuc2FmZVBhcnNlKG1pbmltYWxEYXRhKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEudGhyZXNob2xkKS50b0JlKDAuNyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YS5saW1pdCkudG9CZSgxMCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIHRocmVzaG9sZCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZhbGlkRGF0YSA9IHtcbiAgICAgICAgdGhyZXNob2xkOiAxLjUgLy8g5aSn5pa85pyA5aSn5YC8IDFcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNpbWlsYXJpdHlTZWFyY2hTY2hlbWEuc2FmZVBhcnNlKGludmFsaWREYXRhKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIGxpbWl0IHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWREYXRhID0ge1xuICAgICAgICBsaW1pdDogMCAvLyDlsI/mlrzmnIDlsI/lgLwgMVxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2ltaWxhcml0eVNlYXJjaFNjaGVtYS5zYWZlUGFyc2UoaW52YWxpZERhdGEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=