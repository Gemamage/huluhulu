480e61dc1f4510c3a9dcdc7336ddbd2f
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock external services
jest.mock('../../src/services/aiService');
jest.mock('../../src/services/emailService');
const matchingService_1 = require("../../src/services/matchingService");
const Pet_1 = require("../../src/models/Pet");
const User_1 = require("../../src/models/User");
const Match_1 = require("../../src/models/Match");
const aiService_1 = require("../../src/services/aiService");
const emailService_1 = require("../../src/services/emailService");
const testData_1 = require("../utils/testData");
const mongoose_1 = __importDefault(require("mongoose"));
const mockAiService = aiService_1.aiService;
const mockEmailService = emailService_1.EmailService;
describe('MatchingService', () => {
    let testUser1;
    let testUser2;
    let lostPet;
    let foundPet;
    beforeEach(async () => {
        await User_1.User.deleteMany({});
        await Pet_1.Pet.deleteMany({});
        await Match_1.Match.deleteMany({});
        testUser1 = await new User_1.User(testData_1.validUserData).save();
        testUser2 = await new User_1.User({
            ...testData_1.validUserData,
            email: 'user2@example.com'
        }).save();
        lostPet = await new Pet_1.Pet({
            ...testData_1.validPetData,
            name: 'Lost Dog',
            status: 'lost',
            owner: testUser1._id,
            aiData: {
                breed: 'Golden Retriever',
                confidence: 0.9,
                features: [0.1, 0.2, 0.3, 0.4, 0.5]
            }
        }).save();
        foundPet = await new Pet_1.Pet({
            ...testData_1.validPetData,
            name: 'Found Dog',
            status: 'found',
            owner: testUser2._id,
            aiData: {
                breed: 'Golden Retriever',
                confidence: 0.85,
                features: [0.12, 0.18, 0.32, 0.38, 0.52]
            }
        }).save();
        jest.clearAllMocks();
    });
    afterEach(async () => {
        await User_1.User.deleteMany({});
        await Pet_1.Pet.deleteMany({});
        await Match_1.Match.deleteMany({});
    });
    describe('findPotentialMatches', () => {
        it('should find potential matches for lost pet', async () => {
            mockAiService.calculateSimilarity.mockReturnValue(0.85);
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString());
            expect(matches).toHaveLength(1);
            expect(matches[0].foundPet._id.toString()).toBe(foundPet._id.toString());
            expect(matches[0].similarity).toBe(0.85);
            expect(matches[0].confidence).toBe('high');
        });
        it('should find potential matches for found pet', async () => {
            mockAiService.calculateSimilarity.mockReturnValue(0.85);
            const matches = await matchingService_1.MatchingService.findPotentialMatches(foundPet._id.toString());
            expect(matches).toHaveLength(1);
            expect(matches[0].lostPet._id.toString()).toBe(lostPet._id.toString());
            expect(matches[0].similarity).toBe(0.85);
        });
        it('should filter matches by minimum similarity threshold', async () => {
            mockAiService.calculateSimilarity.mockReturnValue(0.5); // Below default threshold
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString());
            expect(matches).toHaveLength(0);
        });
        it('should use custom similarity threshold', async () => {
            mockAiService.calculateSimilarity.mockReturnValue(0.5);
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString(), { minSimilarity: 0.4 });
            expect(matches).toHaveLength(1);
        });
        it('should filter by location radius', async () => {
            mockAiService.calculateSimilarity.mockReturnValue(0.85);
            // Set different locations
            lostPet.location.coordinates = [0, 0];
            foundPet.location.coordinates = [1, 1]; // ~157km away
            await lostPet.save();
            await foundPet.save();
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString(), { maxDistance: 100 } // 100km radius
            );
            expect(matches).toHaveLength(0);
        });
        it('should filter by date range', async () => {
            mockAiService.calculateSimilarity.mockReturnValue(0.85);
            // Set found pet to be reported much later
            foundPet.createdAt = new Date(Date.now() + 10 * 24 * 60 * 60 * 1000); // 10 days later
            await foundPet.save();
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString(), { maxDays: 5 });
            expect(matches).toHaveLength(0);
        });
        it('should sort matches by similarity score', async () => {
            // Create another found pet with lower similarity
            const foundPet2 = await new Pet_1.Pet({
                ...testData_1.validPetData,
                name: 'Found Dog 2',
                status: 'found',
                owner: testUser2._id,
                aiData: {
                    breed: 'Labrador',
                    confidence: 0.8,
                    features: [0.5, 0.6, 0.7, 0.8, 0.9]
                }
            }).save();
            mockAiService.calculateSimilarity
                .mockReturnValueOnce(0.85) // First pet
                .mockReturnValueOnce(0.75); // Second pet
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString());
            expect(matches).toHaveLength(2);
            expect(matches[0].similarity).toBeGreaterThan(matches[1].similarity);
        });
        it('should handle pet without AI data', async () => {
            lostPet.aiData = undefined;
            await lostPet.save();
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString());
            expect(matches).toHaveLength(0);
        });
        it('should exclude pets from same owner', async () => {
            foundPet.owner = testUser1._id; // Same owner as lost pet
            await foundPet.save();
            mockAiService.calculateSimilarity.mockReturnValue(0.95);
            const matches = await matchingService_1.MatchingService.findPotentialMatches(lostPet._id.toString());
            expect(matches).toHaveLength(0);
        });
    });
    describe('createMatch', () => {
        it('should create match successfully', async () => {
            const matchData = {
                lostPetId: lostPet._id.toString(),
                foundPetId: foundPet._id.toString(),
                similarity: 0.85,
                confidence: 'high'
            };
            const match = await matchingService_1.MatchingService.createMatch(matchData);
            expect(match).toBeDefined();
            expect(match.lostPet.toString()).toBe(lostPet._id.toString());
            expect(match.foundPet.toString()).toBe(foundPet._id.toString());
            expect(match.similarity).toBe(0.85);
            expect(match.status).toBe('pending');
        });
        it('should prevent duplicate matches', async () => {
            const matchData = {
                lostPetId: lostPet._id.toString(),
                foundPetId: foundPet._id.toString(),
                similarity: 0.85,
                confidence: 'high'
            };
            await matchingService_1.MatchingService.createMatch(matchData);
            await expect(matchingService_1.MatchingService.createMatch(matchData))
                .rejects.toThrow('配對已存在');
        });
        it('should send notification emails', async () => {
            const matchData = {
                lostPetId: lostPet._id.toString(),
                foundPetId: foundPet._id.toString(),
                similarity: 0.85,
                confidence: 'high'
            };
            await matchingService_1.MatchingService.createMatch(matchData);
            expect(mockEmailService.sendPetMatchNotification).toHaveBeenCalledTimes(2);
            expect(mockEmailService.sendPetMatchNotification).toHaveBeenCalledWith(testUser1.email, expect.objectContaining({
                lostPet: expect.objectContaining({ name: 'Lost Dog' }),
                foundPet: expect.objectContaining({ name: 'Found Dog' })
            }));
        });
        it('should handle email notification failures gracefully', async () => {
            mockEmailService.sendPetMatchNotification.mockRejectedValue(new Error('Email service unavailable'));
            const matchData = {
                lostPetId: lostPet._id.toString(),
                foundPetId: foundPet._id.toString(),
                similarity: 0.85,
                confidence: 'high'
            };
            // Should not throw error even if email fails
            const match = await matchingService_1.MatchingService.createMatch(matchData);
            expect(match).toBeDefined();
        });
        it('should validate pet existence', async () => {
            const nonExistentId = new mongoose_1.default.Types.ObjectId().toString();
            await expect(matchingService_1.MatchingService.createMatch({
                lostPetId: nonExistentId,
                foundPetId: foundPet._id.toString(),
                similarity: 0.85,
                confidence: 'high'
            })).rejects.toThrow('寵物不存在');
        });
        it('should validate pet statuses', async () => {
            foundPet.status = 'lost'; // Both pets are lost
            await foundPet.save();
            await expect(matchingService_1.MatchingService.createMatch({
                lostPetId: lostPet._id.toString(),
                foundPetId: foundPet._id.toString(),
                similarity: 0.85,
                confidence: 'high'
            })).rejects.toThrow('無效的寵物狀態');
        });
    });
    describe('getMatchById', () => {
        let testMatch;
        beforeEach(async () => {
            testMatch = await new Match_1.Match({
                lostPet: lostPet._id,
                foundPet: foundPet._id,
                similarity: 0.85,
                confidence: 'high',
                status: 'pending'
            }).save();
        });
        it('should get match by ID with populated data', async () => {
            const match = await matchingService_1.MatchingService.getMatchById(testMatch._id.toString());
            expect(match).toBeDefined();
            expect(match?.lostPet).toBeDefined();
            expect(match?.foundPet).toBeDefined();
            expect(typeof match?.lostPet).toBe('object');
            expect(typeof match?.foundPet).toBe('object');
        });
        it('should return null for non-existent match', async () => {
            const nonExistentId = new mongoose_1.default.Types.ObjectId().toString();
            const match = await matchingService_1.MatchingService.getMatchById(nonExistentId);
            expect(match).toBeNull();
        });
    });
    describe('updateMatchStatus', () => {
        let testMatch;
        beforeEach(async () => {
            testMatch = await new Match_1.Match({
                lostPet: lostPet._id,
                foundPet: foundPet._id,
                similarity: 0.85,
                confidence: 'high',
                status: 'pending'
            }).save();
        });
        it('should confirm match successfully', async () => {
            const updatedMatch = await matchingService_1.MatchingService.updateMatchStatus(testMatch._id.toString(), testUser1._id.toString(), 'confirmed');
            expect(updatedMatch?.status).toBe('confirmed');
            expect(updatedMatch?.confirmedAt).toBeDefined();
            expect(updatedMatch?.confirmedBy.toString()).toBe(testUser1._id.toString());
        });
        it('should reject match successfully', async () => {
            const updatedMatch = await matchingService_1.MatchingService.updateMatchStatus(testMatch._id.toString(), testUser1._id.toString(), 'rejected');
            expect(updatedMatch?.status).toBe('rejected');
            expect(updatedMatch?.rejectedAt).toBeDefined();
        });
        it('should only allow pet owners to update match', async () => {
            const unauthorizedUser = await new User_1.User({
                ...testData_1.validUserData,
                email: 'unauthorized@example.com'
            }).save();
            await expect(matchingService_1.MatchingService.updateMatchStatus(testMatch._id.toString(), unauthorizedUser._id.toString(), 'confirmed')).rejects.toThrow('無權限');
        });
        it('should not allow updating already confirmed match', async () => {
            testMatch.status = 'confirmed';
            await testMatch.save();
            await expect(matchingService_1.MatchingService.updateMatchStatus(testMatch._id.toString(), testUser1._id.toString(), 'rejected')).rejects.toThrow('配對已經處理過了');
        });
        it('should handle non-existent match', async () => {
            const nonExistentId = new mongoose_1.default.Types.ObjectId().toString();
            await expect(matchingService_1.MatchingService.updateMatchStatus(nonExistentId, testUser1._id.toString(), 'confirmed')).rejects.toThrow('配對不存在');
        });
    });
    describe('getUserMatches', () => {
        beforeEach(async () => {
            // Create multiple matches
            await new Match_1.Match({
                lostPet: lostPet._id,
                foundPet: foundPet._id,
                similarity: 0.85,
                confidence: 'high',
                status: 'pending'
            }).save();
            const anotherFoundPet = await new Pet_1.Pet({
                ...testData_1.validPetData,
                name: 'Another Found Dog',
                status: 'found',
                owner: testUser2._id
            }).save();
            await new Match_1.Match({
                lostPet: lostPet._id,
                foundPet: anotherFoundPet._id,
                similarity: 0.75,
                confidence: 'medium',
                status: 'confirmed'
            }).save();
        });
        it('should get all matches for user', async () => {
            const result = await matchingService_1.MatchingService.getUserMatches(testUser1._id.toString());
            expect(result.matches).toHaveLength(2);
            expect(result.total).toBe(2);
        });
        it('should filter matches by status', async () => {
            const result = await matchingService_1.MatchingService.getUserMatches(testUser1._id.toString(), { status: 'pending' });
            expect(result.matches).toHaveLength(1);
            expect(result.matches[0].status).toBe('pending');
        });
        it('should paginate matches', async () => {
            const result = await matchingService_1.MatchingService.getUserMatches(testUser1._id.toString(), { page: 1, limit: 1 });
            expect(result.matches).toHaveLength(1);
            expect(result.totalPages).toBe(2);
        });
        it('should sort matches by creation date', async () => {
            const result = await matchingService_1.MatchingService.getUserMatches(testUser1._id.toString(), { sortBy: 'createdAt', sortOrder: 'desc' });
            expect(result.matches.length).toBeGreaterThan(1);
            for (let i = 1; i < result.matches.length; i++) {
                expect(result.matches[i - 1].createdAt.getTime())
                    .toBeGreaterThanOrEqual(result.matches[i].createdAt.getTime());
            }
        });
        it('should handle user with no matches', async () => {
            const userWithNoMatches = await new User_1.User({
                ...testData_1.validUserData,
                email: 'nomatch@example.com'
            }).save();
            const result = await matchingService_1.MatchingService.getUserMatches(userWithNoMatches._id.toString());
            expect(result.matches).toHaveLength(0);
            expect(result.total).toBe(0);
        });
    });
    describe('runAutomaticMatching', () => {
        beforeEach(async () => {
            mockAiService.calculateSimilarity.mockReturnValue(0.85);
        });
        it('should create automatic matches for recent pets', async () => {
            const result = await matchingService_1.MatchingService.runAutomaticMatching();
            expect(result.matchesCreated).toBe(1);
            expect(result.petsProcessed).toBe(2);
            const matches = await Match_1.Match.find({});
            expect(matches).toHaveLength(1);
        });
        it('should not create duplicate matches', async () => {
            // Run matching twice
            await matchingService_1.MatchingService.runAutomaticMatching();
            const result = await matchingService_1.MatchingService.runAutomaticMatching();
            expect(result.matchesCreated).toBe(0); // No new matches created
            const matches = await Match_1.Match.find({});
            expect(matches).toHaveLength(1); // Still only one match
        });
        it('should only process recent pets', async () => {
            // Make pets old
            const oldDate = new Date(Date.now() - 8 * 24 * 60 * 60 * 1000); // 8 days ago
            lostPet.createdAt = oldDate;
            foundPet.createdAt = oldDate;
            await lostPet.save();
            await foundPet.save();
            const result = await matchingService_1.MatchingService.runAutomaticMatching({ maxDays: 7 });
            expect(result.matchesCreated).toBe(0);
            expect(result.petsProcessed).toBe(0);
        });
        it('should handle AI service errors gracefully', async () => {
            mockAiService.calculateSimilarity.mockImplementation(() => {
                throw new Error('AI service error');
            });
            const result = await matchingService_1.MatchingService.runAutomaticMatching();
            expect(result.matchesCreated).toBe(0);
            expect(result.errors).toHaveLength(1);
        });
    });
    describe('getMatchStatistics', () => {
        beforeEach(async () => {
            // Create various matches with different statuses
            await new Match_1.Match({
                lostPet: lostPet._id,
                foundPet: foundPet._id,
                similarity: 0.85,
                confidence: 'high',
                status: 'pending'
            }).save();
            const anotherFoundPet = await new Pet_1.Pet({
                ...testData_1.validPetData,
                name: 'Another Found Dog',
                status: 'found',
                owner: testUser2._id
            }).save();
            await new Match_1.Match({
                lostPet: lostPet._id,
                foundPet: anotherFoundPet._id,
                similarity: 0.75,
                confidence: 'medium',
                status: 'confirmed'
            }).save();
            await new Match_1.Match({
                lostPet: lostPet._id,
                foundPet: anotherFoundPet._id,
                similarity: 0.65,
                confidence: 'low',
                status: 'rejected'
            }).save();
        });
        it('should return correct match statistics', async () => {
            const stats = await matchingService_1.MatchingService.getMatchStatistics();
            expect(stats.total).toBe(3);
            expect(stats.pending).toBe(1);
            expect(stats.confirmed).toBe(1);
            expect(stats.rejected).toBe(1);
            expect(stats.averageSimilarity).toBeCloseTo(0.75, 2);
        });
        it('should filter statistics by date range', async () => {
            const yesterday = new Date(Date.now() - 24 * 60 * 60 * 1000);
            const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000);
            const stats = await matchingService_1.MatchingService.getMatchStatistics({
                startDate: yesterday,
                endDate: tomorrow
            });
            expect(stats.total).toBe(3);
        });
        it('should handle empty results', async () => {
            await Match_1.Match.deleteMany({});
            const stats = await matchingService_1.MatchingService.getMatchStatistics();
            expect(stats.total).toBe(0);
            expect(stats.pending).toBe(0);
            expect(stats.confirmed).toBe(0);
            expect(stats.rejected).toBe(0);
            expect(stats.averageSimilarity).toBe(0);
        });
    });
    describe('Confidence Level Calculation', () => {
        it('should calculate high confidence for high similarity', () => {
            const confidence = matchingService_1.MatchingService.calculateConfidence(0.9);
            expect(confidence).toBe('high');
        });
        it('should calculate medium confidence for medium similarity', () => {
            const confidence = matchingService_1.MatchingService.calculateConfidence(0.75);
            expect(confidence).toBe('medium');
        });
        it('should calculate low confidence for low similarity', () => {
            const confidence = matchingService_1.MatchingService.calculateConfidence(0.6);
            expect(confidence).toBe('low');
        });
    });
    describe('Location Distance Calculation', () => {
        it('should calculate distance between coordinates correctly', () => {
            const distance = matchingService_1.MatchingService.calculateDistance([0, 0], [0, 1]);
            expect(distance).toBeCloseTo(111.32, 1); // ~111km for 1 degree latitude
        });
        it('should handle same coordinates', () => {
            const distance = matchingService_1.MatchingService.calculateDistance([0, 0], [0, 0]);
            expect(distance).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXJ2aWNlc1xcbWF0Y2hpbmdTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFTQSx5QkFBeUI7QUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQzFDLElBQUksQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztBQVg3Qyx3RUFBcUU7QUFDckUsOENBQWlEO0FBQ2pELGdEQUFvRDtBQUNwRCxrREFBdUQ7QUFDdkQsNERBQXlEO0FBQ3pELGtFQUErRDtBQUMvRCxnREFBZ0U7QUFDaEUsd0RBQWdDO0FBTWhDLE1BQU0sYUFBYSxHQUFHLHFCQUEwQyxDQUFDO0FBQ2pFLE1BQU0sZ0JBQWdCLEdBQUcsMkJBQWdELENBQUM7QUFFMUUsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtJQUMvQixJQUFJLFNBQWdCLENBQUM7SUFDckIsSUFBSSxTQUFnQixDQUFDO0lBQ3JCLElBQUksT0FBYSxDQUFDO0lBQ2xCLElBQUksUUFBYyxDQUFDO0lBRW5CLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLFdBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUIsTUFBTSxTQUFHLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sYUFBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUzQixTQUFTLEdBQUcsTUFBTSxJQUFJLFdBQUksQ0FBQyx3QkFBYSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakQsU0FBUyxHQUFHLE1BQU0sSUFBSSxXQUFJLENBQUM7WUFDekIsR0FBRyx3QkFBYTtZQUNoQixLQUFLLEVBQUUsbUJBQW1CO1NBQzNCLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVWLE9BQU8sR0FBRyxNQUFNLElBQUks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RSxHQUFHLEVBQUU7UUFDN0MsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEdBQUcsRUFBRTtZQUNqRSxNQUFNLFFBQVEsR0FBRyxpQ0FBZSxDQUFDLGlCQUFpQixDQUNoRCxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFDTixDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FDUCxDQUFDO1lBRUYsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQywrQkFBK0I7UUFDMUUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1lBQ3hDLE1BQU0sUUFBUSxHQUFHLGlDQUFlLENBQUMsaUJBQWlCLENBQ2hELENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUNOLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUNQLENBQUM7WUFFRixNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXFVzZXJcXERlc2t0b3BcXHRyYWVwcm9qZWN0XFx0ZXN0MlxccGV0LWZpbmRlci1hcHBcXGJhY2tlbmRcXHRlc3RcXHNlcnZpY2VzXFxtYXRjaGluZ1NlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNYXRjaGluZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2VydmljZXMvbWF0Y2hpbmdTZXJ2aWNlJztcbmltcG9ydCB7IFBldCwgSVBldCB9IGZyb20gJy4uLy4uL3NyYy9tb2RlbHMvUGV0JztcbmltcG9ydCB7IFVzZXIsIElVc2VyIH0gZnJvbSAnLi4vLi4vc3JjL21vZGVscy9Vc2VyJztcbmltcG9ydCB7IE1hdGNoLCBJTWF0Y2ggfSBmcm9tICcuLi8uLi9zcmMvbW9kZWxzL01hdGNoJztcbmltcG9ydCB7IGFpU2VydmljZSB9IGZyb20gJy4uLy4uL3NyYy9zZXJ2aWNlcy9haVNlcnZpY2UnO1xuaW1wb3J0IHsgRW1haWxTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2VtYWlsU2VydmljZSc7XG5pbXBvcnQgeyB2YWxpZFVzZXJEYXRhLCB2YWxpZFBldERhdGEgfSBmcm9tICcuLi91dGlscy90ZXN0RGF0YSc7XG5pbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuXG4vLyBNb2NrIGV4dGVybmFsIHNlcnZpY2VzXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9zZXJ2aWNlcy9haVNlcnZpY2UnKTtcbmplc3QubW9jaygnLi4vLi4vc3JjL3NlcnZpY2VzL2VtYWlsU2VydmljZScpO1xuXG5jb25zdCBtb2NrQWlTZXJ2aWNlID0gYWlTZXJ2aWNlIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBhaVNlcnZpY2U+O1xuY29uc3QgbW9ja0VtYWlsU2VydmljZSA9IEVtYWlsU2VydmljZSBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgRW1haWxTZXJ2aWNlPjtcblxuZGVzY3JpYmUoJ01hdGNoaW5nU2VydmljZScsICgpID0+IHtcbiAgbGV0IHRlc3RVc2VyMTogSVVzZXI7XG4gIGxldCB0ZXN0VXNlcjI6IElVc2VyO1xuICBsZXQgbG9zdFBldDogSVBldDtcbiAgbGV0IGZvdW5kUGV0OiBJUGV0O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IFVzZXIuZGVsZXRlTWFueSh7fSk7XG4gICAgYXdhaXQgUGV0LmRlbGV0ZU1hbnkoe30pO1xuICAgIGF3YWl0IE1hdGNoLmRlbGV0ZU1hbnkoe30pO1xuICAgIFxuICAgIHRlc3RVc2VyMSA9IGF3YWl0IG5ldyBVc2VyKHZhbGlkVXNlckRhdGEpLnNhdmUoKTtcbiAgICB0ZXN0VXNlcjIgPSBhd2FpdCBuZXcgVXNlcih7XG4gICAgICAuLi52YWxpZFVzZXJEYXRhLFxuICAgICAgZW1haWw6ICd1c2VyMkBleGFtcGxlLmNvbSdcbiAgICB9KS5zYXZlKCk7XG4gICAgXG4gICAgbG9zdFBldCA9IGF3YWl0IG5ldyBQZXQoe1xuICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgbmFtZTogJ0xvc3QgRG9nJyxcbiAgICAgIHN0YXR1czogJ2xvc3QnLFxuICAgICAgb3duZXI6IHRlc3RVc2VyMS5faWQsXG4gICAgICBhaURhdGE6IHtcbiAgICAgICAgYnJlZWQ6ICdHb2xkZW4gUmV0cmlldmVyJyxcbiAgICAgICAgY29uZmlkZW5jZTogMC45LFxuICAgICAgICBmZWF0dXJlczogWzAuMSwgMC4yLCAwLjMsIDAuNCwgMC41XVxuICAgICAgfVxuICAgIH0pLnNhdmUoKTtcbiAgICBcbiAgICBmb3VuZFBldCA9IGF3YWl0IG5ldyBQZXQoe1xuICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgbmFtZTogJ0ZvdW5kIERvZycsXG4gICAgICBzdGF0dXM6ICdmb3VuZCcsXG4gICAgICBvd25lcjogdGVzdFVzZXIyLl9pZCxcbiAgICAgIGFpRGF0YToge1xuICAgICAgICBicmVlZDogJ0dvbGRlbiBSZXRyaWV2ZXInLFxuICAgICAgICBjb25maWRlbmNlOiAwLjg1LFxuICAgICAgICBmZWF0dXJlczogWzAuMTIsIDAuMTgsIDAuMzIsIDAuMzgsIDAuNTJdXG4gICAgICB9XG4gICAgfSkuc2F2ZSgpO1xuICAgIFxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IFVzZXIuZGVsZXRlTWFueSh7fSk7XG4gICAgYXdhaXQgUGV0LmRlbGV0ZU1hbnkoe30pO1xuICAgIGF3YWl0IE1hdGNoLmRlbGV0ZU1hbnkoe30pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZFBvdGVudGlhbE1hdGNoZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmaW5kIHBvdGVudGlhbCBtYXRjaGVzIGZvciBsb3N0IHBldCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBaVNlcnZpY2UuY2FsY3VsYXRlU2ltaWxhcml0eS5tb2NrUmV0dXJuVmFsdWUoMC44NSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UuZmluZFBvdGVudGlhbE1hdGNoZXMobG9zdFBldC5faWQudG9TdHJpbmcoKSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtYXRjaGVzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QobWF0Y2hlc1swXS5mb3VuZFBldC5faWQudG9TdHJpbmcoKSkudG9CZShmb3VuZFBldC5faWQudG9TdHJpbmcoKSk7XG4gICAgICBleHBlY3QobWF0Y2hlc1swXS5zaW1pbGFyaXR5KS50b0JlKDAuODUpO1xuICAgICAgZXhwZWN0KG1hdGNoZXNbMF0uY29uZmlkZW5jZSkudG9CZSgnaGlnaCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaW5kIHBvdGVudGlhbCBtYXRjaGVzIGZvciBmb3VuZCBwZXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQWlTZXJ2aWNlLmNhbGN1bGF0ZVNpbWlsYXJpdHkubW9ja1JldHVyblZhbHVlKDAuODUpO1xuICAgICAgXG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmZpbmRQb3RlbnRpYWxNYXRjaGVzKGZvdW5kUGV0Ll9pZC50b1N0cmluZygpKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1hdGNoZXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChtYXRjaGVzWzBdLmxvc3RQZXQuX2lkLnRvU3RyaW5nKCkpLnRvQmUobG9zdFBldC5faWQudG9TdHJpbmcoKSk7XG4gICAgICBleHBlY3QobWF0Y2hlc1swXS5zaW1pbGFyaXR5KS50b0JlKDAuODUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgbWF0Y2hlcyBieSBtaW5pbXVtIHNpbWlsYXJpdHkgdGhyZXNob2xkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FpU2VydmljZS5jYWxjdWxhdGVTaW1pbGFyaXR5Lm1vY2tSZXR1cm5WYWx1ZSgwLjUpOyAvLyBCZWxvdyBkZWZhdWx0IHRocmVzaG9sZFxuICAgICAgXG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmZpbmRQb3RlbnRpYWxNYXRjaGVzKGxvc3RQZXQuX2lkLnRvU3RyaW5nKCkpO1xuICAgICAgXG4gICAgICBleHBlY3QobWF0Y2hlcykudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgY3VzdG9tIHNpbWlsYXJpdHkgdGhyZXNob2xkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FpU2VydmljZS5jYWxjdWxhdGVTaW1pbGFyaXR5Lm1vY2tSZXR1cm5WYWx1ZSgwLjUpO1xuICAgICAgXG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmZpbmRQb3RlbnRpYWxNYXRjaGVzKFxuICAgICAgICBsb3N0UGV0Ll9pZC50b1N0cmluZygpLFxuICAgICAgICB7IG1pblNpbWlsYXJpdHk6IDAuNCB9XG4gICAgICApO1xuICAgICAgXG4gICAgICBleHBlY3QobWF0Y2hlcykudG9IYXZlTGVuZ3RoKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmaWx0ZXIgYnkgbG9jYXRpb24gcmFkaXVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FpU2VydmljZS5jYWxjdWxhdGVTaW1pbGFyaXR5Lm1vY2tSZXR1cm5WYWx1ZSgwLjg1KTtcbiAgICAgIFxuICAgICAgLy8gU2V0IGRpZmZlcmVudCBsb2NhdGlvbnNcbiAgICAgIGxvc3RQZXQubG9jYXRpb24uY29vcmRpbmF0ZXMgPSBbMCwgMF07XG4gICAgICBmb3VuZFBldC5sb2NhdGlvbi5jb29yZGluYXRlcyA9IFsxLCAxXTsgLy8gfjE1N2ttIGF3YXlcbiAgICAgIGF3YWl0IGxvc3RQZXQuc2F2ZSgpO1xuICAgICAgYXdhaXQgZm91bmRQZXQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmZpbmRQb3RlbnRpYWxNYXRjaGVzKFxuICAgICAgICBsb3N0UGV0Ll9pZC50b1N0cmluZygpLFxuICAgICAgICB7IG1heERpc3RhbmNlOiAxMDAgfSAvLyAxMDBrbSByYWRpdXNcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtYXRjaGVzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBieSBkYXRlIHJhbmdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FpU2VydmljZS5jYWxjdWxhdGVTaW1pbGFyaXR5Lm1vY2tSZXR1cm5WYWx1ZSgwLjg1KTtcbiAgICAgIFxuICAgICAgLy8gU2V0IGZvdW5kIHBldCB0byBiZSByZXBvcnRlZCBtdWNoIGxhdGVyXG4gICAgICBmb3VuZFBldC5jcmVhdGVkQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTAgKiAyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8gMTAgZGF5cyBsYXRlclxuICAgICAgYXdhaXQgZm91bmRQZXQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmZpbmRQb3RlbnRpYWxNYXRjaGVzKFxuICAgICAgICBsb3N0UGV0Ll9pZC50b1N0cmluZygpLFxuICAgICAgICB7IG1heERheXM6IDUgfVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1hdGNoZXMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc29ydCBtYXRjaGVzIGJ5IHNpbWlsYXJpdHkgc2NvcmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYW5vdGhlciBmb3VuZCBwZXQgd2l0aCBsb3dlciBzaW1pbGFyaXR5XG4gICAgICBjb25zdCBmb3VuZFBldDIgPSBhd2FpdCBuZXcgUGV0KHtcbiAgICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgICBuYW1lOiAnRm91bmQgRG9nIDInLFxuICAgICAgICBzdGF0dXM6ICdmb3VuZCcsXG4gICAgICAgIG93bmVyOiB0ZXN0VXNlcjIuX2lkLFxuICAgICAgICBhaURhdGE6IHtcbiAgICAgICAgICBicmVlZDogJ0xhYnJhZG9yJyxcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjgsXG4gICAgICAgICAgZmVhdHVyZXM6IFswLjUsIDAuNiwgMC43LCAwLjgsIDAuOV1cbiAgICAgICAgfVxuICAgICAgfSkuc2F2ZSgpO1xuICAgICAgXG4gICAgICBtb2NrQWlTZXJ2aWNlLmNhbGN1bGF0ZVNpbWlsYXJpdHlcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoMC44NSkgLy8gRmlyc3QgcGV0XG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKDAuNzUpOyAvLyBTZWNvbmQgcGV0XG4gICAgICBcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UuZmluZFBvdGVudGlhbE1hdGNoZXMobG9zdFBldC5faWQudG9TdHJpbmcoKSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtYXRjaGVzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QobWF0Y2hlc1swXS5zaW1pbGFyaXR5KS50b0JlR3JlYXRlclRoYW4obWF0Y2hlc1sxXS5zaW1pbGFyaXR5KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHBldCB3aXRob3V0IEFJIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsb3N0UGV0LmFpRGF0YSA9IHVuZGVmaW5lZDtcbiAgICAgIGF3YWl0IGxvc3RQZXQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmZpbmRQb3RlbnRpYWxNYXRjaGVzKGxvc3RQZXQuX2lkLnRvU3RyaW5nKCkpO1xuICAgICAgXG4gICAgICBleHBlY3QobWF0Y2hlcykudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleGNsdWRlIHBldHMgZnJvbSBzYW1lIG93bmVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgZm91bmRQZXQub3duZXIgPSB0ZXN0VXNlcjEuX2lkOyAvLyBTYW1lIG93bmVyIGFzIGxvc3QgcGV0XG4gICAgICBhd2FpdCBmb3VuZFBldC5zYXZlKCk7XG4gICAgICBcbiAgICAgIG1vY2tBaVNlcnZpY2UuY2FsY3VsYXRlU2ltaWxhcml0eS5tb2NrUmV0dXJuVmFsdWUoMC45NSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UuZmluZFBvdGVudGlhbE1hdGNoZXMobG9zdFBldC5faWQudG9TdHJpbmcoKSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtYXRjaGVzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVNYXRjaCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBtYXRjaCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYXRjaERhdGEgPSB7XG4gICAgICAgIGxvc3RQZXRJZDogbG9zdFBldC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgZm91bmRQZXRJZDogZm91bmRQZXQuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHNpbWlsYXJpdHk6IDAuODUsXG4gICAgICAgIGNvbmZpZGVuY2U6ICdoaWdoJyBhcyBjb25zdFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgbWF0Y2ggPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UuY3JlYXRlTWF0Y2gobWF0Y2hEYXRhKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1hdGNoKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1hdGNoLmxvc3RQZXQudG9TdHJpbmcoKSkudG9CZShsb3N0UGV0Ll9pZC50b1N0cmluZygpKTtcbiAgICAgIGV4cGVjdChtYXRjaC5mb3VuZFBldC50b1N0cmluZygpKS50b0JlKGZvdW5kUGV0Ll9pZC50b1N0cmluZygpKTtcbiAgICAgIGV4cGVjdChtYXRjaC5zaW1pbGFyaXR5KS50b0JlKDAuODUpO1xuICAgICAgZXhwZWN0KG1hdGNoLnN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGR1cGxpY2F0ZSBtYXRjaGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWF0Y2hEYXRhID0ge1xuICAgICAgICBsb3N0UGV0SWQ6IGxvc3RQZXQuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIGZvdW5kUGV0SWQ6IGZvdW5kUGV0Ll9pZC50b1N0cmluZygpLFxuICAgICAgICBzaW1pbGFyaXR5OiAwLjg1LFxuICAgICAgICBjb25maWRlbmNlOiAnaGlnaCcgYXMgY29uc3RcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGF3YWl0IE1hdGNoaW5nU2VydmljZS5jcmVhdGVNYXRjaChtYXRjaERhdGEpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoTWF0Y2hpbmdTZXJ2aWNlLmNyZWF0ZU1hdGNoKG1hdGNoRGF0YSkpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ+mFjeWwjeW3suWtmOWcqCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZW5kIG5vdGlmaWNhdGlvbiBlbWFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYXRjaERhdGEgPSB7XG4gICAgICAgIGxvc3RQZXRJZDogbG9zdFBldC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgZm91bmRQZXRJZDogZm91bmRQZXQuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHNpbWlsYXJpdHk6IDAuODUsXG4gICAgICAgIGNvbmZpZGVuY2U6ICdoaWdoJyBhcyBjb25zdFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmNyZWF0ZU1hdGNoKG1hdGNoRGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrRW1haWxTZXJ2aWNlLnNlbmRQZXRNYXRjaE5vdGlmaWNhdGlvbikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgZXhwZWN0KG1vY2tFbWFpbFNlcnZpY2Uuc2VuZFBldE1hdGNoTm90aWZpY2F0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgdGVzdFVzZXIxLmVtYWlsLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgbG9zdFBldDogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBuYW1lOiAnTG9zdCBEb2cnIH0pLFxuICAgICAgICAgIGZvdW5kUGV0OiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IG5hbWU6ICdGb3VuZCBEb2cnIH0pXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1haWwgbm90aWZpY2F0aW9uIGZhaWx1cmVzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRW1haWxTZXJ2aWNlLnNlbmRQZXRNYXRjaE5vdGlmaWNhdGlvbi5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IEVycm9yKCdFbWFpbCBzZXJ2aWNlIHVuYXZhaWxhYmxlJylcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1hdGNoRGF0YSA9IHtcbiAgICAgICAgbG9zdFBldElkOiBsb3N0UGV0Ll9pZC50b1N0cmluZygpLFxuICAgICAgICBmb3VuZFBldElkOiBmb3VuZFBldC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgc2ltaWxhcml0eTogMC44NSxcbiAgICAgICAgY29uZmlkZW5jZTogJ2hpZ2gnIGFzIGNvbnN0XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgbm90IHRocm93IGVycm9yIGV2ZW4gaWYgZW1haWwgZmFpbHNcbiAgICAgIGNvbnN0IG1hdGNoID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmNyZWF0ZU1hdGNoKG1hdGNoRGF0YSk7XG4gICAgICBleHBlY3QobWF0Y2gpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHBldCBleGlzdGVuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub25FeGlzdGVudElkID0gbmV3IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkKCkudG9TdHJpbmcoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KE1hdGNoaW5nU2VydmljZS5jcmVhdGVNYXRjaCh7XG4gICAgICAgIGxvc3RQZXRJZDogbm9uRXhpc3RlbnRJZCxcbiAgICAgICAgZm91bmRQZXRJZDogZm91bmRQZXQuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHNpbWlsYXJpdHk6IDAuODUsXG4gICAgICAgIGNvbmZpZGVuY2U6ICdoaWdoJ1xuICAgICAgfSkpLnJlamVjdHMudG9UaHJvdygn5a+154mp5LiN5a2Y5ZyoJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHBldCBzdGF0dXNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGZvdW5kUGV0LnN0YXR1cyA9ICdsb3N0JzsgLy8gQm90aCBwZXRzIGFyZSBsb3N0XG4gICAgICBhd2FpdCBmb3VuZFBldC5zYXZlKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChNYXRjaGluZ1NlcnZpY2UuY3JlYXRlTWF0Y2goe1xuICAgICAgICBsb3N0UGV0SWQ6IGxvc3RQZXQuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIGZvdW5kUGV0SWQ6IGZvdW5kUGV0Ll9pZC50b1N0cmluZygpLFxuICAgICAgICBzaW1pbGFyaXR5OiAwLjg1LFxuICAgICAgICBjb25maWRlbmNlOiAnaGlnaCdcbiAgICAgIH0pKS5yZWplY3RzLnRvVGhyb3coJ+eEoeaViOeahOWvteeJqeeLgOaFiycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0TWF0Y2hCeUlkJywgKCkgPT4ge1xuICAgIGxldCB0ZXN0TWF0Y2g6IElNYXRjaDtcblxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgdGVzdE1hdGNoID0gYXdhaXQgbmV3IE1hdGNoKHtcbiAgICAgICAgbG9zdFBldDogbG9zdFBldC5faWQsXG4gICAgICAgIGZvdW5kUGV0OiBmb3VuZFBldC5faWQsXG4gICAgICAgIHNpbWlsYXJpdHk6IDAuODUsXG4gICAgICAgIGNvbmZpZGVuY2U6ICdoaWdoJyxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcbiAgICAgIH0pLnNhdmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IG1hdGNoIGJ5IElEIHdpdGggcG9wdWxhdGVkIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYXRjaCA9IGF3YWl0IE1hdGNoaW5nU2VydmljZS5nZXRNYXRjaEJ5SWQodGVzdE1hdGNoLl9pZC50b1N0cmluZygpKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1hdGNoKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1hdGNoPy5sb3N0UGV0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1hdGNoPy5mb3VuZFBldCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgbWF0Y2g/Lmxvc3RQZXQpLnRvQmUoJ29iamVjdCcpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBtYXRjaD8uZm91bmRQZXQpLnRvQmUoJ29iamVjdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBmb3Igbm9uLWV4aXN0ZW50IG1hdGNoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm9uRXhpc3RlbnRJZCA9IG5ldyBtb25nb29zZS5UeXBlcy5PYmplY3RJZCgpLnRvU3RyaW5nKCk7XG4gICAgICBjb25zdCBtYXRjaCA9IGF3YWl0IE1hdGNoaW5nU2VydmljZS5nZXRNYXRjaEJ5SWQobm9uRXhpc3RlbnRJZCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtYXRjaCkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZU1hdGNoU3RhdHVzJywgKCkgPT4ge1xuICAgIGxldCB0ZXN0TWF0Y2g6IElNYXRjaDtcblxuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgdGVzdE1hdGNoID0gYXdhaXQgbmV3IE1hdGNoKHtcbiAgICAgICAgbG9zdFBldDogbG9zdFBldC5faWQsXG4gICAgICAgIGZvdW5kUGV0OiBmb3VuZFBldC5faWQsXG4gICAgICAgIHNpbWlsYXJpdHk6IDAuODUsXG4gICAgICAgIGNvbmZpZGVuY2U6ICdoaWdoJyxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcbiAgICAgIH0pLnNhdmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29uZmlybSBtYXRjaCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVkTWF0Y2ggPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UudXBkYXRlTWF0Y2hTdGF0dXMoXG4gICAgICAgIHRlc3RNYXRjaC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgdGVzdFVzZXIxLl9pZC50b1N0cmluZygpLFxuICAgICAgICAnY29uZmlybWVkJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHVwZGF0ZWRNYXRjaD8uc3RhdHVzKS50b0JlKCdjb25maXJtZWQnKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkTWF0Y2g/LmNvbmZpcm1lZEF0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRNYXRjaD8uY29uZmlybWVkQnkudG9TdHJpbmcoKSkudG9CZSh0ZXN0VXNlcjEuX2lkLnRvU3RyaW5nKCkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgbWF0Y2ggc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlZE1hdGNoID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLnVwZGF0ZU1hdGNoU3RhdHVzKFxuICAgICAgICB0ZXN0TWF0Y2guX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHRlc3RVc2VyMS5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgJ3JlamVjdGVkJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHVwZGF0ZWRNYXRjaD8uc3RhdHVzKS50b0JlKCdyZWplY3RlZCcpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRNYXRjaD8ucmVqZWN0ZWRBdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgb25seSBhbGxvdyBwZXQgb3duZXJzIHRvIHVwZGF0ZSBtYXRjaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVuYXV0aG9yaXplZFVzZXIgPSBhd2FpdCBuZXcgVXNlcih7XG4gICAgICAgIC4uLnZhbGlkVXNlckRhdGEsXG4gICAgICAgIGVtYWlsOiAndW5hdXRob3JpemVkQGV4YW1wbGUuY29tJ1xuICAgICAgfSkuc2F2ZSgpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoTWF0Y2hpbmdTZXJ2aWNlLnVwZGF0ZU1hdGNoU3RhdHVzKFxuICAgICAgICB0ZXN0TWF0Y2guX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHVuYXV0aG9yaXplZFVzZXIuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICdjb25maXJtZWQnXG4gICAgICApKS5yZWplY3RzLnRvVGhyb3coJ+eEoeasiumZkCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgYWxsb3cgdXBkYXRpbmcgYWxyZWFkeSBjb25maXJtZWQgbWF0Y2gnLCBhc3luYyAoKSA9PiB7XG4gICAgICB0ZXN0TWF0Y2guc3RhdHVzID0gJ2NvbmZpcm1lZCc7XG4gICAgICBhd2FpdCB0ZXN0TWF0Y2guc2F2ZSgpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoTWF0Y2hpbmdTZXJ2aWNlLnVwZGF0ZU1hdGNoU3RhdHVzKFxuICAgICAgICB0ZXN0TWF0Y2guX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHRlc3RVc2VyMS5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgJ3JlamVjdGVkJ1xuICAgICAgKSkucmVqZWN0cy50b1Rocm93KCfphY3lsI3lt7LntpPomZXnkIbpgY7kuoYnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG5vbi1leGlzdGVudCBtYXRjaCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vbkV4aXN0ZW50SWQgPSBuZXcgbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQoKS50b1N0cmluZygpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoTWF0Y2hpbmdTZXJ2aWNlLnVwZGF0ZU1hdGNoU3RhdHVzKFxuICAgICAgICBub25FeGlzdGVudElkLFxuICAgICAgICB0ZXN0VXNlcjEuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICdjb25maXJtZWQnXG4gICAgICApKS5yZWplY3RzLnRvVGhyb3coJ+mFjeWwjeS4jeWtmOWcqCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VXNlck1hdGNoZXMnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgbXVsdGlwbGUgbWF0Y2hlc1xuICAgICAgYXdhaXQgbmV3IE1hdGNoKHtcbiAgICAgICAgbG9zdFBldDogbG9zdFBldC5faWQsXG4gICAgICAgIGZvdW5kUGV0OiBmb3VuZFBldC5faWQsXG4gICAgICAgIHNpbWlsYXJpdHk6IDAuODUsXG4gICAgICAgIGNvbmZpZGVuY2U6ICdoaWdoJyxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcbiAgICAgIH0pLnNhdmUoKTtcbiAgICAgIFxuICAgICAgY29uc3QgYW5vdGhlckZvdW5kUGV0ID0gYXdhaXQgbmV3IFBldCh7XG4gICAgICAgIC4uLnZhbGlkUGV0RGF0YSxcbiAgICAgICAgbmFtZTogJ0Fub3RoZXIgRm91bmQgRG9nJyxcbiAgICAgICAgc3RhdHVzOiAnZm91bmQnLFxuICAgICAgICBvd25lcjogdGVzdFVzZXIyLl9pZFxuICAgICAgfSkuc2F2ZSgpO1xuICAgICAgXG4gICAgICBhd2FpdCBuZXcgTWF0Y2goe1xuICAgICAgICBsb3N0UGV0OiBsb3N0UGV0Ll9pZCxcbiAgICAgICAgZm91bmRQZXQ6IGFub3RoZXJGb3VuZFBldC5faWQsXG4gICAgICAgIHNpbWlsYXJpdHk6IDAuNzUsXG4gICAgICAgIGNvbmZpZGVuY2U6ICdtZWRpdW0nLFxuICAgICAgICBzdGF0dXM6ICdjb25maXJtZWQnXG4gICAgICB9KS5zYXZlKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBhbGwgbWF0Y2hlcyBmb3IgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE1hdGNoaW5nU2VydmljZS5nZXRVc2VyTWF0Y2hlcyh0ZXN0VXNlcjEuX2lkLnRvU3RyaW5nKCkpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0Lm1hdGNoZXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWwpLnRvQmUoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZpbHRlciBtYXRjaGVzIGJ5IHN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE1hdGNoaW5nU2VydmljZS5nZXRVc2VyTWF0Y2hlcyhcbiAgICAgICAgdGVzdFVzZXIxLl9pZC50b1N0cmluZygpLFxuICAgICAgICB7IHN0YXR1czogJ3BlbmRpbmcnIH1cbiAgICAgICk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQubWF0Y2hlcykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tYXRjaGVzWzBdLnN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwYWdpbmF0ZSBtYXRjaGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmdldFVzZXJNYXRjaGVzKFxuICAgICAgICB0ZXN0VXNlcjEuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHsgcGFnZTogMSwgbGltaXQ6IDEgfVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5tYXRjaGVzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsUGFnZXMpLnRvQmUoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNvcnQgbWF0Y2hlcyBieSBjcmVhdGlvbiBkYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmdldFVzZXJNYXRjaGVzKFxuICAgICAgICB0ZXN0VXNlcjEuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgIHsgc29ydEJ5OiAnY3JlYXRlZEF0Jywgc29ydE9yZGVyOiAnZGVzYycgfVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5tYXRjaGVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDEpO1xuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCByZXN1bHQubWF0Y2hlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBleHBlY3QocmVzdWx0Lm1hdGNoZXNbaS0xXS5jcmVhdGVkQXQuZ2V0VGltZSgpKVxuICAgICAgICAgIC50b0JlR3JlYXRlclRoYW5PckVxdWFsKHJlc3VsdC5tYXRjaGVzW2ldLmNyZWF0ZWRBdC5nZXRUaW1lKCkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdXNlciB3aXRoIG5vIG1hdGNoZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyV2l0aE5vTWF0Y2hlcyA9IGF3YWl0IG5ldyBVc2VyKHtcbiAgICAgICAgLi4udmFsaWRVc2VyRGF0YSxcbiAgICAgICAgZW1haWw6ICdub21hdGNoQGV4YW1wbGUuY29tJ1xuICAgICAgfSkuc2F2ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UuZ2V0VXNlck1hdGNoZXModXNlcldpdGhOb01hdGNoZXMuX2lkLnRvU3RyaW5nKCkpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0Lm1hdGNoZXMpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWwpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdydW5BdXRvbWF0aWNNYXRjaGluZycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBaVNlcnZpY2UuY2FsY3VsYXRlU2ltaWxhcml0eS5tb2NrUmV0dXJuVmFsdWUoMC44NSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhdXRvbWF0aWMgbWF0Y2hlcyBmb3IgcmVjZW50IHBldHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UucnVuQXV0b21hdGljTWF0Y2hpbmcoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5tYXRjaGVzQ3JlYXRlZCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGV0c1Byb2Nlc3NlZCkudG9CZSgyKTtcbiAgICAgIFxuICAgICAgY29uc3QgbWF0Y2hlcyA9IGF3YWl0IE1hdGNoLmZpbmQoe30pO1xuICAgICAgZXhwZWN0KG1hdGNoZXMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGNyZWF0ZSBkdXBsaWNhdGUgbWF0Y2hlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFJ1biBtYXRjaGluZyB0d2ljZVxuICAgICAgYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLnJ1bkF1dG9tYXRpY01hdGNoaW5nKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UucnVuQXV0b21hdGljTWF0Y2hpbmcoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5tYXRjaGVzQ3JlYXRlZCkudG9CZSgwKTsgLy8gTm8gbmV3IG1hdGNoZXMgY3JlYXRlZFxuICAgICAgXG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgTWF0Y2guZmluZCh7fSk7XG4gICAgICBleHBlY3QobWF0Y2hlcykudG9IYXZlTGVuZ3RoKDEpOyAvLyBTdGlsbCBvbmx5IG9uZSBtYXRjaFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBvbmx5IHByb2Nlc3MgcmVjZW50IHBldHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNYWtlIHBldHMgb2xkXG4gICAgICBjb25zdCBvbGREYXRlID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDggKiAyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8gOCBkYXlzIGFnb1xuICAgICAgbG9zdFBldC5jcmVhdGVkQXQgPSBvbGREYXRlO1xuICAgICAgZm91bmRQZXQuY3JlYXRlZEF0ID0gb2xkRGF0ZTtcbiAgICAgIGF3YWl0IGxvc3RQZXQuc2F2ZSgpO1xuICAgICAgYXdhaXQgZm91bmRQZXQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UucnVuQXV0b21hdGljTWF0Y2hpbmcoeyBtYXhEYXlzOiA3IH0pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0Lm1hdGNoZXNDcmVhdGVkKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wZXRzUHJvY2Vzc2VkKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgQUkgc2VydmljZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tBaVNlcnZpY2UuY2FsY3VsYXRlU2ltaWxhcml0eS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FJIHNlcnZpY2UgZXJyb3InKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBNYXRjaGluZ1NlcnZpY2UucnVuQXV0b21hdGljTWF0Y2hpbmcoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5tYXRjaGVzQ3JlYXRlZCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRNYXRjaFN0YXRpc3RpY3MnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgdmFyaW91cyBtYXRjaGVzIHdpdGggZGlmZmVyZW50IHN0YXR1c2VzXG4gICAgICBhd2FpdCBuZXcgTWF0Y2goe1xuICAgICAgICBsb3N0UGV0OiBsb3N0UGV0Ll9pZCxcbiAgICAgICAgZm91bmRQZXQ6IGZvdW5kUGV0Ll9pZCxcbiAgICAgICAgc2ltaWxhcml0eTogMC44NSxcbiAgICAgICAgY29uZmlkZW5jZTogJ2hpZ2gnLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJ1xuICAgICAgfSkuc2F2ZSgpO1xuICAgICAgXG4gICAgICBjb25zdCBhbm90aGVyRm91bmRQZXQgPSBhd2FpdCBuZXcgUGV0KHtcbiAgICAgICAgLi4udmFsaWRQZXREYXRhLFxuICAgICAgICBuYW1lOiAnQW5vdGhlciBGb3VuZCBEb2cnLFxuICAgICAgICBzdGF0dXM6ICdmb3VuZCcsXG4gICAgICAgIG93bmVyOiB0ZXN0VXNlcjIuX2lkXG4gICAgICB9KS5zYXZlKCk7XG4gICAgICBcbiAgICAgIGF3YWl0IG5ldyBNYXRjaCh7XG4gICAgICAgIGxvc3RQZXQ6IGxvc3RQZXQuX2lkLFxuICAgICAgICBmb3VuZFBldDogYW5vdGhlckZvdW5kUGV0Ll9pZCxcbiAgICAgICAgc2ltaWxhcml0eTogMC43NSxcbiAgICAgICAgY29uZmlkZW5jZTogJ21lZGl1bScsXG4gICAgICAgIHN0YXR1czogJ2NvbmZpcm1lZCdcbiAgICAgIH0pLnNhdmUoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgbmV3IE1hdGNoKHtcbiAgICAgICAgbG9zdFBldDogbG9zdFBldC5faWQsXG4gICAgICAgIGZvdW5kUGV0OiBhbm90aGVyRm91bmRQZXQuX2lkLFxuICAgICAgICBzaW1pbGFyaXR5OiAwLjY1LFxuICAgICAgICBjb25maWRlbmNlOiAnbG93JyxcbiAgICAgICAgc3RhdHVzOiAncmVqZWN0ZWQnXG4gICAgICB9KS5zYXZlKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0IG1hdGNoIHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IE1hdGNoaW5nU2VydmljZS5nZXRNYXRjaFN0YXRpc3RpY3MoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLnBlbmRpbmcpLnRvQmUoMSk7XG4gICAgICBleHBlY3Qoc3RhdHMuY29uZmlybWVkKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLnJlamVjdGVkKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLmF2ZXJhZ2VTaW1pbGFyaXR5KS50b0JlQ2xvc2VUbygwLjc1LCAyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmlsdGVyIHN0YXRpc3RpY3MgYnkgZGF0ZSByYW5nZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHllc3RlcmRheSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgIGNvbnN0IHRvbW9ycm93ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IE1hdGNoaW5nU2VydmljZS5nZXRNYXRjaFN0YXRpc3RpY3Moe1xuICAgICAgICBzdGFydERhdGU6IHllc3RlcmRheSxcbiAgICAgICAgZW5kRGF0ZTogdG9tb3Jyb3dcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWwpLnRvQmUoMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSByZXN1bHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgTWF0Y2guZGVsZXRlTWFueSh7fSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgTWF0Y2hpbmdTZXJ2aWNlLmdldE1hdGNoU3RhdGlzdGljcygpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3RhdHMudG90YWwpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMucGVuZGluZykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdGF0cy5jb25maXJtZWQpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMucmVqZWN0ZWQpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuYXZlcmFnZVNpbWlsYXJpdHkpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb25maWRlbmNlIExldmVsIENhbGN1bGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGhpZ2ggY29uZmlkZW5jZSBmb3IgaGlnaCBzaW1pbGFyaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlkZW5jZSA9IE1hdGNoaW5nU2VydmljZS5jYWxjdWxhdGVDb25maWRlbmNlKDAuOSk7XG4gICAgICBleHBlY3QoY29uZmlkZW5jZSkudG9CZSgnaGlnaCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgbWVkaXVtIGNvbmZpZGVuY2UgZm9yIG1lZGl1bSBzaW1pbGFyaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlkZW5jZSA9IE1hdGNoaW5nU2VydmljZS5jYWxjdWxhdGVDb25maWRlbmNlKDAuNzUpO1xuICAgICAgZXhwZWN0KGNvbmZpZGVuY2UpLnRvQmUoJ21lZGl1bScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgbG93IGNvbmZpZGVuY2UgZm9yIGxvdyBzaW1pbGFyaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlkZW5jZSA9IE1hdGNoaW5nU2VydmljZS5jYWxjdWxhdGVDb25maWRlbmNlKDAuNik7XG4gICAgICBleHBlY3QoY29uZmlkZW5jZSkudG9CZSgnbG93Jyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdMb2NhdGlvbiBEaXN0YW5jZSBDYWxjdWxhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBkaXN0YW5jZSBiZXR3ZWVuIGNvb3JkaW5hdGVzIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0Y2hpbmdTZXJ2aWNlLmNhbGN1bGF0ZURpc3RhbmNlKFxuICAgICAgICBbMCwgMF0sXG4gICAgICAgIFswLCAxXVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGRpc3RhbmNlKS50b0JlQ2xvc2VUbygxMTEuMzIsIDEpOyAvLyB+MTExa20gZm9yIDEgZGVncmVlIGxhdGl0dWRlXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzYW1lIGNvb3JkaW5hdGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZGlzdGFuY2UgPSBNYXRjaGluZ1NlcnZpY2UuY2FsY3VsYXRlRGlzdGFuY2UoXG4gICAgICAgIFswLCAwXSxcbiAgICAgICAgWzAsIDBdXG4gICAgICApO1xuICAgICAgXG4gICAgICBleHBlY3QoZGlzdGFuY2UpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9