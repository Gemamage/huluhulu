{"file":"C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\utils\\validation.ts","mappings":"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","names":[],"sources":["C:\\Users\\User\\Desktop\\traeproject\\test2\\pet-finder-app\\backend\\src\\utils\\validation.ts"],"sourcesContent":["import { z } from 'zod';\nimport { ErrorFactory } from './errors';\n\n// 重新導出 schemas（為了向後兼容）\nexport * from '../schemas';\n\n\n\n// 驗證中介軟體輔助函數\nexport const validateRequest = (schema: z.ZodSchema) => {\n  return (req: any, res: any, next: any) => {\n    try {\n      const validatedData = schema.parse(req.body);\n      req.validatedData = validatedData;\n      next();\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const validationError = ErrorFactory.fromZodError(error);\n        return next(validationError);\n      }\n      next(error);\n    }\n  };\n};\n\n// 查詢參數驗證中介軟體\nexport const validateQuery = (schema: z.ZodSchema) => {\n  return (req: any, res: any, next: any) => {\n    try {\n      const validatedQuery = schema.parse(req.query);\n      req.validatedQuery = validatedQuery;\n      next();\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const validationError = ErrorFactory.fromZodError(error);\n        validationError.message = '查詢參數驗證失敗';\n        return next(validationError);\n      }\n      next(error);\n    }\n  };\n};\n\n// 路徑參數驗證中介軟體\nexport const validateParams = (schema: z.ZodSchema) => {\n  return (req: any, res: any, next: any) => {\n    try {\n      const validatedParams = schema.parse(req.params);\n      req.validatedParams = validatedParams;\n      next();\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        const validationError = ErrorFactory.fromZodError(error);\n        validationError.message = '路徑參數驗證失敗';\n        return next(validationError);\n      }\n      next(error);\n    }\n  };\n};\n\n// 檔案驗證中介軟體\nexport const validateFile = (\n  options: {\n    required?: boolean;\n    maxSize?: number; // bytes\n    allowedTypes?: string[];\n    fieldName?: string;\n  } = {}\n) => {\n  return (req: any, res: any, next: any) => {\n    const {\n      required = false,\n      maxSize = 5 * 1024 * 1024, // 5MB\n      allowedTypes = ['image/jpeg', 'image/png', 'image/gif'],\n      fieldName = 'file'\n    } = options;\n\n    const file = req.file || req.files?.[fieldName];\n\n    if (required && !file) {\n      const error = ErrorFactory.createValidationError(\n        '檔案為必填項目',\n        fieldName,\n        undefined,\n        'required'\n      );\n      return next(error);\n    }\n\n    if (file) {\n      // 檢查檔案大小\n      if (file.size > maxSize) {\n        const error = ErrorFactory.createValidationError(\n          `檔案大小不能超過 ${Math.round(maxSize / 1024 / 1024)}MB`,\n          fieldName,\n          file.size,\n          'maxSize'\n        );\n        return next(error);\n      }\n\n      // 檢查檔案類型\n      if (!allowedTypes.includes(file.mimetype)) {\n        const error = ErrorFactory.createValidationError(\n          `不支援的檔案類型，僅支援: ${allowedTypes.join(', ')}`,\n          fieldName,\n          file.mimetype,\n          'fileType'\n        );\n        return next(error);\n      }\n    }\n\n    next();\n  };\n};"],"version":3}