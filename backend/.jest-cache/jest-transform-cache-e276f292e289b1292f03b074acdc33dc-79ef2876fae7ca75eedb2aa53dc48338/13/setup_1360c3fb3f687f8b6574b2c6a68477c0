93594e2423940beefab645552aee7e17
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// 模擬外部服務
jest.mock('../src/services/emailService', () => ({
    EmailService: {
        sendVerificationEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendWelcomeEmail: jest.fn().mockResolvedValue(true),
        sendNotificationEmail: jest.fn().mockResolvedValue(true)
    }
}));
// cloudinaryService not implemented yet
jest.mock('../src/services/aiService', () => ({
    analyzeImage: jest.fn().mockResolvedValue({
        breed: 'Golden Retriever',
        confidence: 0.95,
        features: {
            color: 'golden',
            size: 'large',
            age: 'adult'
        }
    }),
    findSimilarPets: jest.fn().mockResolvedValue([]),
    generateSearchSuggestions: jest.fn().mockResolvedValue(['golden retriever', 'labrador'])
}));
const mongodb_memory_server_1 = require("mongodb-memory-server");
const mongoose_1 = __importDefault(require("mongoose"));
let mongod;
// 測試前設置
beforeAll(async () => {
    // 啟動內存中的 MongoDB 實例
    mongod = await mongodb_memory_server_1.MongoMemoryServer.create();
    const uri = mongod.getUri();
    // 連接到測試資料庫
    await mongoose_1.default.connect(uri);
});
// 每個測試後清理
afterEach(async () => {
    const collections = mongoose_1.default.connection.collections;
    for (const key in collections) {
        const collection = collections[key];
        await collection.deleteMany({});
    }
});
// 測試後清理
afterAll(async () => {
    await mongoose_1.default.connection.dropDatabase();
    await mongoose_1.default.connection.close();
    await mongod.stop();
});
// 設置測試環境變數
process.env.NODE_ENV = 'test';
process.env.MONGODB_URI = 'mongodb://localhost:27017/pet-finder-test';
process.env.JWT_SECRET = 'test-jwt-secret-key-with-minimum-32-characters-length';
process.env.EMAIL_FROM = 'test@example.com';
process.env.FRONTEND_URL = 'http://localhost:3000';
process.env.AWS_ACCESS_KEY_ID = 'test-access-key';
process.env.AWS_SECRET_ACCESS_KEY = 'test-secret-key';
process.env.AWS_REGION = 'us-east-1';
process.env.S3_BUCKET_NAME = 'test-bucket';
process.env.SMTP_HOST = 'smtp.test.com';
process.env.SMTP_PORT = '587';
process.env.SMTP_USER = 'test@example.com';
process.env.SMTP_PASS = 'test-password';
process.env.OPENAI_API_KEY = 'test-openai-key';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXR1cC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQWlEQSxTQUFTO0FBQ1QsSUFBSSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQy9DLFlBQVksRUFBRTtRQUNaLHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7UUFDeEQsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztRQUN6RCxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDO1FBQ25ELHFCQUFxQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUM7S0FDekQ7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLHdDQUF3QztBQUV4QyxJQUFJLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDNUMsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztRQUN4QyxLQUFLLEVBQUUsa0JBQWtCO1FBQ3pCLFVBQVUsRUFBRSxJQUFJO1FBQ2hCLFFBQVEsRUFBRTtZQUNSLEtBQUssRUFBRSxRQUFRO1lBQ2YsSUFBSSxFQUFFLE9BQU87WUFDYixHQUFHLEVBQUUsT0FBTztTQUNiO0tBQ0YsQ0FBQztJQUNGLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDO0lBQ2hELHlCQUF5QixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGtCQUFrQixFQUFFLFVBQVUsQ0FBQyxDQUFDO0NBQ3pGLENBQUMsQ0FBQyxDQUFDO0FBekVKLGlFQUEwRDtBQUMxRCx3REFBZ0M7QUFHaEMsSUFBSSxNQUF5QixDQUFDO0FBRTlCLFFBQVE7QUFDUixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDbkIsb0JBQW9CO0lBQ3BCLE1BQU0sR0FBRyxNQUFNLHlDQUFpQixDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzFDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUU1QixXQUFXO0lBQ1gsTUFBTSxrQkFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM5QixDQUFDLENBQUMsQ0FBQztBQUVILFVBQVU7QUFDVixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7SUFDbkIsTUFBTSxXQUFXLEdBQUcsa0JBQVEsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO0lBRXBELEtBQUssTUFBTSxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFDOUIsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNsQyxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCxRQUFRO0FBQ1IsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO0lBQ2xCLE1BQU0sa0JBQVEsQ0FBQyxVQUFVLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDekMsTUFBTSxrQkFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNsQyxNQUFNLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUN0QixDQUFDLENBQUMsQ0FBQztBQUVILFdBQVc7QUFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUM7QUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsMkNBQTJDLENBQUM7QUFDdEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUcsdURBQXVELENBQUM7QUFDakYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEdBQUcsa0JBQWtCLENBQUM7QUFDNUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEdBQUcsdUJBQXVCLENBQUM7QUFDbkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQztBQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixHQUFHLGlCQUFpQixDQUFDO0FBQ3RELE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQztBQUNyQyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsR0FBRyxhQUFhLENBQUM7QUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsZUFBZSxDQUFDO0FBQ3hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztBQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQztBQUMzQyxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxlQUFlLENBQUM7QUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsaUJBQWlCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEZXNrdG9wXFx0cmFlcHJvamVjdFxcdGVzdDJcXHBldC1maW5kZXItYXBwXFxiYWNrZW5kXFx0ZXN0XFxzZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNb25nb01lbW9yeVNlcnZlciB9IGZyb20gJ21vbmdvZGItbWVtb3J5LXNlcnZlcic7XG5pbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnLi4vc3JjL2NvbmZpZy9lbnZpcm9ubWVudCc7XG5cbmxldCBtb25nb2Q6IE1vbmdvTWVtb3J5U2VydmVyO1xuXG4vLyDmuKzoqabliY3oqK3nva5cbmJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gIC8vIOWVn+WLleWFp+WtmOS4reeahCBNb25nb0RCIOWvpuS+i1xuICBtb25nb2QgPSBhd2FpdCBNb25nb01lbW9yeVNlcnZlci5jcmVhdGUoKTtcbiAgY29uc3QgdXJpID0gbW9uZ29kLmdldFVyaSgpO1xuICBcbiAgLy8g6YCj5o6l5Yiw5ris6Kmm6LOH5paZ5bqrXG4gIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QodXJpKTtcbn0pO1xuXG4vLyDmr4/lgIvmuKzoqablvozmuIXnkIZcbmFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGNvbGxlY3Rpb25zID0gbW9uZ29vc2UuY29ubmVjdGlvbi5jb2xsZWN0aW9ucztcbiAgXG4gIGZvciAoY29uc3Qga2V5IGluIGNvbGxlY3Rpb25zKSB7XG4gICAgY29uc3QgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb25zW2tleV07XG4gICAgYXdhaXQgY29sbGVjdGlvbi5kZWxldGVNYW55KHt9KTtcbiAgfVxufSk7XG5cbi8vIOa4rOippuW+jOa4heeQhlxuYWZ0ZXJBbGwoYXN5bmMgKCkgPT4ge1xuICBhd2FpdCBtb25nb29zZS5jb25uZWN0aW9uLmRyb3BEYXRhYmFzZSgpO1xuICBhd2FpdCBtb25nb29zZS5jb25uZWN0aW9uLmNsb3NlKCk7XG4gIGF3YWl0IG1vbmdvZC5zdG9wKCk7XG59KTtcblxuLy8g6Kit572u5ris6Kmm55Kw5aKD6K6K5pW4XG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcbnByb2Nlc3MuZW52Lk1PTkdPREJfVVJJID0gJ21vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvcGV0LWZpbmRlci10ZXN0JztcbnByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPSAndGVzdC1qd3Qtc2VjcmV0LWtleS13aXRoLW1pbmltdW0tMzItY2hhcmFjdGVycy1sZW5ndGgnO1xucHJvY2Vzcy5lbnYuRU1BSUxfRlJPTSA9ICd0ZXN0QGV4YW1wbGUuY29tJztcbnByb2Nlc3MuZW52LkZST05URU5EX1VSTCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xucHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQgPSAndGVzdC1hY2Nlc3Mta2V5JztcbnByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWSA9ICd0ZXN0LXNlY3JldC1rZXknO1xucHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiA9ICd1cy1lYXN0LTEnO1xucHJvY2Vzcy5lbnYuUzNfQlVDS0VUX05BTUUgPSAndGVzdC1idWNrZXQnO1xucHJvY2Vzcy5lbnYuU01UUF9IT1NUID0gJ3NtdHAudGVzdC5jb20nO1xucHJvY2Vzcy5lbnYuU01UUF9QT1JUID0gJzU4Nyc7XG5wcm9jZXNzLmVudi5TTVRQX1VTRVIgPSAndGVzdEBleGFtcGxlLmNvbSc7XG5wcm9jZXNzLmVudi5TTVRQX1BBU1MgPSAndGVzdC1wYXNzd29yZCc7XG5wcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSA9ICd0ZXN0LW9wZW5haS1rZXknO1xuXG4vLyDmqKHmk6zlpJbpg6jmnI3li5lcbmplc3QubW9jaygnLi4vc3JjL3NlcnZpY2VzL2VtYWlsU2VydmljZScsICgpID0+ICh7XG4gIEVtYWlsU2VydmljZToge1xuICAgIHNlbmRWZXJpZmljYXRpb25FbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRQYXNzd29yZFJlc2V0RW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kV2VsY29tZUVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZE5vdGlmaWNhdGlvbkVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSlcbiAgfVxufSkpO1xuXG4vLyBjbG91ZGluYXJ5U2VydmljZSBub3QgaW1wbGVtZW50ZWQgeWV0XG5cbmplc3QubW9jaygnLi4vc3JjL3NlcnZpY2VzL2FpU2VydmljZScsICgpID0+ICh7XG4gIGFuYWx5emVJbWFnZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICBicmVlZDogJ0dvbGRlbiBSZXRyaWV2ZXInLFxuICAgIGNvbmZpZGVuY2U6IDAuOTUsXG4gICAgZmVhdHVyZXM6IHtcbiAgICAgIGNvbG9yOiAnZ29sZGVuJyxcbiAgICAgIHNpemU6ICdsYXJnZScsXG4gICAgICBhZ2U6ICdhZHVsdCdcbiAgICB9XG4gIH0pLFxuICBmaW5kU2ltaWxhclBldHM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG4gIGdlbmVyYXRlU2VhcmNoU3VnZ2VzdGlvbnM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbJ2dvbGRlbiByZXRyaWV2ZXInLCAnbGFicmFkb3InXSlcbn0pKTsiXSwidmVyc2lvbiI6M30=