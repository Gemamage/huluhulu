# AWS S3 設定指南

## 📋 概述

本指南將協助您設定 AWS S3 服務，用於寵物協尋網站的照片上傳功能。

## 🚀 步驟 1：創建 AWS 帳號

1. 前往 [AWS 官網](https://aws.amazon.com/)
2. 點擊「創建 AWS 帳戶」
3. 填寫必要資訊（需要信用卡驗證）
4. 完成電話驗證
5. 選擇支援方案（建議選擇免費的基本方案）

## 🪣 步驟 2：創建 S3 儲存桶

1. 登入 AWS 管理控制台
2. 搜尋並進入「S3」服務
3. 點擊「創建儲存桶」
4. 設定儲存桶：
   - **儲存桶名稱**：`pet-finder-images-[您的名字]`（必須全球唯一）
   - **AWS 區域**：選擇 `亞太區域 (東京) ap-northeast-1`
   - **物件擁有權**：選擇「ACL 已停用」
   - **封鎖公有存取設定**：取消勾選「封鎖所有公有存取」
   - 確認警告並勾選確認
5. 點擊「創建儲存桶」

## 🔐 步驟 3：設定儲存桶政策

1. 進入剛創建的儲存桶
2. 點擊「許可」標籤
3. 在「儲存桶政策」區域點擊「編輯」
4. 貼上以下政策（記得替換 `YOUR-BUCKET-NAME`）：

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::YOUR-BUCKET-NAME/*"
        }
    ]
}
```

5. 點擊「儲存變更」

## 🔑 步驟 4：創建 IAM 使用者和存取金鑰

1. 在 AWS 控制台搜尋並進入「IAM」
2. 點擊左側選單的「使用者」
3. 點擊「新增使用者」
4. 設定使用者：
   - **使用者名稱**：`pet-finder-s3-user`
   - **存取類型**：選擇「程式設計存取」
5. 設定許可：
   - 選擇「直接連接現有政策」
   - 搜尋並勾選 `AmazonS3FullAccess`
6. 檢閱並創建使用者
7. **重要**：下載或複製存取金鑰 ID 和秘密存取金鑰

## ⚙️ 步驟 5：更新環境變數

將獲得的憑證填入後端 `.env` 檔案：

```env
# AWS S3 配置
AWS_ACCESS_KEY_ID=您的存取金鑰ID
AWS_SECRET_ACCESS_KEY=您的秘密存取金鑰
AWS_REGION=ap-northeast-1
AWS_S3_BUCKET=您的儲存桶名稱
```

## 💰 費用說明

### AWS 免費方案包含：
- 每月 5GB 的 S3 標準儲存
- 每月 20,000 個 GET 請求
- 每月 2,000 個 PUT 請求
- 每月 100GB 的資料傳輸

### 超出免費額度的費用：
- 儲存：約 $0.023/GB/月
- GET 請求：$0.0004/1000 次請求
- PUT 請求：$0.005/1000 次請求

## 🔒 安全建議

1. **定期輪換存取金鑰**：建議每 90 天更換一次
2. **最小權限原則**：只給予必要的 S3 權限
3. **監控使用量**：定期檢查 AWS 帳單和使用量
4. **啟用 CloudTrail**：記錄 API 呼叫以便審計

## 🧪 測試設定

設定完成後，重新啟動後端服務器並測試照片上傳功能：

1. 重新啟動後端：`npm run dev`
2. 前往網站的寵物登記頁面
3. 嘗試上傳照片
4. 檢查 S3 儲存桶是否有新檔案

## ❗ 常見問題

### Q: 上傳失敗，顯示權限錯誤
A: 檢查 IAM 使用者是否有 S3 權限，儲存桶政策是否正確設定

### Q: 圖片無法顯示
A: 確認儲存桶政策允許公開讀取，檢查圖片 URL 是否正確

### Q: 費用過高
A: 檢查是否有異常大量的請求，考慮設定生命週期政策自動刪除舊檔案

## 📞 支援

如果遇到問題，可以：
1. 查看 AWS 文件
2. 聯繫 AWS 技術支援
3. 檢查後端日誌檔案

---

**注意**：請妥善保管您的 AWS 憑證，不要將其提交到版本控制系統中！